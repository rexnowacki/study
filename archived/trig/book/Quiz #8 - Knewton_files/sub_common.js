/*! For license information please see sub_common.js.LICENSE.txt */
(window.LearnosityAmd=window.LearnosityAmd||[]).push([[1],{133:function(t,r,a){"use strict";a.d(r,"a",(function(){return i18nTemplate}));var l=a(0),S=a.n(l);function i18nTemplate(t,r){return S.a.isEmpty(t)?"":(S()(r).forEach((function(r,a){var l="{{".concat(a,"}}");t=t.replace(l,r)})),t)}},136:function(t,r,a){"use strict";var l=a(0),S=a.n(l),O=a(10),T=(a(42),a(35));function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(t){return typeof t}:function _typeof(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,r){for(var a=0;a<r.length;a++){var l=r[a];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(t,l.key,l)}}function _setPrototypeOf(t,r){return(_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(t,r){return t.__proto__=r,t})(t,r)}function _createSuper(t){var r=function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var a,l=_getPrototypeOf(t);if(r){var S=_getPrototypeOf(this).constructor;a=Reflect.construct(l,arguments,S)}else a=l.apply(this,arguments);return _possibleConstructorReturn(this,a)}}function _possibleConstructorReturn(t,r){if(r&&("object"===_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var L=["exactMatch","partialMatch","partialMatchV2"],E=function isDefaultValidResponseValue(t){return 0===S.a.filter(t,(function(t){return t||0===t})).length},D=function(t){!function _inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),r&&_setPrototypeOf(t,r)}(ClozeScorer,t);var r=_createSuper(ClozeScorer);function ClozeScorer(){return _classCallCheck(this,ClozeScorer),r.apply(this,arguments)}return function _createClass(t,r,a){return r&&_defineProperties(t.prototype,r),a&&_defineProperties(t,a),t}(ClozeScorer,[{key:"reset",value:function reset(t){var r=JSON.stringify(t),a=this.flags||this.cachedFlags;if(this.serializedData!==r){t.question.validation&&t.question.validation.scoring_type||(t=O.a.normalizeParameters(t));var l=getOptions(t.question,a);try{this.scoringData=function getScoringData(t,r){var a=t.question.validation,l=[];if(!function canValidateResponse(t){if(!1===S.a.getNested(t,"validation.automarkable"))return!1;var r=t.validation||t||{};return!S.a.isEmpty(r)&&(S.a.isArray(r.valid_responses)||S.a.isObject(r.valid_response)&&!E(r.valid_response.value))}(t.question))return{automarkable:!1};t.question.equiv_literal_legacy&&(t=O.a.processCompatibility(t));if(t.response=t.response||{},a&&a.scoring_type){if(!S.a.contains(L,a.scoring_type))throw new O.a.InvalidScoringTypeException(t.question.type,a.scoring_type);return a.valid_response&&l.push(a.valid_response),a.alt_responses&&(l=l.concat(a.alt_responses)),function processResponsesCurrentScoringFormat(t,r,a){var l={score:1,penaltyScore:0,rounding:"floor"};return O.a.scoreArray(t,r,l,a)}(t,l,r)}return S.a.isArray(t.question.valid_responses)?function processLegacyResponses1233(t,r){var a,l,T=t.question,L=t.response&&t.response.value||[],E=T.valid_responses,D=[];r=getOptions(T,{stripWhiteSpaceForMath:!0}),S.a.each(L,(function(t,T){var L,j,V=E[T],B=!1;S.a.each(V,(function(a){a.value&&S.a.isNumber(a.score)&&(O.a.stringCompare(t,a.value,r)?(j=a.score,B=!0):j=j||0,(S.a.isUndefined(L)||a.score>L)&&(L=a.score))})),a=O.a.addIfDefined(a,j),l=O.a.addIfDefined(l,L),D.push(B)})),L.length||S.a.each(E,(function(t,r){var a;S.a.each(t,(function(t){S.a.isNumber(t.score)&&(S.a.isUndefined(a)||t.score>a)&&(a=t.score)})),l=O.a.addIfDefined(l,a)}));return{score:a,responsesValid:D,maxScore:l,isValid:D.length?S.a.all(D):void 0}}(t,r):function processLegacyResponsesPre2140(t,r){var a,l=t.question,T=t.response||{};l.validation=l.validation||{};var L,E,D=l.validation.valid_responses,j=T.value||[],V=Math.abs(S.a.isNumber(l.validation.penalty_score)?l.validation.penalty_score:0),B=function getResponseScoreArray(t){var r,a=parseFloat(t.validation.valid_score),l=t.validation.valid_responses,O=[];if(a=isNaN(a)?1:a,S.a.isArray(t.validation.valid_score))O=t.validation.valid_score;else for(var T=0;T<l.length;T++){r=[];for(var L=0;L<l[T].length;L++)r.push(a);O.push(r)}return O}(l),q=[],G=0;S.a.each(j,(function(t,l){var T=D[l],E=0,j=!1;if(!S.a.isUndefined(t)&&null!==t&&""!==t&&S.a.isArray(T))for(var G=0;G<T.length;G++){if(O.a.stringCompare(t,T[G],r)){E=B[l][G],a=T,j=!0;break}E=-1*V}q.push(j),L=(S.a.isUndefined(L)?0:L)+E})),S.a.each(B,(function(t){G+=S.a.max(t)})),j.length&&!1===l.validation.partial_scoring&&L!==G&&(L=0);j.length&&q.length&&(E=!1===l.validation.partial_scoring?S.a.all(q):S.a.any(q));return{score:L,responsesValid:q,suggestedResponse:a,maxScore:G,isValid:E}}(t,r)}(t,l),O.a.normalizeScores(this.scoringData,t)}catch(t){this.scoringData={error:t}}this.serializedData=r}return this.cachedFlags=a,this}},{key:"flags",get:function get(){}}]),ClozeScorer}(T.a);function getOptions(t,r){var a={caseSensitive:!!t.case_sensitive,removeWhitespace:!!t.is_math&&r.stripWhiteSpaceForMath,matchAllPossibleResponses:!(!t.validation||!t.validation.match_all_possible_responses)};return delete r.stripWhiteSpaceForMath,S.a.extend(r,a)}r.a=D},142:function(t,r,a){"use strict";a.d(r,"a",(function(){return l})),a.d(r,"f",(function(){return S})),a.d(r,"e",(function(){return O})),a.d(r,"d",(function(){return T})),a.d(r,"c",(function(){return L})),a.d(r,"g",(function(){return E})),a.d(r,"b",(function(){return D}));var l={bold:{type:"button",icon:"lrn-icon-bold",command:"bold"},italic:{type:"button",icon:"lrn-icon-italic",command:"italic"},underline:{type:"button",icon:"lrn-icon-underline",command:"underline"},codeInline:{type:"button",icon:"lrn-icon-code-inline",command:"codeInline"},codeEditor:{type:"button",icon:"lrn-icon-code-editor",command:"codeEditor"},orderedList:{type:"button",icon:"lrn-icon-list-numbered",command:"insertOrderedList"},unorderedList:{type:"button",icon:"lrn-icon-list-bulleted",command:"insertUnorderedList"},removeFormat:{type:"button",icon:"lrn-icon-remove-format",command:"removeFormat"},alignLeft:{type:"button",icon:"lrn-icon-align-left",command:"alignLeftStyle"},alignCenter:{type:"button",icon:"lrn-icon-align-center",command:"alignCenterStyle"},alignRight:{type:"button",icon:"lrn-icon-align-right",command:"alignRightStyle"},alignJustify:{type:"button",icon:"lrn-icon-align-justify",command:"alignJustifyStyle"},superscript:{type:"button",icon:"lrn-icon-superscript",command:"superscript"},subscript:{type:"button",icon:"lrn-icon-subscript",command:"subscript"},insertHorizontalRule:{type:"button",icon:"lrn-icon-hr",command:"insertHorizontalRule"},indentIncrease:{type:"button",icon:"lrn-icon-indent-increase",command:"increaseIndent"},indentDecrease:{type:"button",icon:"lrn-icon-indent-decrease",command:"decreaseIndent"},textDirectionLtr:{type:"button",icon:"lrn-icon-text-direction-ltr",command:"textDirectionLtr"},textDirectionRtl:{type:"button",icon:"lrn-icon-text-direction-rtl",command:"textDirectionRtl"},blockquote:{type:"button",icon:"lrn-icon-blockquote",command:"insertBlockQuote"},table:{type:"createTable",icon:"lrn-icon-table"},editTable:{type:"editTable",icon:"lrn-icon-edit-table"},image:{type:"insertImage",icon:"lrn-icon-image",icons:{edit:"lrn-icon-image-edit",preview:"lrn-icon-image-preview",delete:"lrn-icon-image-delete"}},undo:{type:"button",icon:"lrn-icon-undo",command:"undo"},redo:{type:"button",icon:"lrn-icon-redo",command:"redo"},charactermap:{type:"charactermap"},characterMathMap:{type:"characterMathMap"},"|":{type:"divider"},formulaEditor:{type:"formulaEditor",icon:"lrn-icon-formula"}},S=12,O={SMALL:"small",MEDIUM:"medium",LARGE:"large",FULL_SIZE:"fullSize"},T={SMALL:200,MEDIUM:525,LARGE:1024,FULL_SIZE:3024},L={CREATE_FORMULA:"createFormula",EDIT_FORMULA:"editFormula"},E={FORMULA_EDITOR:"editFormula"},D=["image/jpg","image/jpeg","image/png","image/gif","image/bmp",".jfif"]},152:function(t,r,a){"use strict";var l=a(127),S=a.n(l);function Icon(t){var r=t.icon;return r?S.a.createElement("span",{className:"lrn_icon  ".concat(r),"aria-hidden":"true"}):null}function ScreenReader(t){var r=t.label;return r?S.a.createElement("span",{className:"sr-only"},"  ",r):null}r.a={Divider:function Divider(){return S.a.createElement("div",{className:"lrn-divider"})},Button:function Button(t){var r=t.disabled,a=t.isActive,l=t.name,O=t.icon,T=t.label,L=t.activeClassName,E=t.children,D=t.getRef,j=t.onMouseEnter,V=t.onMouseLeave,B=t.onMouseDown,q=t.onClick,G=t.tabIndex,K="lrn_btn  lrn-editor-toolbar-button-".concat(l,"  ").concat(a?L:"","  ").concat(t.className||"");return S.a.createElement("button",{ref:function ref(t){return D&&D(t)},type:"button",className:K,"aria-label":T,"aria-pressed":a,disabled:r,onMouseEnter:function onMouseEnter(){return j(T)},onMouseLeave:V,onMouseDown:function mouseDownHandler(t){B&&B(),t.preventDefault()},onClick:function clickHandler(t){q&&q(),t.preventDefault()},tabIndex:G},S.a.createElement(Icon,{icon:O}),S.a.createElement(ScreenReader,{label:T}),E)}}},153:function(t,r,a){"use strict";var l=a(127),S=a.n(l),O=a(180);a(182);r.a=function Modal(t){var r=t.afterRender,a=t.children,l=t.title,T=t.parentNode,L=t.modalIsOpen,E=t.onRequestClose,D=t.preventFocusWhenAppear,j="lrn-wysihtml-modal  ".concat(t.className||"");return S.a.createElement(O.a,{afterRender:r,preventFocusWhenAppear:D,isOpen:L,parentNode:T,className:"lrn-wysihtml-floating-modal",onRequestClose:E,shouldUpdatePosition:!1},S.a.createElement("div",{className:j,style:{opacity:1}},S.a.createElement("div",{className:"lrn-wysihtml-modal-dialog",role:"dialog",style:{opacity:1}},S.a.createElement("div",{className:"lrn-wysihtml-modal-title"},l),S.a.createElement("button",{type:"button",className:"lrn_btn lrn_btn_close",title:"Close","data-lrn-action":"close",onClick:E},S.a.createElement("span",{className:"sr-only"},"Close")),S.a.createElement("div",{className:"lrn-wysihtml-modal-content"},a))))}},156:function(t,r,a){"use strict";a.d(r,"a",(function(){return trapFocus}));var l=a(0),S=a.n(l),O=a(1),T=a.n(O),L=a(7),E=a.n(L),D=["a[href]",'input:not([disabled]):not([tabindex="-1"])','select:not([disabled]):not([tabindex="-1"])','textarea:not([disabled]):not([tabindex="-1"])','button:not([disabled]):not([tabindex="-1"])','[tabindex]:not([tabindex="-1"])',"[contenteditable]","area[href]","iframe","object","embed"].join();function trapFocus(t,r){var a=document.activeElement,l=T()(t).find(D).filter(":visible"),O=S.a.first(l),L=S.a.last(l);if(l.length){var j=function handler(t){9===t.keyCode&&(t.shiftKey?document.activeElement===O&&(t.preventDefault(),L.focus()):document.activeElement===L&&(t.preventDefault(),O.focus()))};return(r&&S.a.isFunction(r.focus)?r:O).focus(),t.addEventListener("keydown",j),t.setAttribute("role","dialog"),E.a.isSafari||t.setAttribute("aria-modal","true"),function restore(r){t.removeEventListener("keydown",j),t.removeAttribute("role"),t.removeAttribute("aria-modal"),(r&&S.a.isFunction(r.focus)?r:a).focus()}}}},165:function(t,r,a){"use strict";a.d(r,"a",(function(){return E}));var l=a(131);function _defineProperties(t,r){for(var a=0;a<r.length;a++){var l=r[a];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(t,l.key,l)}}var S=[],O=new MutationObserver((function onMutation(){L||(L=!0,requestAnimationFrame((function(){L=!1,S.concat([]).forEach((function(t){return t.checkVisibility()}))})))})),T=new Set,L=!1,E=function(){function VisibilityChangeObserver(t,r){!function _classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,VisibilityChangeObserver),this.isActive=!1,this.isVisible=!1,this.element=t,this.onVisibilityChange=r}return function _createClass(t,r,a){return r&&_defineProperties(t.prototype,r),a&&_defineProperties(t,a),t}(VisibilityChangeObserver,[{key:"start",value:function start(){this.isActive||(this.isActive=!0,this.isVisible=l.b.isElementVisible(this.element),S.push(this),observeElementAndAncestors(this.element))}},{key:"stop",value:function stop(){this.isActive&&(this.isActive=!1,S.splice(S.indexOf(this),1),function resetMutationObserver(){O.disconnect(),T.clear(),S.forEach((function(t){return observeElementAndAncestors(t.element)})),T.forEach((function(t){return observeElement(t)}))}())}},{key:"checkVisibility",value:function checkVisibility(){if(this.isActive){var t=l.b.isElementVisible(this.element);this.isVisible!==t&&(this.isVisible=t,this.onVisibilityChange(t))}}}]),VisibilityChangeObserver}();function observeElementAndAncestors(t){for(;t&&!T.has(t);)observeElement(t),T.add(t),t=t.parentElement}function observeElement(t){O.observe(t,{attributes:!0,attributeFilter:["id","style","class"]})}},179:function(t,r,a){"use strict";var l=a(5),S=a.n(l),O=a(0),T=a.n(O),L=a(51),E=["toggle"],D=["Left","Right","Backspace","÷","×","-","+","="];switch(L.a.getOs()){case"osx":E=["shift","opt"];break;case"windows":case"unix":case"linux":E=["shift","alt"]}var j=S.a.Model.extend({keysForToggle:E,keyForCtrlToggle:"ctrl",ariaHiddenSymbols:D,defaults:{type:"write"},initialize:function initialize(){this.createDisplayableShortcut(),this.on("change:shortcut",this.createDisplayableShortcut,this)},createDisplayableShortcut:function createDisplayableShortcut(){var t=T.a.clone(this.get("shortcut"));"toggle"===T.a.first(t)&&(t=T.a.union(this.keysForToggle,T.a.rest(t,1))),"ctrl"===T.a.first(t)&&(t=T.a.union(["ctrl"],T.a.rest(t))),t&&t[0]===this.get("title")&&(t=[]),this.set("displayableShortcut",t)},renderLabelAsLatex:function renderLabelAsLatex(){var t=this.get("label_latex");return T.a.isBoolean(t)?t:this.get("label").indexOf("\\")>-1},isPlaceholder:function isPlaceholder(){return""===this.get("id")},isFunctional:function isFunctional(){return!("addmatrixcol"===this.get("name")||"addmatrixrow"===this.get("name"))&&"keystroke"===this.get("type")},hasOwnStyle:function hasOwnStyle(){return!!this.get("style")},isAria:function isAria(t){return T.a.contains(D,t)}});r.a=S.a.Collection.extend({model:j,get:function get(t){return S.a.Collection.prototype.get.apply(this,arguments)||this.find((function(r){return T.a.contains(r.get("aliases"),t)}))},add:function add(t){this.isUnique(t)&&S.a.Collection.prototype.add.apply(this,arguments)},isUnique:function isUnique(t){var r=t.aliases&&T.a.union(t.aliases,t.id)||[];return!this.any((function(a){return t.id===a.id||T.a.intersection(r,a.get("aliases")).length}))},getShortcutsMap:function getShortcutsMap(){var t={};return this.each((function(r){var a=r.get("shortcut");"toggle"===T.a.first(a)&&(t[a[1]]=r)})),t},getGroups:function getGroups(){var t=T.a.unique(this.pluck("group")),r=this;return T.a.map(t,(function(t){return r.where({group:t})}))},getFirstInEachGroup:function getFirstInEachGroup(){return T.a.map(this.getGroups(),T.a.first)}})},183:function(t,r,a){"use strict";a.d(r,"a",(function(){return E}));var l=a(0),S=a.n(l),O=a(2),T=a(13);function _classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,r){for(var a=0;a<r.length;a++){var l=r[a];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(t,l.key,l)}}var L="spokenmathWorker";var E=new(function(){function SingletonWorker(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};_classCallCheck(this,SingletonWorker),this._loading=!1,this._collections=[],this._resolveCollections=this._resolveCollections.bind(this),this.getPostMessage=r.getPostMessage.bind(this),this.processReceivedMessage=r.processReceivedMessage.bind(this)}return function _createClass(t,r,a){return r&&_defineProperties(t.prototype,r),a&&_defineProperties(t,a),t}(SingletonWorker,[{key:"process",value:function process(t){var r=this,a=this._collections;return new O.default((function(l){a.push({data:t,resolve:l}),r._loading||r._loadWorker()}))}},{key:"_loadWorker",value:function _loadWorker(){var t=this;this._loading=!0,function loadWorker(t){return new O.default((function(r){T.a.getExposedExternalBundle(t)().then((function(t){r(t)}))}))}(L).then((function(r){var a=new r,l=t._collections,O=S.a.pluck(l,"data");a.postMessage(t.getPostMessage(O)),a.addEventListener("message",(function(r){var S=r.data;a.terminate(),t._loading=!1,t._resolveCollections(t.processReceivedMessage(S)),l.length&&t._loadWorker()}))}))}},{key:"_resolveCollections",value:function _resolveCollections(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=this._collections;t.length&&r.length;){var a=r.shift(),l=a.resolve;l(t.shift())}}}]),SingletonWorker}())(L,{getPostMessage:function getPostMessage(t){return{latexes:t}},processReceivedMessage:function processReceivedMessage(t){return t.value}})},184:function(t,r,a){"use strict";var l=a(1),S=a.n(l),O=a(0),T=a.n(O),L=function ScaleCompensator(t,r){var a=this;this.id=T.a.uniqueId("lrn_scale_compensator_"),this.$el=t,this.opts=r,this.scale=T.a.debounce((function(){var t=T.a.bind(a.scaleAndPosition,a);window.requestAnimationFrame?window.requestAnimationFrame(t):t()}),r.debounceTime)};T.a.extend(L.prototype,{start:function start(t){return S()(window).on("resize."+this.id+" orientationchange."+this.id+" scroll."+this.id,this.scale),this},stop:function stop(){S()(window).off("."+this.id)},scaleAndPosition:function scaleAndPosition(){var t=document.documentElement.clientWidth,r=document.documentElement.clientHeight,a=window.innerWidth,l=window.innerHeight,S=a/t,O="scale("+S+") translateX("+window.pageXOffset/S+"px) translateY("+-(r-(window.pageYOffset+l))/S+"px)";S>.99?(this.$el.removeClass("lrn_scalable"),O=""):this.$el.addClass("lrn_scalable"),this.setTransform(O),this.opts.onUpdate(S)},setTransform:function setTransform(t){return this.$el.css({transform:t,"-moz-transform":t,"-o-transform":t,"-webkit-transform":t,"-ms-transform":t}),this},destroy:function destroy(){this.stop(),this.setTransform("").$el.removeClass("lrn_scalable"),this.$el=this.opts=null}}),r.a=L},185:function(t,r,a){"use strict";var l=a(5),S=a.n(l),O=a(127),T=a.n(O),L=a(132),E=a.n(L),D=a(159);function _extends(){return(_extends=Object.assign||function(t){for(var r=1;r<arguments.length;r++){var a=arguments[r];for(var l in a)Object.prototype.hasOwnProperty.call(a,l)&&(t[l]=a[l])}return t}).apply(this,arguments)}function _classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,r){for(var a=0;a<r.length;a++){var l=r[a];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(t,l.key,l)}}function _defineProperty(t,r,a){return r in t?Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[r]=a,t}var j=function(){function CustomDropdown(t,r){var a=this,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};_classCallCheck(this,CustomDropdown),_defineProperty(this,"on",S.a.Events.on),_defineProperty(this,"once",S.a.Events.once),_defineProperty(this,"off",S.a.Events.off),_defineProperty(this,"trigger",S.a.Events.trigger),_defineProperty(this,"_selectedIndex",-1),_defineProperty(this,"_value",null),_defineProperty(this,"_onChange",(function(t){var r=t.index,l=t.value;a._selectedIndex=r,a._value=l,a.trigger("change",{value:l,selectedIndex:r})})),_defineProperty(this,"_onBlur",(function(){a.trigger("blur")})),_defineProperty(this,"_onUpdateComplete",(function(){a.trigger("updateComplete")})),this.el=t,this.menuOptions=r,this.options=l,this._render()}return function _createClass(t,r,a){return r&&_defineProperties(t.prototype,r),a&&_defineProperties(t,a),t}(CustomDropdown,[{key:"selectedIndex",get:function get(){return this._selectedIndex},set:function set(t){this._selectedIndex=t,this.component.setSelectedIndex(t)}},{key:"value",get:function get(){return this._value}},{key:"open",value:function open(t){this.component.open(t)}},{key:"close",value:function close(){this.component.close()}},{key:"isOpen",value:function isOpen(){return this.component.isOpen()}},{key:"_render",value:function _render(){var t=this.menuOptions,r=this.options;this.component=E.a.render(T.a.createElement(D.a,_extends({},r,{containerClass:"lrn_theme_primary",menuOptions:t,onChange:this._onChange,onBlur:this._onBlur,updateComplete:this._onUpdateComplete,selectedIndex:this.selectedIndex})),this.el)}}]),CustomDropdown}();r.a=j},190:function(t,r,a){"use strict";var l=a(0),S=a.n(l),O=["syntax","argument"],T=["stringMatch"];String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}),r.a={processSpec:function processSpec(t){var r,a,l;if(S.a.isObject(t)&&"equivSyntax"===t.method)return S.a.isObject(t.options)&&S.a.isString(t.options.syntax)&&""!==t.options.syntax||!t.value?("\\number",l={method:"equivSyntax",value:""},a=t.options.syntax||"\\number",l.value="\\format{"+a,S.a.isNumber(t.options.argument)&&(l.value+="{"+t.options.argument+"}"),l.value+="}",S.a.isBoolean(t.options.ignoreText)&&(l.options={ignoreText:t.options.ignoreText}),l):t;for(r=0;r<O.length;r++)S.a.isObject(t.options)&&!S.a.isUndefined(t.options[O[r]])&&delete t.options[O[r]];return t},useMathCore:function useMathCore(t){return!(S.a.isObject(t)&&-1!==S.a.indexOf(T,t.method))},validate:function validate(t,r){var a,l,O,T,L,E={errorCode:0,location:void 0,message:"Normal completion",result:!1};return S.a.isObject(t)&&S.a.isString(r)&&"stringMatch"===t.method&&S.a.isString(t.value)&&(a=t.value.replace(/\\\s/g," "),l=r.replace(/\\\s/g," "),T=!S.a.isObject(t.options)||S.a.isObject(t.options)&&!1!==t.options.ignoreLeadingAndTrailingSpaces,L=!S.a.isObject(t.options)||S.a.isObject(t.options)&&!1!==t.options.treatMultipleSpacesAsOne,O=S.a.isObject(t.options)&&!0===t.options.inverseResult,T&&(a=a.trim(),l=l.trim()),L&&(a=a.replace(/\s+/g," "),l=l.replace(/\s+/g," ")),E.result=a===l,O&&(E.result=!E.result)),E}}},195:function(t,r,a){"use strict";a(0);var l=a(21),S={LONGTEXTV2_UPDATE_WORD_COUNT:"longtextv2:update:wordcount",LONGTEXTV2_UPDATE_WORD_COUNT_EXCEEDED:"longtextv2:update:wordcountexceeded",LONGTEXTV2_UPDATE_WORD_LIMIT_VISIBILITY:"longtextv2:update:wordlimitvisibility",LONGTEXTV2_DISABLE_EDITOR:"longtextv2:disable:editor",LONGTEXTV2_UPDATE_CHARACTER_COUNT:"longtextv2:update:charactercount",LONGTEXTV2_UPDATE_CHARACTER_COUNT_EXCEEDED:"longtextv2:update:charactercountexceeded"};r.a={actionTypes:S,compressImage:function compressImage(t,r){return function(a,l,S){return S.dataService.compressImage(t,r)}},uploadImage:function uploadImage(t,r){return function(a,l,S){return S.dataService.uploadImage(t,r)}},updateValue:function updateValue(t){return function(r,a,O){var T=O.dataService.getResponse();if((T&&T.value)!==(t=O.dataService.formatValue(t))){r({type:S.LONGTEXTV2_UPDATE_WORD_COUNT,payload:{value:t}});var L=a().longTextV2.footer.wordCount;r(l.a.updateResponseValue({value:t,wordCount:L}));var E=O.dataService.getWordCountExceeded(),D=O.dataService.getCharacterCountExceeded(),j=O.dataService.getCharacterCount();r({type:S.LONGTEXTV2_UPDATE_WORD_COUNT_EXCEEDED,payload:{value:E}}),r({type:S.LONGTEXTV2_UPDATE_CHARACTER_COUNT,payload:{count:j,exceeded:D}});var V=O.dataService.getWordLimitVisibility();r({type:S.LONGTEXTV2_UPDATE_WORD_LIMIT_VISIBILITY,payload:{value:V}})}}},disableEditor:function disableEditor(t){return{type:S.LONGTEXTV2_DISABLE_EDITOR,payload:{value:t}}}}},199:function(t,r,a){"use strict";var l=a(1),S=a.n(l),O=a(0),T=a.n(O),L=a(245),E=a.n(L);function ownKeys(t,r){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);r&&(l=l.filter((function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable}))),a.push.apply(a,l)}return a}function _objectSpread(t){for(var r=1;r<arguments.length;r++){var a=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(a),!0).forEach((function(r){_defineProperty(t,r,a[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):ownKeys(Object(a)).forEach((function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(a,r))}))}return t}function _defineProperty(t,r,a){return r in t?Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[r]=a,t}var D=[],j={lineNumbers:!0,readOnly:!1},V={CODE_EDITOR_WIDGET_SELECTOR:'[data-lrn-wysihtml-widget="codeEditorWidget"]',CODE_MIRROR_SELECTOR:".CodeMirror",CODE_EDITOR_ATTR:"data-lrn-code-editor-id",parse:function parse(t){var r=S()("<div />").html(t);return r.find(V.CODE_EDITOR_WIDGET_SELECTOR).each((function(){var t=S()(this);if(!t.attr(V.CODE_EDITOR_ATTR)){var r=T.a.uniqueId();t.attr(V.CODE_EDITOR_ATTR,r).attr("contenteditable",!1),D.push(r)}})),r.html()},render:function render(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=[];return T.a.each(D,(function(a){var l='[data-lrn-code-editor-id="'.concat(a,'"]'),O=S()(l);if(O.length){var L=T.a.unescape(O.html()||"");O.empty();var D=E()(O.get(0),_objectSpread(_objectSpread({},j),{},{value:L,autofocus:!!t.autofocus,historyEventDelay:400,readOnly:t.readOnly}));D.on("beforeChange",(function(t,r){!t.isReadOnly()||"undo"!==r.origin&&"redo"!==r.origin?(t.__previousValue=t.getValue(),t.__previousCursorLine=t.getCursor().line):r.cancel()})),r.push({$el:O,instance:D})}})),D=[],r},getFocusEditorInstance:function getFocusEditorInstance(t){var r;return S()(t).find(V.CODE_MIRROR_SELECTOR).each((function(){var t=this.CodeMirror;t&&t.hasFocus&&t.hasFocus()&&(r=t)})),r},getAllInstances:function getAllInstances(t){return T.a.map(t.querySelectorAll(V.CODE_MIRROR_SELECTOR),(function(t){return t.CodeMirror}))},getInstanceFromNode:function getInstanceFromNode(t){var r=t.getAttribute(V.CODE_EDITOR_ATTR),a=document.querySelector('[data-lrn-code-editor-id="'.concat(r,'"]'));if(a){var l=a.querySelector(V.CODE_MIRROR_SELECTOR);return l&&l.CodeMirror}},getData:function getData(t){var r=V.getInstanceFromNode(t);if(r){var a=r.getValue(),l=T.a.escape(a);return'<div data-lrn-wysihtml-widget="codeEditorWidget">'.concat(l,"</div>")}return""},remove:function remove(t){if(!t)return!1;var r=t.getWrapperElement();return S()(r).closest(V.CODE_EDITOR_WIDGET_SELECTOR).remove(),!0}};r.a=V},200:function(t,r,a){"use strict";var l=a(0),S=a.n(l),O=a(17),T={jpg:{jpg:"image/jpeg",jpeg:"image/jpeg",jfif:"image/jpeg"},png:"image/png",gif:"image/gif",bmp:"image/bmp",pdf:"application/pdf",csv:"text/csv",rtf:"application/rtf",txt:"text/plain",xps:"application/vnd.ms-xpsdocument",ms_word:{doc:"application/msword",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",dot:"application/msword",dotx:"application/vnd.openxmlformats-officedocument.wordprocessingml.template",docm:"application/vnd.ms-word.document.macroenabled.12",dotm:"application/vnd.ms-word.template.macroenabled.12"},ms_excel:{xls:"application/vnd.ms-excel",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",xlt:"application/vnd.ms-excel",xltm:"application/vnd.ms-excel.template.macroenabled.12",xlsm:"application/vnd.ms-excel.sheet.macroenabled.12"},ms_powerpoint:{ppt:"application/vnd.ms-powerpoint",pps:"application/vnd.ms-powerpoint",pot:"application/vnd.ms-powerpoint",pptx:"application/vnd.openxmlformats-officedocument.presentationml.presentation",pptm:"application/vnd.ms-powerpoint.presentation.macroenabled.12",potx:"application/vnd.openxmlformats-officedocument.presentationml.template",potm:"application/vnd.ms-powerpoint.presentation.macroenabled.12",ppsx:"application/vnd.openxmlformats-officedocument.presentationml.slideshow",ppsm:"application/vnd.ms-powerpoint.slideshow.macroenabled.12"},ms_publisher:{pub:"application/vnd.ms-publisher"},open_office:{odf:"application/vnd.oasis.opendocument.formula",odt:"application/vnd.oasis.opendocument.text",ods:"application/vnd.oasis.opendocument.spreadsheet",odp:"application/vnd.oasis.opendocument.presentation"},video:{mp4:"video/mp4",mov:"video/quicktime",webm:"video/webm",avi:"video/avi",asf:"video/x-ms-asf",wmv:"video/x-ms-wmv"},zip:"application/zip",matlab:{m:"text/plain",fig:"application/octet-stream",mat:"application/octet-stream"},altera_quartus:{bdf:"text/plain",bsf:"text/plain"},verilog:{sv:"text/plain"},c:"text/plain",h:"text/plain",s:"text/plain",v:"text/plain",cpp:"text/plain",assembly:{asm:"text/plain"},labview:{vi:"text/plain"}},L={createBasePath:function createBasePath(t){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=new Date(t.get("security").getTimestamp()),l=a.getUTCFullYear(),S=new Date(Date.UTC(l,0,1)),O=Math.ceil((a-S)/864e5),T=t.get("consumer"),L=T.get("id"),E=t.get("user_id"),D=r?"userupload/":"";return"".concat(D).concat(L,"/questionresponse/").concat(l,"/").concat(O,"/").concat(L,"_").concat(E)},createFullPath:function createFullPath(t,r,a,l){var S=this.createBasePath(t,l),T=O.a.v4(),L=this.getValidExtension(a);return"".concat(S,"_").concat(r,"/").concat(T,".").concat(L)},getValidExtension:function getValidExtension(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=this.getFlattenedExtensions(),a=t.lastIndexOf(".")+1,l=a>0?t.slice(a).toLowerCase():"";return r[l]?l:""},getFlattenedExtensions:function getFlattenedExtensions(){var t={};return S.a.mapObject(T,(function buildExtensionMime(r,a){S.a.isString(r)?t[a]=r:S.a.isObject(r)&&S.a.mapObject(r,buildExtensionMime)})),t},getExtensions:function getExtensions(t){var r=T[t],a=[];return S.a.isString(r)?a.push(t):S.a.isObject(r)&&(a=S.a.keys(r)),a},getMimeTypeByExtension:function getMimeTypeByExtension(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=this.getFlattenedExtensions(),a=r[t.toLowerCase()];return a||""}};r.a=L},201:function(t,r,a){"use strict";a(5);var l=a(0),S=a.n(l),O=a(52),T=a(226),L=a.n(T),E=a(136);function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(t){return typeof t}:function _typeof(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,r){for(var a=0;a<r.length;a++){var l=r[a];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(t,l.key,l)}}function _setPrototypeOf(t,r){return(_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(t,r){return t.__proto__=r,t})(t,r)}function _createSuper(t){var r=function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var a,l=_getPrototypeOf(t);if(r){var S=_getPrototypeOf(this).constructor;a=Reflect.construct(l,arguments,S)}else a=l.apply(this,arguments);return _possibleConstructorReturn(this,a)}}function _possibleConstructorReturn(t,r){if(r&&("object"===_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var D=function(t){!function _inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),r&&_setPrototypeOf(t,r)}(ClozeAssociationScorer,t);var r=_createSuper(ClozeAssociationScorer);function ClozeAssociationScorer(){return _classCallCheck(this,ClozeAssociationScorer),r.apply(this,arguments)}return function _createClass(t,r,a){return r&&_defineProperties(t.prototype,r),a&&_defineProperties(t,a),t}(ClozeAssociationScorer,[{key:"flags",get:function get(){return{stripWhiteSpaceForMath:!1}}}]),ClozeAssociationScorer}(E.a);function clozeinlinetext_scoring_typeof(t){return(clozeinlinetext_scoring_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(t){return typeof t}:function _typeof(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function clozeinlinetext_scoring_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function clozeinlinetext_scoring_defineProperties(t,r){for(var a=0;a<r.length;a++){var l=r[a];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(t,l.key,l)}}function clozeinlinetext_scoring_setPrototypeOf(t,r){return(clozeinlinetext_scoring_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(t,r){return t.__proto__=r,t})(t,r)}function clozeinlinetext_scoring_createSuper(t){var r=function clozeinlinetext_scoring_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var a,l=clozeinlinetext_scoring_getPrototypeOf(t);if(r){var S=clozeinlinetext_scoring_getPrototypeOf(this).constructor;a=Reflect.construct(l,arguments,S)}else a=l.apply(this,arguments);return clozeinlinetext_scoring_possibleConstructorReturn(this,a)}}function clozeinlinetext_scoring_possibleConstructorReturn(t,r){if(r&&("object"===clozeinlinetext_scoring_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function clozeinlinetext_scoring_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function clozeinlinetext_scoring_getPrototypeOf(t){return(clozeinlinetext_scoring_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var j=function(t){!function clozeinlinetext_scoring_inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),r&&clozeinlinetext_scoring_setPrototypeOf(t,r)}(ClozeInlinetextScorer,t);var r=clozeinlinetext_scoring_createSuper(ClozeInlinetextScorer);function ClozeInlinetextScorer(){return clozeinlinetext_scoring_classCallCheck(this,ClozeInlinetextScorer),r.apply(this,arguments)}return function clozeinlinetext_scoring_createClass(t,r,a){return r&&clozeinlinetext_scoring_defineProperties(t.prototype,r),a&&clozeinlinetext_scoring_defineProperties(t,a),t}(ClozeInlinetextScorer,[{key:"flags",get:function get(){return{stripWhiteSpaceForMath:!0}}}]),ClozeInlinetextScorer}(E.a);function clozedropdown_scoring_typeof(t){return(clozedropdown_scoring_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(t){return typeof t}:function _typeof(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function clozedropdown_scoring_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function clozedropdown_scoring_defineProperties(t,r){for(var a=0;a<r.length;a++){var l=r[a];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(t,l.key,l)}}function clozedropdown_scoring_setPrototypeOf(t,r){return(clozedropdown_scoring_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(t,r){return t.__proto__=r,t})(t,r)}function clozedropdown_scoring_createSuper(t){var r=function clozedropdown_scoring_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var a,l=clozedropdown_scoring_getPrototypeOf(t);if(r){var S=clozedropdown_scoring_getPrototypeOf(this).constructor;a=Reflect.construct(l,arguments,S)}else a=l.apply(this,arguments);return clozedropdown_scoring_possibleConstructorReturn(this,a)}}function clozedropdown_scoring_possibleConstructorReturn(t,r){if(r&&("object"===clozedropdown_scoring_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function clozedropdown_scoring_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function clozedropdown_scoring_getPrototypeOf(t){return(clozedropdown_scoring_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var V=function(t){!function clozedropdown_scoring_inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),r&&clozedropdown_scoring_setPrototypeOf(t,r)}(ClozeDropdownScorer,t);var r=clozedropdown_scoring_createSuper(ClozeDropdownScorer);function ClozeDropdownScorer(){return clozedropdown_scoring_classCallCheck(this,ClozeDropdownScorer),r.apply(this,arguments)}return function clozedropdown_scoring_createClass(t,r,a){return r&&clozedropdown_scoring_defineProperties(t.prototype,r),a&&clozedropdown_scoring_defineProperties(t,a),t}(ClozeDropdownScorer,[{key:"flags",get:function get(){return{stripWhiteSpaceForMath:!1,strictEquality:!0,trimWhiteSpace:!0}}}]),ClozeDropdownScorer}(E.a);function clozetext_scoring_typeof(t){return(clozetext_scoring_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(t){return typeof t}:function _typeof(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function clozetext_scoring_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function clozetext_scoring_defineProperties(t,r){for(var a=0;a<r.length;a++){var l=r[a];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(t,l.key,l)}}function clozetext_scoring_setPrototypeOf(t,r){return(clozetext_scoring_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(t,r){return t.__proto__=r,t})(t,r)}function clozetext_scoring_createSuper(t){var r=function clozetext_scoring_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var a,l=clozetext_scoring_getPrototypeOf(t);if(r){var S=clozetext_scoring_getPrototypeOf(this).constructor;a=Reflect.construct(l,arguments,S)}else a=l.apply(this,arguments);return clozetext_scoring_possibleConstructorReturn(this,a)}}function clozetext_scoring_possibleConstructorReturn(t,r){if(r&&("object"===clozetext_scoring_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function clozetext_scoring_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function clozetext_scoring_getPrototypeOf(t){return(clozetext_scoring_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var B=function(t){!function clozetext_scoring_inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),r&&clozetext_scoring_setPrototypeOf(t,r)}(ClozeTextScorer,t);var r=clozetext_scoring_createSuper(ClozeTextScorer);function ClozeTextScorer(){return clozetext_scoring_classCallCheck(this,ClozeTextScorer),r.apply(this,arguments)}return function clozetext_scoring_createClass(t,r,a){return r&&clozetext_scoring_defineProperties(t.prototype,r),a&&clozetext_scoring_defineProperties(t,a),t}(ClozeTextScorer,[{key:"flags",get:function get(){return{stripWhiteSpaceForMath:!0}}}]),ClozeTextScorer}(E.a);function imageclozeassociation_scoring_typeof(t){return(imageclozeassociation_scoring_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(t){return typeof t}:function _typeof(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function imageclozeassociation_scoring_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function imageclozeassociation_scoring_defineProperties(t,r){for(var a=0;a<r.length;a++){var l=r[a];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(t,l.key,l)}}function imageclozeassociation_scoring_setPrototypeOf(t,r){return(imageclozeassociation_scoring_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(t,r){return t.__proto__=r,t})(t,r)}function imageclozeassociation_scoring_createSuper(t){var r=function imageclozeassociation_scoring_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var a,l=imageclozeassociation_scoring_getPrototypeOf(t);if(r){var S=imageclozeassociation_scoring_getPrototypeOf(this).constructor;a=Reflect.construct(l,arguments,S)}else a=l.apply(this,arguments);return imageclozeassociation_scoring_possibleConstructorReturn(this,a)}}function imageclozeassociation_scoring_possibleConstructorReturn(t,r){if(r&&("object"===imageclozeassociation_scoring_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function imageclozeassociation_scoring_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function imageclozeassociation_scoring_getPrototypeOf(t){return(imageclozeassociation_scoring_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var q=function(t){!function imageclozeassociation_scoring_inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),r&&imageclozeassociation_scoring_setPrototypeOf(t,r)}(ImageClozeAssociationScorer,t);var r=imageclozeassociation_scoring_createSuper(ImageClozeAssociationScorer);function ImageClozeAssociationScorer(){return imageclozeassociation_scoring_classCallCheck(this,ImageClozeAssociationScorer),r.apply(this,arguments)}return function imageclozeassociation_scoring_createClass(t,r,a){return r&&imageclozeassociation_scoring_defineProperties(t.prototype,r),a&&imageclozeassociation_scoring_defineProperties(t,a),t}(ImageClozeAssociationScorer,[{key:"flags",get:function get(){return{stripWhiteSpaceForMath:!1}}}]),ImageClozeAssociationScorer}(E.a);function imageclozedropdown_scoring_typeof(t){return(imageclozedropdown_scoring_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(t){return typeof t}:function _typeof(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function imageclozedropdown_scoring_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function imageclozedropdown_scoring_defineProperties(t,r){for(var a=0;a<r.length;a++){var l=r[a];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(t,l.key,l)}}function imageclozedropdown_scoring_setPrototypeOf(t,r){return(imageclozedropdown_scoring_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(t,r){return t.__proto__=r,t})(t,r)}function imageclozedropdown_scoring_createSuper(t){var r=function imageclozedropdown_scoring_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var a,l=imageclozedropdown_scoring_getPrototypeOf(t);if(r){var S=imageclozedropdown_scoring_getPrototypeOf(this).constructor;a=Reflect.construct(l,arguments,S)}else a=l.apply(this,arguments);return imageclozedropdown_scoring_possibleConstructorReturn(this,a)}}function imageclozedropdown_scoring_possibleConstructorReturn(t,r){if(r&&("object"===imageclozedropdown_scoring_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function imageclozedropdown_scoring_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function imageclozedropdown_scoring_getPrototypeOf(t){return(imageclozedropdown_scoring_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var G=function(t){!function imageclozedropdown_scoring_inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),r&&imageclozedropdown_scoring_setPrototypeOf(t,r)}(ImageClozeDropdownScorer,t);var r=imageclozedropdown_scoring_createSuper(ImageClozeDropdownScorer);function ImageClozeDropdownScorer(){return imageclozedropdown_scoring_classCallCheck(this,ImageClozeDropdownScorer),r.apply(this,arguments)}return function imageclozedropdown_scoring_createClass(t,r,a){return r&&imageclozedropdown_scoring_defineProperties(t.prototype,r),a&&imageclozedropdown_scoring_defineProperties(t,a),t}(ImageClozeDropdownScorer,[{key:"flags",get:function get(){return{stripWhiteSpaceForMath:!1}}}]),ImageClozeDropdownScorer}(E.a);function imageclozetext_scoring_typeof(t){return(imageclozetext_scoring_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(t){return typeof t}:function _typeof(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function imageclozetext_scoring_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function imageclozetext_scoring_defineProperties(t,r){for(var a=0;a<r.length;a++){var l=r[a];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(t,l.key,l)}}function imageclozetext_scoring_setPrototypeOf(t,r){return(imageclozetext_scoring_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(t,r){return t.__proto__=r,t})(t,r)}function imageclozetext_scoring_createSuper(t){var r=function imageclozetext_scoring_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var a,l=imageclozetext_scoring_getPrototypeOf(t);if(r){var S=imageclozetext_scoring_getPrototypeOf(this).constructor;a=Reflect.construct(l,arguments,S)}else a=l.apply(this,arguments);return imageclozetext_scoring_possibleConstructorReturn(this,a)}}function imageclozetext_scoring_possibleConstructorReturn(t,r){if(r&&("object"===imageclozetext_scoring_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function imageclozetext_scoring_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function imageclozetext_scoring_getPrototypeOf(t){return(imageclozetext_scoring_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var K=function(t){!function imageclozetext_scoring_inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),r&&imageclozetext_scoring_setPrototypeOf(t,r)}(ImageClozeTextScorer,t);var r=imageclozetext_scoring_createSuper(ImageClozeTextScorer);function ImageClozeTextScorer(){return imageclozetext_scoring_classCallCheck(this,ImageClozeTextScorer),r.apply(this,arguments)}return function imageclozetext_scoring_createClass(t,r,a){return r&&imageclozetext_scoring_defineProperties(t.prototype,r),a&&imageclozetext_scoring_defineProperties(t,a),t}(ImageClozeTextScorer,[{key:"flags",get:function get(){return{stripWhiteSpaceForMath:!1}}}]),ImageClozeTextScorer}(E.a),X=a(4),$=a(157);r.a=O.a.extend({richTextAttributes:["metadata.distractor_rationale_response_level[*]","template"],imageTemplate:L.a,RESPONSE_MARKER_REGEXP:"{{response}}",initialize:function initialize(){O.a.prototype.initialize.apply(this,arguments),this.updateValidationObject()},validateStartup:function validateStartup(){O.a.prototype.validateStartup.call(this)},processResponseValue:function processResponseValue(t){this.hasResponse()||this.set({response:{value:[],type:this.RESPONSE_TYPE.ARRAY}},{silent:!0}),this.get("response").value=t},isDefaultValidResponseValue:function isDefaultValidResponseValue(t){return 0===S.a.filter(t,(function(t){return t||0===t})).length},getScorerClass:function getScorerClass(){var t,r=this.TYPE;switch(this.get("type")){case r.CLOZETEXT:t=B;break;case r.CLOZEASSOCIATION:t=D;break;case r.CLOZEDROPDOWN:t=V;break;case r.CLOZEINLINETEXT:t=j;break;case r.IMAGECLOZEASSOCIATION:t=q;break;case r.IMAGECLOZEDROPDOWN:t=G;break;case r.IMAGECLOZETEXT:t=K}return t},validateResponse:function validateResponse(){var t=this.getScorer(),r=t.error();if(!r)return t.validateIndividualResponses();if("MathQuestionException"!==r.name)throw r;"user"!==r.location&&X.a.exception({code:10019,detail:r.message,i18n:this.activity.get("i18n")})},isImageCloze:function isImageCloze(){var t=this.TYPE;return S.a.include([t.IMAGECLOZETEXT,t.IMAGECLOZEASSOCIATION,t.IMAGECLOZEDROPDOWN,t.IMAGECLOZEFORMULA,t.IMAGECLOZECHEMISTRY],this.get("type"))},getDynamicShuffleSeed:function getDynamicShuffleSeed(){return new $.a(this).getDynamicSeed()},getContentTemplate:function getContentTemplate(){if(this.isImageCloze()){var t=L.a,r=this.get("question"),a={img_alt:!!r.img_alt&&r.img_alt,img_title:!!r.img_title&&r.img_title,img_src:r.img_src,response_positions:r.response_positions,response_container:r.response_container,padding:!!r.padding&&r.padding,question_type:this.get("type")};return r.image&&(r.image.src&&(a.img_src=r.image.src),r.image.alt&&(a.img_alt=r.image.alt),r.image.title&&(a.img_title=r.image.title)),t({displayLogic:a})}return this.get("question").template},getImageClozeAriaLabels:function getImageClozeAriaLabels(){if(this.isImageCloze())return S.a.isUndefined(this._ariaLabels)&&(this._ariaLabels=S.a.map(this.get("question").aria_labels,(function(t){return S.a.escape(t)}))),this._ariaLabels},updateValidationObject:function updateValidationObject(){var t=this.get("question");if(t.hasOwnProperty("valid_responses")){var r,a,l,O=[],T=[],L=!0;S.a.each(t.valid_responses,(function(t,E){O[E]=[],T[E]=[],S.a.each(t,(function(t,D){a=S.a.isUndefined(t.value)?null:t.value,null!==(l=S.a.isUndefined(t.score)?null:t.score)&&(l=parseInt(l,10)),O[E].push(a),T[E].push(l),S.a.isUndefined(r)?r=l:L&=r===l}))})),delete t.valid_responses,t.validation={valid_responses:O},r=L?r:T,S.a.isNull(r)||(t.validation.valid_score=r),this.set({question:t},{silent:!0}),this.trackEvent("Updated pre v1.24.0 question object.")}},getCorrectByIndex:function getCorrectByIndex(t){if(this.canValidateResponse())return this.getValidResponse().value[t]},isVerticalTopContainer:function isVerticalTopContainer(){return S.a.isUndefined(this._verticalTop)&&(this._verticalTop=!!this.isImageCloze()&&!!S.a.getNested(this.get("question"),"response_container.vertical_top")),this._verticalTop},getIgnoreLeadingAndTrailingSpaces:function getIgnoreLeadingAndTrailingSpaces(){var t=this.get("question").ignore_leading_and_trailing_spaces;return!S.a.isBoolean(t)||t}})},204:function(t,r,a){"use strict";a.d(r,"d",(function(){return getSpellCheckValue})),a.d(r,"a",(function(){return getAutoCapitalizeValue})),a.d(r,"b",(function(){return getAutoCompleteValue})),a.d(r,"c",(function(){return getAutoCorrectValue}));var l=a(0),S=a.n(l);function getSpellCheckValue(t){return S.a.isBoolean(t)?t:!!S.a.isString(t)&&"true"===t}function getAutoCapitalizeValue(t){return defaultCheck(t)}function getAutoCompleteValue(t){return defaultCheck(t)}function getAutoCorrectValue(t){return defaultCheck(t)}function defaultCheck(t){return S.a.isString(t)?"true"===t?"on":"off":S.a.isBoolean(t)&&t?"on":"off"}},205:function(t,r,a){"use strict";var l=a(0),S=a.n(l),O=a(5),T=a.n(O),L=a(208),E=(a(2),a(9),a(6)),D=a(200),j="".concat(E.a.apiHost,"/asset/view"),V="".concat(E.a.apiHost,"/asset/viewProcessed"),B={uploading:"uploading",failed:"failed",complete:"complete"};r.a=T.a.Model.extend({UPLOAD_STATUS:B,initialize:function initialize(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=t.file,l=r.eventBus,O=r.activity,T=r.securityObject,L=r.hasVideoSupport,E=r.hasVideoRecordingSupport,D=r.assetExtension,j=r.assetMimeType,V=r.assetPath,q=r.responseId;if(this.options=r,this.eventBus=l,this.activity=O,this.securityToken=this._uriEncodeObject(T),this.responseId=q,this.hasVideoSupport=L,this.hasVideoRecordingSupport=E,this.set("id",S.a.uniqueId()),!S.a.isUndefined(a)&&this.validateFile(a)){if(this.file=a,this.set({name:a.name,originalName:a.name,extension:D,size:a.size,mimetype:j||a.type,status:B.uploading,hasUploaded:this.hasUploaded(),description:"",hasFailed:!1,hasNotifiedFailure:!0,assetPath:V}),(E||L)&&this.isVideoFile()){var G=V.substr(0,V.lastIndexOf(".")),K=this.get("name").substr(0,this.get("name").lastIndexOf("."));this.set({assetProcessedPath:"".concat(G,".").concat("mp4"),extension:"mp4",name:"".concat(K,".").concat("mp4")})}this.uploadAndHandle()}else this.set({status:B.complete,hasUploaded:!0});this.set("colorClass",this.getIconColorClass(this.get("extension")))},validateFile:function validateFile(t){return t instanceof File||t instanceof Blob&&!!t.name},hasUploaded:function hasUploaded(){return this.get("status")===B.complete},upload:function upload(){return L.a.upload({file:this.file,activity:this.activity,responseId:this.responseId,extension:this.get("extension"),mimeType:this.get("mimetype"),assetPath:this.get("assetPath"),assetProcessedPath:this.get("assetProcessedPath"),hasVideoSupport:this.hasVideoSupport})},uploadAndHandle:function uploadAndHandle(){var t=this;return this.upload().then((function(){t.handleUploadSuccess()})).catch((function(){t.handleUploadFail()}))},abortUpload:function abortUpload(){L.a.abort(this.get("assetPath"))},isSubmitPractice:function isSubmitPractice(){return this.options.activity.get("type")===this.activity.TYPE.SUBMIT_PRACTICE},isVideoFile:function isVideoFile(){var t=D.a.getExtensions("video"),r=this.get("extension");return S.a.contains(t,r)},handleUploadSuccess:function handleUploadSuccess(){var t=this.options.onUploadSuccess;this.set({status:B.complete,hasUploaded:!0,hasNotifiedFailure:!0}),S.a.isUndefined(this.eventBus)||this.eventBus.trigger("fileUploaded",this),t&&t()},handleUploadFail:function handleUploadFail(){var t=this.options.onUploadError;this.set({status:B.failed,hasFailed:!0,hasNotifiedFailure:!1}),S.a.isUndefined(this.eventBus)||this.eventBus.trigger("fileUploadFailed",this),t&&t()},getViewUrl:function getViewUrl(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],r={assetPath:this.get("assetPath")},a=j;this.get("assetProcessedPath")&&(r.assetProcessedPath=this.get("assetProcessedPath"),r.assetOriginalName=this.get("originalName"),a=V),t&&(r.assetName=this.get("name"));var l=this._uriEncodeObject(r);return"".concat(a,"?action=get&security=").concat(this.securityToken,"&usrequest=").concat(l)},retryUpload:function retryUpload(){this.get("hasFailed")&&(this.set({hasFailed:!1,status:B.uploading}),this.uploadAndHandle())},clearFailNotification:function clearFailNotification(){this.set("hasNotifiedFailure",!0)},getIconColorClass:function getIconColorClass(t){var r="default";switch(t){case"png":case"gif":case"pdf":case"csv":case"rtf":case"txt":case"xps":r=t;break;case"jpg":case"jpeg":r="jpg";break;case"doc":case"docx":case"dot":case"dotx":case"docm":case"dotm":r="word";break;case"xls":case"xlsx":case"xlt":case"xltm":case"xlsm":r="excel";break;case"ppt":case"pps":case"pot":case"pptx":case"pptm":case"potx":case"potm":case"ppsx":case"ppsm":r="powerpoint";break;case"pub":r="publisher";break;case"odf":case"odt":case"ods":case"odp":r="open-office";break;case"mp4":case"mov":case"avi":r="video"}return"".concat("lrn-file-").concat(r)},updateDescription:function updateDescription(t){this.set({description:t})},_uriEncodeObject:function _uriEncodeObject(t){return encodeURIComponent(JSON.stringify(t))}})},208:function(t,r,a){"use strict";var l=a(0),S=a.n(l),O=(a(236),a(2)),T=(a(17),a(9));function _defineProperties(t,r){for(var a=0;a<r.length;a++){var l=r[a];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(t,l.key,l)}}var L=function(){function S3(){var t=this;!function _classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,S3),this.promise=new O.default((function(r,a){t.resolve=r,t.reject=a}))}return function _createClass(t,r,a){return r&&_defineProperties(t.prototype,r),a&&_defineProperties(t,a),t}(S3,[{key:"request",value:function request(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.send(t),this.promise}},{key:"handleSuccess",value:function handleSuccess(t){t.target.status<400?this.resolve(t):this.handleFailure(t)}},{key:"handleFailure",value:function handleFailure(t){this.reject(t.target.status)}},{key:"send",value:function send(){var t=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=new FormData,l=r.data.data.file,O="".concat(r.data.data.name,".").concat(r.data.data.extension),T=new XMLHttpRequest,L=l.slice(0,l.size,l.type),E=0;S.a.each(r.formInputs,(function(t,r){a.append(r,t)})),a.append("file",L,O),T.addEventListener("load",(function(r){t.handleSuccess(r)})),T.addEventListener("error",(function(r){t.handleFailure(r)})),T.upload.addEventListener("progress",(function(t){E=t.loaded})),T.open(r.formAttributes.method,r.formAttributes.action),T.send(a),r.onSendStart&&r.onSendStart({abort:function abort(){return T.abort()},getUploadedBytes:function getUploadedBytes(){return E}})}}]),S3}(),E=a(7),D=(a.n(E).a.isMicrosoft,[]),j=[],V=!1,B=[],q={MAX_ATTEMPTS:3,RETRY_DELAY:8e3,upload:function upload(){var t=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.validate(r);var a=r.activity,l=r.extension,S=r.file,T=r.assetPath,L=r.mimeType,E=a.get("security"),D={extension:l,file:S,assetPath:T,mimeType:L};return new O.default((function(r,a){var l={security:E.getRequestParameters(),data:D,success:function success(){t.removeFromQueue(l),t.resumeQueue(),r(D)},failure:function failure(r){t.removeFromQueue(l),t.resumeQueue(),a(r)}};t.addToQueue(l)}))},validate:function validate(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!t.file)throw new Error("FileUpload missing file");if(!S.a.isObject(t.activity))throw new Error("FileUpload missing activity");if(!S.a.isString(t.responseId))throw new Error("FileUpload missing responseId");if(!S.a.isString(t.extension))throw new Error("FileUpload missing file extension")},addToQueue:function addToQueue(t){if(this.getQueueItem(t.data.assetPath))throw new Error("Attempting to add duplicate assetPath to upload queue: ".concat(t.data.assetPath));B.push({config:t,isProcessing:!1,attempts:0}),this.processQueue()},abort:function abort(t){var r=this.getQueueItem(t);if(r){var a=r.config.s3Upload;a&&a.abort(),this.removeFromQueue(r),r.isProcessing&&this.resumeQueue()}},removeFromQueue:function removeFromQueue(t){clearTimeout(t.retryTimeoutId),B=S.a.filter(B,(function(r){return S.a.getNested(t,"data.assetPath")!==S.a.getNested(r,"config.data.assetPath")}))},resumeQueue:function resumeQueue(){V=!1,this.processQueue()},processQueue:function processQueue(){if(!V){var t=S()(B).find((function(t){return!t.isProcessing}));t&&this.processQueueItem(t)}},processQueueItem:function processQueueItem(t){var r=this,a=t.config,l=a.data,O=l.assetPath,L=l.mimeType;S.a.contains(B,t)&&(V=!0,t.isProcessing=!0,t.attempts++,T.a.request({url:"/asset/uploadform",security:a.security,action:T.a.ACTION.GET,data:{assetPath:O,mimeType:L},success:function success(a){r.handleTokenSuccess(t,a)},failure:function failure(){r.handleFailure(t)}}))},handleTokenSuccess:function handleTokenSuccess(t,r){var a=this,l=t.config;if(S.a.contains(B,t)){var O=new L;S.a.getNested(r,"response.data")?O.request({formAttributes:r.response.data.formAttributes,formInputs:r.response.data.formInputs,data:l,onSendStart:function onSendStart(t){l.s3Upload=t}}).then((function(){l.success()})).catch((function(){a.handleFailure(t)})):this.handleFailure(t)}},handleFailure:function handleFailure(t){var r=this;t.attempts<this.MAX_ATTEMPTS?(clearTimeout(t.retryTimeoutId),t.retryTimeoutId=setTimeout((function(){return r.processQueueItem(t)}),this.RETRY_DELAY)):t.config.failure.call(null,"Could not upload after ".concat(this.MAX_ATTEMPTS," attempts"))},isSafeToUnload:function isSafeToUnload(){var t=S.a.find(B,(function(t){return t.isProcessing}));return!V&&!t},isAssetPathInQueue:function isAssetPathInQueue(t){return S.a.some(B,(function(r){return r.config.data.assetPath===t}))},getQueueItem:function getQueueItem(t){return S()(B).find((function(r){return t===r.config.data.assetPath}))},getUploadStatus:function getUploadStatus(){var t=0,r=0;return S.a.each(j,(function(a){a.each((function(a){r+=a.get("size"),a.get("hasUploaded")&&(t+=a.get("size"))}))})),B.forEach((function(r){var a=r.config.s3Upload;a&&(t+=a.getUploadedBytes())})),{uploadComplete:this.isSafeToUnload(),totalBytes:r,bytesUploaded:t}},hookToActivity:function hookToActivity(t,r){S.a.contains(j,r)||j.push(r),S.a.isEmpty(t)||S.a.contains(D,t)||(t.hooks.unload.push(this.isSafeToUnload),t.hooks.saveProgress.push(S.a.bind(this.getUploadStatus,this)),D.push(t))}};r.a=q},212:function(t,r,a){"use strict";a.d(r,"a",(function(){return applySelectiveFontBoost}));var l=a(7),S=a.n(l);function applySelectiveFontBoost(t,r){t&&!r&&S.a.isWindows&&[].slice.call(t.querySelectorAll(".mq-math-mode span")).filter((function(t){return"−"===t.textContent})).forEach((function(t){t.style.fontSize="120%"}))}},214:function(t,r,a){"use strict";var l=a(0),S=a.n(l),O=a(175);r.a=function getOrderedListBasedOnQuestion(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0;if(!r.shuffle_options)return S.a.deepClone(t);if(!S.a.isString(a))throw new Error("getOrderedListBasedOnQuestion requires a seed");return Object(O.a)({seed:a,exclusions:t,questionMetadata:r.metadata,originalOrder:t})}},215:function(t,r,a){"use strict";a.d(r,"b",(function(){return B}));var l,S=a(0),O=a.n(S),T=a(195),L=a(25),E=a(255);function _defineProperty(t,r,a){return r in t?Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[r]=a,t}var D=Object(E.a)("[\\p{L}\\p{N}]"),j=T.a.actionTypes,V=(_defineProperty(l={},j.LONGTEXTV2_UPDATE_WORD_COUNT,(function(t,r){var a=t.footer,l=function getWordCount(t){if(!O.a.isString(t)||O.a.isEmpty(t))return 0;return t=B(t),O.a.reduce(t.split(/\s+/),(function(t,r){return r.length>0&&D.test(r)?t+1:t}),0)}(r.value);return{footer:O.a.extend({},a,{wordCount:l})}})),_defineProperty(l,j.LONGTEXTV2_UPDATE_WORD_COUNT_EXCEEDED,(function(t,r){return{wordCountExceeded:r.value}})),_defineProperty(l,j.LONGTEXTV2_UPDATE_WORD_LIMIT_VISIBILITY,(function(t,r){var a=t.footer,l=r.value;return{footer:O.a.extend({},a,{wordStaticVisible:l.wordStatic,wordLimitVisible:l.wordLimit})}})),_defineProperty(l,j.LONGTEXTV2_UPDATE_CHARACTER_COUNT,(function(t,r){var a=t.footer;return{characterCountExceeded:r.exceeded,footer:O.a.extend({},a,{characterCount:r.count})}})),_defineProperty(l,j.LONGTEXTV2_DISABLE_EDITOR,(function(t,r){return{disabled:r.value}})),l);var B=function removeElementsInText(t){return t?t.replace(/( | )/," ").replace(/[\n\r]/g," ").replace(/&nbsp;/g," ").replace(/<\/p>/g," ").replace(/<\/blockquote>/g," ").replace(/<\/li>/g," ").replace(/<\/div>/g," ").replace(/<br>/g," ").replace(/<br \/>/g," ").replace(/<.*?>/g,""):""};r.a=Object(L.a)(V,{imageUrl:null,error:null})},218:function(t,r,a){"use strict";a.d(r,"a",(function(){return mathAccessibility}));var l=a(0),S=a.n(l);function mathAccessibility(t,r){t.processAccessibility=S.a.wrap(t.processAccessibility,(function(r,a){(a=a||{}).getSourceText=function(t){return t.find(".lrn-spokenmath").text()},r.call(t,a)})),t.activity.get("state")===t.activity.STATE.REVIEW&&(t.processAccessibility=S.a.wrap(t.processAccessibility,(function(a,l){var O=r(),T=0;S.a.each(O,(function(r){var S=r.mathEvents;t.listenToOnce(S,S.EVENT.EDITOR_SPOKENMATH_UPDATED,(function(){++T===O.length&&a.call(t,l)}))}))})))}},220:function(t,r,a){"use strict";var l=a(1),S=a.n(l),O=a(0),T=a.n(O),L=a(53),E=a(250),D=a.n(E),j=a(213),V=a.n(j),B=a(11),q=a(24),G=(a(7),L.a.extend({template:D.a,responseMarkerRegExp:void 0,responseValue:[],showingValidationUI:!1,previousResponseValue:[],readOnly:!1,validGap:11,pointLeftRightGap:1.4,pointerWidth:20,pointerTopBottomHeight:25,pointerLeftRightHeight:36,pointerHeight:"10px",RESPONSE_CONTAINER_DEFAULT_DATA:{defaultData:{bottom:"0px",width:"96px",height:"2.3em"},imageclozeassociation:{width:"20px"},imageclozedropdown:{width:"50px"}},responseContainerDefaultInputType:"text",responseContainerInputTypes:["text","number"],incorrectAnswerBubbleTemplate:V.a,initialize:function initialize(){var t,r;L.a.prototype.initialize.call(this),this.jqNamespace=".lrn-cloze-".concat(this.cid),this.events=T.a.extend({},G.prototype.events,this.events),this.activity=this.options.activity,this.i18n=this.activity.get("i18n"),this.responseMarkerRegExp=new RegExp(this.model.RESPONSE_MARKER_REGEXP,"g"),t=this.model.getContentTemplate().match(this.responseMarkerRegExp),this.responseValue=[],this.responseValue.length=t?t.length:0;for(var a=0;a<this.responseValue.length;a++)this.responseValue[a]=null;this.activity.get("state")===this.activity.STATE.RESUME&&this.model.hasResponse()&&(this.responseValue=this.model.getResponseValue()||[]),this.responseContainerDefaultData=T.a.extend({},this.RESPONSE_CONTAINER_DEFAULT_DATA.defaultData),(r=this.RESPONSE_CONTAINER_DEFAULT_DATA[this.model.get("type")])&&T.a.extend(this.responseContainerDefaultData,r),this.readOnly=this.activity.get("state")===this.activity.STATE.REVIEW||this.activity.get("state")===this.activity.STATE.PREVIEW,this.displayLogic={},this.addRenderingLogic(),this.render(),this.initialisationCompleted()},render:function render(t){var r,a=this.model,l=this,O=a.get("question"),L=a.isVerticalTopContainer();function resizeImage(){var t=function setWidth(){return Object(q.a)(l.$el,(function(){l.setImageWidth()}))};t(),l.isListeningToWindowResize||(S()(window).on("resize"+l.jqNamespace,t),l.isListeningToWindowResize=!0)}function resizeImageOnLoad(){var t=l.$(".lrn_imagecloze_image");t.prop("complete")?resizeImage():t.on("load",resizeImage)}return r=t||this.template({questionResponse:a,displayLogic:this.displayLogic,labels:this.i18n.labels}),this.renderViewContent(r,this.extraClasses),this.displayLogic.isReviewState&&this.renderValidatableUI(),this.$el.toggleClass("lrn_cloze_vertical_top_none",!L),this.displayLogic.isMath&&a.isImageCloze()&&T.a.hasProperty(O,"ui_style.possibility_list_position")&&("left"===O.ui_style.possibility_list_position||"right"===O.ui_style.possibility_list_position)?this.mathquillRendering()?(this.renderMathquill(),resizeImageOnLoad()):B.a.once(B.a.EVENT.RENDERED,resizeImageOnLoad):resizeImageOnLoad(),this},setImageWidth:function setImageWidth(){var t=this.$(".lrn_imagecloze_image"),r=this.$(".lrn_possibilityList"),a=this.$(".lrn_imagecloze_container"),l=this.$(".lrn_cloze_response_container"),S=this.$(".lrn_response_input"),O=this.$(".lrn_response_innerbody");l.add(O).add(a).add(t).css({maxWidth:"",width:""});var L,E,D,j,V,B,q=2*parseFloat(S.css("padding-left"),10)||0,G=O.innerWidth(),K=r.length,X=this.getScaledWidth(t.width());return t.css({width:X}),l.css({"max-width":G,display:"block"}),K&&(E=r.css("position"),r.css("position","absolute"),D=this.model.get("question"),B=T.a.hasProperty(D,"ui_style.possibility_list_position")&&("left"===D.ui_style.possibility_list_position||"right"===D.ui_style.possibility_list_position),L=this.$(".lrn_response_innerbody"),j=S.outerWidth(),V=0,r.css("position",E),B&&(V=r.outerWidth()),l.css({width:this.getScaledWidth(j+V+q)}),L.css({"max-width":G,width:this.getScaledWidth(j+V+q)})),a.css({width:t.width()}),X},getScaledWidth:function getScaledWidth(t){return this.displayLogic.imageScale?t/this.model.FONTSIZE_MAP[this.model.FONTSIZE.NORMAL]+"em":t},addRenderingLogic:function addRenderingLogic(){L.a.prototype.addRenderingLogic.call(this);var t=this,r=this.model.get("question"),a=this.activity.get("state")===this.activity.STATE.REVIEW;this.displayLogic.readOnly=a||this.activity.get("state")===this.activity.STATE.PREVIEW,this.displayLogic.multipleResponses=this.responseValue&&this.responseValue.length>1,this.displayLogic.isMath=!!r.is_math,T.a.isObject(this.displayLogic.responseContainer)||(this.displayLogic.responseContainer={}),this.displayLogic.responseContainer.inputType=this.responseContainerDefaultInputType,T.a.isObject(r.response_container)&&(r.response_container.hasOwnProperty("width")&&(this.displayLogic.responseContainer.width=r.response_container.width,r.response_container.width.indexOf("%")>0&&(this.displayLogic.responseContainer.fluid_width=!0)),r.response_container.hasOwnProperty("height")&&(this.displayLogic.responseContainer.height=r.response_container.height,r.response_container.height.indexOf("%")>0&&(this.displayLogic.responseContainer.fluid_height=!0)),r.response_container.hasOwnProperty("placeholder")&&(this.displayLogic.responseContainer.placeholder=r.response_container.placeholder,this.displayLogic.responseContainer.showPlaceholder=!T.a.isEmpty(r.response_container.placeholder)&&!this.displayLogic.readOnly),r.response_container.hasOwnProperty("pointer")&&(this.displayLogic.responseContainer.pointer=r.response_container.pointer),r.response_container.hasOwnProperty("wordwrap")&&(this.displayLogic.responseContainer.wordwrap=r.response_container.wordwrap),T.a.contains(this.responseContainerInputTypes,r.response_container.input_type)&&(this.displayLogic.responseContainer.inputType=r.response_container.input_type)),r.image&&(this.displayLogic.imageScale=r.image.scale),this.extraClasses="lrn_cloze";var l=this.model.getContentTemplate(),S=-1;l=l.replace(this.responseMarkerRegExp,(function(){return S++,t.getResponseInputHTML(S,t.getPointerVars(S))})),this.displayLogic.processedTemplate=l,this.displayLogic.extraContentHTML=this.getExtraContentHTML()},getResponseInputHTML:function getResponseInputHTML(t){return"{replacedInput"+t+"}"},getExtraContentHTML:function getExtraContentHTML(){return null},showCorrectAnswer:function showCorrectAnswer(){this.showCorrectAnswerList()},showCorrectAnswersHover:function showCorrectAnswersHover(){throw new Error("Unimplemented function showCorrectAnswersHover for question type:"+this.model.get("type"))},getResponseContainerFor:function getResponseContainerFor(t){var r=this.model.get("question"),a=T.a.extend({},this.displayLogic.responseContainer);return T.a.isArray(r.response_containers)&&T.a.isObject(r.response_containers[t])&&(T.a.extend(a,r.response_containers[t]),T.a.contains(this.responseContainerInputTypes,r.response_containers[t].input_type)&&(a.inputType=r.response_containers[t].input_type),a.showPlaceholder=!T.a.isEmpty(a.placeholder)&&!this.displayLogic.readOnly),a},getImageClozeAriaLabelFor:function getImageClozeAriaLabelFor(t){var r=this.model.getImageClozeAriaLabels();if(T.a.isArray(r))return r[t]},getPointerVars:function getPointerVars(t){if(!this.model.isImageCloze())return{};var r=this.model.getFontSize(),a=this.getResponseContainerFor(t),l=this.getPixel(a.width||this.responseContainerDefaultData.width,r),S=this.getPixel(a.height||this.responseContainerDefaultData.height,r),O=this.getPixel(a.height||this.responseContainerDefaultData.bottom,r),T=(this.getPixel(this.pointerHeight,r),{position:a.pointer});switch(this.model.get("type")===this.model.TYPE.IMAGECLOZEDROPDOWN&&(this.validGap=0),this.model.get("type")===this.model.TYPE.IMAGECLOZETEXT&&(this.responseContainerDefaultHeight="24px"),a.pointer){case"top":T.top=S/2+this.getPointLeftRightGap()+"px",T.left=this.getEm(-1*(Math.ceil((l-this.pointerWidth)/2)+2));break;case"right":T.right=this.pointerWidth/2+this.getPointLeftRightGap()+"px",T.top=this.getEm(-1*Math.floor((S-this.pointerLeftRightHeight)/2));break;case"bottom":T.bottom=O+this.getPointLeftRightGap()/2+"px",T.left=this.getEm(-1*(Math.ceil((l-this.pointerWidth)/2)+2));break;case"left":T.left=this.pointerWidth*this.pointLeftRightGap+this.getPointLeftRightGap()+"px",T.top=this.getEm(-1*Math.floor((S-this.pointerLeftRightHeight)/2));break;default:T={}}return T},getPointLeftRightGap:function getPointLeftRightGap(){if(!this._pointLeftRightGap){var t=this.model.getFontSize();this._pointLeftRightGap=this.pointLeftRightGap*t}return this._pointLeftRightGap},getPixel:function getPixel(t,r){var a=(t=t.toString()).substr(-2),l=parseFloat(t.substr(0,t.length-2));return"em"===a?l*r:l},getEm:function getEm(t,r,a){var l=t/(a?this.model.FONTSIZE_MAP.normal:this.model.getFontSize());return r?l:l+"em"},remove:function remove(){S()(window).off(this.jqNamespace),L.a.prototype.remove.call(this)}}));r.a=G},225:function(t,r,a){"use strict";var l=a(0),S=a.n(l),O=a(5),T=a.n(O),L=a(205);r.a=T.a.Collection.extend({model:L.a,comparator:"name",ATTRS_FOR_RESPONSE:["name","description","originalName","extension","size","assetPath","assetProcessedPath"],getResponseValueFormat:function getResponseValueFormat(){var t=this,r=this.where({hasUploaded:!0});return S()(r).map((function(r){return r.pick(t.ATTRS_FOR_RESPONSE)}))}})},226:function(module,exports,__webpack_require__){var _=__webpack_require__(0);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="lrn_imagecloze_container"'+(null==(__t=displayLogic.padding?' style="padding: '+displayLogic.padding+'px"':"")?"":__t)+' ><img draggable="false"',displayLogic.img_alt&&(__p+='alt="'+(null==(__t=displayLogic.img_alt)?"":_.escape(__t))+'"'),__p+="",displayLogic.img_title&&(__p+='title="'+(null==(__t=displayLogic.img_title)?"":_.escape(__t))+'"'),__p+='class="lrn_imagecloze_image"src="'+(null==(__t=displayLogic.img_src)?"":_.escape(__t))+'">',_.each(displayLogic.response_positions,(function(t){__p+='<div class="lrn_imagecloze_response" style="left:'+(null==(__t=t.x)?"":__t)+"%;top:"+(null==(__t=t.y)?"":__t)+"%;",displayLogic.response_container&&"imageclozeassociation"===displayLogic.question_type&&(__p+="",displayLogic.response_container.hasOwnProperty("height")&&(__p+="height:"+(null==(__t=displayLogic.response_container.height)?"":__t)+";"),__p+=""),__p+='">{{response}}</div>'})),__p+="</div>";return __p}},228:function(t,r,a){"use strict";var l=a(289),S=a.n(l),O=a(190);r.a=function validateSingleSpec(t,r){return O.a.useMathCore(t)?S.a.evaluateVerbose(t,r):O.a.validate(t,r)}},235:function(t,r,a){"use strict";var l=a(0),S=a.n(l),O=a(208),T=a(205),L=a(225),E=a(200),D=a(247);function ownKeys(t,r){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);r&&(l=l.filter((function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable}))),a.push.apply(a,l)}return a}function _objectSpread(t){for(var r=1;r<arguments.length;r++){var a=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(a),!0).forEach((function(r){_defineProperty(t,r,a[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):ownKeys(Object(a)).forEach((function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(a,r))}))}return t}function _defineProperty(t,r,a){return r in t?Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[r]=a,t}var j=-90,V=-180,B=-270;function getImageConversionOrientation(t){return t===j?8:t===V?3:t===B?6:void 0}function ImageUploader(t){this.activity=t.activity,this.modelId=t.modelId,this.responseId=t.responseId,this.eventBus=t.eventBus,this.compression=t.compression,this.assets=new L.a,O.a.hookToActivity(this.activity,this.assets)}S.a.extend(ImageUploader.prototype,{compressImage:function compressImage(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};r=S.a.extend(this.compression,r);var a=.001*Math.min(t.size,r.size),l=parseInt(a-Math.max(.1*a,1),10),O=_objectSpread(_objectSpread({},r),{},{size:Math.abs(l),orientation:getImageConversionOrientation(r.rotation)});return delete O.rotation,D.compressAccurately(t,O).then((function(r){return r.name=t.name,r.lastModified=t.lastModified,r.lastModifiedDate=t.lastModifiedDate,r}))},upload:function upload(t){var r=E.a.createFullPath(this.activity,this.modelId,t.name,!0),a=E.a.getValidExtension(t.name),l=E.a.getMimeTypeByExtension(a);return this.assets.add({file:t},{assetPath:r,assetExtension:a,assetMimeType:l,activity:this.activity,responseId:this.responseId,eventBus:this.eventBus,securityObject:this.getSecurityObject()})},resume:function resume(t){return this.assets.add({assetPath:t},{securityObject:this.getSecurityObject()})},getSecurityObject:function getSecurityObject(){return this.activity.get("security").getRequestParameters()},currentUploadsCount:function currentUploadsCount(){return this.assets.where({status:T.a.prototype.UPLOAD_STATUS.uploading}).length}}),r.a=ImageUploader},236:function(t,r,a){"use strict";r.a={encode:function base64_encode(t){var r,a,l,S,O,T,L="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",E=0,D=0,j="",V=[];if(!t)return t;do{r=(O=t.charCodeAt(E++)<<16|t.charCodeAt(E++)<<8|t.charCodeAt(E++))>>18&63,a=O>>12&63,l=O>>6&63,S=63&O,V[D++]=L.charAt(r)+L.charAt(a)+L.charAt(l)+L.charAt(S)}while(E<t.length);return j=V.join(""),((T=t.length%3)?j.slice(0,T-3):j)+"===".slice(T||3)},decode:function base64_decode(t){var r,a,l,S,O,T,L="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",E=0,D=0,j=[];if(!t)return t;t+="";do{r=(T=L.indexOf(t.charAt(E++))<<18|L.indexOf(t.charAt(E++))<<12|(S=L.indexOf(t.charAt(E++)))<<6|(O=L.indexOf(t.charAt(E++))))>>16&255,a=T>>8&255,l=255&T,j[D++]=64===S?String.fromCharCode(r):64===O?String.fromCharCode(r,a):String.fromCharCode(r,a,l)}while(E<t.length);return j.join("")}}},244:function(t,r,a){"use strict";var l,S,O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};S=function(){for(var t=arguments.length,r=Array(t),a=0;a<t;a++)r[a]=arguments[a];var l=document.createElement("input");return"object"===O(r[0])&&(!0===r[0].multiple&&l.setAttribute("multiple",""),void 0!==r[0].accept&&l.setAttribute("accept",r[0].accept)),l.setAttribute("type","file"),l.style.display="none",l.setAttribute("id","hidden-file"),document.body.appendChild(l),new Promise((function(t){l.addEventListener("change",(function(){t(l.files);var a=r[r.length-1];"function"==typeof a&&a(l.files),document.body.removeChild(l)}));var a=document.createEvent("MouseEvents");a.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,0,null),l.dispatchEvent(a)}))},void 0===(l=function(){return S}.call(r,a,r,t))||(t.exports=l)},245:function(t,r,a){t.exports=function(){"use strict";var t=navigator.userAgent,r=navigator.platform,a=/gecko\/\d/i.test(t),l=/MSIE \d/.test(t),S=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(t),O=/Edge\/(\d+)/.exec(t),T=l||S||O,L=T&&(l?document.documentMode||6:+(O||S)[1]),E=!O&&/WebKit\//.test(t),D=E&&/Qt\/\d+\.\d+/.test(t),j=!O&&/Chrome\//.test(t),V=/Opera\//.test(t),B=/Apple Computer/.test(navigator.vendor),q=/Mac OS X 1\d\D([8-9]|\d\d)\D/.test(t),G=/PhantomJS/.test(t),K=B&&(/Mobile\/\w+/.test(t)||navigator.maxTouchPoints>2),X=/Android/.test(t),$=K||X||/webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(t),Z=K||/Mac/.test(r),Q=/\bCrOS\b/.test(t),ee=/win/i.test(r),te=V&&t.match(/Version\/(\d*\.\d*)/);te&&(te=Number(te[1])),te&&te>=15&&(V=!1,E=!0);var ne=Z&&(D||V&&(null==te||te<12.11)),re=a||T&&L>=9;function classTest(t){return new RegExp("(^|\\s)"+t+"(?:$|\\s)\\s*")}var oe,rmClass=function(t,r){var a=t.className,l=classTest(r).exec(a);if(l){var S=a.slice(l.index+l[0].length);t.className=a.slice(0,l.index)+(S?l[1]+S:"")}};function removeChildren(t){for(var r=t.childNodes.length;r>0;--r)t.removeChild(t.firstChild);return t}function removeChildrenAndAdd(t,r){return removeChildren(t).appendChild(r)}function elt(t,r,a,l){var S=document.createElement(t);if(a&&(S.className=a),l&&(S.style.cssText=l),"string"==typeof r)S.appendChild(document.createTextNode(r));else if(r)for(var O=0;O<r.length;++O)S.appendChild(r[O]);return S}function eltP(t,r,a,l){var S=elt(t,r,a,l);return S.setAttribute("role","presentation"),S}function contains(t,r){if(3==r.nodeType&&(r=r.parentNode),t.contains)return t.contains(r);do{if(11==r.nodeType&&(r=r.host),r==t)return!0}while(r=r.parentNode)}function activeElt(){var t;try{t=document.activeElement}catch(r){t=document.body||null}for(;t&&t.shadowRoot&&t.shadowRoot.activeElement;)t=t.shadowRoot.activeElement;return t}function addClass(t,r){var a=t.className;classTest(r).test(a)||(t.className+=(a?" ":"")+r)}function joinClasses(t,r){for(var a=t.split(" "),l=0;l<a.length;l++)a[l]&&!classTest(a[l]).test(r)&&(r+=" "+a[l]);return r}oe=document.createRange?function(t,r,a,l){var S=document.createRange();return S.setEnd(l||t,a),S.setStart(t,r),S}:function(t,r,a){var l=document.body.createTextRange();try{l.moveToElementText(t.parentNode)}catch(t){return l}return l.collapse(!0),l.moveEnd("character",a),l.moveStart("character",r),l};var selectInput=function(t){t.select()};function bind(t){var r=Array.prototype.slice.call(arguments,1);return function(){return t.apply(null,r)}}function copyObj(t,r,a){for(var l in r||(r={}),t)!t.hasOwnProperty(l)||!1===a&&r.hasOwnProperty(l)||(r[l]=t[l]);return r}function countColumn(t,r,a,l,S){null==r&&-1==(r=t.search(/[^\s\u00a0]/))&&(r=t.length);for(var O=l||0,T=S||0;;){var L=t.indexOf("\t",O);if(L<0||L>=r)return T+(r-O);T+=L-O,T+=a-T%a,O=L+1}}K?selectInput=function(t){t.selectionStart=0,t.selectionEnd=t.value.length}:T&&(selectInput=function(t){try{t.select()}catch(t){}});var Delayed=function(){this.id=null,this.f=null,this.time=0,this.handler=bind(this.onTimeout,this)};function indexOf(t,r){for(var a=0;a<t.length;++a)if(t[a]==r)return a;return-1}Delayed.prototype.onTimeout=function(t){t.id=0,t.time<=+new Date?t.f():setTimeout(t.handler,t.time-+new Date)},Delayed.prototype.set=function(t,r){this.f=r;var a=+new Date+t;(!this.id||a<this.time)&&(clearTimeout(this.id),this.id=setTimeout(this.handler,t),this.time=a)};var ie={toString:function(){return"CodeMirror.Pass"}},ae={scroll:!1},se={origin:"*mouse"},le={origin:"+move"};function findColumn(t,r,a){for(var l=0,S=0;;){var O=t.indexOf("\t",l);-1==O&&(O=t.length);var T=O-l;if(O==t.length||S+T>=r)return l+Math.min(T,r-S);if(S+=O-l,l=O+1,(S+=a-S%a)>=r)return l}}var ce=[""];function spaceStr(t){for(;ce.length<=t;)ce.push(lst(ce)+" ");return ce[t]}function lst(t){return t[t.length-1]}function map(t,r){for(var a=[],l=0;l<t.length;l++)a[l]=r(t[l],l);return a}function nothing(){}function createObj(t,r){var a;return Object.create?a=Object.create(t):(nothing.prototype=t,a=new nothing),r&&copyObj(r,a),a}var ue=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;function isWordCharBasic(t){return/\w/.test(t)||t>""&&(t.toUpperCase()!=t.toLowerCase()||ue.test(t))}function isWordChar(t,r){return r?!!(r.source.indexOf("\\w")>-1&&isWordCharBasic(t))||r.test(t):isWordCharBasic(t)}function isEmpty(t){for(var r in t)if(t.hasOwnProperty(r)&&t[r])return!1;return!0}var de=/[\u0300-\u036f\u0483-\u0489\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u065e\u0670\u06d6-\u06dc\u06de-\u06e4\u06e7\u06e8\u06ea-\u06ed\u0711\u0730-\u074a\u07a6-\u07b0\u07eb-\u07f3\u0816-\u0819\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0900-\u0902\u093c\u0941-\u0948\u094d\u0951-\u0955\u0962\u0963\u0981\u09bc\u09be\u09c1-\u09c4\u09cd\u09d7\u09e2\u09e3\u0a01\u0a02\u0a3c\u0a41\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a70\u0a71\u0a75\u0a81\u0a82\u0abc\u0ac1-\u0ac5\u0ac7\u0ac8\u0acd\u0ae2\u0ae3\u0b01\u0b3c\u0b3e\u0b3f\u0b41-\u0b44\u0b4d\u0b56\u0b57\u0b62\u0b63\u0b82\u0bbe\u0bc0\u0bcd\u0bd7\u0c3e-\u0c40\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62\u0c63\u0cbc\u0cbf\u0cc2\u0cc6\u0ccc\u0ccd\u0cd5\u0cd6\u0ce2\u0ce3\u0d3e\u0d41-\u0d44\u0d4d\u0d57\u0d62\u0d63\u0dca\u0dcf\u0dd2-\u0dd4\u0dd6\u0ddf\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0eb1\u0eb4-\u0eb9\u0ebb\u0ebc\u0ec8-\u0ecd\u0f18\u0f19\u0f35\u0f37\u0f39\u0f71-\u0f7e\u0f80-\u0f84\u0f86\u0f87\u0f90-\u0f97\u0f99-\u0fbc\u0fc6\u102d-\u1030\u1032-\u1037\u1039\u103a\u103d\u103e\u1058\u1059\u105e-\u1060\u1071-\u1074\u1082\u1085\u1086\u108d\u109d\u135f\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b7-\u17bd\u17c6\u17c9-\u17d3\u17dd\u180b-\u180d\u18a9\u1920-\u1922\u1927\u1928\u1932\u1939-\u193b\u1a17\u1a18\u1a56\u1a58-\u1a5e\u1a60\u1a62\u1a65-\u1a6c\u1a73-\u1a7c\u1a7f\u1b00-\u1b03\u1b34\u1b36-\u1b3a\u1b3c\u1b42\u1b6b-\u1b73\u1b80\u1b81\u1ba2-\u1ba5\u1ba8\u1ba9\u1c2c-\u1c33\u1c36\u1c37\u1cd0-\u1cd2\u1cd4-\u1ce0\u1ce2-\u1ce8\u1ced\u1dc0-\u1de6\u1dfd-\u1dff\u200c\u200d\u20d0-\u20f0\u2cef-\u2cf1\u2de0-\u2dff\u302a-\u302f\u3099\u309a\ua66f-\ua672\ua67c\ua67d\ua6f0\ua6f1\ua802\ua806\ua80b\ua825\ua826\ua8c4\ua8e0-\ua8f1\ua926-\ua92d\ua947-\ua951\ua980-\ua982\ua9b3\ua9b6-\ua9b9\ua9bc\uaa29-\uaa2e\uaa31\uaa32\uaa35\uaa36\uaa43\uaa4c\uaab0\uaab2-\uaab4\uaab7\uaab8\uaabe\uaabf\uaac1\uabe5\uabe8\uabed\udc00-\udfff\ufb1e\ufe00-\ufe0f\ufe20-\ufe26\uff9e\uff9f]/;function isExtendingChar(t){return t.charCodeAt(0)>=768&&de.test(t)}function skipExtendingChars(t,r,a){for(;(a<0?r>0:r<t.length)&&isExtendingChar(t.charAt(r));)r+=a;return r}function findFirst(t,r,a){for(var l=r>a?-1:1;;){if(r==a)return r;var S=(r+a)/2,O=l<0?Math.ceil(S):Math.floor(S);if(O==r)return t(O)?r:a;t(O)?a=O:r=O+l}}var pe=null;function getBidiPartAt(t,r,a){var l;pe=null;for(var S=0;S<t.length;++S){var O=t[S];if(O.from<r&&O.to>r)return S;O.to==r&&(O.from!=O.to&&"before"==a?l=S:pe=S),O.from==r&&(O.from!=O.to&&"before"!=a?l=S:pe=S)}return null!=l?l:pe}var fe=function(){var t=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/,r=/[stwN]/,a=/[LRr]/,l=/[Lb1n]/,S=/[1n]/;function BidiSpan(t,r,a){this.level=t,this.from=r,this.to=a}return function(O,T){var L="ltr"==T?"L":"R";if(0==O.length||"ltr"==T&&!t.test(O))return!1;for(var E,D=O.length,j=[],V=0;V<D;++V)j.push((E=O.charCodeAt(V))<=247?"bbbbbbbbbtstwsbbbbbbbbbbbbbbssstwNN%%%NNNNNN,N,N1111111111NNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNbbbbbbsbbbbbbbbbbbbbbbbbbbbbbbbbb,N%%%%NNNNLNNNNN%%11NLNNN1LNNNNNLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLN".charAt(E):1424<=E&&E<=1524?"R":1536<=E&&E<=1785?"nnnnnnNNr%%r,rNNmmmmmmmmmmmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmmmmmmmmnnnnnnnnnn%nnrrrmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmnNmmmmmmrrmmNmmmmrr1111111111".charAt(E-1536):1774<=E&&E<=2220?"r":8192<=E&&E<=8203?"w":8204==E?"b":"L");for(var B=0,q=L;B<D;++B){var G=j[B];"m"==G?j[B]=q:q=G}for(var K=0,X=L;K<D;++K){var $=j[K];"1"==$&&"r"==X?j[K]="n":a.test($)&&(X=$,"r"==$&&(j[K]="R"))}for(var Z=1,Q=j[0];Z<D-1;++Z){var ee=j[Z];"+"==ee&&"1"==Q&&"1"==j[Z+1]?j[Z]="1":","!=ee||Q!=j[Z+1]||"1"!=Q&&"n"!=Q||(j[Z]=Q),Q=ee}for(var te=0;te<D;++te){var ne=j[te];if(","==ne)j[te]="N";else if("%"==ne){var re=void 0;for(re=te+1;re<D&&"%"==j[re];++re);for(var oe=te&&"!"==j[te-1]||re<D&&"1"==j[re]?"1":"N",ie=te;ie<re;++ie)j[ie]=oe;te=re-1}}for(var ae=0,se=L;ae<D;++ae){var le=j[ae];"L"==se&&"1"==le?j[ae]="L":a.test(le)&&(se=le)}for(var ce=0;ce<D;++ce)if(r.test(j[ce])){var ue=void 0;for(ue=ce+1;ue<D&&r.test(j[ue]);++ue);for(var de="L"==(ce?j[ce-1]:L),pe=de==("L"==(ue<D?j[ue]:L))?de?"L":"R":L,fe=ce;fe<ue;++fe)j[fe]=pe;ce=ue-1}for(var he,ge=[],me=0;me<D;)if(l.test(j[me])){var ye=me;for(++me;me<D&&l.test(j[me]);++me);ge.push(new BidiSpan(0,ye,me))}else{var ve=me,be=ge.length,_e="rtl"==T?1:0;for(++me;me<D&&"L"!=j[me];++me);for(var we=ve;we<me;)if(S.test(j[we])){ve<we&&(ge.splice(be,0,new BidiSpan(1,ve,we)),be+=_e);var Ce=we;for(++we;we<me&&S.test(j[we]);++we);ge.splice(be,0,new BidiSpan(2,Ce,we)),be+=_e,ve=we}else++we;ve<me&&ge.splice(be,0,new BidiSpan(1,ve,me))}return"ltr"==T&&(1==ge[0].level&&(he=O.match(/^\s+/))&&(ge[0].from=he[0].length,ge.unshift(new BidiSpan(0,0,he[0].length))),1==lst(ge).level&&(he=O.match(/\s+$/))&&(lst(ge).to-=he[0].length,ge.push(new BidiSpan(0,D-he[0].length,D)))),"rtl"==T?ge.reverse():ge}}();function getOrder(t,r){var a=t.order;return null==a&&(a=t.order=fe(t.text,r)),a}var he=[],on=function(t,r,a){if(t.addEventListener)t.addEventListener(r,a,!1);else if(t.attachEvent)t.attachEvent("on"+r,a);else{var l=t._handlers||(t._handlers={});l[r]=(l[r]||he).concat(a)}};function getHandlers(t,r){return t._handlers&&t._handlers[r]||he}function off(t,r,a){if(t.removeEventListener)t.removeEventListener(r,a,!1);else if(t.detachEvent)t.detachEvent("on"+r,a);else{var l=t._handlers,S=l&&l[r];if(S){var O=indexOf(S,a);O>-1&&(l[r]=S.slice(0,O).concat(S.slice(O+1)))}}}function signal(t,r){var a=getHandlers(t,r);if(a.length)for(var l=Array.prototype.slice.call(arguments,2),S=0;S<a.length;++S)a[S].apply(null,l)}function signalDOMEvent(t,r,a){return"string"==typeof r&&(r={type:r,preventDefault:function(){this.defaultPrevented=!0}}),signal(t,a||r.type,t,r),e_defaultPrevented(r)||r.codemirrorIgnore}function signalCursorActivity(t){var r=t._handlers&&t._handlers.cursorActivity;if(r)for(var a=t.curOp.cursorActivityHandlers||(t.curOp.cursorActivityHandlers=[]),l=0;l<r.length;++l)-1==indexOf(a,r[l])&&a.push(r[l])}function hasHandler(t,r){return getHandlers(t,r).length>0}function eventMixin(t){t.prototype.on=function(t,r){on(this,t,r)},t.prototype.off=function(t,r){off(this,t,r)}}function e_preventDefault(t){t.preventDefault?t.preventDefault():t.returnValue=!1}function e_stopPropagation(t){t.stopPropagation?t.stopPropagation():t.cancelBubble=!0}function e_defaultPrevented(t){return null!=t.defaultPrevented?t.defaultPrevented:0==t.returnValue}function e_stop(t){e_preventDefault(t),e_stopPropagation(t)}function e_target(t){return t.target||t.srcElement}function e_button(t){var r=t.which;return null==r&&(1&t.button?r=1:2&t.button?r=3:4&t.button&&(r=2)),Z&&t.ctrlKey&&1==r&&(r=3),r}var ge,me,ye=function(){if(T&&L<9)return!1;var t=elt("div");return"draggable"in t||"dragDrop"in t}();function zeroWidthElement(t){if(null==ge){var r=elt("span","​");removeChildrenAndAdd(t,elt("span",[r,document.createTextNode("x")])),0!=t.firstChild.offsetHeight&&(ge=r.offsetWidth<=1&&r.offsetHeight>2&&!(T&&L<8))}var a=ge?elt("span","​"):elt("span"," ",null,"display: inline-block; width: 1px; margin-right: -1px");return a.setAttribute("cm-text",""),a}function hasBadBidiRects(t){if(null!=me)return me;var r=removeChildrenAndAdd(t,document.createTextNode("AخA")),a=oe(r,0,1).getBoundingClientRect(),l=oe(r,1,2).getBoundingClientRect();return removeChildren(t),!(!a||a.left==a.right)&&(me=l.right-a.right<3)}var ve,be=3!="\n\nb".split(/\n/).length?function(t){for(var r=0,a=[],l=t.length;r<=l;){var S=t.indexOf("\n",r);-1==S&&(S=t.length);var O=t.slice(r,"\r"==t.charAt(S-1)?S-1:S),T=O.indexOf("\r");-1!=T?(a.push(O.slice(0,T)),r+=T+1):(a.push(O),r=S+1)}return a}:function(t){return t.split(/\r\n?|\n/)},_e=window.getSelection?function(t){try{return t.selectionStart!=t.selectionEnd}catch(t){return!1}}:function(t){var r;try{r=t.ownerDocument.selection.createRange()}catch(t){}return!(!r||r.parentElement()!=t)&&0!=r.compareEndPoints("StartToEnd",r)},we="oncopy"in(ve=elt("div"))||(ve.setAttribute("oncopy","return;"),"function"==typeof ve.oncopy),Ce=null,Se={},xe={};function defineMode(t,r){arguments.length>2&&(r.dependencies=Array.prototype.slice.call(arguments,2)),Se[t]=r}function resolveMode(t){if("string"==typeof t&&xe.hasOwnProperty(t))t=xe[t];else if(t&&"string"==typeof t.name&&xe.hasOwnProperty(t.name)){var r=xe[t.name];"string"==typeof r&&(r={name:r}),(t=createObj(r,t)).name=r.name}else{if("string"==typeof t&&/^[\w\-]+\/[\w\-]+\+xml$/.test(t))return resolveMode("application/xml");if("string"==typeof t&&/^[\w\-]+\/[\w\-]+\+json$/.test(t))return resolveMode("application/json")}return"string"==typeof t?{name:t}:t||{name:"null"}}function getMode(t,r){r=resolveMode(r);var a=Se[r.name];if(!a)return getMode(t,"text/plain");var l=a(t,r);if(Oe.hasOwnProperty(r.name)){var S=Oe[r.name];for(var O in S)S.hasOwnProperty(O)&&(l.hasOwnProperty(O)&&(l["_"+O]=l[O]),l[O]=S[O])}if(l.name=r.name,r.helperType&&(l.helperType=r.helperType),r.modeProps)for(var T in r.modeProps)l[T]=r.modeProps[T];return l}var Oe={};function extendMode(t,r){copyObj(r,Oe.hasOwnProperty(t)?Oe[t]:Oe[t]={})}function copyState(t,r){if(!0===r)return r;if(t.copyState)return t.copyState(r);var a={};for(var l in r){var S=r[l];S instanceof Array&&(S=S.concat([])),a[l]=S}return a}function innerMode(t,r){for(var a;t.innerMode&&(a=t.innerMode(r))&&a.mode!=t;)r=a.state,t=a.mode;return a||{mode:t,state:r}}function startState(t,r,a){return!t.startState||t.startState(r,a)}var StringStream=function(t,r,a){this.pos=this.start=0,this.string=t,this.tabSize=r||8,this.lastColumnPos=this.lastColumnValue=0,this.lineStart=0,this.lineOracle=a};function getLine(t,r){if((r-=t.first)<0||r>=t.size)throw new Error("There is no line "+(r+t.first)+" in the document.");for(var a=t;!a.lines;)for(var l=0;;++l){var S=a.children[l],O=S.chunkSize();if(r<O){a=S;break}r-=O}return a.lines[r]}function getBetween(t,r,a){var l=[],S=r.line;return t.iter(r.line,a.line+1,(function(t){var O=t.text;S==a.line&&(O=O.slice(0,a.ch)),S==r.line&&(O=O.slice(r.ch)),l.push(O),++S})),l}function getLines(t,r,a){var l=[];return t.iter(r,a,(function(t){l.push(t.text)})),l}function updateLineHeight(t,r){var a=r-t.height;if(a)for(var l=t;l;l=l.parent)l.height+=a}function lineNo(t){if(null==t.parent)return null;for(var r=t.parent,a=indexOf(r.lines,t),l=r.parent;l;r=l,l=l.parent)for(var S=0;l.children[S]!=r;++S)a+=l.children[S].chunkSize();return a+r.first}function lineAtHeight(t,r){var a=t.first;e:do{for(var l=0;l<t.children.length;++l){var S=t.children[l],O=S.height;if(r<O){t=S;continue e}r-=O,a+=S.chunkSize()}return a}while(!t.lines);for(var T=0;T<t.lines.length;++T){var L=t.lines[T].height;if(r<L)break;r-=L}return a+T}function isLine(t,r){return r>=t.first&&r<t.first+t.size}function lineNumberFor(t,r){return String(t.lineNumberFormatter(r+t.firstLineNumber))}function Pos(t,r,a){if(void 0===a&&(a=null),!(this instanceof Pos))return new Pos(t,r,a);this.line=t,this.ch=r,this.sticky=a}function cmp(t,r){return t.line-r.line||t.ch-r.ch}function equalCursorPos(t,r){return t.sticky==r.sticky&&0==cmp(t,r)}function copyPos(t){return Pos(t.line,t.ch)}function maxPos(t,r){return cmp(t,r)<0?r:t}function minPos(t,r){return cmp(t,r)<0?t:r}function clipLine(t,r){return Math.max(t.first,Math.min(r,t.first+t.size-1))}function clipPos(t,r){if(r.line<t.first)return Pos(t.first,0);var a=t.first+t.size-1;return r.line>a?Pos(a,getLine(t,a).text.length):function clipToLen(t,r){var a=t.ch;return null==a||a>r?Pos(t.line,r):a<0?Pos(t.line,0):t}(r,getLine(t,r.line).text.length)}function clipPosArray(t,r){for(var a=[],l=0;l<r.length;l++)a[l]=clipPos(t,r[l]);return a}StringStream.prototype.eol=function(){return this.pos>=this.string.length},StringStream.prototype.sol=function(){return this.pos==this.lineStart},StringStream.prototype.peek=function(){return this.string.charAt(this.pos)||void 0},StringStream.prototype.next=function(){if(this.pos<this.string.length)return this.string.charAt(this.pos++)},StringStream.prototype.eat=function(t){var r=this.string.charAt(this.pos);if("string"==typeof t?r==t:r&&(t.test?t.test(r):t(r)))return++this.pos,r},StringStream.prototype.eatWhile=function(t){for(var r=this.pos;this.eat(t););return this.pos>r},StringStream.prototype.eatSpace=function(){for(var t=this.pos;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++this.pos;return this.pos>t},StringStream.prototype.skipToEnd=function(){this.pos=this.string.length},StringStream.prototype.skipTo=function(t){var r=this.string.indexOf(t,this.pos);if(r>-1)return this.pos=r,!0},StringStream.prototype.backUp=function(t){this.pos-=t},StringStream.prototype.column=function(){return this.lastColumnPos<this.start&&(this.lastColumnValue=countColumn(this.string,this.start,this.tabSize,this.lastColumnPos,this.lastColumnValue),this.lastColumnPos=this.start),this.lastColumnValue-(this.lineStart?countColumn(this.string,this.lineStart,this.tabSize):0)},StringStream.prototype.indentation=function(){return countColumn(this.string,null,this.tabSize)-(this.lineStart?countColumn(this.string,this.lineStart,this.tabSize):0)},StringStream.prototype.match=function(t,r,a){if("string"!=typeof t){var l=this.string.slice(this.pos).match(t);return l&&l.index>0?null:(l&&!1!==r&&(this.pos+=l[0].length),l)}var cased=function(t){return a?t.toLowerCase():t};if(cased(this.string.substr(this.pos,t.length))==cased(t))return!1!==r&&(this.pos+=t.length),!0},StringStream.prototype.current=function(){return this.string.slice(this.start,this.pos)},StringStream.prototype.hideFirstChars=function(t,r){this.lineStart+=t;try{return r()}finally{this.lineStart-=t}},StringStream.prototype.lookAhead=function(t){var r=this.lineOracle;return r&&r.lookAhead(t)},StringStream.prototype.baseToken=function(){var t=this.lineOracle;return t&&t.baseToken(this.pos)};var SavedContext=function(t,r){this.state=t,this.lookAhead=r},Context=function(t,r,a,l){this.state=r,this.doc=t,this.line=a,this.maxLookAhead=l||0,this.baseTokens=null,this.baseTokenPos=1};function highlightLine(t,r,a,l){var S=[t.state.modeGen],O={};runMode(t,r.text,t.doc.mode,a,(function(t,r){return S.push(t,r)}),O,l);for(var T=a.state,loop=function(l){a.baseTokens=S;var L=t.state.overlays[l],E=1,D=0;a.state=!0,runMode(t,r.text,L.mode,a,(function(t,r){for(var a=E;D<t;){var l=S[E];l>t&&S.splice(E,1,t,S[E+1],l),E+=2,D=Math.min(t,l)}if(r)if(L.opaque)S.splice(a,E-a,t,"overlay "+r),E=a+2;else for(;a<E;a+=2){var O=S[a+1];S[a+1]=(O?O+" ":"")+"overlay "+r}}),O),a.state=T,a.baseTokens=null,a.baseTokenPos=1},L=0;L<t.state.overlays.length;++L)loop(L);return{styles:S,classes:O.bgClass||O.textClass?O:null}}function getLineStyles(t,r,a){if(!r.styles||r.styles[0]!=t.state.modeGen){var l=getContextBefore(t,lineNo(r)),S=r.text.length>t.options.maxHighlightLength&&copyState(t.doc.mode,l.state),O=highlightLine(t,r,l);S&&(l.state=S),r.stateAfter=l.save(!S),r.styles=O.styles,O.classes?r.styleClasses=O.classes:r.styleClasses&&(r.styleClasses=null),a===t.doc.highlightFrontier&&(t.doc.modeFrontier=Math.max(t.doc.modeFrontier,++t.doc.highlightFrontier))}return r.styles}function getContextBefore(t,r,a){var l=t.doc,S=t.display;if(!l.mode.startState)return new Context(l,!0,r);var O=function findStartLine(t,r,a){for(var l,S,O=t.doc,T=a?-1:r-(t.doc.mode.innerMode?1e3:100),L=r;L>T;--L){if(L<=O.first)return O.first;var E=getLine(O,L-1),D=E.stateAfter;if(D&&(!a||L+(D instanceof SavedContext?D.lookAhead:0)<=O.modeFrontier))return L;var j=countColumn(E.text,null,t.options.tabSize);(null==S||l>j)&&(S=L-1,l=j)}return S}(t,r,a),T=O>l.first&&getLine(l,O-1).stateAfter,L=T?Context.fromSaved(l,T,O):new Context(l,startState(l.mode),O);return l.iter(O,r,(function(a){processLine(t,a.text,L);var l=L.line;a.stateAfter=l==r-1||l%5==0||l>=S.viewFrom&&l<S.viewTo?L.save():null,L.nextLine()})),a&&(l.modeFrontier=L.line),L}function processLine(t,r,a,l){var S=t.doc.mode,O=new StringStream(r,t.options.tabSize,a);for(O.start=O.pos=l||0,""==r&&callBlankLine(S,a.state);!O.eol();)readToken(S,O,a.state),O.start=O.pos}function callBlankLine(t,r){if(t.blankLine)return t.blankLine(r);if(t.innerMode){var a=innerMode(t,r);return a.mode.blankLine?a.mode.blankLine(a.state):void 0}}function readToken(t,r,a,l){for(var S=0;S<10;S++){l&&(l[0]=innerMode(t,a).mode);var O=t.token(r,a);if(r.pos>r.start)return O}throw new Error("Mode "+t.name+" failed to advance stream.")}Context.prototype.lookAhead=function(t){var r=this.doc.getLine(this.line+t);return null!=r&&t>this.maxLookAhead&&(this.maxLookAhead=t),r},Context.prototype.baseToken=function(t){if(!this.baseTokens)return null;for(;this.baseTokens[this.baseTokenPos]<=t;)this.baseTokenPos+=2;var r=this.baseTokens[this.baseTokenPos+1];return{type:r&&r.replace(/( |^)overlay .*/,""),size:this.baseTokens[this.baseTokenPos]-t}},Context.prototype.nextLine=function(){this.line++,this.maxLookAhead>0&&this.maxLookAhead--},Context.fromSaved=function(t,r,a){return r instanceof SavedContext?new Context(t,copyState(t.mode,r.state),a,r.lookAhead):new Context(t,copyState(t.mode,r),a)},Context.prototype.save=function(t){var r=!1!==t?copyState(this.doc.mode,this.state):this.state;return this.maxLookAhead>0?new SavedContext(r,this.maxLookAhead):r};var Token=function(t,r,a){this.start=t.start,this.end=t.pos,this.string=t.current(),this.type=r||null,this.state=a};function takeToken(t,r,a,l){var S,O,T=t.doc,L=T.mode,E=getLine(T,(r=clipPos(T,r)).line),D=getContextBefore(t,r.line,a),j=new StringStream(E.text,t.options.tabSize,D);for(l&&(O=[]);(l||j.pos<r.ch)&&!j.eol();)j.start=j.pos,S=readToken(L,j,D.state),l&&O.push(new Token(j,S,copyState(T.mode,D.state)));return l?O:new Token(j,S,D.state)}function extractLineClasses(t,r){if(t)for(;;){var a=t.match(/(?:^|\s+)line-(background-)?(\S+)/);if(!a)break;t=t.slice(0,a.index)+t.slice(a.index+a[0].length);var l=a[1]?"bgClass":"textClass";null==r[l]?r[l]=a[2]:new RegExp("(?:^|\\s)"+a[2]+"(?:$|\\s)").test(r[l])||(r[l]+=" "+a[2])}return t}function runMode(t,r,a,l,S,O,T){var L=a.flattenSpans;null==L&&(L=t.options.flattenSpans);var E,D=0,j=null,V=new StringStream(r,t.options.tabSize,l),B=t.options.addModeClass&&[null];for(""==r&&extractLineClasses(callBlankLine(a,l.state),O);!V.eol();){if(V.pos>t.options.maxHighlightLength?(L=!1,T&&processLine(t,r,l,V.pos),V.pos=r.length,E=null):E=extractLineClasses(readToken(a,V,l.state,B),O),B){var q=B[0].name;q&&(E="m-"+(E?q+" "+E:q))}if(!L||j!=E){for(;D<V.start;)S(D=Math.min(V.start,D+5e3),j);j=E}V.start=V.pos}for(;D<V.pos;){var G=Math.min(V.pos,D+5e3);S(G,j),D=G}}var Te=!1,Pe=!1;function MarkedSpan(t,r,a){this.marker=t,this.from=r,this.to=a}function getMarkedSpanFor(t,r){if(t)for(var a=0;a<t.length;++a){var l=t[a];if(l.marker==r)return l}}function removeMarkedSpan(t,r){for(var a,l=0;l<t.length;++l)t[l]!=r&&(a||(a=[])).push(t[l]);return a}function stretchSpansOverChange(t,r){if(r.full)return null;var a=isLine(t,r.from.line)&&getLine(t,r.from.line).markedSpans,l=isLine(t,r.to.line)&&getLine(t,r.to.line).markedSpans;if(!a&&!l)return null;var S=r.from.ch,O=r.to.ch,T=0==cmp(r.from,r.to),L=function markedSpansBefore(t,r,a){var l;if(t)for(var S=0;S<t.length;++S){var O=t[S],T=O.marker;if(null==O.from||(T.inclusiveLeft?O.from<=r:O.from<r)||O.from==r&&"bookmark"==T.type&&(!a||!O.marker.insertLeft)){var L=null==O.to||(T.inclusiveRight?O.to>=r:O.to>r);(l||(l=[])).push(new MarkedSpan(T,O.from,L?null:O.to))}}return l}(a,S,T),E=function markedSpansAfter(t,r,a){var l;if(t)for(var S=0;S<t.length;++S){var O=t[S],T=O.marker;if(null==O.to||(T.inclusiveRight?O.to>=r:O.to>r)||O.from==r&&"bookmark"==T.type&&(!a||O.marker.insertLeft)){var L=null==O.from||(T.inclusiveLeft?O.from<=r:O.from<r);(l||(l=[])).push(new MarkedSpan(T,L?null:O.from-r,null==O.to?null:O.to-r))}}return l}(l,O,T),D=1==r.text.length,j=lst(r.text).length+(D?S:0);if(L)for(var V=0;V<L.length;++V){var B=L[V];if(null==B.to){var q=getMarkedSpanFor(E,B.marker);q?D&&(B.to=null==q.to?null:q.to+j):B.to=S}}if(E)for(var G=0;G<E.length;++G){var K=E[G];null!=K.to&&(K.to+=j),null==K.from?getMarkedSpanFor(L,K.marker)||(K.from=j,D&&(L||(L=[])).push(K)):(K.from+=j,D&&(L||(L=[])).push(K))}L&&(L=clearEmptySpans(L)),E&&E!=L&&(E=clearEmptySpans(E));var X=[L];if(!D){var $,Z=r.text.length-2;if(Z>0&&L)for(var Q=0;Q<L.length;++Q)null==L[Q].to&&($||($=[])).push(new MarkedSpan(L[Q].marker,null,null));for(var ee=0;ee<Z;++ee)X.push($);X.push(E)}return X}function clearEmptySpans(t){for(var r=0;r<t.length;++r){var a=t[r];null!=a.from&&a.from==a.to&&!1!==a.marker.clearWhenEmpty&&t.splice(r--,1)}return t.length?t:null}function detachMarkedSpans(t){var r=t.markedSpans;if(r){for(var a=0;a<r.length;++a)r[a].marker.detachLine(t);t.markedSpans=null}}function attachMarkedSpans(t,r){if(r){for(var a=0;a<r.length;++a)r[a].marker.attachLine(t);t.markedSpans=r}}function extraLeft(t){return t.inclusiveLeft?-1:0}function extraRight(t){return t.inclusiveRight?1:0}function compareCollapsedMarkers(t,r){var a=t.lines.length-r.lines.length;if(0!=a)return a;var l=t.find(),S=r.find(),O=cmp(l.from,S.from)||extraLeft(t)-extraLeft(r);if(O)return-O;var T=cmp(l.to,S.to)||extraRight(t)-extraRight(r);return T||r.id-t.id}function collapsedSpanAtSide(t,r){var a,l=Pe&&t.markedSpans;if(l)for(var S=void 0,O=0;O<l.length;++O)(S=l[O]).marker.collapsed&&null==(r?S.from:S.to)&&(!a||compareCollapsedMarkers(a,S.marker)<0)&&(a=S.marker);return a}function collapsedSpanAtStart(t){return collapsedSpanAtSide(t,!0)}function collapsedSpanAtEnd(t){return collapsedSpanAtSide(t,!1)}function collapsedSpanAround(t,r){var a,l=Pe&&t.markedSpans;if(l)for(var S=0;S<l.length;++S){var O=l[S];O.marker.collapsed&&(null==O.from||O.from<r)&&(null==O.to||O.to>r)&&(!a||compareCollapsedMarkers(a,O.marker)<0)&&(a=O.marker)}return a}function conflictingCollapsedRange(t,r,a,l,S){var O=getLine(t,r),T=Pe&&O.markedSpans;if(T)for(var L=0;L<T.length;++L){var E=T[L];if(E.marker.collapsed){var D=E.marker.find(0),j=cmp(D.from,a)||extraLeft(E.marker)-extraLeft(S),V=cmp(D.to,l)||extraRight(E.marker)-extraRight(S);if(!(j>=0&&V<=0||j<=0&&V>=0)&&(j<=0&&(E.marker.inclusiveRight&&S.inclusiveLeft?cmp(D.to,a)>=0:cmp(D.to,a)>0)||j>=0&&(E.marker.inclusiveRight&&S.inclusiveLeft?cmp(D.from,l)<=0:cmp(D.from,l)<0)))return!0}}}function visualLine(t){for(var r;r=collapsedSpanAtStart(t);)t=r.find(-1,!0).line;return t}function visualLineNo(t,r){var a=getLine(t,r),l=visualLine(a);return a==l?r:lineNo(l)}function visualLineEndNo(t,r){if(r>t.lastLine())return r;var a,l=getLine(t,r);if(!lineIsHidden(t,l))return r;for(;a=collapsedSpanAtEnd(l);)l=a.find(1,!0).line;return lineNo(l)+1}function lineIsHidden(t,r){var a=Pe&&r.markedSpans;if(a)for(var l=void 0,S=0;S<a.length;++S)if((l=a[S]).marker.collapsed){if(null==l.from)return!0;if(!l.marker.widgetNode&&0==l.from&&l.marker.inclusiveLeft&&lineIsHiddenInner(t,r,l))return!0}}function lineIsHiddenInner(t,r,a){if(null==a.to){var l=a.marker.find(1,!0);return lineIsHiddenInner(t,l.line,getMarkedSpanFor(l.line.markedSpans,a.marker))}if(a.marker.inclusiveRight&&a.to==r.text.length)return!0;for(var S=void 0,O=0;O<r.markedSpans.length;++O)if((S=r.markedSpans[O]).marker.collapsed&&!S.marker.widgetNode&&S.from==a.to&&(null==S.to||S.to!=a.from)&&(S.marker.inclusiveLeft||a.marker.inclusiveRight)&&lineIsHiddenInner(t,r,S))return!0}function heightAtLine(t){for(var r=0,a=(t=visualLine(t)).parent,l=0;l<a.lines.length;++l){var S=a.lines[l];if(S==t)break;r+=S.height}for(var O=a.parent;O;O=(a=O).parent)for(var T=0;T<O.children.length;++T){var L=O.children[T];if(L==a)break;r+=L.height}return r}function lineLength(t){if(0==t.height)return 0;for(var r,a=t.text.length,l=t;r=collapsedSpanAtStart(l);){var S=r.find(0,!0);l=S.from.line,a+=S.from.ch-S.to.ch}for(l=t;r=collapsedSpanAtEnd(l);){var O=r.find(0,!0);a-=l.text.length-O.from.ch,a+=(l=O.to.line).text.length-O.to.ch}return a}function findMaxLine(t){var r=t.display,a=t.doc;r.maxLine=getLine(a,a.first),r.maxLineLength=lineLength(r.maxLine),r.maxLineChanged=!0,a.iter((function(t){var a=lineLength(t);a>r.maxLineLength&&(r.maxLineLength=a,r.maxLine=t)}))}var Line=function(t,r,a){this.text=t,attachMarkedSpans(this,r),this.height=a?a(this):1};function cleanUpLine(t){t.parent=null,detachMarkedSpans(t)}Line.prototype.lineNo=function(){return lineNo(this)},eventMixin(Line);var Le={},Ee={};function interpretTokenStyle(t,r){if(!t||/^\s*$/.test(t))return null;var a=r.addModeClass?Ee:Le;return a[t]||(a[t]=t.replace(/\S+/g,"cm-$&"))}function buildLineContent(t,r){var a=eltP("span",null,null,E?"padding-right: .1px":null),l={pre:eltP("pre",[a],"CodeMirror-line"),content:a,col:0,pos:0,cm:t,trailingSpace:!1,splitSpaces:t.getOption("lineWrapping")};r.measure={};for(var S=0;S<=(r.rest?r.rest.length:0);S++){var O=S?r.rest[S-1]:r.line,T=void 0;l.pos=0,l.addToken=buildToken,hasBadBidiRects(t.display.measure)&&(T=getOrder(O,t.doc.direction))&&(l.addToken=buildTokenBadBidi(l.addToken,T)),l.map=[],insertLineContent(O,l,getLineStyles(t,O,r!=t.display.externalMeasured&&lineNo(O))),O.styleClasses&&(O.styleClasses.bgClass&&(l.bgClass=joinClasses(O.styleClasses.bgClass,l.bgClass||"")),O.styleClasses.textClass&&(l.textClass=joinClasses(O.styleClasses.textClass,l.textClass||""))),0==l.map.length&&l.map.push(0,0,l.content.appendChild(zeroWidthElement(t.display.measure))),0==S?(r.measure.map=l.map,r.measure.cache={}):((r.measure.maps||(r.measure.maps=[])).push(l.map),(r.measure.caches||(r.measure.caches=[])).push({}))}if(E){var L=l.content.lastChild;(/\bcm-tab\b/.test(L.className)||L.querySelector&&L.querySelector(".cm-tab"))&&(l.content.className="cm-tab-wrap-hack")}return signal(t,"renderLine",t,r.line,l.pre),l.pre.className&&(l.textClass=joinClasses(l.pre.className,l.textClass||"")),l}function defaultSpecialCharPlaceholder(t){var r=elt("span","•","cm-invalidchar");return r.title="\\u"+t.charCodeAt(0).toString(16),r.setAttribute("aria-label",r.title),r}function buildToken(t,r,a,l,S,O,E){if(r){var D,j=t.splitSpaces?function splitSpaces(t,r){if(t.length>1&&!/  /.test(t))return t;for(var a=r,l="",S=0;S<t.length;S++){var O=t.charAt(S);" "!=O||!a||S!=t.length-1&&32!=t.charCodeAt(S+1)||(O=" "),l+=O,a=" "==O}return l}(r,t.trailingSpace):r,V=t.cm.state.specialChars,B=!1;if(V.test(r)){D=document.createDocumentFragment();for(var q=0;;){V.lastIndex=q;var G=V.exec(r),K=G?G.index-q:r.length-q;if(K){var X=document.createTextNode(j.slice(q,q+K));T&&L<9?D.appendChild(elt("span",[X])):D.appendChild(X),t.map.push(t.pos,t.pos+K,X),t.col+=K,t.pos+=K}if(!G)break;q+=K+1;var $=void 0;if("\t"==G[0]){var Z=t.cm.options.tabSize,Q=Z-t.col%Z;($=D.appendChild(elt("span",spaceStr(Q),"cm-tab"))).setAttribute("role","presentation"),$.setAttribute("cm-text","\t"),t.col+=Q}else"\r"==G[0]||"\n"==G[0]?(($=D.appendChild(elt("span","\r"==G[0]?"␍":"␤","cm-invalidchar"))).setAttribute("cm-text",G[0]),t.col+=1):(($=t.cm.options.specialCharPlaceholder(G[0])).setAttribute("cm-text",G[0]),T&&L<9?D.appendChild(elt("span",[$])):D.appendChild($),t.col+=1);t.map.push(t.pos,t.pos+1,$),t.pos++}}else t.col+=r.length,D=document.createTextNode(j),t.map.push(t.pos,t.pos+r.length,D),T&&L<9&&(B=!0),t.pos+=r.length;if(t.trailingSpace=32==j.charCodeAt(r.length-1),a||l||S||B||O||E){var ee=a||"";l&&(ee+=l),S&&(ee+=S);var te=elt("span",[D],ee,O);if(E)for(var ne in E)E.hasOwnProperty(ne)&&"style"!=ne&&"class"!=ne&&te.setAttribute(ne,E[ne]);return t.content.appendChild(te)}t.content.appendChild(D)}}function buildTokenBadBidi(t,r){return function(a,l,S,O,T,L,E){S=S?S+" cm-force-border":"cm-force-border";for(var D=a.pos,j=D+l.length;;){for(var V=void 0,B=0;B<r.length&&!((V=r[B]).to>D&&V.from<=D);B++);if(V.to>=j)return t(a,l,S,O,T,L,E);t(a,l.slice(0,V.to-D),S,O,null,L,E),O=null,l=l.slice(V.to-D),D=V.to}}}function buildCollapsedSpan(t,r,a,l){var S=!l&&a.widgetNode;S&&t.map.push(t.pos,t.pos+r,S),!l&&t.cm.display.input.needsContentAttribute&&(S||(S=t.content.appendChild(document.createElement("span"))),S.setAttribute("cm-marker",a.id)),S&&(t.cm.display.input.setUneditable(S),t.content.appendChild(S)),t.pos+=r,t.trailingSpace=!1}function insertLineContent(t,r,a){var l=t.markedSpans,S=t.text,O=0;if(l)for(var T,L,E,D,j,V,B,q=S.length,G=0,K=1,X="",$=0;;){if($==G){E=D=j=L="",B=null,V=null,$=1/0;for(var Z=[],Q=void 0,ee=0;ee<l.length;++ee){var te=l[ee],ne=te.marker;if("bookmark"==ne.type&&te.from==G&&ne.widgetNode)Z.push(ne);else if(te.from<=G&&(null==te.to||te.to>G||ne.collapsed&&te.to==G&&te.from==G)){if(null!=te.to&&te.to!=G&&$>te.to&&($=te.to,D=""),ne.className&&(E+=" "+ne.className),ne.css&&(L=(L?L+";":"")+ne.css),ne.startStyle&&te.from==G&&(j+=" "+ne.startStyle),ne.endStyle&&te.to==$&&(Q||(Q=[])).push(ne.endStyle,te.to),ne.title&&((B||(B={})).title=ne.title),ne.attributes)for(var re in ne.attributes)(B||(B={}))[re]=ne.attributes[re];ne.collapsed&&(!V||compareCollapsedMarkers(V.marker,ne)<0)&&(V=te)}else te.from>G&&$>te.from&&($=te.from)}if(Q)for(var oe=0;oe<Q.length;oe+=2)Q[oe+1]==$&&(D+=" "+Q[oe]);if(!V||V.from==G)for(var ie=0;ie<Z.length;++ie)buildCollapsedSpan(r,0,Z[ie]);if(V&&(V.from||0)==G){if(buildCollapsedSpan(r,(null==V.to?q+1:V.to)-G,V.marker,null==V.from),null==V.to)return;V.to==G&&(V=!1)}}if(G>=q)break;for(var ae=Math.min(q,$);;){if(X){var se=G+X.length;if(!V){var le=se>ae?X.slice(0,ae-G):X;r.addToken(r,le,T?T+E:E,j,G+le.length==$?D:"",L,B)}if(se>=ae){X=X.slice(ae-G),G=ae;break}G=se,j=""}X=S.slice(O,O=a[K++]),T=interpretTokenStyle(a[K++],r.cm.options)}}else for(var ce=1;ce<a.length;ce+=2)r.addToken(r,S.slice(O,O=a[ce]),interpretTokenStyle(a[ce+1],r.cm.options))}function LineView(t,r,a){this.line=r,this.rest=function visualLineContinued(t){for(var r,a;r=collapsedSpanAtEnd(t);)t=r.find(1,!0).line,(a||(a=[])).push(t);return a}(r),this.size=this.rest?lineNo(lst(this.rest))-a+1:1,this.node=this.text=null,this.hidden=lineIsHidden(t,r)}function buildViewArray(t,r,a){for(var l,S=[],O=r;O<a;O=l){var T=new LineView(t.doc,getLine(t.doc,O),O);l=O+T.size,S.push(T)}return S}var Me=null,ke=null;function signalLater(t,r){var a=getHandlers(t,r);if(a.length){var l,S=Array.prototype.slice.call(arguments,2);Me?l=Me.delayedCallbacks:ke?l=ke:(l=ke=[],setTimeout(fireOrphanDelayed,0));for(var loop=function(t){l.push((function(){return a[t].apply(null,S)}))},O=0;O<a.length;++O)loop(O)}}function fireOrphanDelayed(){var t=ke;ke=null;for(var r=0;r<t.length;++r)t[r]()}function updateLineForChanges(t,r,a,l){for(var S=0;S<r.changes.length;S++){var O=r.changes[S];"text"==O?updateLineText(t,r):"gutter"==O?updateLineGutter(t,r,a,l):"class"==O?updateLineClasses(t,r):"widget"==O&&updateLineWidgets(t,r,l)}r.changes=null}function ensureLineWrapped(t){return t.node==t.text&&(t.node=elt("div",null,null,"position: relative"),t.text.parentNode&&t.text.parentNode.replaceChild(t.node,t.text),t.node.appendChild(t.text),T&&L<8&&(t.node.style.zIndex=2)),t.node}function getLineContent(t,r){var a=t.display.externalMeasured;return a&&a.line==r.line?(t.display.externalMeasured=null,r.measure=a.measure,a.built):buildLineContent(t,r)}function updateLineText(t,r){var a=r.text.className,l=getLineContent(t,r);r.text==r.node&&(r.node=l.pre),r.text.parentNode.replaceChild(l.pre,r.text),r.text=l.pre,l.bgClass!=r.bgClass||l.textClass!=r.textClass?(r.bgClass=l.bgClass,r.textClass=l.textClass,updateLineClasses(t,r)):a&&(r.text.className=a)}function updateLineClasses(t,r){!function updateLineBackground(t,r){var a=r.bgClass?r.bgClass+" "+(r.line.bgClass||""):r.line.bgClass;if(a&&(a+=" CodeMirror-linebackground"),r.background)a?r.background.className=a:(r.background.parentNode.removeChild(r.background),r.background=null);else if(a){var l=ensureLineWrapped(r);r.background=l.insertBefore(elt("div",null,a),l.firstChild),t.display.input.setUneditable(r.background)}}(t,r),r.line.wrapClass?ensureLineWrapped(r).className=r.line.wrapClass:r.node!=r.text&&(r.node.className="");var a=r.textClass?r.textClass+" "+(r.line.textClass||""):r.line.textClass;r.text.className=a||""}function updateLineGutter(t,r,a,l){if(r.gutter&&(r.node.removeChild(r.gutter),r.gutter=null),r.gutterBackground&&(r.node.removeChild(r.gutterBackground),r.gutterBackground=null),r.line.gutterClass){var S=ensureLineWrapped(r);r.gutterBackground=elt("div",null,"CodeMirror-gutter-background "+r.line.gutterClass,"left: "+(t.options.fixedGutter?l.fixedPos:-l.gutterTotalWidth)+"px; width: "+l.gutterTotalWidth+"px"),t.display.input.setUneditable(r.gutterBackground),S.insertBefore(r.gutterBackground,r.text)}var O=r.line.gutterMarkers;if(t.options.lineNumbers||O){var T=ensureLineWrapped(r),L=r.gutter=elt("div",null,"CodeMirror-gutter-wrapper","left: "+(t.options.fixedGutter?l.fixedPos:-l.gutterTotalWidth)+"px");if(L.setAttribute("aria-hidden","true"),t.display.input.setUneditable(L),T.insertBefore(L,r.text),r.line.gutterClass&&(L.className+=" "+r.line.gutterClass),!t.options.lineNumbers||O&&O["CodeMirror-linenumbers"]||(r.lineNumber=L.appendChild(elt("div",lineNumberFor(t.options,a),"CodeMirror-linenumber CodeMirror-gutter-elt","left: "+l.gutterLeft["CodeMirror-linenumbers"]+"px; width: "+t.display.lineNumInnerWidth+"px"))),O)for(var E=0;E<t.display.gutterSpecs.length;++E){var D=t.display.gutterSpecs[E].className,j=O.hasOwnProperty(D)&&O[D];j&&L.appendChild(elt("div",[j],"CodeMirror-gutter-elt","left: "+l.gutterLeft[D]+"px; width: "+l.gutterWidth[D]+"px"))}}}function updateLineWidgets(t,r,a){r.alignable&&(r.alignable=null);for(var l=classTest("CodeMirror-linewidget"),S=r.node.firstChild,O=void 0;S;S=O)O=S.nextSibling,l.test(S.className)&&r.node.removeChild(S);insertLineWidgets(t,r,a)}function buildLineElement(t,r,a,l){var S=getLineContent(t,r);return r.text=r.node=S.pre,S.bgClass&&(r.bgClass=S.bgClass),S.textClass&&(r.textClass=S.textClass),updateLineClasses(t,r),updateLineGutter(t,r,a,l),insertLineWidgets(t,r,l),r.node}function insertLineWidgets(t,r,a){if(insertLineWidgetsFor(t,r.line,r,a,!0),r.rest)for(var l=0;l<r.rest.length;l++)insertLineWidgetsFor(t,r.rest[l],r,a,!1)}function insertLineWidgetsFor(t,r,a,l,S){if(r.widgets)for(var O=ensureLineWrapped(a),T=0,L=r.widgets;T<L.length;++T){var E=L[T],D=elt("div",[E.node],"CodeMirror-linewidget"+(E.className?" "+E.className:""));E.handleMouseEvents||D.setAttribute("cm-ignore-events","true"),positionLineWidget(E,D,a,l),t.display.input.setUneditable(D),S&&E.above?O.insertBefore(D,a.gutter||a.text):O.appendChild(D),signalLater(E,"redraw")}}function positionLineWidget(t,r,a,l){if(t.noHScroll){(a.alignable||(a.alignable=[])).push(r);var S=l.wrapperWidth;r.style.left=l.fixedPos+"px",t.coverGutter||(S-=l.gutterTotalWidth,r.style.paddingLeft=l.gutterTotalWidth+"px"),r.style.width=S+"px"}t.coverGutter&&(r.style.zIndex=5,r.style.position="relative",t.noHScroll||(r.style.marginLeft=-l.gutterTotalWidth+"px"))}function widgetHeight(t){if(null!=t.height)return t.height;var r=t.doc.cm;if(!r)return 0;if(!contains(document.body,t.node)){var a="position: relative;";t.coverGutter&&(a+="margin-left: -"+r.display.gutters.offsetWidth+"px;"),t.noHScroll&&(a+="width: "+r.display.wrapper.clientWidth+"px;"),removeChildrenAndAdd(r.display.measure,elt("div",[t.node],null,a))}return t.height=t.node.parentNode.offsetHeight}function eventInWidget(t,r){for(var a=e_target(r);a!=t.wrapper;a=a.parentNode)if(!a||1==a.nodeType&&"true"==a.getAttribute("cm-ignore-events")||a.parentNode==t.sizer&&a!=t.mover)return!0}function paddingTop(t){return t.lineSpace.offsetTop}function paddingVert(t){return t.mover.offsetHeight-t.lineSpace.offsetHeight}function paddingH(t){if(t.cachedPaddingH)return t.cachedPaddingH;var r=removeChildrenAndAdd(t.measure,elt("pre","x","CodeMirror-line-like")),a=window.getComputedStyle?window.getComputedStyle(r):r.currentStyle,l={left:parseInt(a.paddingLeft),right:parseInt(a.paddingRight)};return isNaN(l.left)||isNaN(l.right)||(t.cachedPaddingH=l),l}function scrollGap(t){return 50-t.display.nativeBarWidth}function displayWidth(t){return t.display.scroller.clientWidth-scrollGap(t)-t.display.barWidth}function displayHeight(t){return t.display.scroller.clientHeight-scrollGap(t)-t.display.barHeight}function mapFromLineView(t,r,a){if(t.line==r)return{map:t.measure.map,cache:t.measure.cache};for(var l=0;l<t.rest.length;l++)if(t.rest[l]==r)return{map:t.measure.maps[l],cache:t.measure.caches[l]};for(var S=0;S<t.rest.length;S++)if(lineNo(t.rest[S])>a)return{map:t.measure.maps[S],cache:t.measure.caches[S],before:!0}}function measureChar(t,r,a,l){return measureCharPrepared(t,prepareMeasureForLine(t,r),a,l)}function findViewForLine(t,r){if(r>=t.display.viewFrom&&r<t.display.viewTo)return t.display.view[findViewIndex(t,r)];var a=t.display.externalMeasured;return a&&r>=a.lineN&&r<a.lineN+a.size?a:void 0}function prepareMeasureForLine(t,r){var a=lineNo(r),l=findViewForLine(t,a);l&&!l.text?l=null:l&&l.changes&&(updateLineForChanges(t,l,a,getDimensions(t)),t.curOp.forceUpdate=!0),l||(l=function updateExternalMeasurement(t,r){var a=lineNo(r=visualLine(r)),l=t.display.externalMeasured=new LineView(t.doc,r,a);l.lineN=a;var S=l.built=buildLineContent(t,l);return l.text=S.pre,removeChildrenAndAdd(t.display.lineMeasure,S.pre),l}(t,r));var S=mapFromLineView(l,r,a);return{line:r,view:l,rect:null,map:S.map,cache:S.cache,before:S.before,hasHeights:!1}}function measureCharPrepared(t,r,a,l,S){r.before&&(a=-1);var O,E=a+(l||"");return r.cache.hasOwnProperty(E)?O=r.cache[E]:(r.rect||(r.rect=r.view.text.getBoundingClientRect()),r.hasHeights||(function ensureLineHeights(t,r,a){var l=t.options.lineWrapping,S=l&&displayWidth(t);if(!r.measure.heights||l&&r.measure.width!=S){var O=r.measure.heights=[];if(l){r.measure.width=S;for(var T=r.text.firstChild.getClientRects(),L=0;L<T.length-1;L++){var E=T[L],D=T[L+1];Math.abs(E.bottom-D.bottom)>2&&O.push((E.bottom+D.top)/2-a.top)}}O.push(a.bottom-a.top)}}(t,r.view,r.rect),r.hasHeights=!0),(O=function measureCharInner(t,r,a,l){var S,O=nodeAndOffsetInLineMap(r.map,a,l),E=O.node,D=O.start,j=O.end,V=O.collapse;if(3==E.nodeType){for(var B=0;B<4;B++){for(;D&&isExtendingChar(r.line.text.charAt(O.coverStart+D));)--D;for(;O.coverStart+j<O.coverEnd&&isExtendingChar(r.line.text.charAt(O.coverStart+j));)++j;if((S=T&&L<9&&0==D&&j==O.coverEnd-O.coverStart?E.parentNode.getBoundingClientRect():getUsefulRect(oe(E,D,j).getClientRects(),l)).left||S.right||0==D)break;j=D,D-=1,V="right"}T&&L<11&&(S=function maybeUpdateRectForZooming(t,r){if(!window.screen||null==screen.logicalXDPI||screen.logicalXDPI==screen.deviceXDPI||!function hasBadZoomedRects(t){if(null!=Ce)return Ce;var r=removeChildrenAndAdd(t,elt("span","x")),a=r.getBoundingClientRect(),l=oe(r,0,1).getBoundingClientRect();return Ce=Math.abs(a.left-l.left)>1}(t))return r;var a=screen.logicalXDPI/screen.deviceXDPI,l=screen.logicalYDPI/screen.deviceYDPI;return{left:r.left*a,right:r.right*a,top:r.top*l,bottom:r.bottom*l}}(t.display.measure,S))}else{var q;D>0&&(V=l="right"),S=t.options.lineWrapping&&(q=E.getClientRects()).length>1?q["right"==l?q.length-1:0]:E.getBoundingClientRect()}if(T&&L<9&&!D&&(!S||!S.left&&!S.right)){var G=E.parentNode.getClientRects()[0];S=G?{left:G.left,right:G.left+charWidth(t.display),top:G.top,bottom:G.bottom}:Ae}for(var K=S.top-r.rect.top,X=S.bottom-r.rect.top,$=(K+X)/2,Z=r.view.measure.heights,Q=0;Q<Z.length-1&&!($<Z[Q]);Q++);var ee=Q?Z[Q-1]:0,te=Z[Q],ne={left:("right"==V?S.right:S.left)-r.rect.left,right:("left"==V?S.left:S.right)-r.rect.left,top:ee,bottom:te};return S.left||S.right||(ne.bogus=!0),t.options.singleCursorHeightPerLine||(ne.rtop=K,ne.rbottom=X),ne}(t,r,a,l)).bogus||(r.cache[E]=O)),{left:O.left,right:O.right,top:S?O.rtop:O.top,bottom:S?O.rbottom:O.bottom}}var Ie,Ae={left:0,right:0,top:0,bottom:0};function nodeAndOffsetInLineMap(t,r,a){for(var l,S,O,T,L,E,D=0;D<t.length;D+=3)if(L=t[D],E=t[D+1],r<L?(S=0,O=1,T="left"):r<E?O=1+(S=r-L):(D==t.length-3||r==E&&t[D+3]>r)&&(S=(O=E-L)-1,r>=E&&(T="right")),null!=S){if(l=t[D+2],L==E&&a==(l.insertLeft?"left":"right")&&(T=a),"left"==a&&0==S)for(;D&&t[D-2]==t[D-3]&&t[D-1].insertLeft;)l=t[2+(D-=3)],T="left";if("right"==a&&S==E-L)for(;D<t.length-3&&t[D+3]==t[D+4]&&!t[D+5].insertLeft;)l=t[(D+=3)+2],T="right";break}return{node:l,start:S,end:O,collapse:T,coverStart:L,coverEnd:E}}function getUsefulRect(t,r){var a=Ae;if("left"==r)for(var l=0;l<t.length&&(a=t[l]).left==a.right;l++);else for(var S=t.length-1;S>=0&&(a=t[S]).left==a.right;S--);return a}function clearLineMeasurementCacheFor(t){if(t.measure&&(t.measure.cache={},t.measure.heights=null,t.rest))for(var r=0;r<t.rest.length;r++)t.measure.caches[r]={}}function clearLineMeasurementCache(t){t.display.externalMeasure=null,removeChildren(t.display.lineMeasure);for(var r=0;r<t.display.view.length;r++)clearLineMeasurementCacheFor(t.display.view[r])}function clearCaches(t){clearLineMeasurementCache(t),t.display.cachedCharWidth=t.display.cachedTextHeight=t.display.cachedPaddingH=null,t.options.lineWrapping||(t.display.maxLineChanged=!0),t.display.lineNumChars=null}function pageScrollX(){return j&&X?-(document.body.getBoundingClientRect().left-parseInt(getComputedStyle(document.body).marginLeft)):window.pageXOffset||(document.documentElement||document.body).scrollLeft}function pageScrollY(){return j&&X?-(document.body.getBoundingClientRect().top-parseInt(getComputedStyle(document.body).marginTop)):window.pageYOffset||(document.documentElement||document.body).scrollTop}function widgetTopHeight(t){var r=0;if(t.widgets)for(var a=0;a<t.widgets.length;++a)t.widgets[a].above&&(r+=widgetHeight(t.widgets[a]));return r}function intoCoordSystem(t,r,a,l,S){if(!S){var O=widgetTopHeight(r);a.top+=O,a.bottom+=O}if("line"==l)return a;l||(l="local");var T=heightAtLine(r);if("local"==l?T+=paddingTop(t.display):T-=t.display.viewOffset,"page"==l||"window"==l){var L=t.display.lineSpace.getBoundingClientRect();T+=L.top+("window"==l?0:pageScrollY());var E=L.left+("window"==l?0:pageScrollX());a.left+=E,a.right+=E}return a.top+=T,a.bottom+=T,a}function fromCoordSystem(t,r,a){if("div"==a)return r;var l=r.left,S=r.top;if("page"==a)l-=pageScrollX(),S-=pageScrollY();else if("local"==a||!a){var O=t.display.sizer.getBoundingClientRect();l+=O.left,S+=O.top}var T=t.display.lineSpace.getBoundingClientRect();return{left:l-T.left,top:S-T.top}}function charCoords(t,r,a,l,S){return l||(l=getLine(t.doc,r.line)),intoCoordSystem(t,l,measureChar(t,l,r.ch,S),a)}function cursorCoords(t,r,a,l,S,O){function get(r,T){var L=measureCharPrepared(t,S,r,T?"right":"left",O);return T?L.left=L.right:L.right=L.left,intoCoordSystem(t,l,L,a)}l=l||getLine(t.doc,r.line),S||(S=prepareMeasureForLine(t,l));var T=getOrder(l,t.doc.direction),L=r.ch,E=r.sticky;if(L>=l.text.length?(L=l.text.length,E="before"):L<=0&&(L=0,E="after"),!T)return get("before"==E?L-1:L,"before"==E);function getBidi(t,r,a){return get(a?t-1:t,1==T[r].level!=a)}var D=getBidiPartAt(T,L,E),j=pe,V=getBidi(L,D,"before"==E);return null!=j&&(V.other=getBidi(L,j,"before"!=E)),V}function estimateCoords(t,r){var a=0;r=clipPos(t.doc,r),t.options.lineWrapping||(a=charWidth(t.display)*r.ch);var l=getLine(t.doc,r.line),S=heightAtLine(l)+paddingTop(t.display);return{left:a,right:a,top:S,bottom:S+l.height}}function PosWithInfo(t,r,a,l,S){var O=Pos(t,r,a);return O.xRel=S,l&&(O.outside=l),O}function coordsChar(t,r,a){var l=t.doc;if((a+=t.display.viewOffset)<0)return PosWithInfo(l.first,0,null,-1,-1);var S=lineAtHeight(l,a),O=l.first+l.size-1;if(S>O)return PosWithInfo(l.first+l.size-1,getLine(l,O).text.length,null,1,1);r<0&&(r=0);for(var T=getLine(l,S);;){var L=coordsCharInner(t,T,S,r,a),E=collapsedSpanAround(T,L.ch+(L.xRel>0||L.outside>0?1:0));if(!E)return L;var D=E.find(1);if(D.line==S)return D;T=getLine(l,S=D.line)}}function wrappedLineExtent(t,r,a,l){l-=widgetTopHeight(r);var S=r.text.length,O=findFirst((function(r){return measureCharPrepared(t,a,r-1).bottom<=l}),S,0);return{begin:O,end:S=findFirst((function(r){return measureCharPrepared(t,a,r).top>l}),O,S)}}function wrappedLineExtentChar(t,r,a,l){return a||(a=prepareMeasureForLine(t,r)),wrappedLineExtent(t,r,a,intoCoordSystem(t,r,measureCharPrepared(t,a,l),"line").top)}function boxIsAfter(t,r,a,l){return!(t.bottom<=a)&&(t.top>a||(l?t.left:t.right)>r)}function coordsCharInner(t,r,a,l,S){S-=heightAtLine(r);var O=prepareMeasureForLine(t,r),T=widgetTopHeight(r),L=0,E=r.text.length,D=!0,j=getOrder(r,t.doc.direction);if(j){var V=(t.options.lineWrapping?coordsBidiPartWrapped:coordsBidiPart)(t,r,a,O,j,l,S);L=(D=1!=V.level)?V.from:V.to-1,E=D?V.to:V.from-1}var B,q,G=null,K=null,X=findFirst((function(r){var a=measureCharPrepared(t,O,r);return a.top+=T,a.bottom+=T,!!boxIsAfter(a,l,S,!1)&&(a.top<=S&&a.left<=l&&(G=r,K=a),!0)}),L,E),$=!1;if(K){var Z=l-K.left<K.right-l,Q=Z==D;X=G+(Q?0:1),q=Q?"after":"before",B=Z?K.left:K.right}else{D||X!=E&&X!=L||X++,q=0==X?"after":X==r.text.length?"before":measureCharPrepared(t,O,X-(D?1:0)).bottom+T<=S==D?"after":"before";var ee=cursorCoords(t,Pos(a,X,q),"line",r,O);B=ee.left,$=S<ee.top?-1:S>=ee.bottom?1:0}return PosWithInfo(a,X=skipExtendingChars(r.text,X,1),q,$,l-B)}function coordsBidiPart(t,r,a,l,S,O,T){var L=findFirst((function(L){var E=S[L],D=1!=E.level;return boxIsAfter(cursorCoords(t,Pos(a,D?E.to:E.from,D?"before":"after"),"line",r,l),O,T,!0)}),0,S.length-1),E=S[L];if(L>0){var D=1!=E.level,j=cursorCoords(t,Pos(a,D?E.from:E.to,D?"after":"before"),"line",r,l);boxIsAfter(j,O,T,!0)&&j.top>T&&(E=S[L-1])}return E}function coordsBidiPartWrapped(t,r,a,l,S,O,T){var L=wrappedLineExtent(t,r,l,T),E=L.begin,D=L.end;/\s/.test(r.text.charAt(D-1))&&D--;for(var j=null,V=null,B=0;B<S.length;B++){var q=S[B];if(!(q.from>=D||q.to<=E)){var G=measureCharPrepared(t,l,1!=q.level?Math.min(D,q.to)-1:Math.max(E,q.from)).right,K=G<O?O-G+1e9:G-O;(!j||V>K)&&(j=q,V=K)}}return j||(j=S[S.length-1]),j.from<E&&(j={from:E,to:j.to,level:j.level}),j.to>D&&(j={from:j.from,to:D,level:j.level}),j}function textHeight(t){if(null!=t.cachedTextHeight)return t.cachedTextHeight;if(null==Ie){Ie=elt("pre",null,"CodeMirror-line-like");for(var r=0;r<49;++r)Ie.appendChild(document.createTextNode("x")),Ie.appendChild(elt("br"));Ie.appendChild(document.createTextNode("x"))}removeChildrenAndAdd(t.measure,Ie);var a=Ie.offsetHeight/50;return a>3&&(t.cachedTextHeight=a),removeChildren(t.measure),a||1}function charWidth(t){if(null!=t.cachedCharWidth)return t.cachedCharWidth;var r=elt("span","xxxxxxxxxx"),a=elt("pre",[r],"CodeMirror-line-like");removeChildrenAndAdd(t.measure,a);var l=r.getBoundingClientRect(),S=(l.right-l.left)/10;return S>2&&(t.cachedCharWidth=S),S||10}function getDimensions(t){for(var r=t.display,a={},l={},S=r.gutters.clientLeft,O=r.gutters.firstChild,T=0;O;O=O.nextSibling,++T){var L=t.display.gutterSpecs[T].className;a[L]=O.offsetLeft+O.clientLeft+S,l[L]=O.clientWidth}return{fixedPos:compensateForHScroll(r),gutterTotalWidth:r.gutters.offsetWidth,gutterLeft:a,gutterWidth:l,wrapperWidth:r.wrapper.clientWidth}}function compensateForHScroll(t){return t.scroller.getBoundingClientRect().left-t.sizer.getBoundingClientRect().left}function estimateHeight(t){var r=textHeight(t.display),a=t.options.lineWrapping,l=a&&Math.max(5,t.display.scroller.clientWidth/charWidth(t.display)-3);return function(S){if(lineIsHidden(t.doc,S))return 0;var O=0;if(S.widgets)for(var T=0;T<S.widgets.length;T++)S.widgets[T].height&&(O+=S.widgets[T].height);return a?O+(Math.ceil(S.text.length/l)||1)*r:O+r}}function estimateLineHeights(t){var r=t.doc,a=estimateHeight(t);r.iter((function(t){var r=a(t);r!=t.height&&updateLineHeight(t,r)}))}function posFromMouse(t,r,a,l){var S=t.display;if(!a&&"true"==e_target(r).getAttribute("cm-not-content"))return null;var O,T,L=S.lineSpace.getBoundingClientRect();try{O=r.clientX-L.left,T=r.clientY-L.top}catch(t){return null}var E,D=coordsChar(t,O,T);if(l&&D.xRel>0&&(E=getLine(t.doc,D.line).text).length==D.ch){var j=countColumn(E,E.length,t.options.tabSize)-E.length;D=Pos(D.line,Math.max(0,Math.round((O-paddingH(t.display).left)/charWidth(t.display))-j))}return D}function findViewIndex(t,r){if(r>=t.display.viewTo)return null;if((r-=t.display.viewFrom)<0)return null;for(var a=t.display.view,l=0;l<a.length;l++)if((r-=a[l].size)<0)return l}function regChange(t,r,a,l){null==r&&(r=t.doc.first),null==a&&(a=t.doc.first+t.doc.size),l||(l=0);var S=t.display;if(l&&a<S.viewTo&&(null==S.updateLineNumbers||S.updateLineNumbers>r)&&(S.updateLineNumbers=r),t.curOp.viewChanged=!0,r>=S.viewTo)Pe&&visualLineNo(t.doc,r)<S.viewTo&&resetView(t);else if(a<=S.viewFrom)Pe&&visualLineEndNo(t.doc,a+l)>S.viewFrom?resetView(t):(S.viewFrom+=l,S.viewTo+=l);else if(r<=S.viewFrom&&a>=S.viewTo)resetView(t);else if(r<=S.viewFrom){var O=viewCuttingPoint(t,a,a+l,1);O?(S.view=S.view.slice(O.index),S.viewFrom=O.lineN,S.viewTo+=l):resetView(t)}else if(a>=S.viewTo){var T=viewCuttingPoint(t,r,r,-1);T?(S.view=S.view.slice(0,T.index),S.viewTo=T.lineN):resetView(t)}else{var L=viewCuttingPoint(t,r,r,-1),E=viewCuttingPoint(t,a,a+l,1);L&&E?(S.view=S.view.slice(0,L.index).concat(buildViewArray(t,L.lineN,E.lineN)).concat(S.view.slice(E.index)),S.viewTo+=l):resetView(t)}var D=S.externalMeasured;D&&(a<D.lineN?D.lineN+=l:r<D.lineN+D.size&&(S.externalMeasured=null))}function regLineChange(t,r,a){t.curOp.viewChanged=!0;var l=t.display,S=t.display.externalMeasured;if(S&&r>=S.lineN&&r<S.lineN+S.size&&(l.externalMeasured=null),!(r<l.viewFrom||r>=l.viewTo)){var O=l.view[findViewIndex(t,r)];if(null!=O.node){var T=O.changes||(O.changes=[]);-1==indexOf(T,a)&&T.push(a)}}}function resetView(t){t.display.viewFrom=t.display.viewTo=t.doc.first,t.display.view=[],t.display.viewOffset=0}function viewCuttingPoint(t,r,a,l){var S,O=findViewIndex(t,r),T=t.display.view;if(!Pe||a==t.doc.first+t.doc.size)return{index:O,lineN:a};for(var L=t.display.viewFrom,E=0;E<O;E++)L+=T[E].size;if(L!=r){if(l>0){if(O==T.length-1)return null;S=L+T[O].size-r,O++}else S=L-r;r+=S,a+=S}for(;visualLineNo(t.doc,a)!=a;){if(O==(l<0?0:T.length-1))return null;a+=l*T[O-(l<0?1:0)].size,O+=l}return{index:O,lineN:a}}function countDirtyView(t){for(var r=t.display.view,a=0,l=0;l<r.length;l++){var S=r[l];S.hidden||S.node&&!S.changes||++a}return a}function updateSelection(t){t.display.input.showSelection(t.display.input.prepareSelection())}function prepareSelection(t,r){void 0===r&&(r=!0);for(var a=t.doc,l={},S=l.cursors=document.createDocumentFragment(),O=l.selection=document.createDocumentFragment(),T=0;T<a.sel.ranges.length;T++)if(r||T!=a.sel.primIndex){var L=a.sel.ranges[T];if(!(L.from().line>=t.display.viewTo||L.to().line<t.display.viewFrom)){var E=L.empty();(E||t.options.showCursorWhenSelecting)&&drawSelectionCursor(t,L.head,S),E||drawSelectionRange(t,L,O)}}return l}function drawSelectionCursor(t,r,a){var l=cursorCoords(t,r,"div",null,null,!t.options.singleCursorHeightPerLine),S=a.appendChild(elt("div"," ","CodeMirror-cursor"));if(S.style.left=l.left+"px",S.style.top=l.top+"px",S.style.height=Math.max(0,l.bottom-l.top)*t.options.cursorHeight+"px",l.other){var O=a.appendChild(elt("div"," ","CodeMirror-cursor CodeMirror-secondarycursor"));O.style.display="",O.style.left=l.other.left+"px",O.style.top=l.other.top+"px",O.style.height=.85*(l.other.bottom-l.other.top)+"px"}}function cmpCoords(t,r){return t.top-r.top||t.left-r.left}function drawSelectionRange(t,r,a){var l=t.display,S=t.doc,O=document.createDocumentFragment(),T=paddingH(t.display),L=T.left,E=Math.max(l.sizerWidth,displayWidth(t)-l.sizer.offsetLeft)-T.right,D="ltr"==S.direction;function add(t,r,a,l){r<0&&(r=0),r=Math.round(r),l=Math.round(l),O.appendChild(elt("div",null,"CodeMirror-selected","position: absolute; left: "+t+"px;\n                             top: "+r+"px; width: "+(null==a?E-t:a)+"px;\n                             height: "+(l-r)+"px"))}function drawForLine(r,a,l){var O,T,j=getLine(S,r),V=j.text.length;function coords(a,l){return charCoords(t,Pos(r,a),"div",j,l)}function wrapX(r,a,l){var S=wrappedLineExtentChar(t,j,null,r),O="ltr"==a==("after"==l)?"left":"right";return coords("after"==l?S.begin:S.end-(/\s/.test(j.text.charAt(S.end-1))?2:1),O)[O]}var B=getOrder(j,S.direction);return function iterateBidiSections(t,r,a,l){if(!t)return l(r,a,"ltr",0);for(var S=!1,O=0;O<t.length;++O){var T=t[O];(T.from<a&&T.to>r||r==a&&T.to==r)&&(l(Math.max(T.from,r),Math.min(T.to,a),1==T.level?"rtl":"ltr",O),S=!0)}S||l(r,a,"ltr")}(B,a||0,null==l?V:l,(function(t,r,S,j){var q="ltr"==S,G=coords(t,q?"left":"right"),K=coords(r-1,q?"right":"left"),X=null==a&&0==t,$=null==l&&r==V,Z=0==j,Q=!B||j==B.length-1;if(K.top-G.top<=3){var ee=(D?$:X)&&Q,te=(D?X:$)&&Z?L:(q?G:K).left,ne=ee?E:(q?K:G).right;add(te,G.top,ne-te,G.bottom)}else{var re,oe,ie,ae;q?(re=D&&X&&Z?L:G.left,oe=D?E:wrapX(t,S,"before"),ie=D?L:wrapX(r,S,"after"),ae=D&&$&&Q?E:K.right):(re=D?wrapX(t,S,"before"):L,oe=!D&&X&&Z?E:G.right,ie=!D&&$&&Q?L:K.left,ae=D?wrapX(r,S,"after"):E),add(re,G.top,oe-re,G.bottom),G.bottom<K.top&&add(L,G.bottom,null,K.top),add(ie,K.top,ae-ie,K.bottom)}(!O||cmpCoords(G,O)<0)&&(O=G),cmpCoords(K,O)<0&&(O=K),(!T||cmpCoords(G,T)<0)&&(T=G),cmpCoords(K,T)<0&&(T=K)})),{start:O,end:T}}var j=r.from(),V=r.to();if(j.line==V.line)drawForLine(j.line,j.ch,V.ch);else{var B=getLine(S,j.line),q=getLine(S,V.line),G=visualLine(B)==visualLine(q),K=drawForLine(j.line,j.ch,G?B.text.length+1:null).end,X=drawForLine(V.line,G?0:null,V.ch).start;G&&(K.top<X.top-2?(add(K.right,K.top,null,K.bottom),add(L,X.top,X.left,X.bottom)):add(K.right,K.top,X.left-K.right,K.bottom)),K.bottom<X.top&&add(L,K.bottom,null,X.top)}a.appendChild(O)}function restartBlink(t){if(t.state.focused){var r=t.display;clearInterval(r.blinker);var a=!0;r.cursorDiv.style.visibility="",t.options.cursorBlinkRate>0?r.blinker=setInterval((function(){t.hasFocus()||onBlur(t),r.cursorDiv.style.visibility=(a=!a)?"":"hidden"}),t.options.cursorBlinkRate):t.options.cursorBlinkRate<0&&(r.cursorDiv.style.visibility="hidden")}}function ensureFocus(t){t.hasFocus()||(t.display.input.focus(),t.state.focused||onFocus(t))}function delayBlurEvent(t){t.state.delayingBlurEvent=!0,setTimeout((function(){t.state.delayingBlurEvent&&(t.state.delayingBlurEvent=!1,t.state.focused&&onBlur(t))}),100)}function onFocus(t,r){t.state.delayingBlurEvent&&!t.state.draggingText&&(t.state.delayingBlurEvent=!1),"nocursor"!=t.options.readOnly&&(t.state.focused||(signal(t,"focus",t,r),t.state.focused=!0,addClass(t.display.wrapper,"CodeMirror-focused"),t.curOp||t.display.selForContextMenu==t.doc.sel||(t.display.input.reset(),E&&setTimeout((function(){return t.display.input.reset(!0)}),20)),t.display.input.receivedFocus()),restartBlink(t))}function onBlur(t,r){t.state.delayingBlurEvent||(t.state.focused&&(signal(t,"blur",t,r),t.state.focused=!1,rmClass(t.display.wrapper,"CodeMirror-focused")),clearInterval(t.display.blinker),setTimeout((function(){t.state.focused||(t.display.shift=!1)}),150))}function updateHeightsInViewport(t){for(var r=t.display,a=r.lineDiv.offsetTop,l=0;l<r.view.length;l++){var S=r.view[l],O=t.options.lineWrapping,E=void 0,D=0;if(!S.hidden){if(T&&L<8){var j=S.node.offsetTop+S.node.offsetHeight;E=j-a,a=j}else{var V=S.node.getBoundingClientRect();E=V.bottom-V.top,!O&&S.text.firstChild&&(D=S.text.firstChild.getBoundingClientRect().right-V.left-1)}var B=S.line.height-E;if((B>.005||B<-.005)&&(updateLineHeight(S.line,E),updateWidgetHeight(S.line),S.rest))for(var q=0;q<S.rest.length;q++)updateWidgetHeight(S.rest[q]);if(D>t.display.sizerWidth){var G=Math.ceil(D/charWidth(t.display));G>t.display.maxLineLength&&(t.display.maxLineLength=G,t.display.maxLine=S.line,t.display.maxLineChanged=!0)}}}}function updateWidgetHeight(t){if(t.widgets)for(var r=0;r<t.widgets.length;++r){var a=t.widgets[r],l=a.node.parentNode;l&&(a.height=l.offsetHeight)}}function visibleLines(t,r,a){var l=a&&null!=a.top?Math.max(0,a.top):t.scroller.scrollTop;l=Math.floor(l-paddingTop(t));var S=a&&null!=a.bottom?a.bottom:l+t.wrapper.clientHeight,O=lineAtHeight(r,l),T=lineAtHeight(r,S);if(a&&a.ensure){var L=a.ensure.from.line,E=a.ensure.to.line;L<O?(O=L,T=lineAtHeight(r,heightAtLine(getLine(r,L))+t.wrapper.clientHeight)):Math.min(E,r.lastLine())>=T&&(O=lineAtHeight(r,heightAtLine(getLine(r,E))-t.wrapper.clientHeight),T=E)}return{from:O,to:Math.max(T,O+1)}}function calculateScrollPos(t,r){var a=t.display,l=textHeight(t.display);r.top<0&&(r.top=0);var S=t.curOp&&null!=t.curOp.scrollTop?t.curOp.scrollTop:a.scroller.scrollTop,O=displayHeight(t),T={};r.bottom-r.top>O&&(r.bottom=r.top+O);var L=t.doc.height+paddingVert(a),E=r.top<l,D=r.bottom>L-l;if(r.top<S)T.scrollTop=E?0:r.top;else if(r.bottom>S+O){var j=Math.min(r.top,(D?L:r.bottom)-O);j!=S&&(T.scrollTop=j)}var V=t.options.fixedGutter?0:a.gutters.offsetWidth,B=t.curOp&&null!=t.curOp.scrollLeft?t.curOp.scrollLeft:a.scroller.scrollLeft-V,q=displayWidth(t)-a.gutters.offsetWidth,G=r.right-r.left>q;return G&&(r.right=r.left+q),r.left<10?T.scrollLeft=0:r.left<B?T.scrollLeft=Math.max(0,r.left+V-(G?0:10)):r.right>q+B-3&&(T.scrollLeft=r.right+(G?0:10)-q),T}function addToScrollTop(t,r){null!=r&&(resolveScrollToPos(t),t.curOp.scrollTop=(null==t.curOp.scrollTop?t.doc.scrollTop:t.curOp.scrollTop)+r)}function ensureCursorVisible(t){resolveScrollToPos(t);var r=t.getCursor();t.curOp.scrollToPos={from:r,to:r,margin:t.options.cursorScrollMargin}}function scrollToCoords(t,r,a){null==r&&null==a||resolveScrollToPos(t),null!=r&&(t.curOp.scrollLeft=r),null!=a&&(t.curOp.scrollTop=a)}function resolveScrollToPos(t){var r=t.curOp.scrollToPos;r&&(t.curOp.scrollToPos=null,scrollToCoordsRange(t,estimateCoords(t,r.from),estimateCoords(t,r.to),r.margin))}function scrollToCoordsRange(t,r,a,l){var S=calculateScrollPos(t,{left:Math.min(r.left,a.left),top:Math.min(r.top,a.top)-l,right:Math.max(r.right,a.right),bottom:Math.max(r.bottom,a.bottom)+l});scrollToCoords(t,S.scrollLeft,S.scrollTop)}function updateScrollTop(t,r){Math.abs(t.doc.scrollTop-r)<2||(a||updateDisplaySimple(t,{top:r}),setScrollTop(t,r,!0),a&&updateDisplaySimple(t),startWorker(t,100))}function setScrollTop(t,r,a){r=Math.max(0,Math.min(t.display.scroller.scrollHeight-t.display.scroller.clientHeight,r)),(t.display.scroller.scrollTop!=r||a)&&(t.doc.scrollTop=r,t.display.scrollbars.setScrollTop(r),t.display.scroller.scrollTop!=r&&(t.display.scroller.scrollTop=r))}function setScrollLeft(t,r,a,l){r=Math.max(0,Math.min(r,t.display.scroller.scrollWidth-t.display.scroller.clientWidth)),(a?r==t.doc.scrollLeft:Math.abs(t.doc.scrollLeft-r)<2)&&!l||(t.doc.scrollLeft=r,alignHorizontally(t),t.display.scroller.scrollLeft!=r&&(t.display.scroller.scrollLeft=r),t.display.scrollbars.setScrollLeft(r))}function measureForScrollbars(t){var r=t.display,a=r.gutters.offsetWidth,l=Math.round(t.doc.height+paddingVert(t.display));return{clientHeight:r.scroller.clientHeight,viewHeight:r.wrapper.clientHeight,scrollWidth:r.scroller.scrollWidth,clientWidth:r.scroller.clientWidth,viewWidth:r.wrapper.clientWidth,barLeft:t.options.fixedGutter?a:0,docHeight:l,scrollHeight:l+scrollGap(t)+r.barHeight,nativeBarWidth:r.nativeBarWidth,gutterWidth:a}}var NativeScrollbars=function(t,r,a){this.cm=a;var l=this.vert=elt("div",[elt("div",null,null,"min-width: 1px")],"CodeMirror-vscrollbar"),S=this.horiz=elt("div",[elt("div",null,null,"height: 100%; min-height: 1px")],"CodeMirror-hscrollbar");l.tabIndex=S.tabIndex=-1,t(l),t(S),on(l,"scroll",(function(){l.clientHeight&&r(l.scrollTop,"vertical")})),on(S,"scroll",(function(){S.clientWidth&&r(S.scrollLeft,"horizontal")})),this.checkedZeroWidth=!1,T&&L<8&&(this.horiz.style.minHeight=this.vert.style.minWidth="18px")};NativeScrollbars.prototype.update=function(t){var r=t.scrollWidth>t.clientWidth+1,a=t.scrollHeight>t.clientHeight+1,l=t.nativeBarWidth;if(a){this.vert.style.display="block",this.vert.style.bottom=r?l+"px":"0";var S=t.viewHeight-(r?l:0);this.vert.firstChild.style.height=Math.max(0,t.scrollHeight-t.clientHeight+S)+"px"}else this.vert.style.display="",this.vert.firstChild.style.height="0";if(r){this.horiz.style.display="block",this.horiz.style.right=a?l+"px":"0",this.horiz.style.left=t.barLeft+"px";var O=t.viewWidth-t.barLeft-(a?l:0);this.horiz.firstChild.style.width=Math.max(0,t.scrollWidth-t.clientWidth+O)+"px"}else this.horiz.style.display="",this.horiz.firstChild.style.width="0";return!this.checkedZeroWidth&&t.clientHeight>0&&(0==l&&this.zeroWidthHack(),this.checkedZeroWidth=!0),{right:a?l:0,bottom:r?l:0}},NativeScrollbars.prototype.setScrollLeft=function(t){this.horiz.scrollLeft!=t&&(this.horiz.scrollLeft=t),this.disableHoriz&&this.enableZeroWidthBar(this.horiz,this.disableHoriz,"horiz")},NativeScrollbars.prototype.setScrollTop=function(t){this.vert.scrollTop!=t&&(this.vert.scrollTop=t),this.disableVert&&this.enableZeroWidthBar(this.vert,this.disableVert,"vert")},NativeScrollbars.prototype.zeroWidthHack=function(){var t=Z&&!q?"12px":"18px";this.horiz.style.height=this.vert.style.width=t,this.horiz.style.pointerEvents=this.vert.style.pointerEvents="none",this.disableHoriz=new Delayed,this.disableVert=new Delayed},NativeScrollbars.prototype.enableZeroWidthBar=function(t,r,a){t.style.pointerEvents="auto",r.set(1e3,(function maybeDisable(){var l=t.getBoundingClientRect();("vert"==a?document.elementFromPoint(l.right-1,(l.top+l.bottom)/2):document.elementFromPoint((l.right+l.left)/2,l.bottom-1))!=t?t.style.pointerEvents="none":r.set(1e3,maybeDisable)}))},NativeScrollbars.prototype.clear=function(){var t=this.horiz.parentNode;t.removeChild(this.horiz),t.removeChild(this.vert)};var NullScrollbars=function(){};function updateScrollbars(t,r){r||(r=measureForScrollbars(t));var a=t.display.barWidth,l=t.display.barHeight;updateScrollbarsInner(t,r);for(var S=0;S<4&&a!=t.display.barWidth||l!=t.display.barHeight;S++)a!=t.display.barWidth&&t.options.lineWrapping&&updateHeightsInViewport(t),updateScrollbarsInner(t,measureForScrollbars(t)),a=t.display.barWidth,l=t.display.barHeight}function updateScrollbarsInner(t,r){var a=t.display,l=a.scrollbars.update(r);a.sizer.style.paddingRight=(a.barWidth=l.right)+"px",a.sizer.style.paddingBottom=(a.barHeight=l.bottom)+"px",a.heightForcer.style.borderBottom=l.bottom+"px solid transparent",l.right&&l.bottom?(a.scrollbarFiller.style.display="block",a.scrollbarFiller.style.height=l.bottom+"px",a.scrollbarFiller.style.width=l.right+"px"):a.scrollbarFiller.style.display="",l.bottom&&t.options.coverGutterNextToScrollbar&&t.options.fixedGutter?(a.gutterFiller.style.display="block",a.gutterFiller.style.height=l.bottom+"px",a.gutterFiller.style.width=r.gutterWidth+"px"):a.gutterFiller.style.display=""}NullScrollbars.prototype.update=function(){return{bottom:0,right:0}},NullScrollbars.prototype.setScrollLeft=function(){},NullScrollbars.prototype.setScrollTop=function(){},NullScrollbars.prototype.clear=function(){};var Re={native:NativeScrollbars,null:NullScrollbars};function initScrollbars(t){t.display.scrollbars&&(t.display.scrollbars.clear(),t.display.scrollbars.addClass&&rmClass(t.display.wrapper,t.display.scrollbars.addClass)),t.display.scrollbars=new Re[t.options.scrollbarStyle]((function(r){t.display.wrapper.insertBefore(r,t.display.scrollbarFiller),on(r,"mousedown",(function(){t.state.focused&&setTimeout((function(){return t.display.input.focus()}),0)})),r.setAttribute("cm-not-content","true")}),(function(r,a){"horizontal"==a?setScrollLeft(t,r):updateScrollTop(t,r)}),t),t.display.scrollbars.addClass&&addClass(t.display.wrapper,t.display.scrollbars.addClass)}var De=0;function startOperation(t){t.curOp={cm:t,viewChanged:!1,startHeight:t.doc.height,forceUpdate:!1,updateInput:0,typing:!1,changeObjs:null,cursorActivityHandlers:null,cursorActivityCalled:0,selectionChanged:!1,updateMaxLine:!1,scrollLeft:null,scrollTop:null,scrollToPos:null,focus:!1,id:++De},function pushOperation(t){Me?Me.ops.push(t):t.ownsGroup=Me={ops:[t],delayedCallbacks:[]}}(t.curOp)}function endOperation(t){var r=t.curOp;r&&function finishOperation(t,r){var a=t.ownsGroup;if(a)try{!function fireCallbacksForOps(t){var r=t.delayedCallbacks,a=0;do{for(;a<r.length;a++)r[a].call(null);for(var l=0;l<t.ops.length;l++){var S=t.ops[l];if(S.cursorActivityHandlers)for(;S.cursorActivityCalled<S.cursorActivityHandlers.length;)S.cursorActivityHandlers[S.cursorActivityCalled++].call(null,S.cm)}}while(a<r.length)}(a)}finally{Me=null,r(a)}}(r,(function(t){for(var r=0;r<t.ops.length;r++)t.ops[r].cm.curOp=null;!function endOperations(t){for(var r=t.ops,a=0;a<r.length;a++)endOperation_R1(r[a]);for(var l=0;l<r.length;l++)endOperation_W1(r[l]);for(var S=0;S<r.length;S++)endOperation_R2(r[S]);for(var O=0;O<r.length;O++)endOperation_W2(r[O]);for(var T=0;T<r.length;T++)endOperation_finish(r[T])}(t)}))}function endOperation_R1(t){var r=t.cm,a=r.display;!function maybeClipScrollbars(t){var r=t.display;!r.scrollbarsClipped&&r.scroller.offsetWidth&&(r.nativeBarWidth=r.scroller.offsetWidth-r.scroller.clientWidth,r.heightForcer.style.height=scrollGap(t)+"px",r.sizer.style.marginBottom=-r.nativeBarWidth+"px",r.sizer.style.borderRightWidth=scrollGap(t)+"px",r.scrollbarsClipped=!0)}(r),t.updateMaxLine&&findMaxLine(r),t.mustUpdate=t.viewChanged||t.forceUpdate||null!=t.scrollTop||t.scrollToPos&&(t.scrollToPos.from.line<a.viewFrom||t.scrollToPos.to.line>=a.viewTo)||a.maxLineChanged&&r.options.lineWrapping,t.update=t.mustUpdate&&new DisplayUpdate(r,t.mustUpdate&&{top:t.scrollTop,ensure:t.scrollToPos},t.forceUpdate)}function endOperation_W1(t){t.updatedDisplay=t.mustUpdate&&updateDisplayIfNeeded(t.cm,t.update)}function endOperation_R2(t){var r=t.cm,a=r.display;t.updatedDisplay&&updateHeightsInViewport(r),t.barMeasure=measureForScrollbars(r),a.maxLineChanged&&!r.options.lineWrapping&&(t.adjustWidthTo=measureChar(r,a.maxLine,a.maxLine.text.length).left+3,r.display.sizerWidth=t.adjustWidthTo,t.barMeasure.scrollWidth=Math.max(a.scroller.clientWidth,a.sizer.offsetLeft+t.adjustWidthTo+scrollGap(r)+r.display.barWidth),t.maxScrollLeft=Math.max(0,a.sizer.offsetLeft+t.adjustWidthTo-displayWidth(r))),(t.updatedDisplay||t.selectionChanged)&&(t.preparedSelection=a.input.prepareSelection())}function endOperation_W2(t){var r=t.cm;null!=t.adjustWidthTo&&(r.display.sizer.style.minWidth=t.adjustWidthTo+"px",t.maxScrollLeft<r.doc.scrollLeft&&setScrollLeft(r,Math.min(r.display.scroller.scrollLeft,t.maxScrollLeft),!0),r.display.maxLineChanged=!1);var a=t.focus&&t.focus==activeElt();t.preparedSelection&&r.display.input.showSelection(t.preparedSelection,a),(t.updatedDisplay||t.startHeight!=r.doc.height)&&updateScrollbars(r,t.barMeasure),t.updatedDisplay&&setDocumentHeight(r,t.barMeasure),t.selectionChanged&&restartBlink(r),r.state.focused&&t.updateInput&&r.display.input.reset(t.typing),a&&ensureFocus(t.cm)}function endOperation_finish(t){var r=t.cm,a=r.display,l=r.doc;t.updatedDisplay&&postUpdateDisplay(r,t.update),null==a.wheelStartX||null==t.scrollTop&&null==t.scrollLeft&&!t.scrollToPos||(a.wheelStartX=a.wheelStartY=null),null!=t.scrollTop&&setScrollTop(r,t.scrollTop,t.forceScroll),null!=t.scrollLeft&&setScrollLeft(r,t.scrollLeft,!0,!0),t.scrollToPos&&function maybeScrollWindow(t,r){if(!signalDOMEvent(t,"scrollCursorIntoView")){var a=t.display,l=a.sizer.getBoundingClientRect(),S=null;if(r.top+l.top<0?S=!0:r.bottom+l.top>(window.innerHeight||document.documentElement.clientHeight)&&(S=!1),null!=S&&!G){var O=elt("div","​",null,"position: absolute;\n                         top: "+(r.top-a.viewOffset-paddingTop(t.display))+"px;\n                         height: "+(r.bottom-r.top+scrollGap(t)+a.barHeight)+"px;\n                         left: "+r.left+"px; width: "+Math.max(2,r.right-r.left)+"px;");t.display.lineSpace.appendChild(O),O.scrollIntoView(S),t.display.lineSpace.removeChild(O)}}}(r,function scrollPosIntoView(t,r,a,l){var S;null==l&&(l=0),t.options.lineWrapping||r!=a||(a="before"==(r=r.ch?Pos(r.line,"before"==r.sticky?r.ch-1:r.ch,"after"):r).sticky?Pos(r.line,r.ch+1,"before"):r);for(var O=0;O<5;O++){var T=!1,L=cursorCoords(t,r),E=a&&a!=r?cursorCoords(t,a):L,D=calculateScrollPos(t,S={left:Math.min(L.left,E.left),top:Math.min(L.top,E.top)-l,right:Math.max(L.left,E.left),bottom:Math.max(L.bottom,E.bottom)+l}),j=t.doc.scrollTop,V=t.doc.scrollLeft;if(null!=D.scrollTop&&(updateScrollTop(t,D.scrollTop),Math.abs(t.doc.scrollTop-j)>1&&(T=!0)),null!=D.scrollLeft&&(setScrollLeft(t,D.scrollLeft),Math.abs(t.doc.scrollLeft-V)>1&&(T=!0)),!T)break}return S}(r,clipPos(l,t.scrollToPos.from),clipPos(l,t.scrollToPos.to),t.scrollToPos.margin));var S=t.maybeHiddenMarkers,O=t.maybeUnhiddenMarkers;if(S)for(var T=0;T<S.length;++T)S[T].lines.length||signal(S[T],"hide");if(O)for(var L=0;L<O.length;++L)O[L].lines.length&&signal(O[L],"unhide");a.wrapper.offsetHeight&&(l.scrollTop=r.display.scroller.scrollTop),t.changeObjs&&signal(r,"changes",r,t.changeObjs),t.update&&t.update.finish()}function runInOp(t,r){if(t.curOp)return r();startOperation(t);try{return r()}finally{endOperation(t)}}function operation(t,r){return function(){if(t.curOp)return r.apply(t,arguments);startOperation(t);try{return r.apply(t,arguments)}finally{endOperation(t)}}}function methodOp(t){return function(){if(this.curOp)return t.apply(this,arguments);startOperation(this);try{return t.apply(this,arguments)}finally{endOperation(this)}}}function docMethodOp(t){return function(){var r=this.cm;if(!r||r.curOp)return t.apply(this,arguments);startOperation(r);try{return t.apply(this,arguments)}finally{endOperation(r)}}}function startWorker(t,r){t.doc.highlightFrontier<t.display.viewTo&&t.state.highlight.set(r,bind(highlightWorker,t))}function highlightWorker(t){var r=t.doc;if(!(r.highlightFrontier>=t.display.viewTo)){var a=+new Date+t.options.workTime,l=getContextBefore(t,r.highlightFrontier),S=[];r.iter(l.line,Math.min(r.first+r.size,t.display.viewTo+500),(function(O){if(l.line>=t.display.viewFrom){var T=O.styles,L=O.text.length>t.options.maxHighlightLength?copyState(r.mode,l.state):null,E=highlightLine(t,O,l,!0);L&&(l.state=L),O.styles=E.styles;var D=O.styleClasses,j=E.classes;j?O.styleClasses=j:D&&(O.styleClasses=null);for(var V=!T||T.length!=O.styles.length||D!=j&&(!D||!j||D.bgClass!=j.bgClass||D.textClass!=j.textClass),B=0;!V&&B<T.length;++B)V=T[B]!=O.styles[B];V&&S.push(l.line),O.stateAfter=l.save(),l.nextLine()}else O.text.length<=t.options.maxHighlightLength&&processLine(t,O.text,l),O.stateAfter=l.line%5==0?l.save():null,l.nextLine();if(+new Date>a)return startWorker(t,t.options.workDelay),!0})),r.highlightFrontier=l.line,r.modeFrontier=Math.max(r.modeFrontier,l.line),S.length&&runInOp(t,(function(){for(var r=0;r<S.length;r++)regLineChange(t,S[r],"text")}))}}var DisplayUpdate=function(t,r,a){var l=t.display;this.viewport=r,this.visible=visibleLines(l,t.doc,r),this.editorIsHidden=!l.wrapper.offsetWidth,this.wrapperHeight=l.wrapper.clientHeight,this.wrapperWidth=l.wrapper.clientWidth,this.oldDisplayWidth=displayWidth(t),this.force=a,this.dims=getDimensions(t),this.events=[]};function updateDisplayIfNeeded(t,r){var a=t.display,l=t.doc;if(r.editorIsHidden)return resetView(t),!1;if(!r.force&&r.visible.from>=a.viewFrom&&r.visible.to<=a.viewTo&&(null==a.updateLineNumbers||a.updateLineNumbers>=a.viewTo)&&a.renderedView==a.view&&0==countDirtyView(t))return!1;maybeUpdateLineNumberWidth(t)&&(resetView(t),r.dims=getDimensions(t));var S=l.first+l.size,O=Math.max(r.visible.from-t.options.viewportMargin,l.first),T=Math.min(S,r.visible.to+t.options.viewportMargin);a.viewFrom<O&&O-a.viewFrom<20&&(O=Math.max(l.first,a.viewFrom)),a.viewTo>T&&a.viewTo-T<20&&(T=Math.min(S,a.viewTo)),Pe&&(O=visualLineNo(t.doc,O),T=visualLineEndNo(t.doc,T));var L=O!=a.viewFrom||T!=a.viewTo||a.lastWrapHeight!=r.wrapperHeight||a.lastWrapWidth!=r.wrapperWidth;!function adjustView(t,r,a){var l=t.display;0==l.view.length||r>=l.viewTo||a<=l.viewFrom?(l.view=buildViewArray(t,r,a),l.viewFrom=r):(l.viewFrom>r?l.view=buildViewArray(t,r,l.viewFrom).concat(l.view):l.viewFrom<r&&(l.view=l.view.slice(findViewIndex(t,r))),l.viewFrom=r,l.viewTo<a?l.view=l.view.concat(buildViewArray(t,l.viewTo,a)):l.viewTo>a&&(l.view=l.view.slice(0,findViewIndex(t,a)))),l.viewTo=a}(t,O,T),a.viewOffset=heightAtLine(getLine(t.doc,a.viewFrom)),t.display.mover.style.top=a.viewOffset+"px";var D=countDirtyView(t);if(!L&&0==D&&!r.force&&a.renderedView==a.view&&(null==a.updateLineNumbers||a.updateLineNumbers>=a.viewTo))return!1;var j=function selectionSnapshot(t){if(t.hasFocus())return null;var r=activeElt();if(!r||!contains(t.display.lineDiv,r))return null;var a={activeElt:r};if(window.getSelection){var l=window.getSelection();l.anchorNode&&l.extend&&contains(t.display.lineDiv,l.anchorNode)&&(a.anchorNode=l.anchorNode,a.anchorOffset=l.anchorOffset,a.focusNode=l.focusNode,a.focusOffset=l.focusOffset)}return a}(t);return D>4&&(a.lineDiv.style.display="none"),function patchDisplay(t,r,a){var l=t.display,S=t.options.lineNumbers,O=l.lineDiv,T=O.firstChild;function rm(r){var a=r.nextSibling;return E&&Z&&t.display.currentWheelTarget==r?r.style.display="none":r.parentNode.removeChild(r),a}for(var L=l.view,D=l.viewFrom,j=0;j<L.length;j++){var V=L[j];if(V.hidden);else if(V.node&&V.node.parentNode==O){for(;T!=V.node;)T=rm(T);var B=S&&null!=r&&r<=D&&V.lineNumber;V.changes&&(indexOf(V.changes,"gutter")>-1&&(B=!1),updateLineForChanges(t,V,D,a)),B&&(removeChildren(V.lineNumber),V.lineNumber.appendChild(document.createTextNode(lineNumberFor(t.options,D)))),T=V.node.nextSibling}else{var q=buildLineElement(t,V,D,a);O.insertBefore(q,T)}D+=V.size}for(;T;)T=rm(T)}(t,a.updateLineNumbers,r.dims),D>4&&(a.lineDiv.style.display=""),a.renderedView=a.view,function restoreSelection(t){if(t&&t.activeElt&&t.activeElt!=activeElt()&&(t.activeElt.focus(),!/^(INPUT|TEXTAREA)$/.test(t.activeElt.nodeName)&&t.anchorNode&&contains(document.body,t.anchorNode)&&contains(document.body,t.focusNode))){var r=window.getSelection(),a=document.createRange();a.setEnd(t.anchorNode,t.anchorOffset),a.collapse(!1),r.removeAllRanges(),r.addRange(a),r.extend(t.focusNode,t.focusOffset)}}(j),removeChildren(a.cursorDiv),removeChildren(a.selectionDiv),a.gutters.style.height=a.sizer.style.minHeight=0,L&&(a.lastWrapHeight=r.wrapperHeight,a.lastWrapWidth=r.wrapperWidth,startWorker(t,400)),a.updateLineNumbers=null,!0}function postUpdateDisplay(t,r){for(var a=r.viewport,l=!0;;l=!1){if(l&&t.options.lineWrapping&&r.oldDisplayWidth!=displayWidth(t))l&&(r.visible=visibleLines(t.display,t.doc,a));else if(a&&null!=a.top&&(a={top:Math.min(t.doc.height+paddingVert(t.display)-displayHeight(t),a.top)}),r.visible=visibleLines(t.display,t.doc,a),r.visible.from>=t.display.viewFrom&&r.visible.to<=t.display.viewTo)break;if(!updateDisplayIfNeeded(t,r))break;updateHeightsInViewport(t);var S=measureForScrollbars(t);updateSelection(t),updateScrollbars(t,S),setDocumentHeight(t,S),r.force=!1}r.signal(t,"update",t),t.display.viewFrom==t.display.reportedViewFrom&&t.display.viewTo==t.display.reportedViewTo||(r.signal(t,"viewportChange",t,t.display.viewFrom,t.display.viewTo),t.display.reportedViewFrom=t.display.viewFrom,t.display.reportedViewTo=t.display.viewTo)}function updateDisplaySimple(t,r){var a=new DisplayUpdate(t,r);if(updateDisplayIfNeeded(t,a)){updateHeightsInViewport(t),postUpdateDisplay(t,a);var l=measureForScrollbars(t);updateSelection(t),updateScrollbars(t,l),setDocumentHeight(t,l),a.finish()}}function updateGutterSpace(t){var r=t.gutters.offsetWidth;t.sizer.style.marginLeft=r+"px",signalLater(t,"gutterChanged",t)}function setDocumentHeight(t,r){t.display.sizer.style.minHeight=r.docHeight+"px",t.display.heightForcer.style.top=r.docHeight+"px",t.display.gutters.style.height=r.docHeight+t.display.barHeight+scrollGap(t)+"px"}function alignHorizontally(t){var r=t.display,a=r.view;if(r.alignWidgets||r.gutters.firstChild&&t.options.fixedGutter){for(var l=compensateForHScroll(r)-r.scroller.scrollLeft+t.doc.scrollLeft,S=r.gutters.offsetWidth,O=l+"px",T=0;T<a.length;T++)if(!a[T].hidden){t.options.fixedGutter&&(a[T].gutter&&(a[T].gutter.style.left=O),a[T].gutterBackground&&(a[T].gutterBackground.style.left=O));var L=a[T].alignable;if(L)for(var E=0;E<L.length;E++)L[E].style.left=O}t.options.fixedGutter&&(r.gutters.style.left=l+S+"px")}}function maybeUpdateLineNumberWidth(t){if(!t.options.lineNumbers)return!1;var r=t.doc,a=lineNumberFor(t.options,r.first+r.size-1),l=t.display;if(a.length!=l.lineNumChars){var S=l.measure.appendChild(elt("div",[elt("div",a)],"CodeMirror-linenumber CodeMirror-gutter-elt")),O=S.firstChild.offsetWidth,T=S.offsetWidth-O;return l.lineGutter.style.width="",l.lineNumInnerWidth=Math.max(O,l.lineGutter.offsetWidth-T)+1,l.lineNumWidth=l.lineNumInnerWidth+T,l.lineNumChars=l.lineNumInnerWidth?a.length:-1,l.lineGutter.style.width=l.lineNumWidth+"px",updateGutterSpace(t.display),!0}return!1}function getGutters(t,r){for(var a=[],l=!1,S=0;S<t.length;S++){var O=t[S],T=null;if("string"!=typeof O&&(T=O.style,O=O.className),"CodeMirror-linenumbers"==O){if(!r)continue;l=!0}a.push({className:O,style:T})}return r&&!l&&a.push({className:"CodeMirror-linenumbers",style:null}),a}function renderGutters(t){var r=t.gutters,a=t.gutterSpecs;removeChildren(r),t.lineGutter=null;for(var l=0;l<a.length;++l){var S=a[l],O=S.className,T=S.style,L=r.appendChild(elt("div",null,"CodeMirror-gutter "+O));T&&(L.style.cssText=T),"CodeMirror-linenumbers"==O&&(t.lineGutter=L,L.style.width=(t.lineNumWidth||1)+"px")}r.style.display=a.length?"":"none",updateGutterSpace(t)}function updateGutters(t){renderGutters(t.display),regChange(t),alignHorizontally(t)}function Display(t,r,l,S){var O=this;this.input=l,O.scrollbarFiller=elt("div",null,"CodeMirror-scrollbar-filler"),O.scrollbarFiller.setAttribute("cm-not-content","true"),O.gutterFiller=elt("div",null,"CodeMirror-gutter-filler"),O.gutterFiller.setAttribute("cm-not-content","true"),O.lineDiv=eltP("div",null,"CodeMirror-code"),O.selectionDiv=elt("div",null,null,"position: relative; z-index: 1"),O.cursorDiv=elt("div",null,"CodeMirror-cursors"),O.measure=elt("div",null,"CodeMirror-measure"),O.lineMeasure=elt("div",null,"CodeMirror-measure"),O.lineSpace=eltP("div",[O.measure,O.lineMeasure,O.selectionDiv,O.cursorDiv,O.lineDiv],null,"position: relative; outline: none");var D=eltP("div",[O.lineSpace],"CodeMirror-lines");O.mover=elt("div",[D],null,"position: relative"),O.sizer=elt("div",[O.mover],"CodeMirror-sizer"),O.sizerWidth=null,O.heightForcer=elt("div",null,null,"position: absolute; height: 50px; width: 1px;"),O.gutters=elt("div",null,"CodeMirror-gutters"),O.lineGutter=null,O.scroller=elt("div",[O.sizer,O.heightForcer,O.gutters],"CodeMirror-scroll"),O.scroller.setAttribute("tabIndex","-1"),O.wrapper=elt("div",[O.scrollbarFiller,O.gutterFiller,O.scroller],"CodeMirror"),T&&L<8&&(O.gutters.style.zIndex=-1,O.scroller.style.paddingRight=0),E||a&&$||(O.scroller.draggable=!0),t&&(t.appendChild?t.appendChild(O.wrapper):t(O.wrapper)),O.viewFrom=O.viewTo=r.first,O.reportedViewFrom=O.reportedViewTo=r.first,O.view=[],O.renderedView=null,O.externalMeasured=null,O.viewOffset=0,O.lastWrapHeight=O.lastWrapWidth=0,O.updateLineNumbers=null,O.nativeBarWidth=O.barHeight=O.barWidth=0,O.scrollbarsClipped=!1,O.lineNumWidth=O.lineNumInnerWidth=O.lineNumChars=null,O.alignWidgets=!1,O.cachedCharWidth=O.cachedTextHeight=O.cachedPaddingH=null,O.maxLine=null,O.maxLineLength=0,O.maxLineChanged=!1,O.wheelDX=O.wheelDY=O.wheelStartX=O.wheelStartY=null,O.shift=!1,O.selForContextMenu=null,O.activeTouch=null,O.gutterSpecs=getGutters(S.gutters,S.lineNumbers),renderGutters(O),l.init(O)}DisplayUpdate.prototype.signal=function(t,r){hasHandler(t,r)&&this.events.push(arguments)},DisplayUpdate.prototype.finish=function(){for(var t=0;t<this.events.length;t++)signal.apply(null,this.events[t])};var ze=0,Ne=null;function wheelEventDelta(t){var r=t.wheelDeltaX,a=t.wheelDeltaY;return null==r&&t.detail&&t.axis==t.HORIZONTAL_AXIS&&(r=t.detail),null==a&&t.detail&&t.axis==t.VERTICAL_AXIS?a=t.detail:null==a&&(a=t.wheelDelta),{x:r,y:a}}function wheelEventPixels(t){var r=wheelEventDelta(t);return r.x*=Ne,r.y*=Ne,r}function onScrollWheel(t,r){var l=wheelEventDelta(r),S=l.x,O=l.y,T=t.display,L=T.scroller,D=L.scrollWidth>L.clientWidth,j=L.scrollHeight>L.clientHeight;if(S&&D||O&&j){if(O&&Z&&E)e:for(var B=r.target,q=T.view;B!=L;B=B.parentNode)for(var G=0;G<q.length;G++)if(q[G].node==B){t.display.currentWheelTarget=B;break e}if(S&&!a&&!V&&null!=Ne)return O&&j&&updateScrollTop(t,Math.max(0,L.scrollTop+O*Ne)),setScrollLeft(t,Math.max(0,L.scrollLeft+S*Ne)),(!O||O&&j)&&e_preventDefault(r),void(T.wheelStartX=null);if(O&&null!=Ne){var K=O*Ne,X=t.doc.scrollTop,$=X+T.wrapper.clientHeight;K<0?X=Math.max(0,X+K-50):$=Math.min(t.doc.height,$+K+50),updateDisplaySimple(t,{top:X,bottom:$})}ze<20&&(null==T.wheelStartX?(T.wheelStartX=L.scrollLeft,T.wheelStartY=L.scrollTop,T.wheelDX=S,T.wheelDY=O,setTimeout((function(){if(null!=T.wheelStartX){var t=L.scrollLeft-T.wheelStartX,r=L.scrollTop-T.wheelStartY,a=r&&T.wheelDY&&r/T.wheelDY||t&&T.wheelDX&&t/T.wheelDX;T.wheelStartX=T.wheelStartY=null,a&&(Ne=(Ne*ze+a)/(ze+1),++ze)}}),200)):(T.wheelDX+=S,T.wheelDY+=O))}}T?Ne=-.53:a?Ne=15:j?Ne=-.7:B&&(Ne=-1/3);var Selection=function(t,r){this.ranges=t,this.primIndex=r};Selection.prototype.primary=function(){return this.ranges[this.primIndex]},Selection.prototype.equals=function(t){if(t==this)return!0;if(t.primIndex!=this.primIndex||t.ranges.length!=this.ranges.length)return!1;for(var r=0;r<this.ranges.length;r++){var a=this.ranges[r],l=t.ranges[r];if(!equalCursorPos(a.anchor,l.anchor)||!equalCursorPos(a.head,l.head))return!1}return!0},Selection.prototype.deepCopy=function(){for(var t=[],r=0;r<this.ranges.length;r++)t[r]=new Range(copyPos(this.ranges[r].anchor),copyPos(this.ranges[r].head));return new Selection(t,this.primIndex)},Selection.prototype.somethingSelected=function(){for(var t=0;t<this.ranges.length;t++)if(!this.ranges[t].empty())return!0;return!1},Selection.prototype.contains=function(t,r){r||(r=t);for(var a=0;a<this.ranges.length;a++){var l=this.ranges[a];if(cmp(r,l.from())>=0&&cmp(t,l.to())<=0)return a}return-1};var Range=function(t,r){this.anchor=t,this.head=r};function normalizeSelection(t,r,a){var l=t&&t.options.selectionsMayTouch,S=r[a];r.sort((function(t,r){return cmp(t.from(),r.from())})),a=indexOf(r,S);for(var O=1;O<r.length;O++){var T=r[O],L=r[O-1],E=cmp(L.to(),T.from());if(l&&!T.empty()?E>0:E>=0){var D=minPos(L.from(),T.from()),j=maxPos(L.to(),T.to()),V=L.empty()?T.from()==T.head:L.from()==L.head;O<=a&&--a,r.splice(--O,2,new Range(V?j:D,V?D:j))}}return new Selection(r,a)}function simpleSelection(t,r){return new Selection([new Range(t,r||t)],0)}function changeEnd(t){return t.text?Pos(t.from.line+t.text.length-1,lst(t.text).length+(1==t.text.length?t.from.ch:0)):t.to}function adjustForChange(t,r){if(cmp(t,r.from)<0)return t;if(cmp(t,r.to)<=0)return changeEnd(r);var a=t.line+r.text.length-(r.to.line-r.from.line)-1,l=t.ch;return t.line==r.to.line&&(l+=changeEnd(r).ch-r.to.ch),Pos(a,l)}function computeSelAfterChange(t,r){for(var a=[],l=0;l<t.sel.ranges.length;l++){var S=t.sel.ranges[l];a.push(new Range(adjustForChange(S.anchor,r),adjustForChange(S.head,r)))}return normalizeSelection(t.cm,a,t.sel.primIndex)}function offsetPos(t,r,a){return t.line==r.line?Pos(a.line,t.ch-r.ch+a.ch):Pos(a.line+(t.line-r.line),t.ch)}function loadMode(t){t.doc.mode=getMode(t.options,t.doc.modeOption),resetModeState(t)}function resetModeState(t){t.doc.iter((function(t){t.stateAfter&&(t.stateAfter=null),t.styles&&(t.styles=null)})),t.doc.modeFrontier=t.doc.highlightFrontier=t.doc.first,startWorker(t,100),t.state.modeGen++,t.curOp&&regChange(t)}function isWholeLineUpdate(t,r){return 0==r.from.ch&&0==r.to.ch&&""==lst(r.text)&&(!t.cm||t.cm.options.wholeLineUpdateBefore)}function updateDoc(t,r,a,l){function spansFor(t){return a?a[t]:null}function update(t,a,S){!function updateLine(t,r,a,l){t.text=r,t.stateAfter&&(t.stateAfter=null),t.styles&&(t.styles=null),null!=t.order&&(t.order=null),detachMarkedSpans(t),attachMarkedSpans(t,a);var S=l?l(t):1;S!=t.height&&updateLineHeight(t,S)}(t,a,S,l),signalLater(t,"change",t,r)}function linesFor(t,r){for(var a=[],S=t;S<r;++S)a.push(new Line(T[S],spansFor(S),l));return a}var S=r.from,O=r.to,T=r.text,L=getLine(t,S.line),E=getLine(t,O.line),D=lst(T),j=spansFor(T.length-1),V=O.line-S.line;if(r.full)t.insert(0,linesFor(0,T.length)),t.remove(T.length,t.size-T.length);else if(isWholeLineUpdate(t,r)){var B=linesFor(0,T.length-1);update(E,E.text,j),V&&t.remove(S.line,V),B.length&&t.insert(S.line,B)}else if(L==E)if(1==T.length)update(L,L.text.slice(0,S.ch)+D+L.text.slice(O.ch),j);else{var q=linesFor(1,T.length-1);q.push(new Line(D+L.text.slice(O.ch),j,l)),update(L,L.text.slice(0,S.ch)+T[0],spansFor(0)),t.insert(S.line+1,q)}else if(1==T.length)update(L,L.text.slice(0,S.ch)+T[0]+E.text.slice(O.ch),spansFor(0)),t.remove(S.line+1,V);else{update(L,L.text.slice(0,S.ch)+T[0],spansFor(0)),update(E,D+E.text.slice(O.ch),j);var G=linesFor(1,T.length-1);V>1&&t.remove(S.line+1,V-1),t.insert(S.line+1,G)}signalLater(t,"change",t,r)}function linkedDocs(t,r,a){!function propagate(t,l,S){if(t.linked)for(var O=0;O<t.linked.length;++O){var T=t.linked[O];if(T.doc!=l){var L=S&&T.sharedHist;a&&!L||(r(T.doc,L),propagate(T.doc,t,L))}}}(t,null,!0)}function attachDoc(t,r){if(r.cm)throw new Error("This document is already in use.");t.doc=r,r.cm=t,estimateLineHeights(t),loadMode(t),setDirectionClass(t),t.options.lineWrapping||findMaxLine(t),t.options.mode=r.modeOption,regChange(t)}function setDirectionClass(t){("rtl"==t.doc.direction?addClass:rmClass)(t.display.lineDiv,"CodeMirror-rtl")}function History(t){this.done=[],this.undone=[],this.undoDepth=t?t.undoDepth:1/0,this.lastModTime=this.lastSelTime=0,this.lastOp=this.lastSelOp=null,this.lastOrigin=this.lastSelOrigin=null,this.generation=this.maxGeneration=t?t.maxGeneration:1}function historyChangeFromChange(t,r){var a={from:copyPos(r.from),to:changeEnd(r),text:getBetween(t,r.from,r.to)};return attachLocalSpans(t,a,r.from.line,r.to.line+1),linkedDocs(t,(function(t){return attachLocalSpans(t,a,r.from.line,r.to.line+1)}),!0),a}function clearSelectionEvents(t){for(;t.length&&lst(t).ranges;)t.pop()}function addChangeToHistory(t,r,a,l){var S=t.history;S.undone.length=0;var O,T,L=+new Date;if((S.lastOp==l||S.lastOrigin==r.origin&&r.origin&&("+"==r.origin.charAt(0)&&S.lastModTime>L-(t.cm?t.cm.options.historyEventDelay:500)||"*"==r.origin.charAt(0)))&&(O=function lastChangeEvent(t,r){return r?(clearSelectionEvents(t.done),lst(t.done)):t.done.length&&!lst(t.done).ranges?lst(t.done):t.done.length>1&&!t.done[t.done.length-2].ranges?(t.done.pop(),lst(t.done)):void 0}(S,S.lastOp==l)))T=lst(O.changes),0==cmp(r.from,r.to)&&0==cmp(r.from,T.to)?T.to=changeEnd(r):O.changes.push(historyChangeFromChange(t,r));else{var E=lst(S.done);for(E&&E.ranges||pushSelectionToHistory(t.sel,S.done),O={changes:[historyChangeFromChange(t,r)],generation:S.generation},S.done.push(O);S.done.length>S.undoDepth;)S.done.shift(),S.done[0].ranges||S.done.shift()}S.done.push(a),S.generation=++S.maxGeneration,S.lastModTime=S.lastSelTime=L,S.lastOp=S.lastSelOp=l,S.lastOrigin=S.lastSelOrigin=r.origin,T||signal(t,"historyAdded")}function addSelectionToHistory(t,r,a,l){var S=t.history,O=l&&l.origin;a==S.lastSelOp||O&&S.lastSelOrigin==O&&(S.lastModTime==S.lastSelTime&&S.lastOrigin==O||function selectionEventCanBeMerged(t,r,a,l){var S=r.charAt(0);return"*"==S||"+"==S&&a.ranges.length==l.ranges.length&&a.somethingSelected()==l.somethingSelected()&&new Date-t.history.lastSelTime<=(t.cm?t.cm.options.historyEventDelay:500)}(t,O,lst(S.done),r))?S.done[S.done.length-1]=r:pushSelectionToHistory(r,S.done),S.lastSelTime=+new Date,S.lastSelOrigin=O,S.lastSelOp=a,l&&!1!==l.clearRedo&&clearSelectionEvents(S.undone)}function pushSelectionToHistory(t,r){var a=lst(r);a&&a.ranges&&a.equals(t)||r.push(t)}function attachLocalSpans(t,r,a,l){var S=r["spans_"+t.id],O=0;t.iter(Math.max(t.first,a),Math.min(t.first+t.size,l),(function(a){a.markedSpans&&((S||(S=r["spans_"+t.id]={}))[O]=a.markedSpans),++O}))}function removeClearedSpans(t){if(!t)return null;for(var r,a=0;a<t.length;++a)t[a].marker.explicitlyCleared?r||(r=t.slice(0,a)):r&&r.push(t[a]);return r?r.length?r:null:t}function mergeOldSpans(t,r){var a=function getOldSpans(t,r){var a=r["spans_"+t.id];if(!a)return null;for(var l=[],S=0;S<r.text.length;++S)l.push(removeClearedSpans(a[S]));return l}(t,r),l=stretchSpansOverChange(t,r);if(!a)return l;if(!l)return a;for(var S=0;S<a.length;++S){var O=a[S],T=l[S];if(O&&T)e:for(var L=0;L<T.length;++L){for(var E=T[L],D=0;D<O.length;++D)if(O[D].marker==E.marker)continue e;O.push(E)}else T&&(a[S]=T)}return a}function copyHistoryArray(t,r,a){for(var l=[],S=0;S<t.length;++S){var O=t[S];if(O.ranges)l.push(a?Selection.prototype.deepCopy.call(O):O);else{var T=O.changes,L=[];l.push({changes:L});for(var E=0;E<T.length;++E){var D=T[E],j=void 0;if(L.push({from:D.from,to:D.to,text:D.text}),r)for(var V in D)(j=V.match(/^spans_(\d+)$/))&&indexOf(r,Number(j[1]))>-1&&(lst(L)[V]=D[V],delete D[V])}}}return l}function extendRange(t,r,a,l){if(l){var S=t.anchor;if(a){var O=cmp(r,S)<0;O!=cmp(a,S)<0?(S=r,r=a):O!=cmp(r,a)<0&&(r=a)}return new Range(S,r)}return new Range(a||r,r)}function extendSelection(t,r,a,l,S){null==S&&(S=t.cm&&(t.cm.display.shift||t.extend)),setSelection(t,new Selection([extendRange(t.sel.primary(),r,a,S)],0),l)}function extendSelections(t,r,a){for(var l=[],S=t.cm&&(t.cm.display.shift||t.extend),O=0;O<t.sel.ranges.length;O++)l[O]=extendRange(t.sel.ranges[O],r[O],null,S);setSelection(t,normalizeSelection(t.cm,l,t.sel.primIndex),a)}function replaceOneSelection(t,r,a,l){var S=t.sel.ranges.slice(0);S[r]=a,setSelection(t,normalizeSelection(t.cm,S,t.sel.primIndex),l)}function setSimpleSelection(t,r,a,l){setSelection(t,simpleSelection(r,a),l)}function setSelectionReplaceHistory(t,r,a){var l=t.history.done,S=lst(l);S&&S.ranges?(l[l.length-1]=r,setSelectionNoUndo(t,r,a)):setSelection(t,r,a)}function setSelection(t,r,a){setSelectionNoUndo(t,r,a),addSelectionToHistory(t,t.sel,t.cm?t.cm.curOp.id:NaN,a)}function setSelectionNoUndo(t,r,a){(hasHandler(t,"beforeSelectionChange")||t.cm&&hasHandler(t.cm,"beforeSelectionChange"))&&(r=function filterSelectionChange(t,r,a){var l={ranges:r.ranges,update:function(r){this.ranges=[];for(var a=0;a<r.length;a++)this.ranges[a]=new Range(clipPos(t,r[a].anchor),clipPos(t,r[a].head))},origin:a&&a.origin};return signal(t,"beforeSelectionChange",t,l),t.cm&&signal(t.cm,"beforeSelectionChange",t.cm,l),l.ranges!=r.ranges?normalizeSelection(t.cm,l.ranges,l.ranges.length-1):r}(t,r,a));var l=a&&a.bias||(cmp(r.primary().head,t.sel.primary().head)<0?-1:1);setSelectionInner(t,skipAtomicInSelection(t,r,l,!0)),a&&!1===a.scroll||!t.cm||"nocursor"==t.cm.getOption("readOnly")||ensureCursorVisible(t.cm)}function setSelectionInner(t,r){r.equals(t.sel)||(t.sel=r,t.cm&&(t.cm.curOp.updateInput=1,t.cm.curOp.selectionChanged=!0,signalCursorActivity(t.cm)),signalLater(t,"cursorActivity",t))}function reCheckSelection(t){setSelectionInner(t,skipAtomicInSelection(t,t.sel,null,!1))}function skipAtomicInSelection(t,r,a,l){for(var S,O=0;O<r.ranges.length;O++){var T=r.ranges[O],L=r.ranges.length==t.sel.ranges.length&&t.sel.ranges[O],E=skipAtomic(t,T.anchor,L&&L.anchor,a,l),D=skipAtomic(t,T.head,L&&L.head,a,l);(S||E!=T.anchor||D!=T.head)&&(S||(S=r.ranges.slice(0,O)),S[O]=new Range(E,D))}return S?normalizeSelection(t.cm,S,r.primIndex):r}function skipAtomicInner(t,r,a,l,S){var O=getLine(t,r.line);if(O.markedSpans)for(var T=0;T<O.markedSpans.length;++T){var L=O.markedSpans[T],E=L.marker,D="selectLeft"in E?!E.selectLeft:E.inclusiveLeft,j="selectRight"in E?!E.selectRight:E.inclusiveRight;if((null==L.from||(D?L.from<=r.ch:L.from<r.ch))&&(null==L.to||(j?L.to>=r.ch:L.to>r.ch))){if(S&&(signal(E,"beforeCursorEnter"),E.explicitlyCleared)){if(O.markedSpans){--T;continue}break}if(!E.atomic)continue;if(a){var V=E.find(l<0?1:-1),B=void 0;if((l<0?j:D)&&(V=movePos(t,V,-l,V&&V.line==r.line?O:null)),V&&V.line==r.line&&(B=cmp(V,a))&&(l<0?B<0:B>0))return skipAtomicInner(t,V,r,l,S)}var q=E.find(l<0?-1:1);return(l<0?D:j)&&(q=movePos(t,q,l,q.line==r.line?O:null)),q?skipAtomicInner(t,q,r,l,S):null}}return r}function skipAtomic(t,r,a,l,S){var O=l||1,T=skipAtomicInner(t,r,a,O,S)||!S&&skipAtomicInner(t,r,a,O,!0)||skipAtomicInner(t,r,a,-O,S)||!S&&skipAtomicInner(t,r,a,-O,!0);return T||(t.cantEdit=!0,Pos(t.first,0))}function movePos(t,r,a,l){return a<0&&0==r.ch?r.line>t.first?clipPos(t,Pos(r.line-1)):null:a>0&&r.ch==(l||getLine(t,r.line)).text.length?r.line<t.first+t.size-1?Pos(r.line+1,0):null:new Pos(r.line,r.ch+a)}function selectAll(t){t.setSelection(Pos(t.firstLine(),0),Pos(t.lastLine()),ae)}function filterChange(t,r,a){var l={canceled:!1,from:r.from,to:r.to,text:r.text,origin:r.origin,cancel:function(){return l.canceled=!0}};return a&&(l.update=function(r,a,S,O){r&&(l.from=clipPos(t,r)),a&&(l.to=clipPos(t,a)),S&&(l.text=S),void 0!==O&&(l.origin=O)}),signal(t,"beforeChange",t,l),t.cm&&signal(t.cm,"beforeChange",t.cm,l),l.canceled?(t.cm&&(t.cm.curOp.updateInput=2),null):{from:l.from,to:l.to,text:l.text,origin:l.origin}}function makeChange(t,r,a){if(t.cm){if(!t.cm.curOp)return operation(t.cm,makeChange)(t,r,a);if(t.cm.state.suppressEdits)return}if(!(hasHandler(t,"beforeChange")||t.cm&&hasHandler(t.cm,"beforeChange"))||(r=filterChange(t,r,!0))){var l=Te&&!a&&function removeReadOnlyRanges(t,r,a){var l=null;if(t.iter(r.line,a.line+1,(function(t){if(t.markedSpans)for(var r=0;r<t.markedSpans.length;++r){var a=t.markedSpans[r].marker;!a.readOnly||l&&-1!=indexOf(l,a)||(l||(l=[])).push(a)}})),!l)return null;for(var S=[{from:r,to:a}],O=0;O<l.length;++O)for(var T=l[O],L=T.find(0),E=0;E<S.length;++E){var D=S[E];if(!(cmp(D.to,L.from)<0||cmp(D.from,L.to)>0)){var j=[E,1],V=cmp(D.from,L.from),B=cmp(D.to,L.to);(V<0||!T.inclusiveLeft&&!V)&&j.push({from:D.from,to:L.from}),(B>0||!T.inclusiveRight&&!B)&&j.push({from:L.to,to:D.to}),S.splice.apply(S,j),E+=j.length-3}}return S}(t,r.from,r.to);if(l)for(var S=l.length-1;S>=0;--S)makeChangeInner(t,{from:l[S].from,to:l[S].to,text:S?[""]:r.text,origin:r.origin});else makeChangeInner(t,r)}}function makeChangeInner(t,r){if(1!=r.text.length||""!=r.text[0]||0!=cmp(r.from,r.to)){var a=computeSelAfterChange(t,r);addChangeToHistory(t,r,a,t.cm?t.cm.curOp.id:NaN),makeChangeSingleDoc(t,r,a,stretchSpansOverChange(t,r));var l=[];linkedDocs(t,(function(t,a){a||-1!=indexOf(l,t.history)||(rebaseHist(t.history,r),l.push(t.history)),makeChangeSingleDoc(t,r,null,stretchSpansOverChange(t,r))}))}}function makeChangeFromHistory(t,r,a){var l=t.cm&&t.cm.state.suppressEdits;if(!l||a){for(var S,O=t.history,T=t.sel,L="undo"==r?O.done:O.undone,E="undo"==r?O.undone:O.done,D=0;D<L.length&&(S=L[D],a?!S.ranges||S.equals(t.sel):S.ranges);D++);if(D!=L.length){for(O.lastOrigin=O.lastSelOrigin=null;;){if(!(S=L.pop()).ranges){if(l)return void L.push(S);break}if(pushSelectionToHistory(S,E),a&&!S.equals(t.sel))return void setSelection(t,S,{clearRedo:!1});T=S}var j=[];pushSelectionToHistory(T,E),E.push({changes:j,generation:O.generation}),O.generation=S.generation||++O.maxGeneration;for(var V=hasHandler(t,"beforeChange")||t.cm&&hasHandler(t.cm,"beforeChange"),loop=function(a){var l=S.changes[a];if(l.origin=r,V&&!filterChange(t,l,!1))return L.length=0,{};j.push(historyChangeFromChange(t,l));var O=a?computeSelAfterChange(t,l):lst(L);makeChangeSingleDoc(t,l,O,mergeOldSpans(t,l)),!a&&t.cm&&t.cm.scrollIntoView({from:l.from,to:changeEnd(l)});var T=[];linkedDocs(t,(function(t,r){r||-1!=indexOf(T,t.history)||(rebaseHist(t.history,l),T.push(t.history)),makeChangeSingleDoc(t,l,null,mergeOldSpans(t,l))}))},B=S.changes.length-1;B>=0;--B){var q=loop(B);if(q)return q.v}}}}function shiftDoc(t,r){if(0!=r&&(t.first+=r,t.sel=new Selection(map(t.sel.ranges,(function(t){return new Range(Pos(t.anchor.line+r,t.anchor.ch),Pos(t.head.line+r,t.head.ch))})),t.sel.primIndex),t.cm)){regChange(t.cm,t.first,t.first-r,r);for(var a=t.cm.display,l=a.viewFrom;l<a.viewTo;l++)regLineChange(t.cm,l,"gutter")}}function makeChangeSingleDoc(t,r,a,l){if(t.cm&&!t.cm.curOp)return operation(t.cm,makeChangeSingleDoc)(t,r,a,l);if(r.to.line<t.first)shiftDoc(t,r.text.length-1-(r.to.line-r.from.line));else if(!(r.from.line>t.lastLine())){if(r.from.line<t.first){var S=r.text.length-1-(t.first-r.from.line);shiftDoc(t,S),r={from:Pos(t.first,0),to:Pos(r.to.line+S,r.to.ch),text:[lst(r.text)],origin:r.origin}}var O=t.lastLine();r.to.line>O&&(r={from:r.from,to:Pos(O,getLine(t,O).text.length),text:[r.text[0]],origin:r.origin}),r.removed=getBetween(t,r.from,r.to),a||(a=computeSelAfterChange(t,r)),t.cm?function makeChangeSingleDocInEditor(t,r,a){var l=t.doc,S=t.display,O=r.from,T=r.to,L=!1,E=O.line;t.options.lineWrapping||(E=lineNo(visualLine(getLine(l,O.line))),l.iter(E,T.line+1,(function(t){if(t==S.maxLine)return L=!0,!0}))),l.sel.contains(r.from,r.to)>-1&&signalCursorActivity(t),updateDoc(l,r,a,estimateHeight(t)),t.options.lineWrapping||(l.iter(E,O.line+r.text.length,(function(t){var r=lineLength(t);r>S.maxLineLength&&(S.maxLine=t,S.maxLineLength=r,S.maxLineChanged=!0,L=!1)})),L&&(t.curOp.updateMaxLine=!0)),function retreatFrontier(t,r){if(t.modeFrontier=Math.min(t.modeFrontier,r),!(t.highlightFrontier<r-10)){for(var a=t.first,l=r-1;l>a;l--){var S=getLine(t,l).stateAfter;if(S&&(!(S instanceof SavedContext)||l+S.lookAhead<r)){a=l+1;break}}t.highlightFrontier=Math.min(t.highlightFrontier,a)}}(l,O.line),startWorker(t,400);var D=r.text.length-(T.line-O.line)-1;r.full?regChange(t):O.line!=T.line||1!=r.text.length||isWholeLineUpdate(t.doc,r)?regChange(t,O.line,T.line+1,D):regLineChange(t,O.line,"text");var j=hasHandler(t,"changes"),V=hasHandler(t,"change");if(V||j){var B={from:O,to:T,text:r.text,removed:r.removed,origin:r.origin};V&&signalLater(t,"change",t,B),j&&(t.curOp.changeObjs||(t.curOp.changeObjs=[])).push(B)}t.display.selForContextMenu=null}(t.cm,r,l):updateDoc(t,r,l),setSelectionNoUndo(t,a,ae),t.cantEdit&&skipAtomic(t,Pos(t.firstLine(),0))&&(t.cantEdit=!1)}}function replaceRange(t,r,a,l,S){var O;l||(l=a),cmp(l,a)<0&&(a=(O=[l,a])[0],l=O[1]),"string"==typeof r&&(r=t.splitLines(r)),makeChange(t,{from:a,to:l,text:r,origin:S})}function rebaseHistSelSingle(t,r,a,l){a<t.line?t.line+=l:r<t.line&&(t.line=r,t.ch=0)}function rebaseHistArray(t,r,a,l){for(var S=0;S<t.length;++S){var O=t[S],T=!0;if(O.ranges){O.copied||((O=t[S]=O.deepCopy()).copied=!0);for(var L=0;L<O.ranges.length;L++)rebaseHistSelSingle(O.ranges[L].anchor,r,a,l),rebaseHistSelSingle(O.ranges[L].head,r,a,l)}else{for(var E=0;E<O.changes.length;++E){var D=O.changes[E];if(a<D.from.line)D.from=Pos(D.from.line+l,D.from.ch),D.to=Pos(D.to.line+l,D.to.ch);else if(r<=D.to.line){T=!1;break}}T||(t.splice(0,S+1),S=0)}}}function rebaseHist(t,r){var a=r.from.line,l=r.to.line,S=r.text.length-(l-a)-1;rebaseHistArray(t.done,a,l,S),rebaseHistArray(t.undone,a,l,S)}function changeLine(t,r,a,l){var S=r,O=r;return"number"==typeof r?O=getLine(t,clipLine(t,r)):S=lineNo(r),null==S?null:(l(O,S)&&t.cm&&regLineChange(t.cm,S,a),O)}function LeafChunk(t){this.lines=t,this.parent=null;for(var r=0,a=0;a<t.length;++a)t[a].parent=this,r+=t[a].height;this.height=r}function BranchChunk(t){this.children=t;for(var r=0,a=0,l=0;l<t.length;++l){var S=t[l];r+=S.chunkSize(),a+=S.height,S.parent=this}this.size=r,this.height=a,this.parent=null}Range.prototype.from=function(){return minPos(this.anchor,this.head)},Range.prototype.to=function(){return maxPos(this.anchor,this.head)},Range.prototype.empty=function(){return this.head.line==this.anchor.line&&this.head.ch==this.anchor.ch},LeafChunk.prototype={chunkSize:function(){return this.lines.length},removeInner:function(t,r){for(var a=t,l=t+r;a<l;++a){var S=this.lines[a];this.height-=S.height,cleanUpLine(S),signalLater(S,"delete")}this.lines.splice(t,r)},collapse:function(t){t.push.apply(t,this.lines)},insertInner:function(t,r,a){this.height+=a,this.lines=this.lines.slice(0,t).concat(r).concat(this.lines.slice(t));for(var l=0;l<r.length;++l)r[l].parent=this},iterN:function(t,r,a){for(var l=t+r;t<l;++t)if(a(this.lines[t]))return!0}},BranchChunk.prototype={chunkSize:function(){return this.size},removeInner:function(t,r){this.size-=r;for(var a=0;a<this.children.length;++a){var l=this.children[a],S=l.chunkSize();if(t<S){var O=Math.min(r,S-t),T=l.height;if(l.removeInner(t,O),this.height-=T-l.height,S==O&&(this.children.splice(a--,1),l.parent=null),0==(r-=O))break;t=0}else t-=S}if(this.size-r<25&&(this.children.length>1||!(this.children[0]instanceof LeafChunk))){var L=[];this.collapse(L),this.children=[new LeafChunk(L)],this.children[0].parent=this}},collapse:function(t){for(var r=0;r<this.children.length;++r)this.children[r].collapse(t)},insertInner:function(t,r,a){this.size+=r.length,this.height+=a;for(var l=0;l<this.children.length;++l){var S=this.children[l],O=S.chunkSize();if(t<=O){if(S.insertInner(t,r,a),S.lines&&S.lines.length>50){for(var T=S.lines.length%25+25,L=T;L<S.lines.length;){var E=new LeafChunk(S.lines.slice(L,L+=25));S.height-=E.height,this.children.splice(++l,0,E),E.parent=this}S.lines=S.lines.slice(0,T),this.maybeSpill()}break}t-=O}},maybeSpill:function(){if(!(this.children.length<=10)){var t=this;do{var r=new BranchChunk(t.children.splice(t.children.length-5,5));if(t.parent){t.size-=r.size,t.height-=r.height;var a=indexOf(t.parent.children,t);t.parent.children.splice(a+1,0,r)}else{var l=new BranchChunk(t.children);l.parent=t,t.children=[l,r],t=l}r.parent=t.parent}while(t.children.length>10);t.parent.maybeSpill()}},iterN:function(t,r,a){for(var l=0;l<this.children.length;++l){var S=this.children[l],O=S.chunkSize();if(t<O){var T=Math.min(r,O-t);if(S.iterN(t,T,a))return!0;if(0==(r-=T))break;t=0}else t-=O}}};var LineWidget=function(t,r,a){if(a)for(var l in a)a.hasOwnProperty(l)&&(this[l]=a[l]);this.doc=t,this.node=r};function adjustScrollWhenAboveVisible(t,r,a){heightAtLine(r)<(t.curOp&&t.curOp.scrollTop||t.doc.scrollTop)&&addToScrollTop(t,a)}LineWidget.prototype.clear=function(){var t=this.doc.cm,r=this.line.widgets,a=this.line,l=lineNo(a);if(null!=l&&r){for(var S=0;S<r.length;++S)r[S]==this&&r.splice(S--,1);r.length||(a.widgets=null);var O=widgetHeight(this);updateLineHeight(a,Math.max(0,a.height-O)),t&&(runInOp(t,(function(){adjustScrollWhenAboveVisible(t,a,-O),regLineChange(t,l,"widget")})),signalLater(t,"lineWidgetCleared",t,this,l))}},LineWidget.prototype.changed=function(){var t=this,r=this.height,a=this.doc.cm,l=this.line;this.height=null;var S=widgetHeight(this)-r;S&&(lineIsHidden(this.doc,l)||updateLineHeight(l,l.height+S),a&&runInOp(a,(function(){a.curOp.forceUpdate=!0,adjustScrollWhenAboveVisible(a,l,S),signalLater(a,"lineWidgetChanged",a,t,lineNo(l))})))},eventMixin(LineWidget);var Fe=0,TextMarker=function(t,r){this.lines=[],this.type=r,this.doc=t,this.id=++Fe};function markText(t,r,a,l,S){if(l&&l.shared)return function markTextShared(t,r,a,l,S){(l=copyObj(l)).shared=!1;var O=[markText(t,r,a,l,S)],T=O[0],L=l.widgetNode;return linkedDocs(t,(function(t){L&&(l.widgetNode=L.cloneNode(!0)),O.push(markText(t,clipPos(t,r),clipPos(t,a),l,S));for(var E=0;E<t.linked.length;++E)if(t.linked[E].isParent)return;T=lst(O)})),new SharedTextMarker(O,T)}(t,r,a,l,S);if(t.cm&&!t.cm.curOp)return operation(t.cm,markText)(t,r,a,l,S);var O=new TextMarker(t,S),T=cmp(r,a);if(l&&copyObj(l,O,!1),T>0||0==T&&!1!==O.clearWhenEmpty)return O;if(O.replacedWith&&(O.collapsed=!0,O.widgetNode=eltP("span",[O.replacedWith],"CodeMirror-widget"),l.handleMouseEvents||O.widgetNode.setAttribute("cm-ignore-events","true"),l.insertLeft&&(O.widgetNode.insertLeft=!0)),O.collapsed){if(conflictingCollapsedRange(t,r.line,r,a,O)||r.line!=a.line&&conflictingCollapsedRange(t,a.line,r,a,O))throw new Error("Inserting collapsed marker partially overlapping an existing one");!function seeCollapsedSpans(){Pe=!0}()}O.addToHistory&&addChangeToHistory(t,{from:r,to:a,origin:"markText"},t.sel,NaN);var L,E=r.line,D=t.cm;if(t.iter(E,a.line+1,(function(t){D&&O.collapsed&&!D.options.lineWrapping&&visualLine(t)==D.display.maxLine&&(L=!0),O.collapsed&&E!=r.line&&updateLineHeight(t,0),function addMarkedSpan(t,r){t.markedSpans=t.markedSpans?t.markedSpans.concat([r]):[r],r.marker.attachLine(t)}(t,new MarkedSpan(O,E==r.line?r.ch:null,E==a.line?a.ch:null)),++E})),O.collapsed&&t.iter(r.line,a.line+1,(function(r){lineIsHidden(t,r)&&updateLineHeight(r,0)})),O.clearOnEnter&&on(O,"beforeCursorEnter",(function(){return O.clear()})),O.readOnly&&(function seeReadOnlySpans(){Te=!0}(),(t.history.done.length||t.history.undone.length)&&t.clearHistory()),O.collapsed&&(O.id=++Fe,O.atomic=!0),D){if(L&&(D.curOp.updateMaxLine=!0),O.collapsed)regChange(D,r.line,a.line+1);else if(O.className||O.startStyle||O.endStyle||O.css||O.attributes||O.title)for(var j=r.line;j<=a.line;j++)regLineChange(D,j,"text");O.atomic&&reCheckSelection(D.doc),signalLater(D,"markerAdded",D,O)}return O}TextMarker.prototype.clear=function(){if(!this.explicitlyCleared){var t=this.doc.cm,r=t&&!t.curOp;if(r&&startOperation(t),hasHandler(this,"clear")){var a=this.find();a&&signalLater(this,"clear",a.from,a.to)}for(var l=null,S=null,O=0;O<this.lines.length;++O){var T=this.lines[O],L=getMarkedSpanFor(T.markedSpans,this);t&&!this.collapsed?regLineChange(t,lineNo(T),"text"):t&&(null!=L.to&&(S=lineNo(T)),null!=L.from&&(l=lineNo(T))),T.markedSpans=removeMarkedSpan(T.markedSpans,L),null==L.from&&this.collapsed&&!lineIsHidden(this.doc,T)&&t&&updateLineHeight(T,textHeight(t.display))}if(t&&this.collapsed&&!t.options.lineWrapping)for(var E=0;E<this.lines.length;++E){var D=visualLine(this.lines[E]),j=lineLength(D);j>t.display.maxLineLength&&(t.display.maxLine=D,t.display.maxLineLength=j,t.display.maxLineChanged=!0)}null!=l&&t&&this.collapsed&&regChange(t,l,S+1),this.lines.length=0,this.explicitlyCleared=!0,this.atomic&&this.doc.cantEdit&&(this.doc.cantEdit=!1,t&&reCheckSelection(t.doc)),t&&signalLater(t,"markerCleared",t,this,l,S),r&&endOperation(t),this.parent&&this.parent.clear()}},TextMarker.prototype.find=function(t,r){var a,l;null==t&&"bookmark"==this.type&&(t=1);for(var S=0;S<this.lines.length;++S){var O=this.lines[S],T=getMarkedSpanFor(O.markedSpans,this);if(null!=T.from&&(a=Pos(r?O:lineNo(O),T.from),-1==t))return a;if(null!=T.to&&(l=Pos(r?O:lineNo(O),T.to),1==t))return l}return a&&{from:a,to:l}},TextMarker.prototype.changed=function(){var t=this,r=this.find(-1,!0),a=this,l=this.doc.cm;r&&l&&runInOp(l,(function(){var S=r.line,O=lineNo(r.line),T=findViewForLine(l,O);if(T&&(clearLineMeasurementCacheFor(T),l.curOp.selectionChanged=l.curOp.forceUpdate=!0),l.curOp.updateMaxLine=!0,!lineIsHidden(a.doc,S)&&null!=a.height){var L=a.height;a.height=null;var E=widgetHeight(a)-L;E&&updateLineHeight(S,S.height+E)}signalLater(l,"markerChanged",l,t)}))},TextMarker.prototype.attachLine=function(t){if(!this.lines.length&&this.doc.cm){var r=this.doc.cm.curOp;r.maybeHiddenMarkers&&-1!=indexOf(r.maybeHiddenMarkers,this)||(r.maybeUnhiddenMarkers||(r.maybeUnhiddenMarkers=[])).push(this)}this.lines.push(t)},TextMarker.prototype.detachLine=function(t){if(this.lines.splice(indexOf(this.lines,t),1),!this.lines.length&&this.doc.cm){var r=this.doc.cm.curOp;(r.maybeHiddenMarkers||(r.maybeHiddenMarkers=[])).push(this)}},eventMixin(TextMarker);var SharedTextMarker=function(t,r){this.markers=t,this.primary=r;for(var a=0;a<t.length;++a)t[a].parent=this};function findSharedMarkers(t){return t.findMarks(Pos(t.first,0),t.clipPos(Pos(t.lastLine())),(function(t){return t.parent}))}function detachSharedMarkers(t){for(var loop=function(r){var a=t[r],l=[a.primary.doc];linkedDocs(a.primary.doc,(function(t){return l.push(t)}));for(var S=0;S<a.markers.length;S++){var O=a.markers[S];-1==indexOf(l,O.doc)&&(O.parent=null,a.markers.splice(S--,1))}},r=0;r<t.length;r++)loop(r)}SharedTextMarker.prototype.clear=function(){if(!this.explicitlyCleared){this.explicitlyCleared=!0;for(var t=0;t<this.markers.length;++t)this.markers[t].clear();signalLater(this,"clear")}},SharedTextMarker.prototype.find=function(t,r){return this.primary.find(t,r)},eventMixin(SharedTextMarker);var je=0,Doc=function(t,r,a,l,S){if(!(this instanceof Doc))return new Doc(t,r,a,l,S);null==a&&(a=0),BranchChunk.call(this,[new LeafChunk([new Line("",null)])]),this.first=a,this.scrollTop=this.scrollLeft=0,this.cantEdit=!1,this.cleanGeneration=1,this.modeFrontier=this.highlightFrontier=a;var O=Pos(a,0);this.sel=simpleSelection(O),this.history=new History(null),this.id=++je,this.modeOption=r,this.lineSep=l,this.direction="rtl"==S?"rtl":"ltr",this.extend=!1,"string"==typeof t&&(t=this.splitLines(t)),updateDoc(this,{from:O,to:O,text:t}),setSelection(this,simpleSelection(O),ae)};Doc.prototype=createObj(BranchChunk.prototype,{constructor:Doc,iter:function(t,r,a){a?this.iterN(t-this.first,r-t,a):this.iterN(this.first,this.first+this.size,t)},insert:function(t,r){for(var a=0,l=0;l<r.length;++l)a+=r[l].height;this.insertInner(t-this.first,r,a)},remove:function(t,r){this.removeInner(t-this.first,r)},getValue:function(t){var r=getLines(this,this.first,this.first+this.size);return!1===t?r:r.join(t||this.lineSeparator())},setValue:docMethodOp((function(t){var r=Pos(this.first,0),a=this.first+this.size-1;makeChange(this,{from:r,to:Pos(a,getLine(this,a).text.length),text:this.splitLines(t),origin:"setValue",full:!0},!0),this.cm&&scrollToCoords(this.cm,0,0),setSelection(this,simpleSelection(r),ae)})),replaceRange:function(t,r,a,l){replaceRange(this,t,r=clipPos(this,r),a=a?clipPos(this,a):r,l)},getRange:function(t,r,a){var l=getBetween(this,clipPos(this,t),clipPos(this,r));return!1===a?l:l.join(a||this.lineSeparator())},getLine:function(t){var r=this.getLineHandle(t);return r&&r.text},getLineHandle:function(t){if(isLine(this,t))return getLine(this,t)},getLineNumber:function(t){return lineNo(t)},getLineHandleVisualStart:function(t){return"number"==typeof t&&(t=getLine(this,t)),visualLine(t)},lineCount:function(){return this.size},firstLine:function(){return this.first},lastLine:function(){return this.first+this.size-1},clipPos:function(t){return clipPos(this,t)},getCursor:function(t){var r=this.sel.primary();return null==t||"head"==t?r.head:"anchor"==t?r.anchor:"end"==t||"to"==t||!1===t?r.to():r.from()},listSelections:function(){return this.sel.ranges},somethingSelected:function(){return this.sel.somethingSelected()},setCursor:docMethodOp((function(t,r,a){setSimpleSelection(this,clipPos(this,"number"==typeof t?Pos(t,r||0):t),null,a)})),setSelection:docMethodOp((function(t,r,a){setSimpleSelection(this,clipPos(this,t),clipPos(this,r||t),a)})),extendSelection:docMethodOp((function(t,r,a){extendSelection(this,clipPos(this,t),r&&clipPos(this,r),a)})),extendSelections:docMethodOp((function(t,r){extendSelections(this,clipPosArray(this,t),r)})),extendSelectionsBy:docMethodOp((function(t,r){extendSelections(this,clipPosArray(this,map(this.sel.ranges,t)),r)})),setSelections:docMethodOp((function(t,r,a){if(t.length){for(var l=[],S=0;S<t.length;S++)l[S]=new Range(clipPos(this,t[S].anchor),clipPos(this,t[S].head||t[S].anchor));null==r&&(r=Math.min(t.length-1,this.sel.primIndex)),setSelection(this,normalizeSelection(this.cm,l,r),a)}})),addSelection:docMethodOp((function(t,r,a){var l=this.sel.ranges.slice(0);l.push(new Range(clipPos(this,t),clipPos(this,r||t))),setSelection(this,normalizeSelection(this.cm,l,l.length-1),a)})),getSelection:function(t){for(var r,a=this.sel.ranges,l=0;l<a.length;l++){var S=getBetween(this,a[l].from(),a[l].to());r=r?r.concat(S):S}return!1===t?r:r.join(t||this.lineSeparator())},getSelections:function(t){for(var r=[],a=this.sel.ranges,l=0;l<a.length;l++){var S=getBetween(this,a[l].from(),a[l].to());!1!==t&&(S=S.join(t||this.lineSeparator())),r[l]=S}return r},replaceSelection:function(t,r,a){for(var l=[],S=0;S<this.sel.ranges.length;S++)l[S]=t;this.replaceSelections(l,r,a||"+input")},replaceSelections:docMethodOp((function(t,r,a){for(var l=[],S=this.sel,O=0;O<S.ranges.length;O++){var T=S.ranges[O];l[O]={from:T.from(),to:T.to(),text:this.splitLines(t[O]),origin:a}}for(var L=r&&"end"!=r&&function computeReplacedSel(t,r,a){for(var l=[],S=Pos(t.first,0),O=S,T=0;T<r.length;T++){var L=r[T],E=offsetPos(L.from,S,O),D=offsetPos(changeEnd(L),S,O);if(S=L.to,O=D,"around"==a){var j=t.sel.ranges[T],V=cmp(j.head,j.anchor)<0;l[T]=new Range(V?D:E,V?E:D)}else l[T]=new Range(E,E)}return new Selection(l,t.sel.primIndex)}(this,l,r),E=l.length-1;E>=0;E--)makeChange(this,l[E]);L?setSelectionReplaceHistory(this,L):this.cm&&ensureCursorVisible(this.cm)})),undo:docMethodOp((function(){makeChangeFromHistory(this,"undo")})),redo:docMethodOp((function(){makeChangeFromHistory(this,"redo")})),undoSelection:docMethodOp((function(){makeChangeFromHistory(this,"undo",!0)})),redoSelection:docMethodOp((function(){makeChangeFromHistory(this,"redo",!0)})),setExtending:function(t){this.extend=t},getExtending:function(){return this.extend},historySize:function(){for(var t=this.history,r=0,a=0,l=0;l<t.done.length;l++)t.done[l].ranges||++r;for(var S=0;S<t.undone.length;S++)t.undone[S].ranges||++a;return{undo:r,redo:a}},clearHistory:function(){var t=this;this.history=new History(this.history),linkedDocs(this,(function(r){return r.history=t.history}),!0)},markClean:function(){this.cleanGeneration=this.changeGeneration(!0)},changeGeneration:function(t){return t&&(this.history.lastOp=this.history.lastSelOp=this.history.lastOrigin=null),this.history.generation},isClean:function(t){return this.history.generation==(t||this.cleanGeneration)},getHistory:function(){return{done:copyHistoryArray(this.history.done),undone:copyHistoryArray(this.history.undone)}},setHistory:function(t){var r=this.history=new History(this.history);r.done=copyHistoryArray(t.done.slice(0),null,!0),r.undone=copyHistoryArray(t.undone.slice(0),null,!0)},setGutterMarker:docMethodOp((function(t,r,a){return changeLine(this,t,"gutter",(function(t){var l=t.gutterMarkers||(t.gutterMarkers={});return l[r]=a,!a&&isEmpty(l)&&(t.gutterMarkers=null),!0}))})),clearGutter:docMethodOp((function(t){var r=this;this.iter((function(a){a.gutterMarkers&&a.gutterMarkers[t]&&changeLine(r,a,"gutter",(function(){return a.gutterMarkers[t]=null,isEmpty(a.gutterMarkers)&&(a.gutterMarkers=null),!0}))}))})),lineInfo:function(t){var r;if("number"==typeof t){if(!isLine(this,t))return null;if(r=t,!(t=getLine(this,t)))return null}else if(null==(r=lineNo(t)))return null;return{line:r,handle:t,text:t.text,gutterMarkers:t.gutterMarkers,textClass:t.textClass,bgClass:t.bgClass,wrapClass:t.wrapClass,widgets:t.widgets}},addLineClass:docMethodOp((function(t,r,a){return changeLine(this,t,"gutter"==r?"gutter":"class",(function(t){var l="text"==r?"textClass":"background"==r?"bgClass":"gutter"==r?"gutterClass":"wrapClass";if(t[l]){if(classTest(a).test(t[l]))return!1;t[l]+=" "+a}else t[l]=a;return!0}))})),removeLineClass:docMethodOp((function(t,r,a){return changeLine(this,t,"gutter"==r?"gutter":"class",(function(t){var l="text"==r?"textClass":"background"==r?"bgClass":"gutter"==r?"gutterClass":"wrapClass",S=t[l];if(!S)return!1;if(null==a)t[l]=null;else{var O=S.match(classTest(a));if(!O)return!1;var T=O.index+O[0].length;t[l]=S.slice(0,O.index)+(O.index&&T!=S.length?" ":"")+S.slice(T)||null}return!0}))})),addLineWidget:docMethodOp((function(t,r,a){return function addLineWidget(t,r,a,l){var S=new LineWidget(t,a,l),O=t.cm;return O&&S.noHScroll&&(O.display.alignWidgets=!0),changeLine(t,r,"widget",(function(r){var a=r.widgets||(r.widgets=[]);if(null==S.insertAt?a.push(S):a.splice(Math.min(a.length,Math.max(0,S.insertAt)),0,S),S.line=r,O&&!lineIsHidden(t,r)){var l=heightAtLine(r)<t.scrollTop;updateLineHeight(r,r.height+widgetHeight(S)),l&&addToScrollTop(O,S.height),O.curOp.forceUpdate=!0}return!0})),O&&signalLater(O,"lineWidgetAdded",O,S,"number"==typeof r?r:lineNo(r)),S}(this,t,r,a)})),removeLineWidget:function(t){t.clear()},markText:function(t,r,a){return markText(this,clipPos(this,t),clipPos(this,r),a,a&&a.type||"range")},setBookmark:function(t,r){var a={replacedWith:r&&(null==r.nodeType?r.widget:r),insertLeft:r&&r.insertLeft,clearWhenEmpty:!1,shared:r&&r.shared,handleMouseEvents:r&&r.handleMouseEvents};return markText(this,t=clipPos(this,t),t,a,"bookmark")},findMarksAt:function(t){var r=[],a=getLine(this,(t=clipPos(this,t)).line).markedSpans;if(a)for(var l=0;l<a.length;++l){var S=a[l];(null==S.from||S.from<=t.ch)&&(null==S.to||S.to>=t.ch)&&r.push(S.marker.parent||S.marker)}return r},findMarks:function(t,r,a){t=clipPos(this,t),r=clipPos(this,r);var l=[],S=t.line;return this.iter(t.line,r.line+1,(function(O){var T=O.markedSpans;if(T)for(var L=0;L<T.length;L++){var E=T[L];null!=E.to&&S==t.line&&t.ch>=E.to||null==E.from&&S!=t.line||null!=E.from&&S==r.line&&E.from>=r.ch||a&&!a(E.marker)||l.push(E.marker.parent||E.marker)}++S})),l},getAllMarks:function(){var t=[];return this.iter((function(r){var a=r.markedSpans;if(a)for(var l=0;l<a.length;++l)null!=a[l].from&&t.push(a[l].marker)})),t},posFromIndex:function(t){var r,a=this.first,l=this.lineSeparator().length;return this.iter((function(S){var O=S.text.length+l;if(O>t)return r=t,!0;t-=O,++a})),clipPos(this,Pos(a,r))},indexFromPos:function(t){var r=(t=clipPos(this,t)).ch;if(t.line<this.first||t.ch<0)return 0;var a=this.lineSeparator().length;return this.iter(this.first,t.line,(function(t){r+=t.text.length+a})),r},copy:function(t){var r=new Doc(getLines(this,this.first,this.first+this.size),this.modeOption,this.first,this.lineSep,this.direction);return r.scrollTop=this.scrollTop,r.scrollLeft=this.scrollLeft,r.sel=this.sel,r.extend=!1,t&&(r.history.undoDepth=this.history.undoDepth,r.setHistory(this.getHistory())),r},linkedDoc:function(t){t||(t={});var r=this.first,a=this.first+this.size;null!=t.from&&t.from>r&&(r=t.from),null!=t.to&&t.to<a&&(a=t.to);var l=new Doc(getLines(this,r,a),t.mode||this.modeOption,r,this.lineSep,this.direction);return t.sharedHist&&(l.history=this.history),(this.linked||(this.linked=[])).push({doc:l,sharedHist:t.sharedHist}),l.linked=[{doc:this,isParent:!0,sharedHist:t.sharedHist}],function copySharedMarkers(t,r){for(var a=0;a<r.length;a++){var l=r[a],S=l.find(),O=t.clipPos(S.from),T=t.clipPos(S.to);if(cmp(O,T)){var L=markText(t,O,T,l.primary,l.primary.type);l.markers.push(L),L.parent=l}}}(l,findSharedMarkers(this)),l},unlinkDoc:function(t){if(t instanceof CodeMirror&&(t=t.doc),this.linked)for(var r=0;r<this.linked.length;++r)if(this.linked[r].doc==t){this.linked.splice(r,1),t.unlinkDoc(this),detachSharedMarkers(findSharedMarkers(this));break}if(t.history==this.history){var a=[t.id];linkedDocs(t,(function(t){return a.push(t.id)}),!0),t.history=new History(null),t.history.done=copyHistoryArray(this.history.done,a),t.history.undone=copyHistoryArray(this.history.undone,a)}},iterLinkedDocs:function(t){linkedDocs(this,t)},getMode:function(){return this.mode},getEditor:function(){return this.cm},splitLines:function(t){return this.lineSep?t.split(this.lineSep):be(t)},lineSeparator:function(){return this.lineSep||"\n"},setDirection:docMethodOp((function(t){"rtl"!=t&&(t="ltr"),t!=this.direction&&(this.direction=t,this.iter((function(t){return t.order=null})),this.cm&&function directionChanged(t){runInOp(t,(function(){setDirectionClass(t),regChange(t)}))}(this.cm))}))}),Doc.prototype.eachLine=Doc.prototype.iter;var We=0;function onDrop(t){var r=this;if(clearDragCursor(r),!signalDOMEvent(r,t)&&!eventInWidget(r.display,t)){e_preventDefault(t),T&&(We=+new Date);var a=posFromMouse(r,t,!0),l=t.dataTransfer.files;if(a&&!r.isReadOnly())if(l&&l.length&&window.FileReader&&window.File)for(var S=l.length,O=Array(S),L=0,markAsReadAndPasteIfAllFilesAreRead=function(){++L==S&&operation(r,(function(){var t={from:a=clipPos(r.doc,a),to:a,text:r.doc.splitLines(O.filter((function(t){return null!=t})).join(r.doc.lineSeparator())),origin:"paste"};makeChange(r.doc,t),setSelectionReplaceHistory(r.doc,simpleSelection(clipPos(r.doc,a),clipPos(r.doc,changeEnd(t))))}))()},readTextFromFile=function(t,a){if(r.options.allowDropFileTypes&&-1==indexOf(r.options.allowDropFileTypes,t.type))markAsReadAndPasteIfAllFilesAreRead();else{var l=new FileReader;l.onerror=function(){return markAsReadAndPasteIfAllFilesAreRead()},l.onload=function(){var t=l.result;/[\x00-\x08\x0e-\x1f]{2}/.test(t)||(O[a]=t),markAsReadAndPasteIfAllFilesAreRead()},l.readAsText(t)}},E=0;E<l.length;E++)readTextFromFile(l[E],E);else{if(r.state.draggingText&&r.doc.sel.contains(a)>-1)return r.state.draggingText(t),void setTimeout((function(){return r.display.input.focus()}),20);try{var D=t.dataTransfer.getData("Text");if(D){var j;if(r.state.draggingText&&!r.state.draggingText.copy&&(j=r.listSelections()),setSelectionNoUndo(r.doc,simpleSelection(a,a)),j)for(var V=0;V<j.length;++V)replaceRange(r.doc,"",j[V].anchor,j[V].head,"drag");r.replaceSelection(D,"around","paste"),r.display.input.focus()}}catch(t){}}}}function clearDragCursor(t){t.display.dragCursor&&(t.display.lineSpace.removeChild(t.display.dragCursor),t.display.dragCursor=null)}function forEachCodeMirror(t){if(document.getElementsByClassName){for(var r=document.getElementsByClassName("CodeMirror"),a=[],l=0;l<r.length;l++){var S=r[l].CodeMirror;S&&a.push(S)}a.length&&a[0].operation((function(){for(var r=0;r<a.length;r++)t(a[r])}))}}var He=!1;function ensureGlobalHandlers(){He||(function registerGlobalHandlers(){var t;on(window,"resize",(function(){null==t&&(t=setTimeout((function(){t=null,forEachCodeMirror(onResize)}),100))})),on(window,"blur",(function(){return forEachCodeMirror(onBlur)}))}(),He=!0)}function onResize(t){var r=t.display;r.cachedCharWidth=r.cachedTextHeight=r.cachedPaddingH=null,r.scrollbarsClipped=!1,t.setSize()}for(var Ve={3:"Pause",8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause",20:"CapsLock",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"PrintScrn",45:"Insert",46:"Delete",59:";",61:"=",91:"Mod",92:"Mod",93:"Mod",106:"*",107:"=",109:"-",110:".",111:"/",145:"ScrollLock",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",224:"Mod",63232:"Up",63233:"Down",63234:"Left",63235:"Right",63272:"Delete",63273:"Home",63275:"End",63276:"PageUp",63277:"PageDown",63302:"Insert"},Be=0;Be<10;Be++)Ve[Be+48]=Ve[Be+96]=String(Be);for(var Ue=65;Ue<=90;Ue++)Ve[Ue]=String.fromCharCode(Ue);for(var qe=1;qe<=12;qe++)Ve[qe+111]=Ve[qe+63235]="F"+qe;var Ge={};function normalizeKeyName(t){var r,a,l,S,O=t.split(/-(?!$)/);t=O[O.length-1];for(var T=0;T<O.length-1;T++){var L=O[T];if(/^(cmd|meta|m)$/i.test(L))S=!0;else if(/^a(lt)?$/i.test(L))r=!0;else if(/^(c|ctrl|control)$/i.test(L))a=!0;else{if(!/^s(hift)?$/i.test(L))throw new Error("Unrecognized modifier name: "+L);l=!0}}return r&&(t="Alt-"+t),a&&(t="Ctrl-"+t),S&&(t="Cmd-"+t),l&&(t="Shift-"+t),t}function normalizeKeyMap(t){var r={};for(var a in t)if(t.hasOwnProperty(a)){var l=t[a];if(/^(name|fallthrough|(de|at)tach)$/.test(a))continue;if("..."==l){delete t[a];continue}for(var S=map(a.split(" "),normalizeKeyName),O=0;O<S.length;O++){var T=void 0,L=void 0;O==S.length-1?(L=S.join(" "),T=l):(L=S.slice(0,O+1).join(" "),T="...");var E=r[L];if(E){if(E!=T)throw new Error("Inconsistent bindings for "+L)}else r[L]=T}delete t[a]}for(var D in r)t[D]=r[D];return t}function lookupKey(t,r,a,l){var S=(r=getKeyMap(r)).call?r.call(t,l):r[t];if(!1===S)return"nothing";if("..."===S)return"multi";if(null!=S&&a(S))return"handled";if(r.fallthrough){if("[object Array]"!=Object.prototype.toString.call(r.fallthrough))return lookupKey(t,r.fallthrough,a,l);for(var O=0;O<r.fallthrough.length;O++){var T=lookupKey(t,r.fallthrough[O],a,l);if(T)return T}}}function isModifierKey(t){var r="string"==typeof t?t:Ve[t.keyCode];return"Ctrl"==r||"Alt"==r||"Shift"==r||"Mod"==r}function addModifierNames(t,r,a){var l=t;return r.altKey&&"Alt"!=l&&(t="Alt-"+t),(ne?r.metaKey:r.ctrlKey)&&"Ctrl"!=l&&(t="Ctrl-"+t),(ne?r.ctrlKey:r.metaKey)&&"Mod"!=l&&(t="Cmd-"+t),!a&&r.shiftKey&&"Shift"!=l&&(t="Shift-"+t),t}function keyName(t,r){if(V&&34==t.keyCode&&t.char)return!1;var a=Ve[t.keyCode];return null!=a&&!t.altGraphKey&&(3==t.keyCode&&t.code&&(a=t.code),addModifierNames(a,t,r))}function getKeyMap(t){return"string"==typeof t?Ge[t]:t}function deleteNearSelection(t,r){for(var a=t.doc.sel.ranges,l=[],S=0;S<a.length;S++){for(var O=r(a[S]);l.length&&cmp(O.from,lst(l).to)<=0;){var T=l.pop();if(cmp(T.from,O.from)<0){O.from=T.from;break}}l.push(O)}runInOp(t,(function(){for(var r=l.length-1;r>=0;r--)replaceRange(t.doc,"",l[r].from,l[r].to,"+delete");ensureCursorVisible(t)}))}function moveCharLogically(t,r,a){var l=skipExtendingChars(t.text,r+a,a);return l<0||l>t.text.length?null:l}function moveLogically(t,r,a){var l=moveCharLogically(t,r.ch,a);return null==l?null:new Pos(r.line,l,a<0?"after":"before")}function endOfLine(t,r,a,l,S){if(t){"rtl"==r.doc.direction&&(S=-S);var O=getOrder(a,r.doc.direction);if(O){var T,L=S<0?lst(O):O[0],E=S<0==(1==L.level)?"after":"before";if(L.level>0||"rtl"==r.doc.direction){var D=prepareMeasureForLine(r,a);T=S<0?a.text.length-1:0;var j=measureCharPrepared(r,D,T).top;T=findFirst((function(t){return measureCharPrepared(r,D,t).top==j}),S<0==(1==L.level)?L.from:L.to-1,T),"before"==E&&(T=moveCharLogically(a,T,1))}else T=S<0?L.to:L.from;return new Pos(l,T,E)}}return new Pos(l,S<0?a.text.length:0,S<0?"before":"after")}Ge.basic={Left:"goCharLeft",Right:"goCharRight",Up:"goLineUp",Down:"goLineDown",End:"goLineEnd",Home:"goLineStartSmart",PageUp:"goPageUp",PageDown:"goPageDown",Delete:"delCharAfter",Backspace:"delCharBefore","Shift-Backspace":"delCharBefore",Tab:"defaultTab","Shift-Tab":"indentAuto",Enter:"newlineAndIndent",Insert:"toggleOverwrite",Esc:"singleSelection"},Ge.pcDefault={"Ctrl-A":"selectAll","Ctrl-D":"deleteLine","Ctrl-Z":"undo","Shift-Ctrl-Z":"redo","Ctrl-Y":"redo","Ctrl-Home":"goDocStart","Ctrl-End":"goDocEnd","Ctrl-Up":"goLineUp","Ctrl-Down":"goLineDown","Ctrl-Left":"goGroupLeft","Ctrl-Right":"goGroupRight","Alt-Left":"goLineStart","Alt-Right":"goLineEnd","Ctrl-Backspace":"delGroupBefore","Ctrl-Delete":"delGroupAfter","Ctrl-S":"save","Ctrl-F":"find","Ctrl-G":"findNext","Shift-Ctrl-G":"findPrev","Shift-Ctrl-F":"replace","Shift-Ctrl-R":"replaceAll","Ctrl-[":"indentLess","Ctrl-]":"indentMore","Ctrl-U":"undoSelection","Shift-Ctrl-U":"redoSelection","Alt-U":"redoSelection",fallthrough:"basic"},Ge.emacsy={"Ctrl-F":"goCharRight","Ctrl-B":"goCharLeft","Ctrl-P":"goLineUp","Ctrl-N":"goLineDown","Ctrl-A":"goLineStart","Ctrl-E":"goLineEnd","Ctrl-V":"goPageDown","Shift-Ctrl-V":"goPageUp","Ctrl-D":"delCharAfter","Ctrl-H":"delCharBefore","Alt-Backspace":"delWordBefore","Ctrl-K":"killLine","Ctrl-T":"transposeChars","Ctrl-O":"openLine"},Ge.macDefault={"Cmd-A":"selectAll","Cmd-D":"deleteLine","Cmd-Z":"undo","Shift-Cmd-Z":"redo","Cmd-Y":"redo","Cmd-Home":"goDocStart","Cmd-Up":"goDocStart","Cmd-End":"goDocEnd","Cmd-Down":"goDocEnd","Alt-Left":"goGroupLeft","Alt-Right":"goGroupRight","Cmd-Left":"goLineLeft","Cmd-Right":"goLineRight","Alt-Backspace":"delGroupBefore","Ctrl-Alt-Backspace":"delGroupAfter","Alt-Delete":"delGroupAfter","Cmd-S":"save","Cmd-F":"find","Cmd-G":"findNext","Shift-Cmd-G":"findPrev","Cmd-Alt-F":"replace","Shift-Cmd-Alt-F":"replaceAll","Cmd-[":"indentLess","Cmd-]":"indentMore","Cmd-Backspace":"delWrappedLineLeft","Cmd-Delete":"delWrappedLineRight","Cmd-U":"undoSelection","Shift-Cmd-U":"redoSelection","Ctrl-Up":"goDocStart","Ctrl-Down":"goDocEnd",fallthrough:["basic","emacsy"]},Ge.default=Z?Ge.macDefault:Ge.pcDefault;var Ke={selectAll:selectAll,singleSelection:function(t){return t.setSelection(t.getCursor("anchor"),t.getCursor("head"),ae)},killLine:function(t){return deleteNearSelection(t,(function(r){if(r.empty()){var a=getLine(t.doc,r.head.line).text.length;return r.head.ch==a&&r.head.line<t.lastLine()?{from:r.head,to:Pos(r.head.line+1,0)}:{from:r.head,to:Pos(r.head.line,a)}}return{from:r.from(),to:r.to()}}))},deleteLine:function(t){return deleteNearSelection(t,(function(r){return{from:Pos(r.from().line,0),to:clipPos(t.doc,Pos(r.to().line+1,0))}}))},delLineLeft:function(t){return deleteNearSelection(t,(function(t){return{from:Pos(t.from().line,0),to:t.from()}}))},delWrappedLineLeft:function(t){return deleteNearSelection(t,(function(r){var a=t.charCoords(r.head,"div").top+5;return{from:t.coordsChar({left:0,top:a},"div"),to:r.from()}}))},delWrappedLineRight:function(t){return deleteNearSelection(t,(function(r){var a=t.charCoords(r.head,"div").top+5,l=t.coordsChar({left:t.display.lineDiv.offsetWidth+100,top:a},"div");return{from:r.from(),to:l}}))},undo:function(t){return t.undo()},redo:function(t){return t.redo()},undoSelection:function(t){return t.undoSelection()},redoSelection:function(t){return t.redoSelection()},goDocStart:function(t){return t.extendSelection(Pos(t.firstLine(),0))},goDocEnd:function(t){return t.extendSelection(Pos(t.lastLine()))},goLineStart:function(t){return t.extendSelectionsBy((function(r){return lineStart(t,r.head.line)}),{origin:"+move",bias:1})},goLineStartSmart:function(t){return t.extendSelectionsBy((function(r){return lineStartSmart(t,r.head)}),{origin:"+move",bias:1})},goLineEnd:function(t){return t.extendSelectionsBy((function(r){return function lineEnd(t,r){var a=getLine(t.doc,r),l=function visualLineEnd(t){for(var r;r=collapsedSpanAtEnd(t);)t=r.find(1,!0).line;return t}(a);return l!=a&&(r=lineNo(l)),endOfLine(!0,t,a,r,-1)}(t,r.head.line)}),{origin:"+move",bias:-1})},goLineRight:function(t){return t.extendSelectionsBy((function(r){var a=t.cursorCoords(r.head,"div").top+5;return t.coordsChar({left:t.display.lineDiv.offsetWidth+100,top:a},"div")}),le)},goLineLeft:function(t){return t.extendSelectionsBy((function(r){var a=t.cursorCoords(r.head,"div").top+5;return t.coordsChar({left:0,top:a},"div")}),le)},goLineLeftSmart:function(t){return t.extendSelectionsBy((function(r){var a=t.cursorCoords(r.head,"div").top+5,l=t.coordsChar({left:0,top:a},"div");return l.ch<t.getLine(l.line).search(/\S/)?lineStartSmart(t,r.head):l}),le)},goLineUp:function(t){return t.moveV(-1,"line")},goLineDown:function(t){return t.moveV(1,"line")},goPageUp:function(t){return t.moveV(-1,"page")},goPageDown:function(t){return t.moveV(1,"page")},goCharLeft:function(t){return t.moveH(-1,"char")},goCharRight:function(t){return t.moveH(1,"char")},goColumnLeft:function(t){return t.moveH(-1,"column")},goColumnRight:function(t){return t.moveH(1,"column")},goWordLeft:function(t){return t.moveH(-1,"word")},goGroupRight:function(t){return t.moveH(1,"group")},goGroupLeft:function(t){return t.moveH(-1,"group")},goWordRight:function(t){return t.moveH(1,"word")},delCharBefore:function(t){return t.deleteH(-1,"codepoint")},delCharAfter:function(t){return t.deleteH(1,"char")},delWordBefore:function(t){return t.deleteH(-1,"word")},delWordAfter:function(t){return t.deleteH(1,"word")},delGroupBefore:function(t){return t.deleteH(-1,"group")},delGroupAfter:function(t){return t.deleteH(1,"group")},indentAuto:function(t){return t.indentSelection("smart")},indentMore:function(t){return t.indentSelection("add")},indentLess:function(t){return t.indentSelection("subtract")},insertTab:function(t){return t.replaceSelection("\t")},insertSoftTab:function(t){for(var r=[],a=t.listSelections(),l=t.options.tabSize,S=0;S<a.length;S++){var O=a[S].from(),T=countColumn(t.getLine(O.line),O.ch,l);r.push(spaceStr(l-T%l))}t.replaceSelections(r)},defaultTab:function(t){t.somethingSelected()?t.indentSelection("add"):t.execCommand("insertTab")},transposeChars:function(t){return runInOp(t,(function(){for(var r=t.listSelections(),a=[],l=0;l<r.length;l++)if(r[l].empty()){var S=r[l].head,O=getLine(t.doc,S.line).text;if(O)if(S.ch==O.length&&(S=new Pos(S.line,S.ch-1)),S.ch>0)S=new Pos(S.line,S.ch+1),t.replaceRange(O.charAt(S.ch-1)+O.charAt(S.ch-2),Pos(S.line,S.ch-2),S,"+transpose");else if(S.line>t.doc.first){var T=getLine(t.doc,S.line-1).text;T&&(S=new Pos(S.line,1),t.replaceRange(O.charAt(0)+t.doc.lineSeparator()+T.charAt(T.length-1),Pos(S.line-1,T.length-1),S,"+transpose"))}a.push(new Range(S,S))}t.setSelections(a)}))},newlineAndIndent:function(t){return runInOp(t,(function(){for(var r=t.listSelections(),a=r.length-1;a>=0;a--)t.replaceRange(t.doc.lineSeparator(),r[a].anchor,r[a].head,"+input");r=t.listSelections();for(var l=0;l<r.length;l++)t.indentLine(r[l].from().line,null,!0);ensureCursorVisible(t)}))},openLine:function(t){return t.replaceSelection("\n","start")},toggleOverwrite:function(t){return t.toggleOverwrite()}};function lineStart(t,r){var a=getLine(t.doc,r),l=visualLine(a);return l!=a&&(r=lineNo(l)),endOfLine(!0,t,l,r,1)}function lineStartSmart(t,r){var a=lineStart(t,r.line),l=getLine(t.doc,a.line),S=getOrder(l,t.doc.direction);if(!S||0==S[0].level){var O=Math.max(a.ch,l.text.search(/\S/)),T=r.line==a.line&&r.ch<=O&&r.ch;return Pos(a.line,T?0:O,a.sticky)}return a}function doHandleBinding(t,r,a){if("string"==typeof r&&!(r=Ke[r]))return!1;t.display.input.ensurePolled();var l=t.display.shift,S=!1;try{t.isReadOnly()&&(t.state.suppressEdits=!0),a&&(t.display.shift=!1),S=r(t)!=ie}finally{t.display.shift=l,t.state.suppressEdits=!1}return S}var Xe=new Delayed;function dispatchKey(t,r,a,l){var S=t.state.keySeq;if(S){if(isModifierKey(r))return"handled";if(/\'$/.test(r)?t.state.keySeq=null:Xe.set(50,(function(){t.state.keySeq==S&&(t.state.keySeq=null,t.display.input.reset())})),dispatchKeyInner(t,S+" "+r,a,l))return!0}return dispatchKeyInner(t,r,a,l)}function dispatchKeyInner(t,r,a,l){var S=function lookupKeyForEditor(t,r,a){for(var l=0;l<t.state.keyMaps.length;l++){var S=lookupKey(r,t.state.keyMaps[l],a,t);if(S)return S}return t.options.extraKeys&&lookupKey(r,t.options.extraKeys,a,t)||lookupKey(r,t.options.keyMap,a,t)}(t,r,l);return"multi"==S&&(t.state.keySeq=r),"handled"==S&&signalLater(t,"keyHandled",t,r,a),"handled"!=S&&"multi"!=S||(e_preventDefault(a),restartBlink(t)),!!S}function handleKeyBinding(t,r){var a=keyName(r,!0);return!!a&&(r.shiftKey&&!t.state.keySeq?dispatchKey(t,"Shift-"+a,r,(function(r){return doHandleBinding(t,r,!0)}))||dispatchKey(t,a,r,(function(r){if("string"==typeof r?/^go[A-Z]/.test(r):r.motion)return doHandleBinding(t,r)})):dispatchKey(t,a,r,(function(r){return doHandleBinding(t,r)})))}var Ye=null;function onKeyDown(t){var r=this;if(!(t.target&&t.target!=r.display.input.getField()||(r.curOp.focus=activeElt(),signalDOMEvent(r,t)))){T&&L<11&&27==t.keyCode&&(t.returnValue=!1);var l=t.keyCode;r.display.shift=16==l||t.shiftKey;var S=handleKeyBinding(r,t);V&&(Ye=S?l:null,!S&&88==l&&!we&&(Z?t.metaKey:t.ctrlKey)&&r.replaceSelection("",null,"cut")),a&&!Z&&!S&&46==l&&t.shiftKey&&!t.ctrlKey&&document.execCommand&&document.execCommand("cut"),18!=l||/\bCodeMirror-crosshair\b/.test(r.display.lineDiv.className)||function showCrossHair(t){var r=t.display.lineDiv;function up(t){18!=t.keyCode&&t.altKey||(rmClass(r,"CodeMirror-crosshair"),off(document,"keyup",up),off(document,"mouseover",up))}addClass(r,"CodeMirror-crosshair"),on(document,"keyup",up),on(document,"mouseover",up)}(r)}}function onKeyUp(t){16==t.keyCode&&(this.doc.sel.shift=!1),signalDOMEvent(this,t)}function onKeyPress(t){var r=this;if(!(t.target&&t.target!=r.display.input.getField()||eventInWidget(r.display,t)||signalDOMEvent(r,t)||t.ctrlKey&&!t.altKey||Z&&t.metaKey)){var a=t.keyCode,l=t.charCode;if(V&&a==Ye)return Ye=null,void e_preventDefault(t);if(!V||t.which&&!(t.which<10)||!handleKeyBinding(r,t)){var S=String.fromCharCode(null==l?a:l);"\b"!=S&&(function handleCharBinding(t,r,a){return dispatchKey(t,"'"+a+"'",r,(function(r){return doHandleBinding(t,r,!0)}))}(r,t,S)||r.display.input.onKeyPress(t))}}}var $e,Ze,PastClick=function(t,r,a){this.time=t,this.pos=r,this.button=a};function onMouseDown(t){var r=this,a=r.display;if(!(signalDOMEvent(r,t)||a.activeTouch&&a.input.supportsTouch()))if(a.input.ensurePolled(),a.shift=t.shiftKey,eventInWidget(a,t))E||(a.scroller.draggable=!1,setTimeout((function(){return a.scroller.draggable=!0}),100));else if(!clickInGutter(r,t)){var l=posFromMouse(r,t),S=e_button(t),O=l?function clickRepeat(t,r){var a=+new Date;return Ze&&Ze.compare(a,t,r)?($e=Ze=null,"triple"):$e&&$e.compare(a,t,r)?(Ze=new PastClick(a,t,r),$e=null,"double"):($e=new PastClick(a,t,r),Ze=null,"single")}(l,S):"single";window.focus(),1==S&&r.state.selectingText&&r.state.selectingText(t),l&&function handleMappedButton(t,r,a,l,S){var O="Click";return"double"==l?O="Double"+O:"triple"==l&&(O="Triple"+O),dispatchKey(t,addModifierNames(O=(1==r?"Left":2==r?"Middle":"Right")+O,S),S,(function(r){if("string"==typeof r&&(r=Ke[r]),!r)return!1;var l=!1;try{t.isReadOnly()&&(t.state.suppressEdits=!0),l=r(t,a)!=ie}finally{t.state.suppressEdits=!1}return l}))}(r,S,l,O,t)||(1==S?l?function leftButtonDown(t,r,a,l){T?setTimeout(bind(ensureFocus,t),0):t.curOp.focus=activeElt();var S,O=function configureMouse(t,r,a){var l=t.getOption("configureMouse"),S=l?l(t,r,a):{};if(null==S.unit){var O=Q?a.shiftKey&&a.metaKey:a.altKey;S.unit=O?"rectangle":"single"==r?"char":"double"==r?"word":"line"}return(null==S.extend||t.doc.extend)&&(S.extend=t.doc.extend||a.shiftKey),null==S.addNew&&(S.addNew=Z?a.metaKey:a.ctrlKey),null==S.moveOnDrag&&(S.moveOnDrag=!(Z?a.altKey:a.ctrlKey)),S}(t,a,l),D=t.doc.sel;t.options.dragDrop&&ye&&!t.isReadOnly()&&"single"==a&&(S=D.contains(r))>-1&&(cmp((S=D.ranges[S]).from(),r)<0||r.xRel>0)&&(cmp(S.to(),r)>0||r.xRel<0)?function leftButtonStartDrag(t,r,a,l){var S=t.display,O=!1,D=operation(t,(function(r){E&&(S.scroller.draggable=!1),t.state.draggingText=!1,t.state.delayingBlurEvent&&(t.hasFocus()?t.state.delayingBlurEvent=!1:delayBlurEvent(t)),off(S.wrapper.ownerDocument,"mouseup",D),off(S.wrapper.ownerDocument,"mousemove",mouseMove),off(S.scroller,"dragstart",dragStart),off(S.scroller,"drop",D),O||(e_preventDefault(r),l.addNew||extendSelection(t.doc,a,null,null,l.extend),E&&!B||T&&9==L?setTimeout((function(){S.wrapper.ownerDocument.body.focus({preventScroll:!0}),S.input.focus()}),20):S.input.focus())})),mouseMove=function(t){O=O||Math.abs(r.clientX-t.clientX)+Math.abs(r.clientY-t.clientY)>=10},dragStart=function(){return O=!0};E&&(S.scroller.draggable=!0),t.state.draggingText=D,D.copy=!l.moveOnDrag,on(S.wrapper.ownerDocument,"mouseup",D),on(S.wrapper.ownerDocument,"mousemove",mouseMove),on(S.scroller,"dragstart",dragStart),on(S.scroller,"drop",D),t.state.delayingBlurEvent=!0,setTimeout((function(){return S.input.focus()}),20),S.scroller.dragDrop&&S.scroller.dragDrop()}(t,l,r,O):function leftButtonSelect(t,r,a,l){T&&delayBlurEvent(t);var S=t.display,O=t.doc;e_preventDefault(r);var L,E,D=O.sel,j=D.ranges;if(l.addNew&&!l.extend?(E=O.sel.contains(a),L=E>-1?j[E]:new Range(a,a)):(L=O.sel.primary(),E=O.sel.primIndex),"rectangle"==l.unit)l.addNew||(L=new Range(a,a)),a=posFromMouse(t,r,!0,!0),E=-1;else{var V=rangeForUnit(t,a,l.unit);L=l.extend?extendRange(L,V.anchor,V.head,l.extend):V}l.addNew?-1==E?(E=j.length,setSelection(O,normalizeSelection(t,j.concat([L]),E),{scroll:!1,origin:"*mouse"})):j.length>1&&j[E].empty()&&"char"==l.unit&&!l.extend?(setSelection(O,normalizeSelection(t,j.slice(0,E).concat(j.slice(E+1)),0),{scroll:!1,origin:"*mouse"}),D=O.sel):replaceOneSelection(O,E,L,se):(E=0,setSelection(O,new Selection([L],0),se),D=O.sel);var B=a;function extendTo(r){if(0!=cmp(B,r))if(B=r,"rectangle"==l.unit){for(var S=[],T=t.options.tabSize,j=countColumn(getLine(O,a.line).text,a.ch,T),V=countColumn(getLine(O,r.line).text,r.ch,T),q=Math.min(j,V),G=Math.max(j,V),K=Math.min(a.line,r.line),X=Math.min(t.lastLine(),Math.max(a.line,r.line));K<=X;K++){var $=getLine(O,K).text,Z=findColumn($,q,T);q==G?S.push(new Range(Pos(K,Z),Pos(K,Z))):$.length>Z&&S.push(new Range(Pos(K,Z),Pos(K,findColumn($,G,T))))}S.length||S.push(new Range(a,a)),setSelection(O,normalizeSelection(t,D.ranges.slice(0,E).concat(S),E),{origin:"*mouse",scroll:!1}),t.scrollIntoView(r)}else{var Q,ee=L,te=rangeForUnit(t,r,l.unit),ne=ee.anchor;cmp(te.anchor,ne)>0?(Q=te.head,ne=minPos(ee.from(),te.anchor)):(Q=te.anchor,ne=maxPos(ee.to(),te.head));var re=D.ranges.slice(0);re[E]=function bidiSimplify(t,r){var a=r.anchor,l=r.head,S=getLine(t.doc,a.line);if(0==cmp(a,l)&&a.sticky==l.sticky)return r;var O=getOrder(S);if(!O)return r;var T=getBidiPartAt(O,a.ch,a.sticky),L=O[T];if(L.from!=a.ch&&L.to!=a.ch)return r;var E,D=T+(L.from==a.ch==(1!=L.level)?0:1);if(0==D||D==O.length)return r;if(l.line!=a.line)E=(l.line-a.line)*("ltr"==t.doc.direction?1:-1)>0;else{var j=getBidiPartAt(O,l.ch,l.sticky),V=j-T||(l.ch-a.ch)*(1==L.level?-1:1);E=j==D-1||j==D?V<0:V>0}var B=O[D+(E?-1:0)],q=E==(1==B.level),G=q?B.from:B.to,K=q?"after":"before";return a.ch==G&&a.sticky==K?r:new Range(new Pos(a.line,G,K),l)}(t,new Range(clipPos(O,ne),Q)),setSelection(O,normalizeSelection(t,re,E),se)}}var q=S.wrapper.getBoundingClientRect(),G=0;function done(r){t.state.selectingText=!1,G=1/0,r&&(e_preventDefault(r),S.input.focus()),off(S.wrapper.ownerDocument,"mousemove",K),off(S.wrapper.ownerDocument,"mouseup",X),O.history.lastSelOrigin=null}var K=operation(t,(function(r){0!==r.buttons&&e_button(r)?function extend(r){var a=++G,T=posFromMouse(t,r,!0,"rectangle"==l.unit);if(T)if(0!=cmp(T,B)){t.curOp.focus=activeElt(),extendTo(T);var L=visibleLines(S,O);(T.line>=L.to||T.line<L.from)&&setTimeout(operation(t,(function(){G==a&&extend(r)})),150)}else{var E=r.clientY<q.top?-20:r.clientY>q.bottom?20:0;E&&setTimeout(operation(t,(function(){G==a&&(S.scroller.scrollTop+=E,extend(r))})),50)}}(r):done(r)})),X=operation(t,done);t.state.selectingText=X,on(S.wrapper.ownerDocument,"mousemove",K),on(S.wrapper.ownerDocument,"mouseup",X)}(t,l,r,O)}(r,l,O,t):e_target(t)==a.scroller&&e_preventDefault(t):2==S?(l&&extendSelection(r.doc,l),setTimeout((function(){return a.input.focus()}),20)):3==S&&(re?r.display.input.onContextMenu(t):delayBlurEvent(r)))}}function rangeForUnit(t,r,a){if("char"==a)return new Range(r,r);if("word"==a)return t.findWordAt(r);if("line"==a)return new Range(Pos(r.line,0),clipPos(t.doc,Pos(r.line+1,0)));var l=a(t,r);return new Range(l.from,l.to)}function gutterEvent(t,r,a,l){var S,O;if(r.touches)S=r.touches[0].clientX,O=r.touches[0].clientY;else try{S=r.clientX,O=r.clientY}catch(t){return!1}if(S>=Math.floor(t.display.gutters.getBoundingClientRect().right))return!1;l&&e_preventDefault(r);var T=t.display,L=T.lineDiv.getBoundingClientRect();if(O>L.bottom||!hasHandler(t,a))return e_defaultPrevented(r);O-=L.top-T.viewOffset;for(var E=0;E<t.display.gutterSpecs.length;++E){var D=T.gutters.childNodes[E];if(D&&D.getBoundingClientRect().right>=S)return signal(t,a,t,lineAtHeight(t.doc,O),t.display.gutterSpecs[E].className,r),e_defaultPrevented(r)}}function clickInGutter(t,r){return gutterEvent(t,r,"gutterClick",!0)}function onContextMenu(t,r){eventInWidget(t.display,r)||function contextMenuInGutter(t,r){return!!hasHandler(t,"gutterContextMenu")&&gutterEvent(t,r,"gutterContextMenu",!1)}(t,r)||signalDOMEvent(t,r,"contextmenu")||re||t.display.input.onContextMenu(r)}function themeChanged(t){t.display.wrapper.className=t.display.wrapper.className.replace(/\s*cm-s-\S+/g,"")+t.options.theme.replace(/(^|\s)\s*/g," cm-s-"),clearCaches(t)}PastClick.prototype.compare=function(t,r,a){return this.time+400>t&&0==cmp(r,this.pos)&&a==this.button};var Qe={toString:function(){return"CodeMirror.Init"}},Je={},et={};function dragDropChanged(t,r,a){if(!r!=!(a&&a!=Qe)){var l=t.display.dragFunctions,S=r?on:off;S(t.display.scroller,"dragstart",l.start),S(t.display.scroller,"dragenter",l.enter),S(t.display.scroller,"dragover",l.over),S(t.display.scroller,"dragleave",l.leave),S(t.display.scroller,"drop",l.drop)}}function wrappingChanged(t){t.options.lineWrapping?(addClass(t.display.wrapper,"CodeMirror-wrap"),t.display.sizer.style.minWidth="",t.display.sizerWidth=null):(rmClass(t.display.wrapper,"CodeMirror-wrap"),findMaxLine(t)),estimateLineHeights(t),regChange(t),clearCaches(t),setTimeout((function(){return updateScrollbars(t)}),100)}function CodeMirror(t,r){var a=this;if(!(this instanceof CodeMirror))return new CodeMirror(t,r);this.options=r=r?copyObj(r):{},copyObj(Je,r,!1);var l=r.value;"string"==typeof l?l=new Doc(l,r.mode,null,r.lineSeparator,r.direction):r.mode&&(l.modeOption=r.mode),this.doc=l;var S=new CodeMirror.inputStyles[r.inputStyle](this),O=this.display=new Display(t,l,S,r);for(var D in O.wrapper.CodeMirror=this,themeChanged(this),r.lineWrapping&&(this.display.wrapper.className+=" CodeMirror-wrap"),initScrollbars(this),this.state={keyMaps:[],overlays:[],modeGen:0,overwrite:!1,delayingBlurEvent:!1,focused:!1,suppressEdits:!1,pasteIncoming:-1,cutIncoming:-1,selectingText:!1,draggingText:!1,highlight:new Delayed,keySeq:null,specialChars:null},r.autofocus&&!$&&O.input.focus(),T&&L<11&&setTimeout((function(){return a.display.input.reset(!0)}),20),function registerEventHandlers(t){var r=t.display;on(r.scroller,"mousedown",operation(t,onMouseDown)),on(r.scroller,"dblclick",T&&L<11?operation(t,(function(r){if(!signalDOMEvent(t,r)){var a=posFromMouse(t,r);if(a&&!clickInGutter(t,r)&&!eventInWidget(t.display,r)){e_preventDefault(r);var l=t.findWordAt(a);extendSelection(t.doc,l.anchor,l.head)}}})):function(r){return signalDOMEvent(t,r)||e_preventDefault(r)}),on(r.scroller,"contextmenu",(function(r){return onContextMenu(t,r)})),on(r.input.getField(),"contextmenu",(function(a){r.scroller.contains(a.target)||onContextMenu(t,a)}));var a,l={end:0};function finishTouch(){r.activeTouch&&(a=setTimeout((function(){return r.activeTouch=null}),1e3),(l=r.activeTouch).end=+new Date)}function farAway(t,r){if(null==r.left)return!0;var a=r.left-t.left,l=r.top-t.top;return a*a+l*l>400}on(r.scroller,"touchstart",(function(S){if(!signalDOMEvent(t,S)&&!function isMouseLikeTouchEvent(t){if(1!=t.touches.length)return!1;var r=t.touches[0];return r.radiusX<=1&&r.radiusY<=1}(S)&&!clickInGutter(t,S)){r.input.ensurePolled(),clearTimeout(a);var O=+new Date;r.activeTouch={start:O,moved:!1,prev:O-l.end<=300?l:null},1==S.touches.length&&(r.activeTouch.left=S.touches[0].pageX,r.activeTouch.top=S.touches[0].pageY)}})),on(r.scroller,"touchmove",(function(){r.activeTouch&&(r.activeTouch.moved=!0)})),on(r.scroller,"touchend",(function(a){var l=r.activeTouch;if(l&&!eventInWidget(r,a)&&null!=l.left&&!l.moved&&new Date-l.start<300){var S,O=t.coordsChar(r.activeTouch,"page");S=!l.prev||farAway(l,l.prev)?new Range(O,O):!l.prev.prev||farAway(l,l.prev.prev)?t.findWordAt(O):new Range(Pos(O.line,0),clipPos(t.doc,Pos(O.line+1,0))),t.setSelection(S.anchor,S.head),t.focus(),e_preventDefault(a)}finishTouch()})),on(r.scroller,"touchcancel",finishTouch),on(r.scroller,"scroll",(function(){r.scroller.clientHeight&&(updateScrollTop(t,r.scroller.scrollTop),setScrollLeft(t,r.scroller.scrollLeft,!0),signal(t,"scroll",t))})),on(r.scroller,"mousewheel",(function(r){return onScrollWheel(t,r)})),on(r.scroller,"DOMMouseScroll",(function(r){return onScrollWheel(t,r)})),on(r.wrapper,"scroll",(function(){return r.wrapper.scrollTop=r.wrapper.scrollLeft=0})),r.dragFunctions={enter:function(r){signalDOMEvent(t,r)||e_stop(r)},over:function(r){signalDOMEvent(t,r)||(function onDragOver(t,r){var a=posFromMouse(t,r);if(a){var l=document.createDocumentFragment();drawSelectionCursor(t,a,l),t.display.dragCursor||(t.display.dragCursor=elt("div",null,"CodeMirror-cursors CodeMirror-dragcursors"),t.display.lineSpace.insertBefore(t.display.dragCursor,t.display.cursorDiv)),removeChildrenAndAdd(t.display.dragCursor,l)}}(t,r),e_stop(r))},start:function(r){return function onDragStart(t,r){if(T&&(!t.state.draggingText||+new Date-We<100))e_stop(r);else if(!signalDOMEvent(t,r)&&!eventInWidget(t.display,r)&&(r.dataTransfer.setData("Text",t.getSelection()),r.dataTransfer.effectAllowed="copyMove",r.dataTransfer.setDragImage&&!B)){var a=elt("img",null,null,"position: fixed; left: 0; top: 0;");a.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",V&&(a.width=a.height=1,t.display.wrapper.appendChild(a),a._top=a.offsetTop),r.dataTransfer.setDragImage(a,0,0),V&&a.parentNode.removeChild(a)}}(t,r)},drop:operation(t,onDrop),leave:function(r){signalDOMEvent(t,r)||clearDragCursor(t)}};var S=r.input.getField();on(S,"keyup",(function(r){return onKeyUp.call(t,r)})),on(S,"keydown",operation(t,onKeyDown)),on(S,"keypress",operation(t,onKeyPress)),on(S,"focus",(function(r){return onFocus(t,r)})),on(S,"blur",(function(r){return onBlur(t,r)}))}(this),ensureGlobalHandlers(),startOperation(this),this.curOp.forceUpdate=!0,attachDoc(this,l),r.autofocus&&!$||this.hasFocus()?setTimeout((function(){a.hasFocus()&&!a.state.focused&&onFocus(a)}),20):onBlur(this),et)et.hasOwnProperty(D)&&et[D](this,r[D],Qe);maybeUpdateLineNumberWidth(this),r.finishInit&&r.finishInit(this);for(var j=0;j<tt.length;++j)tt[j](this);endOperation(this),E&&r.lineWrapping&&"optimizelegibility"==getComputedStyle(O.lineDiv).textRendering&&(O.lineDiv.style.textRendering="auto")}CodeMirror.defaults=Je,CodeMirror.optionHandlers=et;var tt=[];function indentLine(t,r,a,l){var S,O=t.doc;null==a&&(a="add"),"smart"==a&&(O.mode.indent?S=getContextBefore(t,r).state:a="prev");var T=t.options.tabSize,L=getLine(O,r),E=countColumn(L.text,null,T);L.stateAfter&&(L.stateAfter=null);var D,j=L.text.match(/^\s*/)[0];if(l||/\S/.test(L.text)){if("smart"==a&&((D=O.mode.indent(S,L.text.slice(j.length),L.text))==ie||D>150)){if(!l)return;a="prev"}}else D=0,a="not";"prev"==a?D=r>O.first?countColumn(getLine(O,r-1).text,null,T):0:"add"==a?D=E+t.options.indentUnit:"subtract"==a?D=E-t.options.indentUnit:"number"==typeof a&&(D=E+a),D=Math.max(0,D);var V="",B=0;if(t.options.indentWithTabs)for(var q=Math.floor(D/T);q;--q)B+=T,V+="\t";if(B<D&&(V+=spaceStr(D-B)),V!=j)return replaceRange(O,V,Pos(r,0),Pos(r,j.length),"+input"),L.stateAfter=null,!0;for(var G=0;G<O.sel.ranges.length;G++){var K=O.sel.ranges[G];if(K.head.line==r&&K.head.ch<j.length){var X=Pos(r,j.length);replaceOneSelection(O,G,new Range(X,X));break}}}CodeMirror.defineInitHook=function(t){return tt.push(t)};var nt=null;function setLastCopied(t){nt=t}function applyTextInput(t,r,a,l,S){var O=t.doc;t.display.shift=!1,l||(l=O.sel);var T=+new Date-200,L="paste"==S||t.state.pasteIncoming>T,E=be(r),D=null;if(L&&l.ranges.length>1)if(nt&&nt.text.join("\n")==r){if(l.ranges.length%nt.text.length==0){D=[];for(var j=0;j<nt.text.length;j++)D.push(O.splitLines(nt.text[j]))}}else E.length==l.ranges.length&&t.options.pasteLinesPerSelection&&(D=map(E,(function(t){return[t]})));for(var V=t.curOp.updateInput,B=l.ranges.length-1;B>=0;B--){var q=l.ranges[B],G=q.from(),K=q.to();q.empty()&&(a&&a>0?G=Pos(G.line,G.ch-a):t.state.overwrite&&!L?K=Pos(K.line,Math.min(getLine(O,K.line).text.length,K.ch+lst(E).length)):L&&nt&&nt.lineWise&&nt.text.join("\n")==E.join("\n")&&(G=K=Pos(G.line,0)));var X={from:G,to:K,text:D?D[B%D.length]:E,origin:S||(L?"paste":t.state.cutIncoming>T?"cut":"+input")};makeChange(t.doc,X),signalLater(t,"inputRead",t,X)}r&&!L&&triggerElectric(t,r),ensureCursorVisible(t),t.curOp.updateInput<2&&(t.curOp.updateInput=V),t.curOp.typing=!0,t.state.pasteIncoming=t.state.cutIncoming=-1}function handlePaste(t,r){var a=t.clipboardData&&t.clipboardData.getData("Text");if(a)return t.preventDefault(),r.isReadOnly()||r.options.disableInput||runInOp(r,(function(){return applyTextInput(r,a,0,null,"paste")})),!0}function triggerElectric(t,r){if(t.options.electricChars&&t.options.smartIndent)for(var a=t.doc.sel,l=a.ranges.length-1;l>=0;l--){var S=a.ranges[l];if(!(S.head.ch>100||l&&a.ranges[l-1].head.line==S.head.line)){var O=t.getModeAt(S.head),T=!1;if(O.electricChars){for(var L=0;L<O.electricChars.length;L++)if(r.indexOf(O.electricChars.charAt(L))>-1){T=indentLine(t,S.head.line,"smart");break}}else O.electricInput&&O.electricInput.test(getLine(t.doc,S.head.line).text.slice(0,S.head.ch))&&(T=indentLine(t,S.head.line,"smart"));T&&signalLater(t,"electricInput",t,S.head.line)}}}function copyableRanges(t){for(var r=[],a=[],l=0;l<t.doc.sel.ranges.length;l++){var S=t.doc.sel.ranges[l].head.line,O={anchor:Pos(S,0),head:Pos(S+1,0)};a.push(O),r.push(t.getRange(O.anchor,O.head))}return{text:r,ranges:a}}function disableBrowserMagic(t,r,a,l){t.setAttribute("autocorrect",a?"":"off"),t.setAttribute("autocapitalize",l?"":"off"),t.setAttribute("spellcheck",!!r)}function hiddenTextarea(){var t=elt("textarea",null,null,"position: absolute; bottom: -1em; padding: 0; width: 1px; height: 1em; outline: none"),r=elt("div",[t],null,"overflow: hidden; position: relative; width: 3px; height: 0px;");return E?t.style.width="1000px":t.setAttribute("wrap","off"),K&&(t.style.border="1px solid black"),disableBrowserMagic(t),r}function findPosH(t,r,a,l,S){var O=r,T=a,L=getLine(t,r.line),E=S&&"rtl"==t.direction?-a:a;function moveOnce(O){var T;if("codepoint"==l){var D=L.text.charCodeAt(r.ch+(a>0?0:-1));if(isNaN(D))T=null;else{var j=a>0?D>=55296&&D<56320:D>=56320&&D<57343;T=new Pos(r.line,Math.max(0,Math.min(L.text.length,r.ch+a*(j?2:1))),-a)}}else T=S?function moveVisually(t,r,a,l){var S=getOrder(r,t.doc.direction);if(!S)return moveLogically(r,a,l);a.ch>=r.text.length?(a.ch=r.text.length,a.sticky="before"):a.ch<=0&&(a.ch=0,a.sticky="after");var O=getBidiPartAt(S,a.ch,a.sticky),T=S[O];if("ltr"==t.doc.direction&&T.level%2==0&&(l>0?T.to>a.ch:T.from<a.ch))return moveLogically(r,a,l);var L,mv=function(t,a){return moveCharLogically(r,t instanceof Pos?t.ch:t,a)},getWrappedLineExtent=function(a){return t.options.lineWrapping?(L=L||prepareMeasureForLine(t,r),wrappedLineExtentChar(t,r,L,a)):{begin:0,end:r.text.length}},E=getWrappedLineExtent("before"==a.sticky?mv(a,-1):a.ch);if("rtl"==t.doc.direction||1==T.level){var D=1==T.level==l<0,j=mv(a,D?1:-1);if(null!=j&&(D?j<=T.to&&j<=E.end:j>=T.from&&j>=E.begin)){var V=D?"before":"after";return new Pos(a.line,j,V)}}var searchInVisualLine=function(t,r,l){for(var getRes=function(t,r){return r?new Pos(a.line,mv(t,1),"before"):new Pos(a.line,t,"after")};t>=0&&t<S.length;t+=r){var O=S[t],T=r>0==(1!=O.level),L=T?l.begin:mv(l.end,-1);if(O.from<=L&&L<O.to)return getRes(L,T);if(L=T?O.from:mv(O.to,-1),l.begin<=L&&L<l.end)return getRes(L,T)}},B=searchInVisualLine(O+l,l,E);if(B)return B;var q=l>0?E.end:mv(E.begin,-1);return null==q||l>0&&q==r.text.length||!(B=searchInVisualLine(l>0?0:S.length-1,l,getWrappedLineExtent(q)))?null:B}(t.cm,L,r,a):moveLogically(L,r,a);if(null==T){if(O||!function findNextLine(){var a=r.line+E;return!(a<t.first||a>=t.first+t.size)&&(r=new Pos(a,r.ch,r.sticky),L=getLine(t,a))}())return!1;r=endOfLine(S,t.cm,L,r.line,E)}else r=T;return!0}if("char"==l||"codepoint"==l)moveOnce();else if("column"==l)moveOnce(!0);else if("word"==l||"group"==l)for(var D=null,j="group"==l,V=t.cm&&t.cm.getHelper(r,"wordChars"),B=!0;!(a<0)||moveOnce(!B);B=!1){var q=L.text.charAt(r.ch)||"\n",G=isWordChar(q,V)?"w":j&&"\n"==q?"n":!j||/\s/.test(q)?null:"p";if(!j||B||G||(G="s"),D&&D!=G){a<0&&(a=1,moveOnce(),r.sticky="after");break}if(G&&(D=G),a>0&&!moveOnce(!B))break}var K=skipAtomic(t,r,O,T,!0);return equalCursorPos(O,K)&&(K.hitSide=!0),K}function findPosV(t,r,a,l){var S,O,T=t.doc,L=r.left;if("page"==l){var E=Math.min(t.display.wrapper.clientHeight,window.innerHeight||document.documentElement.clientHeight),D=Math.max(E-.5*textHeight(t.display),3);S=(a>0?r.bottom:r.top)+a*D}else"line"==l&&(S=a>0?r.bottom+3:r.top-3);for(;(O=coordsChar(t,L,S)).outside;){if(a<0?S<=0:S>=T.height){O.hitSide=!0;break}S+=5*a}return O}var ContentEditableInput=function(t){this.cm=t,this.lastAnchorNode=this.lastAnchorOffset=this.lastFocusNode=this.lastFocusOffset=null,this.polling=new Delayed,this.composing=null,this.gracePeriod=!1,this.readDOMTimeout=null};function posToDOM(t,r){var a=findViewForLine(t,r.line);if(!a||a.hidden)return null;var l=getLine(t.doc,r.line),S=mapFromLineView(a,l,r.line),O=getOrder(l,t.doc.direction),T="left";O&&(T=getBidiPartAt(O,r.ch)%2?"right":"left");var L=nodeAndOffsetInLineMap(S.map,r.ch,T);return L.offset="right"==L.collapse?L.end:L.start,L}function badPos(t,r){return r&&(t.bad=!0),t}function domToPos(t,r,a){var l;if(r==t.display.lineDiv){if(!(l=t.display.lineDiv.childNodes[a]))return badPos(t.clipPos(Pos(t.display.viewTo-1)),!0);r=null,a=0}else for(l=r;;l=l.parentNode){if(!l||l==t.display.lineDiv)return null;if(l.parentNode&&l.parentNode==t.display.lineDiv)break}for(var S=0;S<t.display.view.length;S++){var O=t.display.view[S];if(O.node==l)return locateNodeInLineView(O,r,a)}}function locateNodeInLineView(t,r,a){var l=t.text.firstChild,S=!1;if(!r||!contains(l,r))return badPos(Pos(lineNo(t.line),0),!0);if(r==l&&(S=!0,r=l.childNodes[a],a=0,!r)){var O=t.rest?lst(t.rest):t.line;return badPos(Pos(lineNo(O),O.text.length),S)}var T=3==r.nodeType?r:null,L=r;for(T||1!=r.childNodes.length||3!=r.firstChild.nodeType||(T=r.firstChild,a&&(a=T.nodeValue.length));L.parentNode!=l;)L=L.parentNode;var E=t.measure,D=E.maps;function find(r,a,l){for(var S=-1;S<(D?D.length:0);S++)for(var O=S<0?E.map:D[S],T=0;T<O.length;T+=3){var L=O[T+2];if(L==r||L==a){var j=lineNo(S<0?t.line:t.rest[S]),V=O[T]+l;return(l<0||L!=r)&&(V=O[T+(l?1:0)]),Pos(j,V)}}}var j=find(T,L,a);if(j)return badPos(j,S);for(var V=L.nextSibling,B=T?T.nodeValue.length-a:0;V;V=V.nextSibling){if(j=find(V,V.firstChild,0))return badPos(Pos(j.line,j.ch-B),S);B+=V.textContent.length}for(var q=L.previousSibling,G=a;q;q=q.previousSibling){if(j=find(q,q.firstChild,-1))return badPos(Pos(j.line,j.ch+G),S);G+=q.textContent.length}}ContentEditableInput.prototype.init=function(t){var r=this,a=this,l=a.cm,S=a.div=t.lineDiv;function belongsToInput(t){for(var r=t.target;r;r=r.parentNode){if(r==S)return!0;if(/\bCodeMirror-(?:line)?widget\b/.test(r.className))break}return!1}function onCopyCut(t){if(belongsToInput(t)&&!signalDOMEvent(l,t)){if(l.somethingSelected())setLastCopied({lineWise:!1,text:l.getSelections()}),"cut"==t.type&&l.replaceSelection("",null,"cut");else{if(!l.options.lineWiseCopyCut)return;var r=copyableRanges(l);setLastCopied({lineWise:!0,text:r.text}),"cut"==t.type&&l.operation((function(){l.setSelections(r.ranges,0,ae),l.replaceSelection("",null,"cut")}))}if(t.clipboardData){t.clipboardData.clearData();var O=nt.text.join("\n");if(t.clipboardData.setData("Text",O),t.clipboardData.getData("Text")==O)return void t.preventDefault()}var T=hiddenTextarea(),L=T.firstChild;l.display.lineSpace.insertBefore(T,l.display.lineSpace.firstChild),L.value=nt.text.join("\n");var E=activeElt();selectInput(L),setTimeout((function(){l.display.lineSpace.removeChild(T),E.focus(),E==S&&a.showPrimarySelection()}),50)}}S.contentEditable=!0,disableBrowserMagic(S,l.options.spellcheck,l.options.autocorrect,l.options.autocapitalize),on(S,"paste",(function(t){!belongsToInput(t)||signalDOMEvent(l,t)||handlePaste(t,l)||L<=11&&setTimeout(operation(l,(function(){return r.updateFromDOM()})),20)})),on(S,"compositionstart",(function(t){r.composing={data:t.data,done:!1}})),on(S,"compositionupdate",(function(t){r.composing||(r.composing={data:t.data,done:!1})})),on(S,"compositionend",(function(t){r.composing&&(t.data!=r.composing.data&&r.readFromDOMSoon(),r.composing.done=!0)})),on(S,"touchstart",(function(){return a.forceCompositionEnd()})),on(S,"input",(function(){r.composing||r.readFromDOMSoon()})),on(S,"copy",onCopyCut),on(S,"cut",onCopyCut)},ContentEditableInput.prototype.screenReaderLabelChanged=function(t){t?this.div.setAttribute("aria-label",t):this.div.removeAttribute("aria-label")},ContentEditableInput.prototype.prepareSelection=function(){var t=prepareSelection(this.cm,!1);return t.focus=activeElt()==this.div,t},ContentEditableInput.prototype.showSelection=function(t,r){t&&this.cm.display.view.length&&((t.focus||r)&&this.showPrimarySelection(),this.showMultipleSelections(t))},ContentEditableInput.prototype.getSelection=function(){return this.cm.display.wrapper.ownerDocument.getSelection()},ContentEditableInput.prototype.showPrimarySelection=function(){var t=this.getSelection(),r=this.cm,l=r.doc.sel.primary(),S=l.from(),O=l.to();if(r.display.viewTo==r.display.viewFrom||S.line>=r.display.viewTo||O.line<r.display.viewFrom)t.removeAllRanges();else{var T=domToPos(r,t.anchorNode,t.anchorOffset),L=domToPos(r,t.focusNode,t.focusOffset);if(!T||T.bad||!L||L.bad||0!=cmp(minPos(T,L),S)||0!=cmp(maxPos(T,L),O)){var E=r.display.view,D=S.line>=r.display.viewFrom&&posToDOM(r,S)||{node:E[0].measure.map[2],offset:0},j=O.line<r.display.viewTo&&posToDOM(r,O);if(!j){var V=E[E.length-1].measure,B=V.maps?V.maps[V.maps.length-1]:V.map;j={node:B[B.length-1],offset:B[B.length-2]-B[B.length-3]}}if(D&&j){var q,G=t.rangeCount&&t.getRangeAt(0);try{q=oe(D.node,D.offset,j.offset,j.node)}catch(t){}q&&(!a&&r.state.focused?(t.collapse(D.node,D.offset),q.collapsed||(t.removeAllRanges(),t.addRange(q))):(t.removeAllRanges(),t.addRange(q)),G&&null==t.anchorNode?t.addRange(G):a&&this.startGracePeriod()),this.rememberSelection()}else t.removeAllRanges()}}},ContentEditableInput.prototype.startGracePeriod=function(){var t=this;clearTimeout(this.gracePeriod),this.gracePeriod=setTimeout((function(){t.gracePeriod=!1,t.selectionChanged()&&t.cm.operation((function(){return t.cm.curOp.selectionChanged=!0}))}),20)},ContentEditableInput.prototype.showMultipleSelections=function(t){removeChildrenAndAdd(this.cm.display.cursorDiv,t.cursors),removeChildrenAndAdd(this.cm.display.selectionDiv,t.selection)},ContentEditableInput.prototype.rememberSelection=function(){var t=this.getSelection();this.lastAnchorNode=t.anchorNode,this.lastAnchorOffset=t.anchorOffset,this.lastFocusNode=t.focusNode,this.lastFocusOffset=t.focusOffset},ContentEditableInput.prototype.selectionInEditor=function(){var t=this.getSelection();if(!t.rangeCount)return!1;var r=t.getRangeAt(0).commonAncestorContainer;return contains(this.div,r)},ContentEditableInput.prototype.focus=function(){"nocursor"!=this.cm.options.readOnly&&(this.selectionInEditor()&&activeElt()==this.div||this.showSelection(this.prepareSelection(),!0),this.div.focus())},ContentEditableInput.prototype.blur=function(){this.div.blur()},ContentEditableInput.prototype.getField=function(){return this.div},ContentEditableInput.prototype.supportsTouch=function(){return!0},ContentEditableInput.prototype.receivedFocus=function(){var t=this;this.selectionInEditor()?this.pollSelection():runInOp(this.cm,(function(){return t.cm.curOp.selectionChanged=!0})),this.polling.set(this.cm.options.pollInterval,(function poll(){t.cm.state.focused&&(t.pollSelection(),t.polling.set(t.cm.options.pollInterval,poll))}))},ContentEditableInput.prototype.selectionChanged=function(){var t=this.getSelection();return t.anchorNode!=this.lastAnchorNode||t.anchorOffset!=this.lastAnchorOffset||t.focusNode!=this.lastFocusNode||t.focusOffset!=this.lastFocusOffset},ContentEditableInput.prototype.pollSelection=function(){if(null==this.readDOMTimeout&&!this.gracePeriod&&this.selectionChanged()){var t=this.getSelection(),r=this.cm;if(X&&j&&this.cm.display.gutterSpecs.length&&function isInGutter(t){for(var r=t;r;r=r.parentNode)if(/CodeMirror-gutter-wrapper/.test(r.className))return!0;return!1}(t.anchorNode))return this.cm.triggerOnKeyDown({type:"keydown",keyCode:8,preventDefault:Math.abs}),this.blur(),void this.focus();if(!this.composing){this.rememberSelection();var a=domToPos(r,t.anchorNode,t.anchorOffset),l=domToPos(r,t.focusNode,t.focusOffset);a&&l&&runInOp(r,(function(){setSelection(r.doc,simpleSelection(a,l),ae),(a.bad||l.bad)&&(r.curOp.selectionChanged=!0)}))}}},ContentEditableInput.prototype.pollContent=function(){null!=this.readDOMTimeout&&(clearTimeout(this.readDOMTimeout),this.readDOMTimeout=null);var t,r,a,l=this.cm,S=l.display,O=l.doc.sel.primary(),T=O.from(),L=O.to();if(0==T.ch&&T.line>l.firstLine()&&(T=Pos(T.line-1,getLine(l.doc,T.line-1).length)),L.ch==getLine(l.doc,L.line).text.length&&L.line<l.lastLine()&&(L=Pos(L.line+1,0)),T.line<S.viewFrom||L.line>S.viewTo-1)return!1;T.line==S.viewFrom||0==(t=findViewIndex(l,T.line))?(r=lineNo(S.view[0].line),a=S.view[0].node):(r=lineNo(S.view[t].line),a=S.view[t-1].node.nextSibling);var E,D,j=findViewIndex(l,L.line);if(j==S.view.length-1?(E=S.viewTo-1,D=S.lineDiv.lastChild):(E=lineNo(S.view[j+1].line)-1,D=S.view[j+1].node.previousSibling),!a)return!1;for(var V=l.doc.splitLines(function domTextBetween(t,r,a,l,S){var O="",T=!1,L=t.doc.lineSeparator(),E=!1;function close(){T&&(O+=L,E&&(O+=L),T=E=!1)}function addText(t){t&&(close(),O+=t)}function walk(r){if(1==r.nodeType){var a=r.getAttribute("cm-text");if(a)return void addText(a);var O,D=r.getAttribute("cm-marker");if(D){var j=t.findMarks(Pos(l,0),Pos(S+1,0),function recognizeMarker(t){return function(r){return r.id==t}}(+D));return void(j.length&&(O=j[0].find(0))&&addText(getBetween(t.doc,O.from,O.to).join(L)))}if("false"==r.getAttribute("contenteditable"))return;var V=/^(pre|div|p|li|table|br)$/i.test(r.nodeName);if(!/^br$/i.test(r.nodeName)&&0==r.textContent.length)return;V&&close();for(var B=0;B<r.childNodes.length;B++)walk(r.childNodes[B]);/^(pre|p)$/i.test(r.nodeName)&&(E=!0),V&&(T=!0)}else 3==r.nodeType&&addText(r.nodeValue.replace(/\u200b/g,"").replace(/\u00a0/g," "))}for(;walk(r),r!=a;)r=r.nextSibling,E=!1;return O}(l,a,D,r,E)),B=getBetween(l.doc,Pos(r,0),Pos(E,getLine(l.doc,E).text.length));V.length>1&&B.length>1;)if(lst(V)==lst(B))V.pop(),B.pop(),E--;else{if(V[0]!=B[0])break;V.shift(),B.shift(),r++}for(var q=0,G=0,K=V[0],X=B[0],$=Math.min(K.length,X.length);q<$&&K.charCodeAt(q)==X.charCodeAt(q);)++q;for(var Z=lst(V),Q=lst(B),ee=Math.min(Z.length-(1==V.length?q:0),Q.length-(1==B.length?q:0));G<ee&&Z.charCodeAt(Z.length-G-1)==Q.charCodeAt(Q.length-G-1);)++G;if(1==V.length&&1==B.length&&r==T.line)for(;q&&q>T.ch&&Z.charCodeAt(Z.length-G-1)==Q.charCodeAt(Q.length-G-1);)q--,G++;V[V.length-1]=Z.slice(0,Z.length-G).replace(/^\u200b+/,""),V[0]=V[0].slice(q).replace(/\u200b+$/,"");var te=Pos(r,q),ne=Pos(E,B.length?lst(B).length-G:0);return V.length>1||V[0]||cmp(te,ne)?(replaceRange(l.doc,V,te,ne,"+input"),!0):void 0},ContentEditableInput.prototype.ensurePolled=function(){this.forceCompositionEnd()},ContentEditableInput.prototype.reset=function(){this.forceCompositionEnd()},ContentEditableInput.prototype.forceCompositionEnd=function(){this.composing&&(clearTimeout(this.readDOMTimeout),this.composing=null,this.updateFromDOM(),this.div.blur(),this.div.focus())},ContentEditableInput.prototype.readFromDOMSoon=function(){var t=this;null==this.readDOMTimeout&&(this.readDOMTimeout=setTimeout((function(){if(t.readDOMTimeout=null,t.composing){if(!t.composing.done)return;t.composing=null}t.updateFromDOM()}),80))},ContentEditableInput.prototype.updateFromDOM=function(){var t=this;!this.cm.isReadOnly()&&this.pollContent()||runInOp(this.cm,(function(){return regChange(t.cm)}))},ContentEditableInput.prototype.setUneditable=function(t){t.contentEditable="false"},ContentEditableInput.prototype.onKeyPress=function(t){0==t.charCode||this.composing||(t.preventDefault(),this.cm.isReadOnly()||operation(this.cm,applyTextInput)(this.cm,String.fromCharCode(null==t.charCode?t.keyCode:t.charCode),0))},ContentEditableInput.prototype.readOnlyChanged=function(t){this.div.contentEditable=String("nocursor"!=t)},ContentEditableInput.prototype.onContextMenu=function(){},ContentEditableInput.prototype.resetPosition=function(){},ContentEditableInput.prototype.needsContentAttribute=!0;var TextareaInput=function(t){this.cm=t,this.prevInput="",this.pollingFast=!1,this.polling=new Delayed,this.hasSelection=!1,this.composing=null};TextareaInput.prototype.init=function(t){var r=this,a=this,l=this.cm;this.createField(t);var S=this.textarea;function prepareCopyCut(t){if(!signalDOMEvent(l,t)){if(l.somethingSelected())setLastCopied({lineWise:!1,text:l.getSelections()});else{if(!l.options.lineWiseCopyCut)return;var r=copyableRanges(l);setLastCopied({lineWise:!0,text:r.text}),"cut"==t.type?l.setSelections(r.ranges,null,ae):(a.prevInput="",S.value=r.text.join("\n"),selectInput(S))}"cut"==t.type&&(l.state.cutIncoming=+new Date)}}t.wrapper.insertBefore(this.wrapper,t.wrapper.firstChild),K&&(S.style.width="0px"),on(S,"input",(function(){T&&L>=9&&r.hasSelection&&(r.hasSelection=null),a.poll()})),on(S,"paste",(function(t){signalDOMEvent(l,t)||handlePaste(t,l)||(l.state.pasteIncoming=+new Date,a.fastPoll())})),on(S,"cut",prepareCopyCut),on(S,"copy",prepareCopyCut),on(t.scroller,"paste",(function(r){if(!eventInWidget(t,r)&&!signalDOMEvent(l,r)){if(!S.dispatchEvent)return l.state.pasteIncoming=+new Date,void a.focus();var O=new Event("paste");O.clipboardData=r.clipboardData,S.dispatchEvent(O)}})),on(t.lineSpace,"selectstart",(function(r){eventInWidget(t,r)||e_preventDefault(r)})),on(S,"compositionstart",(function(){var t=l.getCursor("from");a.composing&&a.composing.range.clear(),a.composing={start:t,range:l.markText(t,l.getCursor("to"),{className:"CodeMirror-composing"})}})),on(S,"compositionend",(function(){a.composing&&(a.poll(),a.composing.range.clear(),a.composing=null)}))},TextareaInput.prototype.createField=function(t){this.wrapper=hiddenTextarea(),this.textarea=this.wrapper.firstChild},TextareaInput.prototype.screenReaderLabelChanged=function(t){t?this.textarea.setAttribute("aria-label",t):this.textarea.removeAttribute("aria-label")},TextareaInput.prototype.prepareSelection=function(){var t=this.cm,r=t.display,a=t.doc,l=prepareSelection(t);if(t.options.moveInputWithCursor){var S=cursorCoords(t,a.sel.primary().head,"div"),O=r.wrapper.getBoundingClientRect(),T=r.lineDiv.getBoundingClientRect();l.teTop=Math.max(0,Math.min(r.wrapper.clientHeight-10,S.top+T.top-O.top)),l.teLeft=Math.max(0,Math.min(r.wrapper.clientWidth-10,S.left+T.left-O.left))}return l},TextareaInput.prototype.showSelection=function(t){var r=this.cm.display;removeChildrenAndAdd(r.cursorDiv,t.cursors),removeChildrenAndAdd(r.selectionDiv,t.selection),null!=t.teTop&&(this.wrapper.style.top=t.teTop+"px",this.wrapper.style.left=t.teLeft+"px")},TextareaInput.prototype.reset=function(t){if(!this.contextMenuPending&&!this.composing){var r=this.cm;if(r.somethingSelected()){this.prevInput="";var a=r.getSelection();this.textarea.value=a,r.state.focused&&selectInput(this.textarea),T&&L>=9&&(this.hasSelection=a)}else t||(this.prevInput=this.textarea.value="",T&&L>=9&&(this.hasSelection=null))}},TextareaInput.prototype.getField=function(){return this.textarea},TextareaInput.prototype.supportsTouch=function(){return!1},TextareaInput.prototype.focus=function(){if("nocursor"!=this.cm.options.readOnly&&(!$||activeElt()!=this.textarea))try{this.textarea.focus()}catch(t){}},TextareaInput.prototype.blur=function(){this.textarea.blur()},TextareaInput.prototype.resetPosition=function(){this.wrapper.style.top=this.wrapper.style.left=0},TextareaInput.prototype.receivedFocus=function(){this.slowPoll()},TextareaInput.prototype.slowPoll=function(){var t=this;this.pollingFast||this.polling.set(this.cm.options.pollInterval,(function(){t.poll(),t.cm.state.focused&&t.slowPoll()}))},TextareaInput.prototype.fastPoll=function(){var t=!1,r=this;r.pollingFast=!0,r.polling.set(20,(function p(){r.poll()||t?(r.pollingFast=!1,r.slowPoll()):(t=!0,r.polling.set(60,p))}))},TextareaInput.prototype.poll=function(){var t=this,r=this.cm,a=this.textarea,l=this.prevInput;if(this.contextMenuPending||!r.state.focused||_e(a)&&!l&&!this.composing||r.isReadOnly()||r.options.disableInput||r.state.keySeq)return!1;var S=a.value;if(S==l&&!r.somethingSelected())return!1;if(T&&L>=9&&this.hasSelection===S||Z&&/[\uf700-\uf7ff]/.test(S))return r.display.input.reset(),!1;if(r.doc.sel==r.display.selForContextMenu){var O=S.charCodeAt(0);if(8203!=O||l||(l="​"),8666==O)return this.reset(),this.cm.execCommand("undo")}for(var E=0,D=Math.min(l.length,S.length);E<D&&l.charCodeAt(E)==S.charCodeAt(E);)++E;return runInOp(r,(function(){applyTextInput(r,S.slice(E),l.length-E,null,t.composing?"*compose":null),S.length>1e3||S.indexOf("\n")>-1?a.value=t.prevInput="":t.prevInput=S,t.composing&&(t.composing.range.clear(),t.composing.range=r.markText(t.composing.start,r.getCursor("to"),{className:"CodeMirror-composing"}))})),!0},TextareaInput.prototype.ensurePolled=function(){this.pollingFast&&this.poll()&&(this.pollingFast=!1)},TextareaInput.prototype.onKeyPress=function(){T&&L>=9&&(this.hasSelection=null),this.fastPoll()},TextareaInput.prototype.onContextMenu=function(t){var r=this,a=r.cm,l=a.display,S=r.textarea;r.contextMenuPending&&r.contextMenuPending();var O=posFromMouse(a,t),D=l.scroller.scrollTop;if(O&&!V){a.options.resetSelectionOnContextMenu&&-1==a.doc.sel.contains(O)&&operation(a,setSelection)(a.doc,simpleSelection(O),ae);var j,B=S.style.cssText,q=r.wrapper.style.cssText,G=r.wrapper.offsetParent.getBoundingClientRect();if(r.wrapper.style.cssText="position: static",S.style.cssText="position: absolute; width: 30px; height: 30px;\n      top: "+(t.clientY-G.top-5)+"px; left: "+(t.clientX-G.left-5)+"px;\n      z-index: 1000; background: "+(T?"rgba(255, 255, 255, .05)":"transparent")+";\n      outline: none; border-width: 0; outline: none; overflow: hidden; opacity: .05; filter: alpha(opacity=5);",E&&(j=window.scrollY),l.input.focus(),E&&window.scrollTo(null,j),l.input.reset(),a.somethingSelected()||(S.value=r.prevInput=" "),r.contextMenuPending=rehide,l.selForContextMenu=a.doc.sel,clearTimeout(l.detectingSelectAll),T&&L>=9&&prepareSelectAllHack(),re){e_stop(t);var mouseup=function(){off(window,"mouseup",mouseup),setTimeout(rehide,20)};on(window,"mouseup",mouseup)}else setTimeout(rehide,50)}function prepareSelectAllHack(){if(null!=S.selectionStart){var t=a.somethingSelected(),O="​"+(t?S.value:"");S.value="⇚",S.value=O,r.prevInput=t?"":"​",S.selectionStart=1,S.selectionEnd=O.length,l.selForContextMenu=a.doc.sel}}function rehide(){if(r.contextMenuPending==rehide&&(r.contextMenuPending=!1,r.wrapper.style.cssText=q,S.style.cssText=B,T&&L<9&&l.scrollbars.setScrollTop(l.scroller.scrollTop=D),null!=S.selectionStart)){(!T||T&&L<9)&&prepareSelectAllHack();var t=0,poll=function(){l.selForContextMenu==a.doc.sel&&0==S.selectionStart&&S.selectionEnd>0&&"​"==r.prevInput?operation(a,selectAll)(a):t++<10?l.detectingSelectAll=setTimeout(poll,500):(l.selForContextMenu=null,l.input.reset())};l.detectingSelectAll=setTimeout(poll,200)}}},TextareaInput.prototype.readOnlyChanged=function(t){t||this.reset(),this.textarea.disabled="nocursor"==t,this.textarea.readOnly=!!t},TextareaInput.prototype.setUneditable=function(){},TextareaInput.prototype.needsContentAttribute=!1,function defineOptions(t){var r=t.optionHandlers;function option(a,l,S,O){t.defaults[a]=l,S&&(r[a]=O?function(t,r,a){a!=Qe&&S(t,r,a)}:S)}t.defineOption=option,t.Init=Qe,option("value","",(function(t,r){return t.setValue(r)}),!0),option("mode",null,(function(t,r){t.doc.modeOption=r,loadMode(t)}),!0),option("indentUnit",2,loadMode,!0),option("indentWithTabs",!1),option("smartIndent",!0),option("tabSize",4,(function(t){resetModeState(t),clearCaches(t),regChange(t)}),!0),option("lineSeparator",null,(function(t,r){if(t.doc.lineSep=r,r){var a=[],l=t.doc.first;t.doc.iter((function(t){for(var S=0;;){var O=t.text.indexOf(r,S);if(-1==O)break;S=O+r.length,a.push(Pos(l,O))}l++}));for(var S=a.length-1;S>=0;S--)replaceRange(t.doc,r,a[S],Pos(a[S].line,a[S].ch+r.length))}})),option("specialChars",/[\u0000-\u001f\u007f-\u009f\u00ad\u061c\u200b\u200e\u200f\u2028\u2029\ufeff\ufff9-\ufffc]/g,(function(t,r,a){t.state.specialChars=new RegExp(r.source+(r.test("\t")?"":"|\t"),"g"),a!=Qe&&t.refresh()})),option("specialCharPlaceholder",defaultSpecialCharPlaceholder,(function(t){return t.refresh()}),!0),option("electricChars",!0),option("inputStyle",$?"contenteditable":"textarea",(function(){throw new Error("inputStyle can not (yet) be changed in a running editor")}),!0),option("spellcheck",!1,(function(t,r){return t.getInputField().spellcheck=r}),!0),option("autocorrect",!1,(function(t,r){return t.getInputField().autocorrect=r}),!0),option("autocapitalize",!1,(function(t,r){return t.getInputField().autocapitalize=r}),!0),option("rtlMoveVisually",!ee),option("wholeLineUpdateBefore",!0),option("theme","default",(function(t){themeChanged(t),updateGutters(t)}),!0),option("keyMap","default",(function(t,r,a){var l=getKeyMap(r),S=a!=Qe&&getKeyMap(a);S&&S.detach&&S.detach(t,l),l.attach&&l.attach(t,S||null)})),option("extraKeys",null),option("configureMouse",null),option("lineWrapping",!1,wrappingChanged,!0),option("gutters",[],(function(t,r){t.display.gutterSpecs=getGutters(r,t.options.lineNumbers),updateGutters(t)}),!0),option("fixedGutter",!0,(function(t,r){t.display.gutters.style.left=r?compensateForHScroll(t.display)+"px":"0",t.refresh()}),!0),option("coverGutterNextToScrollbar",!1,(function(t){return updateScrollbars(t)}),!0),option("scrollbarStyle","native",(function(t){initScrollbars(t),updateScrollbars(t),t.display.scrollbars.setScrollTop(t.doc.scrollTop),t.display.scrollbars.setScrollLeft(t.doc.scrollLeft)}),!0),option("lineNumbers",!1,(function(t,r){t.display.gutterSpecs=getGutters(t.options.gutters,r),updateGutters(t)}),!0),option("firstLineNumber",1,updateGutters,!0),option("lineNumberFormatter",(function(t){return t}),updateGutters,!0),option("showCursorWhenSelecting",!1,updateSelection,!0),option("resetSelectionOnContextMenu",!0),option("lineWiseCopyCut",!0),option("pasteLinesPerSelection",!0),option("selectionsMayTouch",!1),option("readOnly",!1,(function(t,r){"nocursor"==r&&(onBlur(t),t.display.input.blur()),t.display.input.readOnlyChanged(r)})),option("screenReaderLabel",null,(function(t,r){r=""===r?null:r,t.display.input.screenReaderLabelChanged(r)})),option("disableInput",!1,(function(t,r){r||t.display.input.reset()}),!0),option("dragDrop",!0,dragDropChanged),option("allowDropFileTypes",null),option("cursorBlinkRate",530),option("cursorScrollMargin",0),option("cursorHeight",1,updateSelection,!0),option("singleCursorHeightPerLine",!0,updateSelection,!0),option("workTime",100),option("workDelay",100),option("flattenSpans",!0,resetModeState,!0),option("addModeClass",!1,resetModeState,!0),option("pollInterval",100),option("undoDepth",200,(function(t,r){return t.doc.history.undoDepth=r})),option("historyEventDelay",1250),option("viewportMargin",10,(function(t){return t.refresh()}),!0),option("maxHighlightLength",1e4,resetModeState,!0),option("moveInputWithCursor",!0,(function(t,r){r||t.display.input.resetPosition()})),option("tabindex",null,(function(t,r){return t.display.input.getField().tabIndex=r||""})),option("autofocus",null),option("direction","ltr",(function(t,r){return t.doc.setDirection(r)}),!0),option("phrases",null)}(CodeMirror),function addEditorMethods(t){var r=t.optionHandlers,a=t.helpers={};t.prototype={constructor:t,focus:function(){window.focus(),this.display.input.focus()},setOption:function(t,a){var l=this.options,S=l[t];l[t]==a&&"mode"!=t||(l[t]=a,r.hasOwnProperty(t)&&operation(this,r[t])(this,a,S),signal(this,"optionChange",this,t))},getOption:function(t){return this.options[t]},getDoc:function(){return this.doc},addKeyMap:function(t,r){this.state.keyMaps[r?"push":"unshift"](getKeyMap(t))},removeKeyMap:function(t){for(var r=this.state.keyMaps,a=0;a<r.length;++a)if(r[a]==t||r[a].name==t)return r.splice(a,1),!0},addOverlay:methodOp((function(r,a){var l=r.token?r:t.getMode(this.options,r);if(l.startState)throw new Error("Overlays may not be stateful.");!function insertSorted(t,r,a){for(var l=0,S=a(r);l<t.length&&a(t[l])<=S;)l++;t.splice(l,0,r)}(this.state.overlays,{mode:l,modeSpec:r,opaque:a&&a.opaque,priority:a&&a.priority||0},(function(t){return t.priority})),this.state.modeGen++,regChange(this)})),removeOverlay:methodOp((function(t){for(var r=this.state.overlays,a=0;a<r.length;++a){var l=r[a].modeSpec;if(l==t||"string"==typeof t&&l.name==t)return r.splice(a,1),this.state.modeGen++,void regChange(this)}})),indentLine:methodOp((function(t,r,a){"string"!=typeof r&&"number"!=typeof r&&(r=null==r?this.options.smartIndent?"smart":"prev":r?"add":"subtract"),isLine(this.doc,t)&&indentLine(this,t,r,a)})),indentSelection:methodOp((function(t){for(var r=this.doc.sel.ranges,a=-1,l=0;l<r.length;l++){var S=r[l];if(S.empty())S.head.line>a&&(indentLine(this,S.head.line,t,!0),a=S.head.line,l==this.doc.sel.primIndex&&ensureCursorVisible(this));else{var O=S.from(),T=S.to(),L=Math.max(a,O.line);a=Math.min(this.lastLine(),T.line-(T.ch?0:1))+1;for(var E=L;E<a;++E)indentLine(this,E,t);var D=this.doc.sel.ranges;0==O.ch&&r.length==D.length&&D[l].from().ch>0&&replaceOneSelection(this.doc,l,new Range(O,D[l].to()),ae)}}})),getTokenAt:function(t,r){return takeToken(this,t,r)},getLineTokens:function(t,r){return takeToken(this,Pos(t),r,!0)},getTokenTypeAt:function(t){t=clipPos(this.doc,t);var r,a=getLineStyles(this,getLine(this.doc,t.line)),l=0,S=(a.length-1)/2,O=t.ch;if(0==O)r=a[2];else for(;;){var T=l+S>>1;if((T?a[2*T-1]:0)>=O)S=T;else{if(!(a[2*T+1]<O)){r=a[2*T+2];break}l=T+1}}var L=r?r.indexOf("overlay "):-1;return L<0?r:0==L?null:r.slice(0,L-1)},getModeAt:function(r){var a=this.doc.mode;return a.innerMode?t.innerMode(a,this.getTokenAt(r).state).mode:a},getHelper:function(t,r){return this.getHelpers(t,r)[0]},getHelpers:function(t,r){var l=[];if(!a.hasOwnProperty(r))return l;var S=a[r],O=this.getModeAt(t);if("string"==typeof O[r])S[O[r]]&&l.push(S[O[r]]);else if(O[r])for(var T=0;T<O[r].length;T++){var L=S[O[r][T]];L&&l.push(L)}else O.helperType&&S[O.helperType]?l.push(S[O.helperType]):S[O.name]&&l.push(S[O.name]);for(var E=0;E<S._global.length;E++){var D=S._global[E];D.pred(O,this)&&-1==indexOf(l,D.val)&&l.push(D.val)}return l},getStateAfter:function(t,r){var a=this.doc;return getContextBefore(this,(t=clipLine(a,null==t?a.first+a.size-1:t))+1,r).state},cursorCoords:function(t,r){var a=this.doc.sel.primary();return cursorCoords(this,null==t?a.head:"object"==typeof t?clipPos(this.doc,t):t?a.from():a.to(),r||"page")},charCoords:function(t,r){return charCoords(this,clipPos(this.doc,t),r||"page")},coordsChar:function(t,r){return coordsChar(this,(t=fromCoordSystem(this,t,r||"page")).left,t.top)},lineAtHeight:function(t,r){return t=fromCoordSystem(this,{top:t,left:0},r||"page").top,lineAtHeight(this.doc,t+this.display.viewOffset)},heightAtLine:function(t,r,a){var l,S=!1;if("number"==typeof t){var O=this.doc.first+this.doc.size-1;t<this.doc.first?t=this.doc.first:t>O&&(t=O,S=!0),l=getLine(this.doc,t)}else l=t;return intoCoordSystem(this,l,{top:0,left:0},r||"page",a||S).top+(S?this.doc.height-heightAtLine(l):0)},defaultTextHeight:function(){return textHeight(this.display)},defaultCharWidth:function(){return charWidth(this.display)},getViewport:function(){return{from:this.display.viewFrom,to:this.display.viewTo}},addWidget:function(t,r,a,l,S){var O=this.display,T=(t=cursorCoords(this,clipPos(this.doc,t))).bottom,L=t.left;if(r.style.position="absolute",r.setAttribute("cm-ignore-events","true"),this.display.input.setUneditable(r),O.sizer.appendChild(r),"over"==l)T=t.top;else if("above"==l||"near"==l){var E=Math.max(O.wrapper.clientHeight,this.doc.height),D=Math.max(O.sizer.clientWidth,O.lineSpace.clientWidth);("above"==l||t.bottom+r.offsetHeight>E)&&t.top>r.offsetHeight?T=t.top-r.offsetHeight:t.bottom+r.offsetHeight<=E&&(T=t.bottom),L+r.offsetWidth>D&&(L=D-r.offsetWidth)}r.style.top=T+"px",r.style.left=r.style.right="","right"==S?(L=O.sizer.clientWidth-r.offsetWidth,r.style.right="0px"):("left"==S?L=0:"middle"==S&&(L=(O.sizer.clientWidth-r.offsetWidth)/2),r.style.left=L+"px"),a&&function scrollIntoView(t,r){var a=calculateScrollPos(t,r);null!=a.scrollTop&&updateScrollTop(t,a.scrollTop),null!=a.scrollLeft&&setScrollLeft(t,a.scrollLeft)}(this,{left:L,top:T,right:L+r.offsetWidth,bottom:T+r.offsetHeight})},triggerOnKeyDown:methodOp(onKeyDown),triggerOnKeyPress:methodOp(onKeyPress),triggerOnKeyUp:onKeyUp,triggerOnMouseDown:methodOp(onMouseDown),execCommand:function(t){if(Ke.hasOwnProperty(t))return Ke[t].call(null,this)},triggerElectric:methodOp((function(t){triggerElectric(this,t)})),findPosH:function(t,r,a,l){var S=1;r<0&&(S=-1,r=-r);for(var O=clipPos(this.doc,t),T=0;T<r&&!(O=findPosH(this.doc,O,S,a,l)).hitSide;++T);return O},moveH:methodOp((function(t,r){var a=this;this.extendSelectionsBy((function(l){return a.display.shift||a.doc.extend||l.empty()?findPosH(a.doc,l.head,t,r,a.options.rtlMoveVisually):t<0?l.from():l.to()}),le)})),deleteH:methodOp((function(t,r){var a=this.doc.sel,l=this.doc;a.somethingSelected()?l.replaceSelection("",null,"+delete"):deleteNearSelection(this,(function(a){var S=findPosH(l,a.head,t,r,!1);return t<0?{from:S,to:a.head}:{from:a.head,to:S}}))})),findPosV:function(t,r,a,l){var S=1,O=l;r<0&&(S=-1,r=-r);for(var T=clipPos(this.doc,t),L=0;L<r;++L){var E=cursorCoords(this,T,"div");if(null==O?O=E.left:E.left=O,(T=findPosV(this,E,S,a)).hitSide)break}return T},moveV:methodOp((function(t,r){var a=this,l=this.doc,S=[],O=!this.display.shift&&!l.extend&&l.sel.somethingSelected();if(l.extendSelectionsBy((function(T){if(O)return t<0?T.from():T.to();var L=cursorCoords(a,T.head,"div");null!=T.goalColumn&&(L.left=T.goalColumn),S.push(L.left);var E=findPosV(a,L,t,r);return"page"==r&&T==l.sel.primary()&&addToScrollTop(a,charCoords(a,E,"div").top-L.top),E}),le),S.length)for(var T=0;T<l.sel.ranges.length;T++)l.sel.ranges[T].goalColumn=S[T]})),findWordAt:function(t){var r=getLine(this.doc,t.line).text,a=t.ch,l=t.ch;if(r){var S=this.getHelper(t,"wordChars");"before"!=t.sticky&&l!=r.length||!a?++l:--a;for(var O=r.charAt(a),T=isWordChar(O,S)?function(t){return isWordChar(t,S)}:/\s/.test(O)?function(t){return/\s/.test(t)}:function(t){return!/\s/.test(t)&&!isWordChar(t)};a>0&&T(r.charAt(a-1));)--a;for(;l<r.length&&T(r.charAt(l));)++l}return new Range(Pos(t.line,a),Pos(t.line,l))},toggleOverwrite:function(t){null!=t&&t==this.state.overwrite||((this.state.overwrite=!this.state.overwrite)?addClass(this.display.cursorDiv,"CodeMirror-overwrite"):rmClass(this.display.cursorDiv,"CodeMirror-overwrite"),signal(this,"overwriteToggle",this,this.state.overwrite))},hasFocus:function(){return this.display.input.getField()==activeElt()},isReadOnly:function(){return!(!this.options.readOnly&&!this.doc.cantEdit)},scrollTo:methodOp((function(t,r){scrollToCoords(this,t,r)})),getScrollInfo:function(){var t=this.display.scroller;return{left:t.scrollLeft,top:t.scrollTop,height:t.scrollHeight-scrollGap(this)-this.display.barHeight,width:t.scrollWidth-scrollGap(this)-this.display.barWidth,clientHeight:displayHeight(this),clientWidth:displayWidth(this)}},scrollIntoView:methodOp((function(t,r){null==t?(t={from:this.doc.sel.primary().head,to:null},null==r&&(r=this.options.cursorScrollMargin)):"number"==typeof t?t={from:Pos(t,0),to:null}:null==t.from&&(t={from:t,to:null}),t.to||(t.to=t.from),t.margin=r||0,null!=t.from.line?function scrollToRange(t,r){resolveScrollToPos(t),t.curOp.scrollToPos=r}(this,t):scrollToCoordsRange(this,t.from,t.to,t.margin)})),setSize:methodOp((function(t,r){var a=this,interpret=function(t){return"number"==typeof t||/^\d+$/.test(String(t))?t+"px":t};null!=t&&(this.display.wrapper.style.width=interpret(t)),null!=r&&(this.display.wrapper.style.height=interpret(r)),this.options.lineWrapping&&clearLineMeasurementCache(this);var l=this.display.viewFrom;this.doc.iter(l,this.display.viewTo,(function(t){if(t.widgets)for(var r=0;r<t.widgets.length;r++)if(t.widgets[r].noHScroll){regLineChange(a,l,"widget");break}++l})),this.curOp.forceUpdate=!0,signal(this,"refresh",this)})),operation:function(t){return runInOp(this,t)},startOperation:function(){return startOperation(this)},endOperation:function(){return endOperation(this)},refresh:methodOp((function(){var t=this.display.cachedTextHeight;regChange(this),this.curOp.forceUpdate=!0,clearCaches(this),scrollToCoords(this,this.doc.scrollLeft,this.doc.scrollTop),updateGutterSpace(this.display),(null==t||Math.abs(t-textHeight(this.display))>.5||this.options.lineWrapping)&&estimateLineHeights(this),signal(this,"refresh",this)})),swapDoc:methodOp((function(t){var r=this.doc;return r.cm=null,this.state.selectingText&&this.state.selectingText(),attachDoc(this,t),clearCaches(this),this.display.input.reset(),scrollToCoords(this,t.scrollLeft,t.scrollTop),this.curOp.forceScroll=!0,signalLater(this,"swapDoc",this,r),r})),phrase:function(t){var r=this.options.phrases;return r&&Object.prototype.hasOwnProperty.call(r,t)?r[t]:t},getInputField:function(){return this.display.input.getField()},getWrapperElement:function(){return this.display.wrapper},getScrollerElement:function(){return this.display.scroller},getGutterElement:function(){return this.display.gutters}},eventMixin(t),t.registerHelper=function(r,l,S){a.hasOwnProperty(r)||(a[r]=t[r]={_global:[]}),a[r][l]=S},t.registerGlobalHelper=function(r,l,S,O){t.registerHelper(r,l,O),a[r]._global.push({pred:S,val:O})}}(CodeMirror);var rt="iter insert remove copy getEditor constructor".split(" ");for(var ot in Doc.prototype)Doc.prototype.hasOwnProperty(ot)&&indexOf(rt,ot)<0&&(CodeMirror.prototype[ot]=function(t){return function(){return t.apply(this.doc,arguments)}}(Doc.prototype[ot]));return eventMixin(Doc),CodeMirror.inputStyles={textarea:TextareaInput,contenteditable:ContentEditableInput},CodeMirror.defineMode=function(t){CodeMirror.defaults.mode||"null"==t||(CodeMirror.defaults.mode=t),defineMode.apply(this,arguments)},CodeMirror.defineMIME=function defineMIME(t,r){xe[t]=r},CodeMirror.defineMode("null",(function(){return{token:function(t){return t.skipToEnd()}}})),CodeMirror.defineMIME("text/plain","null"),CodeMirror.defineExtension=function(t,r){CodeMirror.prototype[t]=r},CodeMirror.defineDocExtension=function(t,r){Doc.prototype[t]=r},CodeMirror.fromTextArea=function fromTextArea(t,r){if((r=r?copyObj(r):{}).value=t.value,!r.tabindex&&t.tabIndex&&(r.tabindex=t.tabIndex),!r.placeholder&&t.placeholder&&(r.placeholder=t.placeholder),null==r.autofocus){var a=activeElt();r.autofocus=a==t||null!=t.getAttribute("autofocus")&&a==document.body}function save(){t.value=T.getValue()}var l;if(t.form&&(on(t.form,"submit",save),!r.leaveSubmitMethodAlone)){var S=t.form;l=S.submit;try{var O=S.submit=function(){save(),S.submit=l,S.submit(),S.submit=O}}catch(t){}}r.finishInit=function(a){a.save=save,a.getTextArea=function(){return t},a.toTextArea=function(){a.toTextArea=isNaN,save(),t.parentNode.removeChild(a.getWrapperElement()),t.style.display="",t.form&&(off(t.form,"submit",save),r.leaveSubmitMethodAlone||"function"!=typeof t.form.submit||(t.form.submit=l))}},t.style.display="none";var T=CodeMirror((function(r){return t.parentNode.insertBefore(r,t.nextSibling)}),r);return T},function addLegacyProps(t){t.off=off,t.on=on,t.wheelEventPixels=wheelEventPixels,t.Doc=Doc,t.splitLines=be,t.countColumn=countColumn,t.findColumn=findColumn,t.isWordChar=isWordCharBasic,t.Pass=ie,t.signal=signal,t.Line=Line,t.changeEnd=changeEnd,t.scrollbarModel=Re,t.Pos=Pos,t.cmpPos=cmp,t.modes=Se,t.mimeModes=xe,t.resolveMode=resolveMode,t.getMode=getMode,t.modeExtensions=Oe,t.extendMode=extendMode,t.copyState=copyState,t.startState=startState,t.innerMode=innerMode,t.commands=Ke,t.keyMap=Ge,t.keyName=keyName,t.isModifierKey=isModifierKey,t.lookupKey=lookupKey,t.normalizeKeyMap=normalizeKeyMap,t.StringStream=StringStream,t.SharedTextMarker=SharedTextMarker,t.TextMarker=TextMarker,t.LineWidget=LineWidget,t.e_preventDefault=e_preventDefault,t.e_stopPropagation=e_stopPropagation,t.e_stop=e_stop,t.addClass=addClass,t.contains=contains,t.rmClass=rmClass,t.keyNames=Ve}(CodeMirror),CodeMirror.version="5.61.0",CodeMirror}()},247:function(t,r,a){const l=a(0);t.exports=function(t){var r={};function n(a){if(r[a])return r[a].exports;var l=r[a]={i:a,l:!1,exports:{}};return t[a].call(l.exports,l,l.exports,n),l.l=!0,l.exports}return n.m=t,n.c=r,n.d=function(t,r,a){n.o(t,r)||Object.defineProperty(t,r,{enumerable:!0,get:a})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,r){if(1&r&&(t=n(t)),8&r)return t;if(4&r&&"object"==typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&r&&"string"!=typeof t)for(var l in t)n.d(a,l,function(r){return t[r]}.bind(null,l));return a},n.n=function(t){var r=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(r,"a",r),r},n.o=function(t,r){return Object.prototype.hasOwnProperty.call(t,r)},n.p="",n(n.s=0)}([function(t,r,a){"use strict";var S;function o(t){return["image/png","image/jpeg","image/gif"].some((function(r){return r===t}))}function u(t,r,a){return void 0===r&&(r=.92),void 0===a&&(a=S.JPEG),function(t,r,a,l){return new(a||(a=Promise))((function(S,O){function i(t){try{c(l.next(t))}catch(t){O(t)}}function u(t){try{c(l.throw(t))}catch(t){O(t)}}function c(t){var r;t.done?S(t.value):(r=t.value,r instanceof a?r:new a((function(t){t(r)}))).then(i,u)}c((l=l.apply(t,r||[])).next())}))}(this,void 0,void 0,(function(){return function(t,r){var a,l,S,O,T={label:0,sent:function(){if(1&S[0])throw S[1];return S[1]},trys:[],ops:[]};return O={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(O[Symbol.iterator]=function(){return this}),O;function u(O){return function(L){return function(O){if(a)throw new TypeError("Generator is already executing.");for(;T;)try{if(a=1,l&&(S=2&O[0]?l.return:O[0]?l.throw||((S=l.return)&&S.call(l),0):l.next)&&!(S=S.call(l,O[1])).done)return S;switch(l=0,S&&(O=[2&O[0],S.value]),O[0]){case 0:case 1:S=O;break;case 4:return T.label++,{value:O[1],done:!1};case 5:T.label++,l=O[1],O=[0];continue;case 7:O=T.ops.pop(),T.trys.pop();continue;default:if(!((S=(S=T.trys).length>0&&S[S.length-1])||6!==O[0]&&2!==O[0])){T=0;continue}if(3===O[0]&&(!S||O[1]>S[0]&&O[1]<S[3])){T.label=O[1];break}if(6===O[0]&&T.label<S[1]){T.label=S[1],S=O;break}if(S&&T.label<S[2]){T.label=S[2],T.ops.push(O);break}S[2]&&T.ops.pop(),T.trys.pop();continue}O=r.call(t,T)}catch(t){O=[6,t],l=0}finally{a=S=0}if(5&O[0])throw O[1];return{value:O[0]?O[1]:void 0,done:!0}}([O,L])}}}(this,(function(l){return o(a)||(a=S.JPEG),[2,t.toDataURL(a,r)]}))}))}function c(t,r,a){return void 0===r&&(r=.92),void 0===a&&(a=S.JPEG),new Promise((function(l){return t.toBlob((function(t){return l(t)}),a,r)}))}function f(t,r){return function(t,r,a,l){return new(a||(a=Promise))((function(S,O){function i(t){try{c(l.next(t))}catch(t){O(t)}}function u(t){try{c(l.throw(t))}catch(t){O(t)}}function c(t){var r;t.done?S(t.value):(r=t.value,r instanceof a?r:new a((function(t){t(r)}))).then(i,u)}c((l=l.apply(t,r||[])).next())}))}(this,void 0,void 0,(function(){var a,l,S,O,T;return function(t,r){var a,l,S,O,T={label:0,sent:function(){if(1&S[0])throw S[1];return S[1]},trys:[],ops:[]};return O={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(O[Symbol.iterator]=function(){return this}),O;function u(O){return function(L){return function(O){if(a)throw new TypeError("Generator is already executing.");for(;T;)try{if(a=1,l&&(S=2&O[0]?l.return:O[0]?l.throw||((S=l.return)&&S.call(l),0):l.next)&&!(S=S.call(l,O[1])).done)return S;switch(l=0,S&&(O=[2&O[0],S.value]),O[0]){case 0:case 1:S=O;break;case 4:return T.label++,{value:O[1],done:!1};case 5:T.label++,l=O[1],O=[0];continue;case 7:O=T.ops.pop(),T.trys.pop();continue;default:if(!((S=(S=T.trys).length>0&&S[S.length-1])||6!==O[0]&&2!==O[0])){T=0;continue}if(3===O[0]&&(!S||O[1]>S[0]&&O[1]<S[3])){T.label=O[1];break}if(6===O[0]&&T.label<S[1]){T.label=S[1],S=O;break}if(S&&T.label<S[2]){T.label=S[2],T.ops.push(O);break}S[2]&&T.ops.pop(),T.trys.pop();continue}O=r.call(t,T)}catch(t){O=[6,t],l=0}finally{a=S=0}if(5&O[0])throw O[1];return{value:O[0]?O[1]:void 0,done:!0}}([O,L])}}}(this,(function(L){for(a=t.split(","),l=a[0].match(/:(.*?);/)[1],S=atob(a[1]),O=S.length,T=new Uint8Array(O);O--;)T[O]=S.charCodeAt(O);return o(r)&&(l=r),[2,new Blob([T],{type:l})]}))}))}function h(t){return new Promise((function(r,a){var l=new Image;l.onload=function(){return r(l)},l.onerror=function(){return a(new Error("dataURLtoImage(): dataURL is illegal"))},l.src=t}))}function d(t,r){var a=document.createElement("a");a.href=window.URL.createObjectURL(t),a.download=r||Date.now().toString(36),document.body.appendChild(a);var l=document.createEvent("MouseEvents");l.initEvent("click",!1,!1),a.dispatchEvent(l),document.body.removeChild(a)}function p(t){return new Promise((function(r){var a=new FileReader;a.onloadend=function(t){return r(t.target.result)},a.readAsDataURL(t)}))}a.r(r),a.d(r,"canvastoDataURL",(function(){return u})),a.d(r,"canvastoFile",(function(){return c})),a.d(r,"dataURLtoFile",(function(){return f})),a.d(r,"dataURLtoImage",(function(){return h})),a.d(r,"downloadFile",(function(){return d})),a.d(r,"filetoDataURL",(function(){return p})),a.d(r,"imagetoCanvas",(function(){return g})),a.d(r,"urltoBlob",(function(){return v})),a.d(r,"urltoImage",(function(){return m})),a.d(r,"compress",(function(){return k})),a.d(r,"compressAccurately",(function(){return I})),a.d(r,"EImageType",(function(){return S})),function(t){t.PNG="image/png",t.JPEG="image/jpeg",t.GIF="image/gif"}(S||(S={}));var b=function(){return(b=l.extend||function(t){for(var r,a=1,l=arguments.length;a<l;a++)for(var S in r=arguments[a])Object.prototype.hasOwnProperty.call(r,S)&&(t[S]=r[S]);return t}).apply(this,arguments)};function g(t,r){return void 0===r&&(r={}),function(t,r,a,l){return new(a||(a=Promise))((function(S,O){function i(t){try{c(l.next(t))}catch(t){O(t)}}function u(t){try{c(l.throw(t))}catch(t){O(t)}}function c(t){var r;t.done?S(t.value):(r=t.value,r instanceof a?r:new a((function(t){t(r)}))).then(i,u)}c((l=l.apply(t,r||[])).next())}))}(this,void 0,void 0,(function(){var a,l,S,O,T,L,E;return function(t,r){var a,l,S,O,T={label:0,sent:function(){if(1&S[0])throw S[1];return S[1]},trys:[],ops:[]};return O={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(O[Symbol.iterator]=function(){return this}),O;function u(O){return function(L){return function(O){if(a)throw new TypeError("Generator is already executing.");for(;T;)try{if(a=1,l&&(S=2&O[0]?l.return:O[0]?l.throw||((S=l.return)&&S.call(l),0):l.next)&&!(S=S.call(l,O[1])).done)return S;switch(l=0,S&&(O=[2&O[0],S.value]),O[0]){case 0:case 1:S=O;break;case 4:return T.label++,{value:O[1],done:!1};case 5:T.label++,l=O[1],O=[0];continue;case 7:O=T.ops.pop(),T.trys.pop();continue;default:if(!((S=(S=T.trys).length>0&&S[S.length-1])||6!==O[0]&&2!==O[0])){T=0;continue}if(3===O[0]&&(!S||O[1]>S[0]&&O[1]<S[3])){T.label=O[1];break}if(6===O[0]&&T.label<S[1]){T.label=S[1],S=O;break}if(S&&T.label<S[2]){T.label=S[2],T.ops.push(O);break}S[2]&&T.ops.pop(),T.trys.pop();continue}O=r.call(t,T)}catch(t){O=[6,t],l=0}finally{a=S=0}if(5&O[0])throw O[1];return{value:O[0]?O[1]:void 0,done:!0}}([O,L])}}}(this,(function(D){for(L in a=b({},r),l=document.createElement("canvas"),S=l.getContext("2d"),a)Object.prototype.hasOwnProperty.call(a,L)&&(a[L]=Number(a[L]));switch(a.scale?(E=a.scale>0&&a.scale<10?a.scale:1,T=t.width*E,O=t.height*E):(T=a.width||a.height*t.width/t.height||t.width,O=a.height||a.width*t.height/t.width||t.height),[5,6,7,8].some((function(t){return t===a.orientation}))?(l.height=T,l.width=O):(l.height=O,l.width=T),a.orientation){case 3:S.rotate(180*Math.PI/180),S.drawImage(t,-l.width,-l.height,l.width,l.height);break;case 6:S.rotate(90*Math.PI/180),S.drawImage(t,0,-l.width,l.height,l.width);break;case 8:S.rotate(270*Math.PI/180),S.drawImage(t,-l.height,0,l.height,l.width);break;case 2:S.translate(l.width,0),S.scale(-1,1),S.drawImage(t,0,0,l.width,l.height);break;case 4:S.translate(l.width,0),S.scale(-1,1),S.rotate(180*Math.PI/180),S.drawImage(t,-l.width,-l.height,l.width,l.height);break;case 5:S.translate(l.width,0),S.scale(-1,1),S.rotate(90*Math.PI/180),S.drawImage(t,0,-l.width,l.height,l.width);break;case 7:S.translate(l.width,0),S.scale(-1,1),S.rotate(270*Math.PI/180),S.drawImage(t,-l.height,0,l.height,l.width);break;default:S.drawImage(t,0,0,l.width,l.height)}return[2,l]}))}))}function v(t){return fetch(t).then((function(t){return t.blob()}))}function m(t){return new Promise((function(r,a){var l=new Image;l.onload=function(){return r(l)},l.onerror=function(){return a(new Error("urltoImage(): Image failed to load, please check the image URL"))},l.src=t}))}var x=function(t,r,a,l){return new(a||(a=Promise))((function(S,O){function i(t){try{c(l.next(t))}catch(t){O(t)}}function u(t){try{c(l.throw(t))}catch(t){O(t)}}function c(t){var r;t.done?S(t.value):(r=t.value,r instanceof a?r:new a((function(t){t(r)}))).then(i,u)}c((l=l.apply(t,r||[])).next())}))},P=function(t,r){var a,l,S,O,T={label:0,sent:function(){if(1&S[0])throw S[1];return S[1]},trys:[],ops:[]};return O={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(O[Symbol.iterator]=function(){return this}),O;function u(O){return function(L){return function(O){if(a)throw new TypeError("Generator is already executing.");for(;T;)try{if(a=1,l&&(S=2&O[0]?l.return:O[0]?l.throw||((S=l.return)&&S.call(l),0):l.next)&&!(S=S.call(l,O[1])).done)return S;switch(l=0,S&&(O=[2&O[0],S.value]),O[0]){case 0:case 1:S=O;break;case 4:return T.label++,{value:O[1],done:!1};case 5:T.label++,l=O[1],O=[0];continue;case 7:O=T.ops.pop(),T.trys.pop();continue;default:if(!((S=(S=T.trys).length>0&&S[S.length-1])||6!==O[0]&&2!==O[0])){T=0;continue}if(3===O[0]&&(!S||O[1]>S[0]&&O[1]<S[3])){T.label=O[1];break}if(6===O[0]&&T.label<S[1]){T.label=S[1],S=O;break}if(S&&T.label<S[2]){T.label=S[2],T.ops.push(O);break}S[2]&&T.ops.pop(),T.trys.pop();continue}O=r.call(t,T)}catch(t){O=[6,t],l=0}finally{a=S=0}if(5&O[0])throw O[1];return{value:O[0]?O[1]:void 0,done:!0}}([O,L])}}};function k(t,r){return void 0===r&&(r={}),x(this,void 0,void 0,(function(){var a,O,T,L;return P(this,(function(E){switch(E.label){case 0:if(!(t instanceof Blob))throw new Error("compress(): First arg must be a Blob object or a File object.");return"object"!=typeof r&&(r=l.extend({quality:r})),r.quality=Number(r.quality),l.isNaN(r.quality)?[2,t]:[4,p(t)];case 1:return a=E.sent(),O=a.split(",")[0].match(/:(.*?);/)[1],T=S.JPEG,o(r.type)&&(T=r.type,O=r.type),[4,h(a)];case 2:return[4,g(E.sent(),l.extend({},r))];case 3:return[4,u(E.sent(),r.quality,T)];case 4:return[4,f(E.sent(),O)];case 5:return(L=E.sent()).size>t.size?[2,t]:[2,L]}}))}))}function I(t,r){return void 0===r&&(r={}),x(this,void 0,void 0,(function(){var a,O,T,L,E,D,j,V,B,q,G,K;return P(this,(function(X){switch(X.label){case 0:if(!(t instanceof Blob))throw new Error("compressAccurately(): First arg must be a Blob object or a File object.");return"object"!=typeof r&&(r=l.extend({size:r})),r.size=Number(r.size),l.isNaN(r.size)||1024*r.size>t.size?[2,t]:(r.accuracy=Number(r.accuracy),(!r.accuracy||r.accuracy<.8||r.accuracy>.99)&&(r.accuracy=.95),a={max:r.size*(2-r.accuracy)*1024,accurate:1024*r.size,min:r.size*r.accuracy*1024},[4,p(t)]);case 1:return O=X.sent(),T=O.split(",")[0].match(/:(.*?);/)[1],L=S.JPEG,o(r.type)&&(L=r.type,T=r.type),[4,h(O)];case 2:return[4,g(X.sent(),l.extend({},r))];case 3:E=X.sent(),D=.75,j=.5,B=[null,null],q=1,X.label=4;case 4:return q<=7?[4,u(E,j,L)]:[3,7];case 5:if(V=X.sent(),G=V.length*D,7===q)return(a.max<G||a.min>G)&&(V=function(){for(var t=0,r=0,a=arguments.length;r<a;r++)t+=arguments[r].length;var l=Array(t),S=0;for(r=0;r<a;r++)for(var O=arguments[r],T=0,L=O.length;T<L;T++,S++)l[S]=O[T];return l}([V],B).filter((function(t){return t})).sort((function(t,r){return Math.abs(t.length*D-a.accurate)-Math.abs(r.length*D-a.accurate)}))[0]),[3,7];if(a.max<G)B[1]=V,j-=Math.pow(.5,q+1);else{if(!(a.min>G))return[3,7];B[0]=V,j+=Math.pow(.5,q+1)}X.label=6;case 6:return q++,[3,4];case 7:return[4,f(V,T)];case 8:return(K=X.sent()).size>t.size?[2,t]:[2,K]}}))}))}}])},250:function(module,exports,__webpack_require__){var _=__webpack_require__(0);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="lrn_cloze_response_container">'+(null==(__t="clozeassociation"==displayLogic.questiontype?'<div class="lrn_response_input_wrapper lrn-response-validate-wrapper">':"")?"":__t)+(null==(__t="imageclozeassociation"==displayLogic.questiontype?'<div class="lrn_response_input_wrapper lrn_response_input_wrapper_left lrn-response-validate-wrapper">':"")?"":__t)+'<div class="lrn_response_innerbody '+(null==(__t="imageclozeassociation"!=displayLogic.questiontype&&"clozeassociation"!=displayLogic.questiontype?"lrn-response-validate-wrapper":"")?"":__t)+'">',_.isUndefined(displayLogic.possibilityListPosition)||"top"!==displayLogic.possibilityListPosition&&"left"!==displayLogic.possibilityListPosition||(__p+="",displayLogic.extraContentHTML&&(__p+=""+(null==(__t=displayLogic.extraContentHTML)?"":__t)),__p+=""),__p+="",_.isUndefined(displayLogic.possibilityListPosition)||"left"!==displayLogic.possibilityListPosition&&"right"!==displayLogic.possibilityListPosition||(__p+='<div class="lrn_response_input_position">'),__p+='<div class="lrn_response_input lrn_response_math'+(null==(__t=displayLogic.hasBoostedFont?" lrn_response_font_boost":"")?"":__t)+'" aria-label="'+(null==(__t=displayLogic.questionText)?"":_.escape(__t))+'">'+(null==(__t=displayLogic.processedTemplate)?"":__t)+"</div>",_.isUndefined(displayLogic.possibilityListPosition)||"left"!==displayLogic.possibilityListPosition&&"right"!==displayLogic.possibilityListPosition||(__p+="</div>"),__p+="",(_.isUndefined(displayLogic.possibilityListPosition)||_.isNull(displayLogic.possibilityListPosition)||"bottom"===displayLogic.possibilityListPosition||"right"===displayLogic.possibilityListPosition)&&(__p+="",displayLogic.extraContentHTML&&(__p+=""+(null==(__t=displayLogic.extraContentHTML)?"":__t)),__p+=""),__p+="</div>"+(null==(__t="imageclozeassociation"==displayLogic.questiontype||"clozeassociation"==displayLogic.questiontype?"</div>":"")?"":__t)+'</div><div class="lrn_correctAnswers lrn_hide"><span>'+(null==(__t=labels.correctAnswers)?"":__t)+':</span><ul class="lrn_correctAnswerList"></ul></div>',displayLogic.showValidationButton&&(__p+='<button type="button" '+(null==(__t=displayLogic.readOnly?'disabled="disabled"':"")?"":__t)+' class="lrn_btn lrn_validate"><span>'+(null==(__t=displayLogic.multipleResponses?labels.checkAnswers:labels.checkAnswer)?"":__t)+"</span></button>"),__p+="";return __p}},251:function(module,exports,__webpack_require__){var _=__webpack_require__(0);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="",displayLogic.showInputUi&&(__p+='<div class="lrn_input_ui">\x3c!-- Keyboard --\x3e</div>'),__p+="";return __p}},252:function(module,exports,__webpack_require__){var _=__webpack_require__(0);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<span data-lrn-access-review-dest class="lrn_textinput lrn-clozeformula-input lrn_cloze_response '+(null==(__t=displayLogic.readOnly?" lrn_disabled":"")?"":__t)+'"data-inputid="'+(null==(__t=displayLogic.inputId)?"":__t)+'"',(displayLogic.responseContainer.hasOwnProperty("width")||displayLogic.responseContainer.hasOwnProperty("height"))&&(__p+='style="',displayLogic.responseContainer.width&&(__p+="min-width: "+(null==(__t=displayLogic.responseContainer.width)?"":__t)+";"),displayLogic.responseContainer.height&&(__p+="min-height: "+(null==(__t=displayLogic.responseContainer.height)?"":__t)+";"),__p+='"'),__p+="></span>";return __p}},261:function(t,r,a){"use strict";a(1);var l=a(0),S=a.n(l),O=a(8),T=a(215),L=O.a.extend({DEFAULT_FORMATTING_OPTIONS:["bold","italic","underline","|","unorderedList","orderedList"],SHOW_WORD_LIMITS:{ALWAYS:"always",ON:"on-limit",OFF:"off"},MAX_WORD_LENGTH:1e4,MAX_CHARACTER_LENGTH:1e5,processResponseValue:function processResponseValue(t){this.hasResponse()||this.set({response:{value:"",wordCount:0,type:this.RESPONSE_TYPE.STRING}},{silent:!0}),this.get("response").value=this.sanitizeValue(t.value),this.get("response").wordCount=t.wordCount},getFormattingOptions:function getFormattingOptions(){if(!this._formattingOptions){var t=this.get("question").formatting_options;S.a.isArray(t)||(t=this.DEFAULT_FORMATTING_OPTIONS);var r=this.getCharacterMap(),a=t.indexOf("charactermap");S.a.isArray(r)||!1!==r?a<0&&t.push("charactermap"):!1===r&&a>=0&&Array.prototype.splice.call(t,a,1),this._formattingOptions=t}return this._formattingOptions},getMaxLength:function getMaxLength(){if(!this._maxLength){var t=this.get("question").max_length;(!S.a.isNumber(t)||t<0||t>this.MAX_WORD_LENGTH)&&(t=this.MAX_WORD_LENGTH),this._maxLength=t}return this._maxLength},getWordCount:function getWordCount(){return this.hasResponse()?this.get("response").wordCount:0},getShowWordCount:function getShowWordCount(){if(S.a.isUndefined(this._showWordCount)){var t=this.get("question").show_word_count;this._showWordCount=!S.a.isBoolean(t)||t}return this._showWordCount},getMaxCharacterLength:function getMaxCharacterLength(){return this.MAX_CHARACTER_LENGTH},getCharacterCount:function getCharacterCount(){if(this.hasResponse()){var t=this.get("response").value;return Object(T.b)(t).length}return 0},characterCountExceeded:function characterCountExceeded(){return this.getCharacterCount()>this.getMaxCharacterLength()},getPlaceholder:function getPlaceholder(){return this.get("question").placeholder},getBrowserSpellCheck:function getBrowserSpellCheck(){if(S.a.isUndefined(this._spellCheck)){var t=this.get("question").spellcheck;this._spellCheck=S.a.isBoolean(t)?t:"false"!==t}return this._spellCheck},disableAutoLink:function disableAutoLink(){return this.activity.get("disable_auto_link")||S.a.getNested(this.get("question"),"disable_auto_link")},getCharacterMap:function getCharacterMap(){if(S.a.isUndefined(this._characterMap)){var t=this.get("question"),r=t.character_map,a=S.a.isArray(t.formatting_options)?t.formatting_options:[],l=(S.a.isUndefined(r)||S.a.isArray(r)&&!r.length)&&a.indexOf("charactermap")>=0;this._characterMap=!!l||!(!S.a.isArray(r)&&!S.a.isBoolean(r))&&r}return this._characterMap},getShowWordLimit:function getShowWordLimit(){if(S.a.isUndefined(this._showWordLimit)){var t=this.get("question").show_word_limit,r=this.SHOW_WORD_LIMITS;this._showWordLimit=S.a.contains(r,t)?t:r.ALWAYS}return this._showWordLimit},getUIStyle:function getUIStyle(){return S.a.isUndefined(this._uiStyle)&&(this._uiStyle=S.a.getNested(this.get("question"),"ui_style")||{}),this._uiStyle},isMaxLengthDefined:function isMaxLengthDefined(){return S.a.isUndefined(this._isMaxLengthDefined)&&(this._isMaxLengthDefined=!!this.get("question").max_length),this._isMaxLengthDefined},wordCountExceeded:function wordCountExceeded(){return this.getWordCount()>this.getMaxLength()},hasAllowedResponse:function hasAllowedResponse(){return!(this.hasResponse()&&!this.get("question").submit_over_limit&&(this.wordCountExceeded()||this.characterCountExceeded()))}});r.a=L},268:function(t,r,a){"use strict";var l=a(0),S=a.n(l),O=a(544),T=a.n(O);function _defineProperties(t,r){for(var a=0;a<r.length;a++){var l=r[a];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(t,l.key,l)}}function _defineProperty(t,r,a){return r in t?Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[r]=a,t}var L=function(){function Fraction(t,r,a){!function _classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,Fraction),this.integer=isNaN(parseFloat(a))?0:parseFloat(a),this.numerator=0,this.denominator=null,(t||r)&&this.set(t,r)}return function _createClass(t,r,a){return r&&_defineProperties(t.prototype,r),a&&_defineProperties(t,a),t}(Fraction,[{key:"normalize",value:function normalize(t){var r,a,l,S,O=this.denominator?this.denominator:1;if(!0===t?(l=this.numerator,S=O):(a=Fraction.gcd(this.numerator,O),l=this.numerator/a,S=O/a),Math.abs(l)>=Math.abs(S)){if(1===S)return this.integer+=l,this.numerator=0,this.denominator=null,this;r=l<0?-Math.floor(-l/S):Math.floor(l/S),this.integer<0?this.integer-=r:this.integer+=r,l-=r*S}return this.set(l,S)}},{key:"clone",value:function clone(){return new Fraction(this)}},{key:"set",value:function set(t,r){if(t instanceof Fraction)this.integer=t.integer,this.numerator=t.numerator,this.denominator=t.denominator;else if(S.a.isUndefined(t)||S.a.isNull(t)||S.a.isUndefined(r)||S.a.isNull(r))if(S.a.isUndefined(r)||S.a.isNull(r))if(S.a.isString(t)){var a=Fraction.IMPROPER_REG_EXP.exec(t),l=Fraction.MIXED_REG_EXP.exec(t);l&&4===l.length?(this.integer=parseInt(l[1],10),this.numerator=parseInt(l[2],10),this.denominator=parseInt(l[3],10)):a&&3===a.length?(this.numerator=parseInt(a[1],10),this.denominator=parseInt(a[2],10)):(this.integer=parseFloat(t),this.numerator=0,this.denominator=null)}else S.a.isNumber(t)?(this.integer=t,this.numerator=0,this.denominator=null):(this.integer=0,this.numerator=0,this.denominator=null);else S.a.isUndefined(r)||S.a.isNull(r)?(this.integer=0,this.numerator=0,this.denominator=null):(this.integer=0,this.numerator=0,(S.a.isNumber(r)||S.a.isString(r))&&(this.denominator=parseInt(r,10),this.denominator||(this.denominator=null)));else(S.a.isNumber(t)||S.a.isString(t))&&(this.numerator=parseInt(t,10)),(S.a.isNumber(r)||S.a.isString(r))&&(this.denominator=parseInt(r,10)),this.denominator||(this.denominator=null);return this.setCorrectSign(),this}},{key:"convertToDenominator",value:function convertToDenominator(t){var r,a,l=this.denominator?this.denominator:1,O=this.numerator,T=this.integer;return S.a.isNumber(t)||(t=(a=new Fraction(t)).denominator?a.denominator:1),S.a.isNumber(t)&&l!==t&&(r=t/l,0===(O=this.numerator*r)&&(O=T*t,T=0)),new Fraction(O,t,T)}},{key:"add",value:function add(t){var r,a,l,S;return t=new Fraction(t),r=this.getImproperFraction(),a=t.getImproperFraction(),l=Fraction.lcm(r.denominator?r.denominator:1,a.denominator?a.denominator:1),(S=new Fraction(l/(r.denominator?r.denominator:1)*r.numerator+l/(a.denominator?a.denominator:1)*a.numerator,l)).normalize(!0),S}},{key:"subtract",value:function subtract(t){return t=new Fraction(t),this.add(t.multiply(-1))}},{key:"inverse",value:function inverse(){var t=this.getImproperFraction();return new Fraction(t.denominator,t.numerator)}},{key:"multiply",value:function multiply(t){var r,a;return t=new Fraction(t),r=this.getImproperFraction(),a=t.getImproperFraction(),new Fraction(r.numerator*a.numerator,(r.denominator?r.denominator:0)*(a.denominator?a.denominator:0))}},{key:"divide",value:function divide(t){return t=new Fraction(t),this.multiply(t.inverse())}},{key:"getProperFraction",value:function getProperFraction(){var t=new Fraction(this);return t.normalize(!0),new Fraction(t.integer<0&&t.numerator>0?-t.numerator:t.numerator,this.denominator)}},{key:"getImproperFraction",value:function getImproperFraction(){var t,r;return this.numerator&&this.denominator?(t=this.integer<0?this.integer*this.denominator-this.numerator:this.integer*this.denominator+this.numerator,r=this.denominator):this.denominator?(r=this.denominator,this.integer&&(t=this.integer*this.denominator)):this.integer&&(t=this.integer,r=1),new Fraction(t,r)}},{key:"getSimpleFraction",value:function getSimpleFraction(){return new Fraction(this.integer<0?-this.numerator:this.numerator,this.denominator)}},{key:"toInteger",value:function toInteger(){return~~this.toDecimal()}},{key:"toDecimal",value:function toDecimal(){return this.denominator&&0!==this.denominator?this.integer&&this.integer<0?this.integer-this.numerator/this.denominator:this.numerator/this.denominator+this.integer:this.integer}},{key:"setCorrectSign",value:function setCorrectSign(){this.numerator&&this.numerator<0&&this.denominator&&this.denominator<0?(this.numerator=-this.numerator,this.denominator=-this.denominator):this.integer&&this.integer<0&&this.numerator&&this.numerator<0?this.numerator=-this.numerator:this.integer&&this.integer<0&&this.denominator&&this.denominator<0?this.denominator=-this.denominator:this.numerator&&this.numerator<0?this.integer&&(this.integer=-this.integer,this.numerator=-this.numerator):this.denominator&&this.denominator<0&&(this.integer?(this.integer=-this.integer,this.denominator=-this.denominator):(this.numerator=-this.numerator,this.denominator=-this.denominator))}},{key:"toSimpleString",value:function toSimpleString(){var t=0;return 0===this.integer&&0===this.numerator&&null===this.denominator?"0":!this.integer||this.numerator||this.denominator?(this.integer&&this.denominator&&(t=this.integer<0?-this.integer*this.denominator:this.integer*this.denominator),this.numerator&&(t+=this.numerator),this.denominator?(this.integer<0?"-":"")+t+"/"+this.denominator:""):""+this.integer}},{key:"toSimpleHtml",value:function toSimpleHtml(t,r){var a={integer:"",simpleFraction:this.getImproperFraction(),allowZeroNumerator:!0};return this.toMixedHtml(t,a,r)}},{key:"toMixedParams",value:function toMixedParams(){var t=this.getSimpleFraction();return 0===t.toDecimal()?t=null:this.integer<0&&(t=t.multiply(-1)),{integer:this.integer,simpleFraction:t,allowZeroNumerator:!1}}},{key:"toMixedString",value:function toMixedString(){var t=this.toMixedParams(),r=(t.integer?t.integer:"")+(t.simpleFraction?" "+t.simpleFraction.toSimpleString():"");return r?r.trim():"0"}},{key:"toMixedHtml",value:function toMixedHtml(t,r,a){var l,S,O,T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Fraction.fractionClass,L="",E="";return E=(r=r||this.toMixedParams()).integer,r.simpleFraction?(S=r.simpleFraction.numerator,O=r.simpleFraction.denominator):(S=0,O=0),S<0&&(S=-S,""===E||0===E?E="-":E>0&&(E=-E)),0!==S?(L+=S,O&&(L+="<hr/>"+O)):r.allowZeroNumerator&&O&&(L+="0<hr/>"+O),t&&(E=t+" "+E),""===L&&""===E&&(E=0),l={fractionClass:T,proper:L,integer:0===E&&""!==L?"":""+E},!0===a?l:Fraction.mixedFractionTemplate(l)}}]),Fraction}();_defineProperty(L,"IMPROPER_REG_EXP",/(\-?\d+)\s*\/\s*([1-9]\d*)/),_defineProperty(L,"MIXED_REG_EXP",/(\-?\d+)\s+(\d+)\s*\/\s*([1-9]\d*)/),_defineProperty(L,"fractionClass","lrn-numberline-fraction"),_defineProperty(L,"mixedFractionTemplate",T.a),_defineProperty(L,"gcd",(function(t,r){return r?L.gcd(r,t%r):t})),_defineProperty(L,"lcm",(function(t,r){var a=L.gcd(t,r);return Math.abs(t)/a*Math.abs(r)})),_defineProperty(L,"isNumber",(function(t){return!isNaN(parseFloat(t))&&isFinite(t)})),_defineProperty(L,"isFraction",(function(t){var r=L.IMPROPER_REG_EXP.exec(t),a=L.MIXED_REG_EXP.exec(t);return!!(a&&4===a.length||r&&3===r.length)})),_defineProperty(L,"isMixedFraction",(function(t){var r=L.MIXED_REG_EXP.exec(t);return!(!r||4!==r.length)})),_defineProperty(L,"isParsable",(function(t){return L.isNumber(t)||L.isFraction(t)})),_defineProperty(L,"areEqual",(function(t,r){return t.toDecimal()===r.toDecimal()})),_defineProperty(L,"areIdentical",(function(t,r){return t.numerator===r.numerator&&t.denominator===r.denominator&&t.integer===r.integer})),_defineProperty(L,"decimalToFraction",(function(t){if(t===parseInt(t))return{top:parseInt(t),bottom:1,display:parseInt(t)+"/1"};var r=-1!==t.toString().indexOf(".")?t.toString().replace(/\d+[.]/,""):0,a=Math.pow(10,r.toString().replace("-","").length);t>=1?r=+r+Math.floor(t)*a:t<=-1&&(r=+r+Math.ceil(t)*a);var l=Math.abs(L.gcd(r,a));return{top:r/l,bottom:a/l}})),r.a=L},269:function(t,r,a){"use strict";var l=a(1),S=a.n(l),O=(a(5),a(0)),T=a.n(O),L=a(163),E=a(164),D=a(26),j=a(148),V=a(220),B=a(251),q=a.n(B),G=(a(213),a(252)),K=a.n(G),X=a(218),$=a(212);r.a=V.a.extend({clozeFormulaExtraHtmlTemplate:q.a,clozeFormulaSpan:K.a,defaultUiStyle:E.a.prototype.TYPE.FLOATING_KEYBOARD,addFacadeMethods:D.a.addFacadeMethods,addRenderingLogic:function addRenderingLogic(){var t=this.activity.get("state")===this.activity.STATE.REVIEW,r=this.activity.get("state")===this.activity.STATE.PREVIEW,a=t||r,l=this.model.get("question").ui_style||{},S=l.type||this.defaultUiStyle,O=l&&l.disable_input,T=!(S===E.a.prototype.TYPE.NO_INPUT_UI)&&!a;this.displayLogic.hasBoostedFont="normal"!==l.response_font_scale,this.displayLogic.disableInput=O,this.displayLogic.showInputUi=T,this.displayLogic.uiStyleType=S,this.displayLogic.uiBelowResponse=!!l.keyboard_below_response_area,V.a.prototype.addRenderingLogic.call(this)},cacheOriginalHeight:function cacheOriginalHeight(){var t=this.$(".lrn_response_input").outerHeight();t>0&&(this.originalHeight=t)},clearValidationUI:function clearValidationUI(){this.readOnly||(this.displayLogic.enableCorrectAnswerHover=!1,this.showingValidationUI&&(this.$(".lrn_correct,.lrn_incorrect,.lrn_correct_marker,.lrn_incorrect_marker,.lrn_not_attempted").removeClass("lrn_correct lrn_incorrect lrn_correct_marker lrn_incorrect_marker lrn_not_attempted"),this.showingValidationUI=!1),V.a.prototype.clearValidationUI.call(this)),this.clearCorrectAnswers()},createMathEditor:function createMathEditor(t,r){var a,l,S=this,O=this.model,E=O.get("question"),j=O.getResponseValue(),V=O.get("response")&&O.get("response").responses,B=this.activity.get("disable_spokenmath_user_inputs"),q=E.response_container;return T.a.isArray(E.response_containers)&&r<E.response_containers.length&&(q=T.a.extend({},q,E.response_containers[r])),a=q&&q.template||"",l=new L.a({el:t,editables:V&&V[r]||[],disableSpokenmathUserInputs:B,value:j&&j[r]||"",disableInput:this.displayLogic.disableInput,readOnly:this.displayLogic.readOnly,clozeBordering:!0,template:a.replace(/^{{response}}$/,""),symbols:E.symbols,i18n:this.i18n,ui_style:E.ui_style,showInputUi:this.displayLogic.showInputUi,response_container:q,text_blocks:E.text_blocks,persistent_id:"formulaeditor"+r,disableItalics:D.a.isChemistry.call(this)}),this.listenTo(l.mathEvents,"all",(function(){Array.prototype.splice.call(arguments,1,0,l),S.trigger.apply(S,arguments)})),l},getCorrectResponseTextByIndex:function getCorrectResponseTextByIndex(t){var r=this.model.getCorrectByIndex(t);return"\\("+T.a.escape(r)+"\\)"},getExtraContentHTML:function getExtraContentHTML(){return this.clozeFormulaExtraHtmlTemplate({displayLogic:this.displayLogic})},getResponseInputHTML:function getResponseInputHTML(t){var r={inputId:t};return T.a.extend(r,this.displayLogic),r.responseContainer=this.getResponseContainerFor(t),this.clozeFormulaSpan({displayLogic:r})},insertUiKeyboard:function insertUiKeyboard(t){var r=this.model.get("question"),a=this.model.get("response"),l=t.find(".lrn_response_input")[0],S=this.activity.get("disable_spokenmath_user_inputs");this.keyboardView=new E.a({el:t.find("div.lrn_input_ui")[0],disableSpokenmathUserInputs:S,horizontalParent:l,mathEvents:T.a.size(this.inputs)>0?T.a.first(this.inputs).mathEvents:new j.a,symbols:r.symbols,showHints:T.a.isUndefined(r.showHints)||!0===r.showHints,security:this.activity.get("security"),handwriting:a&&a.handwriting,handwritingRecognises:r.handwriting_recognises,lazy:D.a.usesLazyKeyboard(this.options.activity),uiStyleType:this.displayLogic.uiStyleType,immutablePositioner:this.displayLogic.uiBelowResponse&&l,i18n:this.i18n,chemistry:D.a.isChemistry.call(this),numberPad:r.numberPad,horizontalLayout:r.horizontal_layout,horizontalPad:r.horizontalPad,uiBelowResponse:this.displayLogic.uiBelowResponse})},onAttach:function onAttach(){D.a.onAttach.call(this),T.a.invoke(this.inputs,"onAttach")},onItemBlurred:function onItemBlurred(t){var r=t.mathEvents,a=this.$(".lrn_response_innerbody").get(0),l=this.keyboardView&&this.keyboardView.el;D.a.onItemBlurred(r,a,l)},render:function render(){var t,r=this;this.model.get("question");if(this.inputs={},this.responseResponses=[],this.activity.get("state")===this.activity.STATE.RESUME&&this.model.hasResponse())this.responseResponses=this.model.get("response").responses;else for(var a=0;a<this.responseValue.length;a++)this.responseResponses[a]=null;return(t=S()(this.template({questionResponse:this.model,displayLogic:this.displayLogic,labels:this.i18n.labels}))).find(".lrn-clozeformula-input").each((function(t){var a=S()(this).data("inputid");r.inputs[a]=r.createMathEditor(this,t)})),Object(X.a)(this,(function(){return T.a.values(r.inputs)})),this.on(j.a.UPDATED,this.updateModel,this),this.on(j.a.ITEM_BLURRED,this.onItemBlurred,this),this.on(j.a.EDITOR_FOCUSED,this.setActiveEditor,this),this.displayLogic.showInputUi&&this.insertUiKeyboard(t),V.a.prototype.render.call(this,t),this.setMinWidth(),this.cacheOriginalHeight(),this},setActiveEditor:function setActiveEditor(t){this.clearValidationUI(),this.updateHeight(),this.keyboardView&&this.keyboardView.setPositioner(t.el).setMathEvents(t.mathEvents).show()},setDisabled:function setDisabled(t){D.a.setDisabled(this.inputs,t),this.showingValidationUI&&this.showValidationUI(),this.setButtonsDisabled(t)},setImageWidth:function setImageWidth(){var t=!0===T.a.getNested(this.model.get("question"),"image.prevent_scale");if(t)this.preventImageScale();else{var r=V.a.prototype.setImageWidth.apply(this,arguments);this.keyboardView&&this.keyboardView.notifyContainerWidth(r),this.cacheOriginalHeight()}},preventImageScale:function preventImageScale(){var t=this.$(".lrn_imagecloze_image"),r=this.$(".lrn_cloze_response_container"),a=t.width()+2;t.css("max-width","none"),r.css({"max-width":a,width:a})},setMinWidth:function setMinWidth(){var t=T.a.isObject(this.model.get("question").ui_style)&&!T.a.isUndefined(this.model.get("question").ui_style.min_width)?this.model.get("question").ui_style.min_width:null;this.$el.find(".lrn_response_input").css("min-width",t)},showValidationUI:function showValidationUI(){var t=V.a.prototype.showValidationUI.call(this)||[],r=this.model.getResponseValue()||this.responseValue;T.a.each(r,(function(r,a){var l=this.responseResponses[a]||[],S=this.inputs[a].$el;t[a]?S.addClass("lrn_correct"):r&&!l.length||l.join("").length?S.addClass("lrn_incorrect"):S.addClass("lrn_not_attempted"),this.displayLogic.displayCorrectAnswer&&S.prepend('<span class="lrn_responseIndex">'+this.getResponseIndexLabel(a)+"</span>")}),this),D.a.addAriaLabelToValidationUi.call(this)},updateHeight:function updateHeight(){var t=!0===T.a.getNested(this.model.get("question"),"image.prevent_scale"),r=0;this.$(".lrn_imagecloze_response").each((function(){var t=S()(this),a=t.position().top+t.outerHeight();r=a>r?a:r})),r>this.originalHeight&&!t&&this.$(".lrn_response_input").height(r)},updateModel:function updateModel(t,r,a){var l=t.$el.data("inputid");this.responseValue[l]=r,this.responseResponses[l]=a,this.model.updateResponseValue({value:this.responseValue,responses:this.responseResponses,handwriting:this.keyboardView&&this.keyboardView.getHandwriting()}),this.clearValidationUI(),this.updateHeight(),Object($.a)(this.el,this.displayLogic.hasBoostedFont)},showCorrectAnswer:function showCorrectAnswer(){D.a.addAriaLabelToValidationUi.call(this),this.showCorrectAnswerList()},getReviewAriaLabel:function getReviewAriaLabel(t){return(t=t.clone()).text("response"),V.a.prototype.getReviewAriaLabel.call(this,t)}})},270:function(t,r,a){"use strict";var l=a(0),S=a.n(l),O=a(149),T=a(127),L=a.n(T),E=a(130),D=a(128),j=a(129),V=a.n(j),B=a(145),q=a(142),G=a(152),K=a(187);function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(t){return typeof t}:function _typeof(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _extends(){return(_extends=Object.assign||function(t){for(var r=1;r<arguments.length;r++){var a=arguments[r];for(var l in a)Object.prototype.hasOwnProperty.call(a,l)&&(t[l]=a[l])}return t}).apply(this,arguments)}function _classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,r){for(var a=0;a<r.length;a++){var l=r[a];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(t,l.key,l)}}function _setPrototypeOf(t,r){return(_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(t,r){return t.__proto__=r,t})(t,r)}function _createSuper(t){var r=function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var a,l=_getPrototypeOf(t);if(r){var S=_getPrototypeOf(this).constructor;a=Reflect.construct(l,arguments,S)}else a=l.apply(this,arguments);return _possibleConstructorReturn(this,a)}}function _possibleConstructorReturn(t,r){if(r&&("object"===_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(t)}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _defineProperty(t,r,a){return r in t?Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[r]=a,t}function modalWithToggle(t){return function(r){!function _inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),r&&_setPrototypeOf(t,r)}(_class2,r);var a=_createSuper(_class2);function _class2(){var t;_classCallCheck(this,_class2);for(var r=arguments.length,l=new Array(r),S=0;S<r;S++)l[S]=arguments[S];return _defineProperty(_assertThisInitialized(t=a.call.apply(a,[this].concat(l))),"state",{modalIsOpen:!1}),_defineProperty(_assertThisInitialized(t),"closeModal",(function(){(0,t.props.onModal)(null),t.setState({modalIsOpen:!1})})),_defineProperty(_assertThisInitialized(t),"toggleModal",(function(){var r=t.props.onModal,a=!t.state.modalIsOpen;r(a),t.setState({modalIsOpen:a})})),t}return function _createClass(t,r,a){return r&&_defineProperties(t.prototype,r),a&&_defineProperties(t,a),t}(_class2,[{key:"render",value:function render(){var r=this.props,a=this.state,l=r.isActive,S=r.visible,O=r.onApply,T=r.getContainer,E=a.modalIsOpen,D=V()({hide:!S});return L.a.createElement(L.a.Fragment,null,L.a.createElement(G.a.Button,_extends({},r,{isActive:l,className:D,onClick:this.toggleModal})),L.a.createElement(t,_extends({},r,{relativeNode:T,modalIsOpen:E,onRequestClose:this.closeModal,onApply:O})))}}]),_class2}(L.a.Component)}var X=a(153);function create_typeof(t){return(create_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(t){return typeof t}:function _typeof(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function create_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function create_defineProperties(t,r){for(var a=0;a<r.length;a++){var l=r[a];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(t,l.key,l)}}function create_setPrototypeOf(t,r){return(create_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(t,r){return t.__proto__=r,t})(t,r)}function create_createSuper(t){var r=function create_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var a,l=create_getPrototypeOf(t);if(r){var S=create_getPrototypeOf(this).constructor;a=Reflect.construct(l,arguments,S)}else a=l.apply(this,arguments);return create_possibleConstructorReturn(this,a)}}function create_possibleConstructorReturn(t,r){if(r&&("object"===create_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return create_assertThisInitialized(t)}function create_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function create_getPrototypeOf(t){return(create_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function create_defineProperty(t,r,a){return r in t?Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[r]=a,t}var $=function(t){!function create_inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),r&&create_setPrototypeOf(t,r)}(CreateTableModal,t);var r=create_createSuper(CreateTableModal);function CreateTableModal(){var t;create_classCallCheck(this,CreateTableModal);for(var a=arguments.length,l=new Array(a),S=0;S<a;S++)l[S]=arguments[S];return create_defineProperty(create_assertThisInitialized(t=r.call.apply(r,[this].concat(l))),"state",{cols:3,rows:2}),create_defineProperty(create_assertThisInitialized(t),"onChange",(function(r,a){t.setState(create_defineProperty({},r,a))})),create_defineProperty(create_assertThisInitialized(t),"onApply",(function(r){var a=t.props,l=a.onApply,S=a.onRequestClose,O=t.state;l({cols:O.cols,rows:O.rows}),S(),r.preventDefault()})),create_defineProperty(create_assertThisInitialized(t),"onCloseWithoutApply",(function(){var r=t.props,a=r.onApply,l=r.onRequestClose;a(null),l()})),t}return function create_createClass(t,r,a){return r&&create_defineProperties(t.prototype,r),a&&create_defineProperties(t,a),t}(CreateTableModal,[{key:"render",value:function render(){var t=this,r=this.props,a=r.i18n,l=r.relativeNode,S=r.modalIsOpen,O=r.responseId,T=a.labels.editor.modals,E=this.state,D=E.cols,j=E.rows,V=D>0&&j>0&&D<100&&j<100;return L.a.createElement(X.a,{getRef:function getRef(r){return t.el=r},title:T.tableTitle,parentNode:l,modalIsOpen:S,onRequestClose:this.onCloseWithoutApply},L.a.createElement("div",{className:"lrn_clearfix"},L.a.createElement("div",{className:"lrn-wysihtml-modal-section"},L.a.createElement("label",{htmlFor:"".concat(O,"-table-columns")},L.a.createElement("span",{className:"lrn-label-title"},T.columns),L.a.createElement("input",{type:"number",id:"".concat(O,"-table-columns"),className:"lrn-editor-input",defaultValue:D,min:"1",max:"99",onChange:function onChange(r){return t.onChange("cols",r.target.value)}}))),L.a.createElement("div",{className:"lrn-wysihtml-modal-section"},L.a.createElement("label",{htmlFor:"".concat(O,"-table-rows")},L.a.createElement("span",{className:"lrn-label-title"},T.rows),L.a.createElement("input",{type:"number",id:"".concat(O,"-table-rows"),className:"lrn-editor-input",defaultValue:j,min:"1",max:"99",onChange:function onChange(r){return t.onChange("rows",r.target.value)}})))),L.a.createElement("hr",null),L.a.createElement("div",{className:"lrn-wysihtml-modal-controls"},L.a.createElement("button",{className:"lrn_btn lrn_btn_blue","data-lrn-action":"apply",onClick:this.onApply,disabled:!V,type:"button"},T.apply)))}}]),CreateTableModal}(L.a.Component);function edit_typeof(t){return(edit_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(t){return typeof t}:function _typeof(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function edit_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function edit_defineProperties(t,r){for(var a=0;a<r.length;a++){var l=r[a];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(t,l.key,l)}}function edit_setPrototypeOf(t,r){return(edit_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(t,r){return t.__proto__=r,t})(t,r)}function edit_createSuper(t){var r=function edit_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var a,l=edit_getPrototypeOf(t);if(r){var S=edit_getPrototypeOf(this).constructor;a=Reflect.construct(l,arguments,S)}else a=l.apply(this,arguments);return edit_possibleConstructorReturn(this,a)}}function edit_possibleConstructorReturn(t,r){if(r&&("object"===edit_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return edit_assertThisInitialized(t)}function edit_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function edit_getPrototypeOf(t){return(edit_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function edit_defineProperty(t,r,a){return r in t?Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[r]=a,t}var Z=function(t){!function edit_inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),r&&edit_setPrototypeOf(t,r)}(EditTableModal,t);var r=edit_createSuper(EditTableModal);function EditTableModal(){var t;edit_classCallCheck(this,EditTableModal);for(var a=arguments.length,l=new Array(a),S=0;S<a;S++)l[S]=arguments[S];return edit_defineProperty(edit_assertThisInitialized(t=r.call.apply(r,[this].concat(l))),"onApply",(function(r,a){var l=t.props,S=l.onApply,O=l.onRequestClose;S(a),O(),r.preventDefault()})),t}return function edit_createClass(t,r,a){return r&&edit_defineProperties(t.prototype,r),a&&edit_defineProperties(t,a),t}(EditTableModal,[{key:"render",value:function render(){var t=this,r=this.props,a=r.i18n,l=r.relativeNode,S=r.modalIsOpen,O=r.onRequestClose,T=a.labels.editor.modals;return L.a.createElement(X.a,{getRef:function getRef(r){return t.el=r},title:T.tableTitle,parentNode:l,className:"lrn-wysihtml-modal-table-edit",modalIsOpen:S,onRequestClose:O},L.a.createElement("div",{className:"lrn_clearfix"},L.a.createElement("div",{className:"lrn-wysihtml-modal-section"},L.a.createElement("div",null,L.a.createElement("span",{className:"lrn-label-title"},T.columns)),L.a.createElement("ul",null,L.a.createElement("li",null,L.a.createElement("button",{type:"button",className:"lrn_btn",onMouseDown:function onMouseDown(r){return t.onApply(r,{type:"addTableCells",params:"before"})}},T.insertColumnBefore)),L.a.createElement("li",null,L.a.createElement("button",{type:"button",className:"lrn_btn",onMouseDown:function onMouseDown(r){return t.onApply(r,{type:"addTableCells",params:"after"})}},T.insertColumnAfter)),L.a.createElement("li",null,L.a.createElement("button",{type:"button",className:"lrn_btn",onMouseDown:function onMouseDown(r){return t.onApply(r,{type:"deleteTableCells",params:"column"})}},T.deleteColumn)))),L.a.createElement("div",{className:"lrn-wysihtml-modal-section"},L.a.createElement("div",null,L.a.createElement("span",{className:"lrn-label-title"},T.rows)),L.a.createElement("ul",null,L.a.createElement("li",null,L.a.createElement("button",{type:"button",className:"lrn_btn",onMouseDown:function onMouseDown(r){return t.onApply(r,{type:"addTableCells",params:"above"})}},T.insertRowAbove)),L.a.createElement("li",null,L.a.createElement("button",{type:"button",className:"lrn_btn",onMouseDown:function onMouseDown(r){return t.onApply(r,{type:"addTableCells",params:"below"})}},T.insertRowBelow)),L.a.createElement("li",null,L.a.createElement("button",{type:"button",className:"lrn_btn",onMouseDown:function onMouseDown(r){return t.onApply(r,{type:"deleteTableCells",params:"row"})}},T.deleteRow))))),L.a.createElement("hr",null),L.a.createElement("div",{className:"lrn-wysihtml-modal-controls"},L.a.createElement("button",{type:"button",className:"lrn_btn  lrn_btn_danger",onMouseDown:function onMouseDown(r){return t.onApply(r,{type:"deleteTable"})}},T.deleteTable)))}}]),EditTableModal}(L.a.Component),Q={CreateTableButton:modalWithToggle($),EditTableButton:modalWithToggle(Z)},ee=a(279),te=a.n(ee),ne=a(203),re=a(133);function imagePropsUtil_defineProperty(t,r,a){return r in t?Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[r]=a,t}function generateImageAttributes(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{className:"class"},a=t.url,l=t.size,S=t.naturalWidth,O=t.naturalHeight,T=imagePropsUtil_defineProperty({src:a,width:getImageWidthFromSize(l,S,O)},r.className,V()(imagePropsUtil_defineProperty({},"lrn-size-".concat(l),!!l)));return t.assetPath&&(T["data-asset-path"]=t.assetPath),T}function getImageWidthFromSize(t,r,a){var l,S=r<a,O=S?a:r;((l=t===q.e.SMALL?Math.min(O,q.d.SMALL):t===q.e.MEDIUM?Math.min(O,q.d.MEDIUM):t===q.e.LARGE?Math.min(O,q.d.LARGE):Math.min(O,q.d.FULL_SIZE))||(l=0),S)&&(l=parseInt(l*(r/a),10));return l}var oe=a(243);function editor_extends(){return(editor_extends=Object.assign||function(t){for(var r=1;r<arguments.length;r++){var a=arguments[r];for(var l in a)Object.prototype.hasOwnProperty.call(a,l)&&(t[l]=a[l])}return t}).apply(this,arguments)}function _slicedToArray(t,r){return function _arrayWithHoles(t){if(Array.isArray(t))return t}(t)||function _iterableToArrayLimit(t,r){var a=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==a)return;var l,S,O=[],T=!0,L=!1;try{for(a=a.call(t);!(T=(l=a.next()).done)&&(O.push(l.value),!r||O.length!==r);T=!0);}catch(t){L=!0,S=t}finally{try{T||null==a.return||a.return()}finally{if(L)throw S}}return O}(t,r)||function _unsupportedIterableToArray(t,r){if(!t)return;if("string"==typeof t)return _arrayLikeToArray(t,r);var a=Object.prototype.toString.call(t).slice(8,-1);"Object"===a&&t.constructor&&(a=t.constructor.name);if("Map"===a||"Set"===a)return Array.from(t);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return _arrayLikeToArray(t,r)}(t,r)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var a=0,l=new Array(r);a<r;a++)l[a]=t[a];return l}function ImageSizeSelection(t){var r=t.naturalWidth,a=t.naturalHeight,l=t.labels,O=t.size,T=t.responseId,E=function getAvailableSizes(t,r){var a=t<r?r:t;if(a<=q.d.SMALL)return null;var l=[q.e.SMALL];return a>q.d.MEDIUM&&l.push(q.e.MEDIUM),a>q.d.LARGE&&l.push(q.e.LARGE),l.push(q.e.FULL_SIZE),l}(r,a);if(!E)return null;var D=S.a.mapObject(l.imageSize,(function(t,l){return function getImageSizeLabel(t){var r=t.label,a=t.size,l=t.naturalWidth,S=t.naturalHeight,O=l/S,T=getImageWidthFromSize(a,l,S)||l,L=parseInt(T/O,10);return Object(re.a)(r,{width:T,height:L})}({label:t,size:l,naturalWidth:r,naturalHeight:a})}));return L.a.createElement("div",{className:"lrn-image-properties"},L.a.createElement("div",{className:"lrn-image-properties-inner"},L.a.createElement("label",{htmlFor:"".concat(T,"-image-size")},L.a.createElement("span",{className:"lrn-label-title lrn-display-block"},l.imageSize.title),L.a.createElement("select",{id:"".concat(T,"-image-size"),value:O,className:"lrn-editor-input",onChange:function onChange(l){return function onSizeChange(l){t.onChange({size:l,width:getImageWidthFromSize(l,r,a)})}(l.target.value)},onBlur:S.a.noop},S.a.map(E,(function(t){return L.a.createElement("option",{key:t,value:t},D[t])}))))))}function ZoomableImage(t){var r=t.naturalWidth,a=t.naturalHeight,l=t.containerDimensions.height,S=r>l&&a>l,O=_slicedToArray(Object(T.useState)(!1),2),E=O[0],D=O[1],j={onClick:function onClick(){return D(S&&!E)}},B=generateImageAttributes(t,{className:"className"});return B.className=V()({"lrn-img-zoom-in":S&&E,"lrn-img-zoom-out":S&&!E},B.className),L.a.createElement("img",editor_extends({alt:""},j,B))}function ImageEditor(t){var r=t.children,a=Object(T.useRef)(null),l=_slicedToArray(Object(T.useState)(0),2),S=l[0],O=l[1];return Object(T.useLayoutEffect)((function(){a.current&&a.current.clientHeight!==S&&O(a.current.clientHeight)})),L.a.createElement("div",null,L.a.createElement("div",{className:"lrn-image-uploader-preview",ref:a},L.a.createElement(ZoomableImage,editor_extends({containerDimensions:{height:S}},t))),r,L.a.createElement(ImageSizeSelection,t))}var ie=a(244),ae={fileDialog:a.n(ie).a},se=a(195);function uploadModal_typeof(t){return(uploadModal_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(t){return typeof t}:function _typeof(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ownKeys(t,r){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);r&&(l=l.filter((function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable}))),a.push.apply(a,l)}return a}function _objectSpread(t){for(var r=1;r<arguments.length;r++){var a=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(a),!0).forEach((function(r){uploadModal_defineProperty(t,r,a[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):ownKeys(Object(a)).forEach((function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(a,r))}))}return t}function uploadModal_extends(){return(uploadModal_extends=Object.assign||function(t){for(var r=1;r<arguments.length;r++){var a=arguments[r];for(var l in a)Object.prototype.hasOwnProperty.call(a,l)&&(t[l]=a[l])}return t}).apply(this,arguments)}function uploadModal_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function uploadModal_defineProperties(t,r){for(var a=0;a<r.length;a++){var l=r[a];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(t,l.key,l)}}function uploadModal_setPrototypeOf(t,r){return(uploadModal_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(t,r){return t.__proto__=r,t})(t,r)}function uploadModal_createSuper(t){var r=function uploadModal_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var a,l=uploadModal_getPrototypeOf(t);if(r){var S=uploadModal_getPrototypeOf(this).constructor;a=Reflect.construct(l,arguments,S)}else a=l.apply(this,arguments);return uploadModal_possibleConstructorReturn(this,a)}}function uploadModal_possibleConstructorReturn(t,r){if(r&&("object"===uploadModal_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return uploadModal_assertThisInitialized(t)}function uploadModal_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function uploadModal_getPrototypeOf(t){return(uploadModal_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function uploadModal_defineProperty(t,r,a){return r in t?Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[r]=a,t}var le={url:null,width:0,naturalWidth:0,naturalHeight:0,size:q.e.FULL_SIZE,rotation:0,loading:!1,error:null,warning:null},ce=function(t){!function uploadModal_inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),r&&uploadModal_setPrototypeOf(t,r)}(UploadImageModal,t);var r=uploadModal_createSuper(UploadImageModal);function UploadImageModal(){var t;uploadModal_classCallCheck(this,UploadImageModal);for(var a=arguments.length,l=new Array(a),O=0;O<a;O++)l[O]=arguments[O];return uploadModal_defineProperty(uploadModal_assertThisInitialized(t=r.call.apply(r,[this].concat(l))),"file",null),uploadModal_defineProperty(uploadModal_assertThisInitialized(t),"state",S.a.extend({},le)),uploadModal_defineProperty(uploadModal_assertThisInitialized(t),"reset",(function(){t.setState(le)})),uploadModal_defineProperty(uploadModal_assertThisInitialized(t),"cleanUpAndClose",(function(){t.file=null,t.props.onRequestClose(),t.reset()})),uploadModal_defineProperty(uploadModal_assertThisInitialized(t),"onImageRotationClick",(function(){var r=uploadModal_assertThisInitialized(t),a=r.file,l=r.state,S=r.props,O=l.rotation;return O>-270?O-=90:O=0,t.setState({loading:!0}),S.compressImage(a,{rotation:O}).then(ne.c).then((function(r){t.setState({loading:!1,url:r.src,width:r.width,naturalWidth:r.width,naturalHeight:r.height,rotation:O})}))})),uploadModal_defineProperty(uploadModal_assertThisInitialized(t),"startImageSelection",(function(){t.uploadAborted=!1,ae.fileDialog({multiple:!1,accept:q.b}).then((function(r){t.processSelectedImage(r[0])}))})),uploadModal_defineProperty(uploadModal_assertThisInitialized(t),"onImageEditorChanged",(function(r){var a=r.width,l=r.size;t.setState({width:a,size:l})})),uploadModal_defineProperty(uploadModal_assertThisInitialized(t),"onCancelButtonClicked",(function(){t.uploadAborted=!0,t.cleanUpAndClose()})),uploadModal_defineProperty(uploadModal_assertThisInitialized(t),"onUploadButtonClicked",(function(r){var a=t.state,l=a.rotation,S=a.naturalWidth,O=t.props.uploadImage,T={rotation:l};return S>q.d.FULL_SIZE&&(T.width=q.d.FULL_SIZE),r.preventDefault(),r.stopPropagation(),t.setState({loading:!0}),O(t.file,T).then((function(r){t.uploadAborted||t.insertImage(r)})).catch((function(){t.showProcessingImageError()}))})),t}return function uploadModal_createClass(t,r,a){return r&&uploadModal_defineProperties(t.prototype,r),a&&uploadModal_defineProperties(t,a),t}(UploadImageModal,[{key:"componentDidUpdate",value:function componentDidUpdate(t){var r=this.props,a=r.modalIsOpen,l=r.selectedFile;t.selectedFile!==l&&(this.file=null,this.uploadAborted=!1,l&&a&&this.processSelectedImage(l))}},{key:"render",value:function render(){var t=this,r=this.props,a=r.i18n,l=r.relativeNode,O=r.responseId,T=r.modalIsOpen,E=this.state,D=E.url,j=E.loading,V=E.warning,B=E.error,q=!(!T||!(this.file||j||B||V)),G=a.labels.editor.modals;return L.a.createElement(X.a,{className:"lrn-full-width",getRef:function getRef(r){return t.el=r},title:G.imageTitle,parentNode:l,modalIsOpen:q,onRequestClose:this.onCancelButtonClicked},L.a.createElement("div",{className:"lrn-image-editor-wrapper"},this.getMessage(),B&&L.a.createElement("div",{className:"lrn-config-btn-upload-wrapper"},L.a.createElement("button",{className:"btn lrn_btn_blue lrn-imageupload-config-btn-upload",type:"button",onClick:this.startImageSelection},G.uploadText)),D&&L.a.createElement(ImageEditor,uploadModal_extends({},this.state,{labels:G,responseId:O,onChange:this.onImageEditorChanged}),L.a.createElement("button",{className:"lrn_btn lrn-btn-outline image-editor-replace-btn",onClick:this.startImageSelection,disabled:j},L.a.createElement("span",{className:"lrn-icon-image image-editor-replace-span"}),G.imageReplace),L.a.createElement("button",{className:"lrn_btn lrn-btn-outline image-editor-rotate-btn",onClick:this.onImageRotationClick,disabled:j},L.a.createElement("span",{className:"lrn-icon-image-rotation image-editor-rotate-span"}),G.imageRotate)),j&&L.a.createElement("div",{className:"lrn-loader-wrapper"},L.a.createElement(oe.a,null))),L.a.createElement("hr",null),L.a.createElement("div",{className:"lrn-wysihtml-modal-controls"},L.a.createElement("button",{className:"lrn_btn lrn_btn_blue image-editor-upload-button","data-lrn-action":"upload",onClick:this.onUploadButtonClicked,disabled:S.a.isEmpty(D)||j,type:"button"},G.upload),L.a.createElement("button",{className:"lrn_btn",onClick:this.onCancelButtonClicked,type:"button"},G.cancel)))}},{key:"getMessage",value:function getMessage(){var t=this.state,r=t.error,a=t.warning;if(!r&&!a)return null;var l=this.props.i18n.labels.editor.messages,S=r?"error":"warning",O=r?l.failedLoadingImage:l.imageHasBeenOptimized;return L.a.createElement(te.a,{className:"upload-modal-message",type:S,iconClassMapping:{warning:"lrn-icon-warning",error:"lrn-icon-info"},ariaHidden:!0},O)}},{key:"showProcessingImageError",value:function showProcessingImageError(){this.file=null,this.uploadAborted=!1,this.setState({loading:!1,url:null,error:!0})}},{key:"processSelectedImage",value:function processSelectedImage(t){var r,a=this;return this.setState({loading:!0,error:!1}),Object(ne.c)(t).then((function(a){return r=a.width,t})).then((function processImage(){return a.shouldCompress(t,r)?(a.setState({warning:a.shouldShowWarning(t,r)}),r>q.d.FULL_SIZE&&(l={width:q.d.FULL_SIZE}),a.props.compressImage(t,{rotation:0,compressOptions:l})):(a.setState({warning:null,error:null}),Promise.resolve(t));var l})).then((function(t){return a.file=t,Object(ne.c)(t)})).then((function(t){return a.setState({loading:!1,url:t.src,width:t.width,naturalWidth:t.width,naturalHeight:t.height,rotation:0})})).catch((function(){a.showProcessingImageError()}))}},{key:"insertImage",value:function insertImage(t){var r=t.url,a=t.assetPath;(0,this.props.onApply)(generateImageAttributes(_objectSpread(_objectSpread({},this.state),{},{url:r,assetPath:a}))),this.cleanUpAndClose()}},{key:"shouldCompress",value:function shouldCompress(t,r){return t.size>this.props.maxFileSize||r>q.d.FULL_SIZE}},{key:"shouldShowWarning",value:function shouldShowWarning(t,r){return t.size>this.props.warningFileSize||r>q.d.FULL_SIZE}}]),UploadImageModal}(L.a.PureComponent),ue=D.b((function(t){return{maxFileSize:t.longTextV2.maxFileSize,warningFileSize:t.longTextV2.warningFileSize}}),(function(t){return{compressImage:E.b(se.a.compressImage,t),uploadImage:E.b(se.a.uploadImage,t)}}))(ce);function insertImageButton_extends(){return(insertImageButton_extends=Object.assign||function(t){for(var r=1;r<arguments.length;r++){var a=arguments[r];for(var l in a)Object.prototype.hasOwnProperty.call(a,l)&&(t[l]=a[l])}return t}).apply(this,arguments)}function insertImageButton_slicedToArray(t,r){return function insertImageButton_arrayWithHoles(t){if(Array.isArray(t))return t}(t)||function insertImageButton_iterableToArrayLimit(t,r){var a=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==a)return;var l,S,O=[],T=!0,L=!1;try{for(a=a.call(t);!(T=(l=a.next()).done)&&(O.push(l.value),!r||O.length!==r);T=!0);}catch(t){L=!0,S=t}finally{try{T||null==a.return||a.return()}finally{if(L)throw S}}return O}(t,r)||function insertImageButton_unsupportedIterableToArray(t,r){if(!t)return;if("string"==typeof t)return insertImageButton_arrayLikeToArray(t,r);var a=Object.prototype.toString.call(t).slice(8,-1);"Object"===a&&t.constructor&&(a=t.constructor.name);if("Map"===a||"Set"===a)return Array.from(t);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return insertImageButton_arrayLikeToArray(t,r)}(t,r)||function insertImageButton_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function insertImageButton_arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var a=0,l=new Array(r);a<r;a++)l[a]=t[a];return l}function editorModal_typeof(t){return(editorModal_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(t){return typeof t}:function _typeof(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function editorModal_extends(){return(editorModal_extends=Object.assign||function(t){for(var r=1;r<arguments.length;r++){var a=arguments[r];for(var l in a)Object.prototype.hasOwnProperty.call(a,l)&&(t[l]=a[l])}return t}).apply(this,arguments)}function editorModal_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function editorModal_defineProperties(t,r){for(var a=0;a<r.length;a++){var l=r[a];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(t,l.key,l)}}function editorModal_setPrototypeOf(t,r){return(editorModal_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(t,r){return t.__proto__=r,t})(t,r)}function editorModal_createSuper(t){var r=function editorModal_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var a,l=editorModal_getPrototypeOf(t);if(r){var S=editorModal_getPrototypeOf(this).constructor;a=Reflect.construct(l,arguments,S)}else a=l.apply(this,arguments);return editorModal_possibleConstructorReturn(this,a)}}function editorModal_possibleConstructorReturn(t,r){if(r&&("object"===editorModal_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return editorModal_assertThisInitialized(t)}function editorModal_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function editorModal_getPrototypeOf(t){return(editorModal_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function editorModal_defineProperty(t,r,a){return r in t?Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[r]=a,t}var de={url:null,align:"",width:0,naturalWidth:0,size:q.e.FULL_SIZE},pe={InsertImageButton:function InsertImageButton(t){var r=insertImageButton_slicedToArray(Object(T.useState)(!1),2),a=r[0],l=r[1],O=insertImageButton_slicedToArray(Object(T.useState)(null),2),E=O[0],D=O[1],j=t.isActive,B=t.visible,K=t.onApply,X=t.getContainer,$=t.onModal,Z=t.editableElementSelector,Q=V()({hide:!B}),ee=S.a.debounce((function(){D(null),ae.fileDialog({multiple:!1,accept:q.b}).then((function(t){$(!0),l(!0),D(t[0])}))}),10,!0),te=function(){var t=X();if(t){var r=t.querySelector(Z),a=r&&r.querySelectorAll("img");return!!(a&&a.length>=q.f)}return!1}();return L.a.createElement(L.a.Fragment,null,L.a.createElement(G.a.Button,insertImageButton_extends({},t,{isActive:j,disabled:t.disabled||te,className:Q,onClick:ee})),L.a.createElement(ue,insertImageButton_extends({},t,{selectedFile:E,relativeNode:X,modalIsOpen:a,onRequestClose:function closeModal(){$(null),D(null),l(!1)},onApply:K})))},EditImageButton:modalWithToggle(function(t){!function editorModal_inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),r&&editorModal_setPrototypeOf(t,r)}(ImageEditorModal,t);var r=editorModal_createSuper(ImageEditorModal);function ImageEditorModal(){var t;editorModal_classCallCheck(this,ImageEditorModal);for(var a=arguments.length,l=new Array(a),O=0;O<a;O++)l[O]=arguments[O];return editorModal_defineProperty(editorModal_assertThisInitialized(t=r.call.apply(r,[this].concat(l))),"state",S.a.extend({},de)),editorModal_defineProperty(editorModal_assertThisInitialized(t),"cleanUpAndClose",(function(){t.setState(de),t.props.onRequestClose()})),editorModal_defineProperty(editorModal_assertThisInitialized(t),"onImageEditorChanged",(function(r){var a=r.width,l=r.size;t.setState({width:a,size:l})})),editorModal_defineProperty(editorModal_assertThisInitialized(t),"onApply",(function(r){var a=t.props.onApply,l=generateImageAttributes(t.state);r.preventDefault(),r.stopPropagation(),a(l),t.cleanUpAndClose()})),t}return function editorModal_createClass(t,r,a){return r&&editorModal_defineProperties(t.prototype,r),a&&editorModal_defineProperties(t,a),t}(ImageEditorModal,[{key:"componentDidUpdate",value:function componentDidUpdate(){var t=this.props,r=t.image;t.modalIsOpen&&r&&this.state.url!==r.url&&this.setState(S.a.extend({},de,r))}},{key:"render",value:function render(){var t=this,r=this.state.url,a=this.props,l=a.i18n,S=a.relativeNode,O=a.responseId,T=a.modalIsOpen,E=l.labels.editor.modals;return L.a.createElement(L.a.Fragment,null,L.a.createElement(X.a,{className:"lrn-full-width",getRef:function getRef(r){return t.el=r},title:E.imageTitle,parentNode:S,modalIsOpen:T,onRequestClose:this.cleanUpAndClose},r&&L.a.createElement(L.a.Fragment,null,L.a.createElement(ImageEditor,editorModal_extends({},this.state,{labels:E,responseId:O,onChange:this.onImageEditorChanged})),L.a.createElement("hr",null),L.a.createElement("div",{className:"lrn-wysihtml-modal-controls"},L.a.createElement("button",{className:"lrn_btn lrn_btn_blue editor-modal-blue-button","data-lrn-action":"apply",onClick:this.onApply,type:"button"},E.apply),L.a.createElement("button",{className:"lrn_btn","data-lrn-action":"cancel",onClick:this.cleanUpAndClose,type:"button"},E.cancel)))))}}]),ImageEditorModal}(L.a.PureComponent))};function subToolbar_extends(){return(subToolbar_extends=Object.assign||function(t){for(var r=1;r<arguments.length;r++){var a=arguments[r];for(var l in a)Object.prototype.hasOwnProperty.call(a,l)&&(t[l]=a[l])}return t}).apply(this,arguments)}var fe=function getImageFromProps(t){var r=S.a.findWhere(t.activeActions,{action:"insertImage"}),a=r&&r.target;return a?function getImageProps(t){var r,a,l,S=t.naturalWidth,O=t.naturalHeight,T=t.width,L=t.src,E=t.className;return{naturalWidth:S,naturalHeight:O,url:L,width:T||0,size:(r=E,a="lrn-size-(\\S+)",l=new RegExp(a,"g").exec(r),(l&&l.length>=2?l[1]:"")||q.e.FULL_SIZE)}}(a):null};function ImageEditorSubControl(t){var r=t.image,a=t.i18n,l=t.onClick,S=t.onModal,O=a.labels.editor.toolbar,T=!!r;return L.a.createElement(L.a.Fragment,null,L.a.createElement(pe.EditImageButton,subToolbar_extends({},t,{name:"editImage",image:r,getImage:function getImage(){return r},icon:q.a.image.icons.edit,label:O.editImage,isActive:!1,visible:!0,disabled:!T,onApply:function onApply(t){return l({type:"insertImage",params:t})},onModal:function onModal(t){return S(t?"editImage":null)}})),L.a.createElement(G.a.Button,subToolbar_extends({},t,{name:"preview",icon:q.a.image.icons.preview,label:O.previewImage,disabled:!T,onClick:function onClick(){return l({type:"previewImage",url:r.url})}})),L.a.createElement(G.a.Button,subToolbar_extends({},t,{name:"delete",icon:q.a.image.icons.delete,label:O.deleteImage,disabled:!T,onClick:function onClick(){return l({type:"deleteImage"})}})))}function SubToolbar(t){var r=fe(t),a=V()({in:!!r},"lrn-sub-toolbar lrn-wysihtml-toolbar lrn-animation-dropdown");return L.a.createElement("div",{className:a},S.a.contains(t.formattingOptions,"image")&&L.a.createElement(ImageEditorSubControl,subToolbar_extends({},t,{image:r})))}var he=a(274),ge=a(31);function toolbar_typeof(t){return(toolbar_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(t){return typeof t}:function _typeof(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function toolbar_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function toolbar_defineProperties(t,r){for(var a=0;a<r.length;a++){var l=r[a];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(t,l.key,l)}}function toolbar_setPrototypeOf(t,r){return(toolbar_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(t,r){return t.__proto__=r,t})(t,r)}function toolbar_createSuper(t){var r=function toolbar_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var a,l=toolbar_getPrototypeOf(t);if(r){var S=toolbar_getPrototypeOf(this).constructor;a=Reflect.construct(l,arguments,S)}else a=l.apply(this,arguments);return toolbar_possibleConstructorReturn(this,a)}}function toolbar_possibleConstructorReturn(t,r){if(r&&("object"===toolbar_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return toolbar_assertThisInitialized(t)}function toolbar_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function toolbar_getPrototypeOf(t){return(toolbar_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function toolbar_defineProperty(t,r,a){return r in t?Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[r]=a,t}function _toConsumableArray(t){return function _arrayWithoutHoles(t){if(Array.isArray(t))return toolbar_arrayLikeToArray(t)}(t)||function _iterableToArray(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function toolbar_unsupportedIterableToArray(t,r){if(!t)return;if("string"==typeof t)return toolbar_arrayLikeToArray(t,r);var a=Object.prototype.toString.call(t).slice(8,-1);"Object"===a&&t.constructor&&(a=t.constructor.name);if("Map"===a||"Set"===a)return Array.from(t);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return toolbar_arrayLikeToArray(t,r)}(t)||function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function toolbar_arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var a=0,l=new Array(r);a<r;a++)l[a]=t[a];return l}function toolbar_extends(){return(toolbar_extends=Object.assign||function(t){for(var r=1;r<arguments.length;r++){var a=arguments[r];for(var l in a)Object.prototype.hasOwnProperty.call(a,l)&&(t[l]=a[l])}return t}).apply(this,arguments)}var me="ArrowRight",ye="ArrowLeft";function getControls(t,r){return S.a.reduce(t.formattingOptions,(function(a,l){var S=q.a[l],O=a.length,T={control:S,key:l,index:O,props:t,selectedIndex:r};if(S&&(a.push(getControl(T)),"table"===l)){var L={control:q.a.editTable,key:"editTable",index:O+1,props:t,selectedIndex:r};a.push(getControl(L))}return a}),[])}function getControl(t){var r=t.control,a=t.key,l=t.index,O=t.props,T=t.selectedIndex,E=O.i18n,D=O.isChemistry,j=O.disabled,V=O.activeModal,B=O.formulaEditorHorizontalLayout,q=O.formulaEditorNumberPad,X=O.formulaEditorSymbols,$=O.formulaEditorTextBlocks,Z=O.modalData,ee=O.activeActions,te=O.onClick,ne=O.onModal,re=O.onMouseEnter,oe=O.onMouseLeave,ie=O.characterMapModalClassName,ae=O.focusButtonInsideToolbar,se=O.hasCodeEditorFocus,le=O.disableSpokenmathUserInputs,ce=E.labels.ariaLabel,ue=r.icon,de=r.type,fe=E.labels.editor.toolbar[a],ge=!!S.a.findWhere(ee,{action:a}),me="".concat(a).concat(l),ye=l===T?0:-1;switch(de){case"divider":return L.a.createElement(G.a.Divider,{key:me,name:de});case"button":return L.a.createElement(G.a.Button,toolbar_extends({},O,{key:me,name:a,icon:ue,label:fe,tabIndex:ye,isActive:ge,disabled:"undo"!==a&&"redo"!==a?j||se:j,onClick:function onClick(){return te({type:a})}}));case"charactermap":var ve=O.characterMap,be=!0===ve?_toConsumableArray(E.labels.characterMapCharacters):ve;return L.a.createElement(K.a.CharacterMapButton,{key:me,label:E.labels.characterMapIcon,title:E.labels.characterMapTitle,disabled:j||se,characters:be,className:"lrn-wysihtml-toolbar",modalClassName:ie,tabIndex:ye,recoverFocus:ae,onMouseEnter:function onMouseEnter(){return re(E.labels.characterMapTitle)},onMouseLeave:oe,onSelect:function onSelect(t){return te({type:"characterMap",params:t})}});case"characterMathMap":var _e=_toConsumableArray(E.labels.characterMapMathCharacters);return(L.a.createElement(K.a.CharacterMapButton,{key:me,label:E.labels.characterMapMathIcon,title:E.labels.characterMathMapTitle,onMouseEnter:function onMouseEnter(){return re(E.labels.characterMathMapTitle)},onMouseLeave:oe,disabled:j||se,characters:_e,tabIndex:ye,recoverFocus:ae,className:"lrn-wysihtml-toolbar",modalClassName:ie,onSelect:function onSelect(t){return te({type:"characterMap",params:t})}}));case"createTable":var we=S.a.findWhere(ee,{action:"editTable"});return(L.a.createElement(Q.CreateTableButton,toolbar_extends({},O,{key:me,name:a,icon:ue,tabIndex:ye,label:fe,disabled:j||se,visible:!we,onApply:function onApply(t){return te({type:"createTable",params:t})},onModal:function onModal(t){return ne(t?"createTable":null)}})));case"editTable":return L.a.createElement(Q.EditTableButton,toolbar_extends({},O,{key:me,name:a,icon:ue,tabIndex:ye,label:E.labels.editor.editTable,isActive:ge,visible:ge,disabled:j||se,onApply:function onApply(t){return te({type:t.type,params:t.params})},onModal:function onModal(t){return ne(t?"editTable":null)}}));case"insertImage":return L.a.createElement(pe.InsertImageButton,{i18n:E,getContainer:O.getContainer,editableElementSelector:O.editableElementSelector,responseId:O.responseId,key:me,name:"insertImage",icon:ue,tabIndex:ye,label:fe,visible:!0,disabled:j||se,onMouseEnter:re,onMouseLeave:oe,onApply:function onApply(t){return te({type:"insertImage",params:t})},onModal:function onModal(t){return ne(t?"insertImage":null)}});case"formulaEditor":return L.a.createElement(he.a.FormulaEditorButton,{activeModal:V,className:"lrn-wysihtml-toolbar",disabled:j||se,getContainer:O.getContainer,disableSpokenmathUserInputs:le,horizontalLayout:B,i18n:E,icon:ue,isActive:ge,isChemistry:D,key:me,modalData:Z,onApply:function onApply(t){return te(t)},onModal:ne,onMouseEnter:function onMouseEnter(){return re(ce.mathKeyboard.title)},onMouseLeave:oe,tabIndex:ye,symbols:X,textBlocks:$,numberPad:q,title:ce.mathKeyboard.title});default:return null}}function lrnToolbar_extends(){return(lrnToolbar_extends=Object.assign||function(t){for(var r=1;r<arguments.length;r++){var a=arguments[r];for(var l in a)Object.prototype.hasOwnProperty.call(a,l)&&(t[l]=a[l])}return t}).apply(this,arguments)}var ve={WYSIHTML:function withWYSIHTML(t){return function(r){return r.isReviewState?null:L.a.createElement(t,lrnToolbar_extends({},r,{className:"lrn-wysihtml-toolbar",activeClassName:"wysihtml-command-active",role:"group"}))}}(function(t){!function toolbar_inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),r&&toolbar_setPrototypeOf(t,r)}(Toolbar,t);var r=toolbar_createSuper(Toolbar);function Toolbar(){var t;toolbar_classCallCheck(this,Toolbar);for(var a=arguments.length,l=new Array(a),S=0;S<a;S++)l[S]=arguments[S];return toolbar_defineProperty(toolbar_assertThisInitialized(t=r.call.apply(r,[this].concat(l))),"state",{index:0}),toolbar_defineProperty(toolbar_assertThisInitialized(t),"handleKeyDown",(function(r){r.stopPropagation();var a=r.key;if(a===ye||a===me){var l=t.rovingTabIndex(a);t.setState({index:l})}})),toolbar_defineProperty(toolbar_assertThisInitialized(t),"rovingTabIndex",(function(r){for(var a=toolbar_assertThisInitialized(t),l=a.props,S=a.state,O=getControls(l,S.index),T=t.moveIndex(S.index,r,O.length);"divider"===O[T].props.name||"editTable"===O[T].props.name;)T=t.moveIndex(T,r,O.length);return T})),toolbar_defineProperty(toolbar_assertThisInitialized(t),"moveIndex",(function(t,r,a){var l=t,S=ge.a.getKeyDirection(r);return S===ge.a.direction.LEFT?l--:S===ge.a.direction.RIGHT&&l++,Math.max(Math.min(l,a-1),0)})),t}return function toolbar_createClass(t,r,a){return r&&toolbar_defineProperties(t.prototype,r),a&&toolbar_defineProperties(t,a),t}(Toolbar,[{key:"componentDidUpdate",value:function componentDidUpdate(t,r){this.state.index!==r.index&&this.props.focusButtonInsideToolbar()}},{key:"render",value:function render(){var t=this.props,r=this.state,a=t.i18n.labels.ariaLabel,l=getControls(t,r.index),S=V()({"lrn-toolbar-rtl":t.toolbarRtlEditingMode},t.className,"lrn_clearfix");return L.a.createElement("div",{className:"lrn-toolbar"},L.a.createElement("div",{ref:t.toolbarRef,onKeyDown:this.handleKeyDown,className:S,role:"toolbar","aria-label":a.longTextV2.toolbar},l),L.a.createElement(SubToolbar,t))}}]),Toolbar}(L.a.Component))};function preview_typeof(t){return(preview_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(t){return typeof t}:function _typeof(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function preview_ownKeys(t,r){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);r&&(l=l.filter((function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable}))),a.push.apply(a,l)}return a}function preview_objectSpread(t){for(var r=1;r<arguments.length;r++){var a=null!=arguments[r]?arguments[r]:{};r%2?preview_ownKeys(Object(a),!0).forEach((function(r){preview_defineProperty(t,r,a[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):preview_ownKeys(Object(a)).forEach((function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(a,r))}))}return t}function preview_extends(){return(preview_extends=Object.assign||function(t){for(var r=1;r<arguments.length;r++){var a=arguments[r];for(var l in a)Object.prototype.hasOwnProperty.call(a,l)&&(t[l]=a[l])}return t}).apply(this,arguments)}function preview_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function preview_defineProperties(t,r){for(var a=0;a<r.length;a++){var l=r[a];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(t,l.key,l)}}function preview_createClass(t,r,a){return r&&preview_defineProperties(t.prototype,r),a&&preview_defineProperties(t,a),t}function preview_inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),r&&preview_setPrototypeOf(t,r)}function preview_setPrototypeOf(t,r){return(preview_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(t,r){return t.__proto__=r,t})(t,r)}function preview_createSuper(t){var r=function preview_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var a,l=preview_getPrototypeOf(t);if(r){var S=preview_getPrototypeOf(this).constructor;a=Reflect.construct(l,arguments,S)}else a=l.apply(this,arguments);return preview_possibleConstructorReturn(this,a)}}function preview_possibleConstructorReturn(t,r){if(r&&("object"===preview_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return preview_assertThisInitialized(t)}function preview_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function preview_getPrototypeOf(t){return(preview_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function preview_defineProperty(t,r,a){return r in t?Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[r]=a,t}var be={fullSize:!1,scrollPosition:null,zoomable:!1,imageSizeText:""},_e=function(t){preview_inherits(ImagePreview,t);var r=preview_createSuper(ImagePreview);function ImagePreview(){var t;preview_classCallCheck(this,ImagePreview);for(var a=arguments.length,l=new Array(a),S=0;S<a;S++)l[S]=arguments[S];return preview_defineProperty(preview_assertThisInitialized(t=r.call.apply(r,[this].concat(l))),"state",preview_objectSpread({},be)),preview_defineProperty(preview_assertThisInitialized(t),"onImageClick",(function(r){if(r.preventDefault(),r.stopPropagation(),t.state.fullSize)t.onToggleFullSize();else{var a=r.currentTarget.getBoundingClientRect(),l=(r.clientX-a.left)/a.width,S=(r.clientY-a.top)/a.height;t.setState({fullSize:!0},(function(){t.scrollToPosition(l,S)}))}})),preview_defineProperty(preview_assertThisInitialized(t),"validateImageSize",(function(){if(t.image&&t.imageWrapper){var r=t.props.labels,a=t.image,l=a.naturalWidth,S=a.naturalHeight,O=t.imageWrapper.getBoundingClientRect();t.setState({imageSizeText:Object(re.a)(r.imagePreviewText,{width:l,height:S}),zoomable:l>O.width||S>O.height})}})),preview_defineProperty(preview_assertThisInitialized(t),"close",(function(){t.setState(be),t.props.onClose()})),preview_defineProperty(preview_assertThisInitialized(t),"onToggleFullSize",(function(){t.setState({fullSize:!t.state.fullSize})})),t}return preview_createClass(ImagePreview,[{key:"render",value:function render(){var t=this,r=this.props,a=this.state,l=r.url,S=r.labels,O=a.fullSize,T=a.zoomable,E=a.imageSizeText;if(!l)return null;var D=V()({"full-size":O,zoomable:T}),j=T?{onClick:this.onImageClick}:{};return L.a.createElement("div",{className:"lrn-image-preview"},L.a.createElement("div",{className:"lrn-image-preview-toolbar"},L.a.createElement("div",{className:"lrn-image-preview-size-label"},E),L.a.createElement("div",{className:"lrn-image-preview-control"},L.a.createElement("a",{className:"lrn_btn lrn-btn-outline snow-theme",href:l,target:"_blank"},S.openImageURL),T&&L.a.createElement("button",{className:"lrn_btn lrn-btn-outline snow-theme",onClick:this.onToggleFullSize,type:"button"},O?S.zoomOut:S.zoomIn)),L.a.createElement("div",{className:"close-button"},L.a.createElement("button",{className:"lrn_btn lrn-btn-outline snow-theme lrn-btn-close",type:"button",onClick:this.close},L.a.createElement("span",{className:"lrn-icon-clear"})))),L.a.createElement("div",{className:"lrn-image-wrapper-container"},L.a.createElement("div",{className:"lrn-image-wrapper",ref:function ref(r){return t.imageWrapper=r}},L.a.createElement("img",preview_extends({src:l,className:D,onLoad:this.validateImageSize,ref:function ref(r){return t.image=r},alt:S.imageTitle},j)))))}},{key:"scrollToPosition",value:function scrollToPosition(t,r){var a=this.image.getBoundingClientRect(),l=a.width,S=a.height,O=this.imageWrapper.getBoundingClientRect(),T=parseInt(t*l-O.width/2,10),L=parseInt(r*S-O.height/2,10);this.imageWrapper.scrollTop=L,this.imageWrapper.scrollLeft=T}}]),ImagePreview}(L.a.PureComponent),we=function withImageClickDetection(t){return function(r){preview_inherits(_class2,r);var a=preview_createSuper(_class2);function _class2(){var t;preview_classCallCheck(this,_class2);for(var r=arguments.length,l=new Array(r),S=0;S<r;S++)l[S]=arguments[S];return preview_defineProperty(preview_assertThisInitialized(t=a.call.apply(a,[this].concat(l))),"state",{url:null}),preview_defineProperty(preview_assertThisInitialized(t),"onContainerClick",(function(r){r.preventDefault(),r.stopPropagation(),"IMG"===r.target.tagName&&(t.setState({url:r.target.src}),t.props.onOpen())})),preview_defineProperty(preview_assertThisInitialized(t),"onClose",(function(){t.setState({url:null}),t.props.onClose()})),t}return preview_createClass(_class2,[{key:"componentDidMount",value:function componentDidMount(){this.container=this.props.getContainer(),this.container.addEventListener("click",this.onContainerClick)}},{key:"componentDidUpdate",value:function componentDidUpdate(t,r){r.url!==this.state.url&&(this.state.url?this.container.removeEventListener("click",this.onContainerClick):this.container.addEventListener("click",this.onContainerClick))}},{key:"render",value:function render(){return L.a.createElement(t,preview_extends({},this.props,{url:this.state.url,onClose:this.onClose}))}}]),_class2}(L.a.PureComponent)}(_e),Ce=a(257);function Tooltip(t){var r=t.disabled,a=t.activeAction;return r?null:L.a.createElement("span",null,a)}function CharacterExceededIndicator(t){var r=t.characterCount,a=t.characterMaxLength,l=t.i18n.labels,S=r-a,O=Object(re.a)(l.characterLimitExceeded,{num:S});return L.a.createElement("span",{className:"lrn_length_indicator lrn_charactercount_warning_label"},L.a.createElement("span",{className:"lrn_character_count"},O),L.a.createElement(AccessibleCounter,{textToAnnounce:O}))}function LengthIndicator(t){var r=t.wordCountExceeded,a="lrn_length_indicator  ".concat(r?"lrn_wordcount_warning_label":"");return L.a.createElement("span",{className:a}," ",L.a.createElement(WordCount,t),L.a.createElement(WordStatic,t),L.a.createElement(WordLimit,t),L.a.createElement(AccessibleCounter,t))}function WordCount(t){var r=t.wordCountVisible,a=t.wordCount;return r?L.a.createElement("span",{className:"lrn_word_count"},a):null}function AccessibleCounter(t){var r=t.textToAnnounce;return(L.a.createElement("span",{className:"sr-only","aria-live":"polite","aria-atomic":"true"},r))}function WordStatic(t){var r=t.wordStaticVisible,a=t.wordCountVisible,l=t.i18n.labels.word;return r&&a?L.a.createElement("span",{className:"lrn_static_words"},l):null}function WordLimit(t){var r=t.wordLimitVisible,a=t.wordCountVisible,l=t.wordMaxLength,S=a?" /":"",O=t.i18n.labels.wordLength,T="".concat(S," ").concat(l," ").concat(O);return r?L.a.createElement("span",{className:"lrn_word_limit"},T):null}var Se=function Footer(t){var r=t.characterCountExceeded?L.a.createElement(CharacterExceededIndicator,t):L.a.createElement(LengthIndicator,t);return L.a.createElement("footer",{className:"lrn-toolbar-footer  lrn_clearfix"},L.a.createElement("div",{className:"lrn_toolbar_footer_left"},L.a.createElement(Tooltip,t)),L.a.createElement("div",{className:"lrn_toolbar_footer_right"},r))},xe=a(21);function longTextV2_typeof(t){return(longTextV2_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(t){return typeof t}:function _typeof(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function longTextV2_extends(){return(longTextV2_extends=Object.assign||function(t){for(var r=1;r<arguments.length;r++){var a=arguments[r];for(var l in a)Object.prototype.hasOwnProperty.call(a,l)&&(t[l]=a[l])}return t}).apply(this,arguments)}function longTextV2_defineProperties(t,r){for(var a=0;a<r.length;a++){var l=r[a];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(t,l.key,l)}}function longTextV2_setPrototypeOf(t,r){return(longTextV2_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(t,r){return t.__proto__=r,t})(t,r)}function longTextV2_createSuper(t){var r=function longTextV2_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var a,l=longTextV2_getPrototypeOf(t);if(r){var S=longTextV2_getPrototypeOf(this).constructor;a=Reflect.construct(l,arguments,S)}else a=l.apply(this,arguments);return longTextV2_possibleConstructorReturn(this,a)}}function longTextV2_possibleConstructorReturn(t,r){if(r&&("object"===longTextV2_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return longTextV2_assertThisInitialized(t)}function longTextV2_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function longTextV2_getPrototypeOf(t){return(longTextV2_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function longTextV2_defineProperty(t,r,a){return r in t?Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[r]=a,t}var Oe=function(t){!function longTextV2_inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),r&&longTextV2_setPrototypeOf(t,r)}(LongTextV2,t);var r=longTextV2_createSuper(LongTextV2);function LongTextV2(t){var a;return function longTextV2_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,LongTextV2),longTextV2_defineProperty(longTextV2_assertThisInitialized(a=r.call(this,t)),"state",{toolbarActiveActions:[],toolbarRtlEditingMode:ge.a.isRtl(),footerActiveAction:null,isPreviewingImage:!1,previewingImageUrl:null,hasCodeEditorFocus:!1,actionToDo:null,activeModal:null,modalData:null,container:null,textToAnnounce:""}),longTextV2_defineProperty(longTextV2_assertThisInitialized(a),"toolbarRef",L.a.createRef()),longTextV2_defineProperty(longTextV2_assertThisInitialized(a),"setContainerElement",(function(t){return a.el=t})),longTextV2_defineProperty(longTextV2_assertThisInitialized(a),"getContainerElement",(function(){return a.el})),longTextV2_defineProperty(longTextV2_assertThisInitialized(a),"onImagePreviewOpened",(function(){return a.setState({isPreviewingImage:!0})})),longTextV2_defineProperty(longTextV2_assertThisInitialized(a),"onImagePreviewClosed",(function(){return a.setState({isPreviewingImage:!1,previewingImageUrl:null})})),longTextV2_defineProperty(longTextV2_assertThisInitialized(a),"focusButtonInsideToolbar",(function(){var t=a.toolbarRef.current.querySelector("[tabIndex='0']");t&&t.focus()})),longTextV2_defineProperty(longTextV2_assertThisInitialized(a),"onToolbarControlHover",(function(t){a.setState({footerActiveAction:t})})),longTextV2_defineProperty(longTextV2_assertThisInitialized(a),"onToolbarActionToDo",(function(t){t&&"previewImage"===t.type?(a.setState({previewingImageUrl:t.url}),a.onImagePreviewOpened()):a.setState({actionToDo:t})})),longTextV2_defineProperty(longTextV2_assertThisInitialized(a),"onEditorActionDone",(function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=r.type,O=S()([q.c.EDIT_FORMULA,q.c.CREATE_FORMULA]).contains(l);O&&a.props.renderMath(),a.setState(S.a.extend(getToolbarState(t),{actionToDo:null}))})),longTextV2_defineProperty(longTextV2_assertThisInitialized(a),"onEditorInteraction",(function(t){a.setState(getToolbarState(t))})),longTextV2_defineProperty(longTextV2_assertThisInitialized(a),"onEditorValueChange",(function(t){a.props.longTextV2Actions.updateValue(t),a.updateAriaLiveText()})),longTextV2_defineProperty(longTextV2_assertThisInitialized(a),"onMathWidgetPaste",(function(){a.props.renderMath()})),longTextV2_defineProperty(longTextV2_assertThisInitialized(a),"onMathWidgetSelect",(function(t){a.onModal(q.g.FORMULA_EDITOR,t)})),longTextV2_defineProperty(longTextV2_assertThisInitialized(a),"updateAriaLiveText",(function(){var t=a.getWordLimitText();setTimeout((function(){return!a._unmounted&&a.setState({textToAnnounce:t})}),500)})),longTextV2_defineProperty(longTextV2_assertThisInitialized(a),"getWordLimitText",(function(){var t=a.props.longTextV2.footer,r=t.wordCount,l=t.wordMaxLength,S=t.wordCountVisible,O=t.wordLimitVisible,T="of ".concat(l," allowed");return S?"".concat(r," words written ").concat(O?T:""):""})),longTextV2_defineProperty(longTextV2_assertThisInitialized(a),"onModal",(function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;a.setState({modalData:r,activeModal:t})})),longTextV2_defineProperty(longTextV2_assertThisInitialized(a),"onCodeEditorFocusChange",(function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];a.state.hasCodeEditorFocus!==t&&a.setState({hasCodeEditorFocus:t})})),a.onEditorValueChange=S.a.debounce(a.onEditorValueChange,500).bind(longTextV2_assertThisInitialized(a)),a.updateAriaLiveText=S.a.debounce(a.updateAriaLiveText,500),a}return function longTextV2_createClass(t,r,a){return r&&longTextV2_defineProperties(t.prototype,r),a&&longTextV2_defineProperties(t,a),t}(LongTextV2,[{key:"shouldComponentUpdate",value:function shouldComponentUpdate(){return!this._unmounted}},{key:"componentWillUnmount",value:function componentWillUnmount(){this._unmounted=!0}},{key:"render",value:function render(){var t=this,r=this.props,a=r.base,l=r.longTextV2,O=r.canInsertImage,T=a.isReviewState,E=a.isPreviewState,D=a.readOnly,j=a.disabled,q=a.i18n,G=a.fontSizeClass,K=a.responseId,X=(a.isLDS,a.resetState,l.wordCountExceeded),$=l.characterCountExceeded,Z=l.disableAutoLink,Q=this.state,ee=Q.toolbarActiveActions,te=Q.toolbarRtlEditingMode,ne=Q.isPreviewingImage,re=Q.previewingImageUrl,oe=Q.footerActiveAction,ie=Q.hasCodeEditorFocus,ae=Q.actionToDo,se=Q.activeModal,le=Q.modalData,ce=Q.container,ue=Q.textToAnnounce,de=V()({lrn_texteditor_inactive:se,lrn_hide:ne},"lrn_texteditor"),pe=j||D,fe=V()({lrn_active:ie},"lrn_longtextinput"),he="chemistryessayV2"===a.questionType,ge=a.disableSpokenmathUserInputs,me=l.toolbar.formattingOptions,ye=!S.a.contains(me,"image"),be=!S.a.contains(me,"formulaEditor"),xe=q.labels.longTextV2,Oe=xe.invalidExternalImageWarning,Te=xe.invalidExternalMathWarning;return L.a.createElement(B.a,{responsive:O},L.a.createElement("div",{className:"lrn_response_input_wrapper"},L.a.createElement("div",{className:de,ref:this.setContainerElement},L.a.createElement(ve.WYSIHTML,longTextV2_extends({},l.toolbar,{toolbarRtlEditingMode:te,isReviewState:T,isPreviewState:E,disableSpokenmathUserInputs:ge,i18n:q,isChemistry:he,characterMapModalClassName:G,disabled:pe||se,hasCodeEditorFocus:ie,activeActions:ee,activeModal:se,modalData:le,responseId:K,getContainer:function getContainer(){return ce},editableElementSelector:".".concat(fe),onMouseEnter:this.onToolbarControlHover,onMouseLeave:function onMouseLeave(){return t.onToolbarControlHover(null)},onClick:this.onToolbarActionToDo,onModal:this.onModal,focusButtonInsideToolbar:this.focusButtonInsideToolbar,toolbarRef:this.toolbarRef})),L.a.createElement(Ce.a.WYSIHTML,longTextV2_extends({},l.lrnEditor,{isReviewState:T,readOnly:D,className:fe,disabled:pe,inactive:!!se,i18n:q,limitExceeded:X||$,actionToDo:ae,focusButtonInsideToolbar:this.focusButtonInsideToolbar,onInteraction:this.onEditorInteraction,onValueChange:this.onEditorValueChange,onActionDone:this.onEditorActionDone,onMathWidgetSelect:this.onMathWidgetSelect,onMathWidgetPaste:this.onMathWidgetPaste,onCodeEditorFocusChange:this.onCodeEditorFocusChange,disableAutoLink:Z,invalidExternalImageWarning:Oe,invalidExternalMathWarning:Te,stripExternalPastedImages:ye,stripExternalPastedMath:be})),L.a.createElement(Se,longTextV2_extends({},l.footer,{textToAnnounce:ue,i18n:q,disabled:pe,wordCountExceeded:X,characterCountExceeded:$,activeAction:oe}))),D&&L.a.createElement(we,{labels:q.labels.editor.modals,getContainer:this.getContainerElement,onOpen:this.onImagePreviewOpened,onClose:this.onImagePreviewClosed}),!D&&O&&L.a.createElement(_e,{url:re,labels:q.labels.editor.modals,visible:ne,getContainer:this.getContainerElement,onOpen:this.onImagePreviewOpened,onClose:this.onImagePreviewClosed})))}},{key:"componentDidMount",value:function componentDidMount(){this.setState({container:this.el})}}]),LongTextV2}(L.a.Component);function getToolbarState(t){return{toolbarActiveActions:t,toolbarRtlEditingMode:S.a.isEmpty(t)?ge.a.isRtl():S.a.some(t,{action:"textDirectionRtl"})}}var Te=D.b((function(t){return{base:t.base,longTextV2:t.longTextV2,canInsertImage:S.a.contains(t.longTextV2.toolbar.formattingOptions,"image")}}),(function(t){return{longTextV2Actions:E.b(se.a,t),renderMath:E.b(xe.a.renderMathIfRequired,t)}}))(Oe),Pe=a(27),Le=a(211),Ee=a(204),Me=a(246),ke=a(199);function dataService_typeof(t){return(dataService_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(t){return typeof t}:function _typeof(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function dataService_arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var a=0,l=new Array(r);a<r;a++)l[a]=t[a];return l}function dataService_defineProperties(t,r){for(var a=0;a<r.length;a++){var l=r[a];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(t,l.key,l)}}function _get(t,r,a){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function _get(t,r,a){var l=function _superPropBase(t,r){for(;!Object.prototype.hasOwnProperty.call(t,r)&&null!==(t=dataService_getPrototypeOf(t)););return t}(t,r);if(l){var S=Object.getOwnPropertyDescriptor(l,r);return S.get?S.get.call(a):S.value}})(t,r,a||t)}function dataService_setPrototypeOf(t,r){return(dataService_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(t,r){return t.__proto__=r,t})(t,r)}function dataService_createSuper(t){var r=function dataService_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var a,l=dataService_getPrototypeOf(t);if(r){var S=dataService_getPrototypeOf(this).constructor;a=Reflect.construct(l,arguments,S)}else a=l.apply(this,arguments);return dataService_possibleConstructorReturn(this,a)}}function dataService_possibleConstructorReturn(t,r){if(r&&("object"===dataService_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return dataService_assertThisInitialized(t)}function dataService_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function dataService_getPrototypeOf(t){return(dataService_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Ie=function(t){!function dataService_inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),r&&dataService_setPrototypeOf(t,r)}(LongTextV2DataService,t);var r=dataService_createSuper(LongTextV2DataService);function LongTextV2DataService(t,a){var l;return function dataService_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,LongTextV2DataService),l=r.call(this,t,a),Object(Le.a)(dataService_assertThisInitialized(l)),Object(Me.a)(dataService_assertThisInitialized(l)),l}return function dataService_createClass(t,r,a){return r&&dataService_defineProperties(t.prototype,r),a&&dataService_defineProperties(t,a),t}(LongTextV2DataService,[{key:"getInitialState",value:function getInitialState(){var t=_get(dataService_getPrototypeOf(LongTextV2DataService.prototype),"getInitialState",this).call(this),r=this.placeholder,a=this.browserSpellCheck,l=Object(Ee.a)(a),O=Object(Ee.b)(a),T=Object(Ee.c)(a),L=this.isReviewState?this.getReviewResponseValue():this.responseValue,E=this.uiStyle,D=this.wordCount,j=this.wordCountExceeded,V=this.wordCountVisible,B=this.wordLimitVisibility,q=B.wordStatic,G=B.wordLimit,K=this.wordMaxLength,X=this.characterCount,$=this.characterCountExceeded,Z=this.characterMaxLength,Q=this.formattingOptions,ee=this.characterMap,te=this.disableAutoLink,ne=this.formulaEditorHorizontalLayout,re=this.formulaEditorSymbols,oe=this.formulaEditorTextBlocks,ie=this.formulaEditorNumberPad;return S.a.extend(t,{longTextV2:{wordCountExceeded:j,characterCountExceeded:$,disableAutoLink:te,maxFileSize:this.maxFileSize,warningFileSize:this.warningFileSize,toolbar:{formattingOptions:Q,characterMap:ee,formulaEditorHorizontalLayout:ne,formulaEditorNumberPad:ie,formulaEditorSymbols:re,formulaEditorTextBlocks:oe},lrnEditor:{placeholder:r,spellCheck:a,autocapitalize:l,autocomplete:O,autocorrect:T,responseValue:L,uiStyle:E},footer:{wordCount:D,wordCountVisible:V,wordStaticVisible:q,wordLimitVisible:G,wordMaxLength:K,characterCount:X,characterMaxLength:Z}}})}},{key:"getWordLimitVisibility",value:function getWordLimitVisibility(){return this.wordLimitVisibility}},{key:"getWordCountExceeded",value:function getWordCountExceeded(){return this.wordCountExceeded}},{key:"getCharacterCountExceeded",value:function getCharacterCountExceeded(){return this.characterCountExceeded}},{key:"formatValue",value:function formatValue(t){return t=(t||"").replace(/<p[^>]*>\s?<\/p>/gi,"")}},{key:"wordLimitVisibility",get:function get(){var t,r,a=this.model,l=a.SHOW_WORD_LIMITS,S=a.getShowWordLimit();return S===l.ALWAYS||S===l.ON&&this.wordCountExceeded?(r=!0,t=!1):(r=!1,t=!0),{wordLimit:r,wordStatic:t}}},{key:"placeholder",get:function get(){return this.model.getPlaceholder()}},{key:"browserSpellCheck",get:function get(){return this.model.getBrowserSpellCheck()}},{key:"disableAutoLink",get:function get(){return this.model.disableAutoLink()}},{key:"formulaEditorHorizontalLayout",get:function get(){return!!this.question.horizontal_layout}},{key:"formulaEditorNumberPad",get:function get(){return this.question.numberPad}},{key:"formulaEditorSymbols",get:function get(){return this.question.symbols}},{key:"formulaEditorTextBlocks",get:function get(){return this.question.text_blocks}},{key:"responseValue",get:function get(){var t=this.getResponse();return S.a.getNested(t,"value")}},{key:"uiStyle",get:function get(){var t=S.a.extend({},this.model.getUIStyle());return t.minHeight=t.min_height||"",t.maxHeight=t.max_height||"",delete t.min_height,delete t.max_height,t}},{key:"wordCount",get:function get(){return this.model.getWordCount()}},{key:"wordCountExceeded",get:function get(){return this.model.wordCountExceeded()}},{key:"wordCountVisible",get:function get(){return this.model.getShowWordCount()}},{key:"wordMaxLength",get:function get(){return this.model.getMaxLength()}},{key:"getCharacterCount",value:function getCharacterCount(){return this.characterCount}},{key:"characterCount",get:function get(){return this.model.getCharacterCount()}},{key:"characterCountExceeded",get:function get(){return this.model.characterCountExceeded()}},{key:"characterMaxLength",get:function get(){return this.model.getMaxCharacterLength()}},{key:"formattingOptions",get:function get(){return this.model.getFormattingOptions()}},{key:"getReviewResponseValue",value:function getReviewResponseValue(){var t=this.responseValue;return ke.a.parse(t)}}]),LongTextV2DataService}(Pe.a);Ie.prototype.EXPOSED_METHODS=[].concat(function dataService_toConsumableArray(t){return function dataService_arrayWithoutHoles(t){if(Array.isArray(t))return dataService_arrayLikeToArray(t)}(t)||function dataService_iterableToArray(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function dataService_unsupportedIterableToArray(t,r){if(!t)return;if("string"==typeof t)return dataService_arrayLikeToArray(t,r);var a=Object.prototype.toString.call(t).slice(8,-1);"Object"===a&&t.constructor&&(a=t.constructor.name);if("Map"===a||"Set"===a)return Array.from(t);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return dataService_arrayLikeToArray(t,r)}(t)||function dataService_nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(Ie.prototype.EXPOSED_METHODS),["getWordLimitVisibility","getWordCountExceeded","getCharacterCountExceeded","getCharacterCount","formatValue"]);var Ae=Ie,Re=a(215);r.a=O.a.extend({maskable:!1,ViewComponent:Te,DataService:Ae,getReducers:function getReducers(){var t=O.a.prototype.getReducers.apply(this,arguments);return S.a.extend(t,{longTextV2:Re.a})}})},272:function(t,r,a){"use strict";var l=a(0),S=a.n(l),O=a(201),T=a(136),L=a(206),E=a.n(L),D=a(217);function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(t){return typeof t}:function _typeof(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,r){for(var a=0;a<r.length;a++){var l=r[a];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(t,l.key,l)}}function _setPrototypeOf(t,r){return(_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(t,r){return t.__proto__=r,t})(t,r)}function _createSuper(t){var r=function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var a,l=_getPrototypeOf(t);if(r){var S=_getPrototypeOf(this).constructor;a=Reflect.construct(l,arguments,S)}else a=l.apply(this,arguments);return _possibleConstructorReturn(this,a)}}function _possibleConstructorReturn(t,r){if(r&&("object"===_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var j=function(t){!function _inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),r&&_setPrototypeOf(t,r)}(ClozeFormulaScorer,t);var r=_createSuper(ClozeFormulaScorer);function ClozeFormulaScorer(t){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};_classCallCheck(this,ClozeFormulaScorer);var l=a.includeError;return S.a.isObject(a)&&S.a.isNumber(a.mathcoreTimeoutDuration)?E.a.setTimeoutDuration(a.mathcoreTimeoutDuration):E.a.setTimeoutDuration(5e3),r.call(this,t,{includeError:l})}return function _createClass(t,r,a){return r&&_defineProperties(t.prototype,r),a&&_defineProperties(t,a),t}(ClozeFormulaScorer,[{key:"flags",get:function get(){return{validateSingleSpec:D.a}}}]),ClozeFormulaScorer}(T.a);function clozeformulaV2_scoring_typeof(t){return(clozeformulaV2_scoring_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(t){return typeof t}:function _typeof(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function clozeformulaV2_scoring_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function clozeformulaV2_scoring_setPrototypeOf(t,r){return(clozeformulaV2_scoring_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(t,r){return t.__proto__=r,t})(t,r)}function clozeformulaV2_scoring_createSuper(t){var r=function clozeformulaV2_scoring_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var a,l=clozeformulaV2_scoring_getPrototypeOf(t);if(r){var S=clozeformulaV2_scoring_getPrototypeOf(this).constructor;a=Reflect.construct(l,arguments,S)}else a=l.apply(this,arguments);return clozeformulaV2_scoring_possibleConstructorReturn(this,a)}}function clozeformulaV2_scoring_possibleConstructorReturn(t,r){if(r&&("object"===clozeformulaV2_scoring_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function clozeformulaV2_scoring_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function clozeformulaV2_scoring_getPrototypeOf(t){return(clozeformulaV2_scoring_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var V=function(t){!function clozeformulaV2_scoring_inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),r&&clozeformulaV2_scoring_setPrototypeOf(t,r)}(ClozeFormulaV2Scorer,t);var r=clozeformulaV2_scoring_createSuper(ClozeFormulaV2Scorer);function ClozeFormulaV2Scorer(){return clozeformulaV2_scoring_classCallCheck(this,ClozeFormulaV2Scorer),r.apply(this,arguments)}return ClozeFormulaV2Scorer}(j),B=a(228);function clozechemistry_scoring_typeof(t){return(clozechemistry_scoring_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(t){return typeof t}:function _typeof(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function clozechemistry_scoring_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function clozechemistry_scoring_defineProperties(t,r){for(var a=0;a<r.length;a++){var l=r[a];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(t,l.key,l)}}function clozechemistry_scoring_setPrototypeOf(t,r){return(clozechemistry_scoring_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(t,r){return t.__proto__=r,t})(t,r)}function clozechemistry_scoring_createSuper(t){var r=function clozechemistry_scoring_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var a,l=clozechemistry_scoring_getPrototypeOf(t);if(r){var S=clozechemistry_scoring_getPrototypeOf(this).constructor;a=Reflect.construct(l,arguments,S)}else a=l.apply(this,arguments);return clozechemistry_scoring_possibleConstructorReturn(this,a)}}function clozechemistry_scoring_possibleConstructorReturn(t,r){if(r&&("object"===clozechemistry_scoring_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function clozechemistry_scoring_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function clozechemistry_scoring_getPrototypeOf(t){return(clozechemistry_scoring_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var q=function(t){!function clozechemistry_scoring_inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),r&&clozechemistry_scoring_setPrototypeOf(t,r)}(ClozeChemistryScorer,t);var r=clozechemistry_scoring_createSuper(ClozeChemistryScorer);function ClozeChemistryScorer(){return clozechemistry_scoring_classCallCheck(this,ClozeChemistryScorer),r.apply(this,arguments)}return function clozechemistry_scoring_createClass(t,r,a){return r&&clozechemistry_scoring_defineProperties(t.prototype,r),a&&clozechemistry_scoring_defineProperties(t,a),t}(ClozeChemistryScorer,[{key:"flags",get:function get(){return{validateSingleSpec:B.a}}}]),ClozeChemistryScorer}(T.a);r.a=O.a.extend({processResponseValue:function processResponseValue(t){var r=this.hasResponse();if(!r||!t){var a=r?this.get("response").dynamic:void 0,l={value:[],responses:{},type:this.RESPONSE_TYPE.ARRAY};a&&(l.dynamic=a),this.set({response:l},{silent:!0})}t&&S.a.deepExtend(this.get("response"),t)},isDefaultValidResponseValue:function isDefaultValidResponseValue(t){var r=function hasInnerValue(t){return S.a.isObject(t)&&(t.value||t.method)};return 0===S.a.filter(t,(function(t){return S.a.isArray(t)&&0!==S()(t).filter(r).length})).length},getScorerClass:function getScorerClass(){var t;switch(this.get("type")){case this.TYPE.CLOZEFORMULA:t=j;break;case this.TYPE.CLOZEFORMULAV2:t=V;break;case this.TYPE.IMAGECLOZEFORMULA:t=j;break;case this.TYPE.CLOZECHEMISTRY:case this.TYPE.IMAGECLOZECHEMISTRY:t=q}return t},getScorer:function getScorer(){if(!this.scorer||this._prevModifiedForScorer!==this.lastModified)if(this._prevModifiedForScorer=this.lastModified,this.scorer)this.scorer.reset(this.toJSON());else{var t=this.getScorerClass();0,this.scorer=new t(this.toJSON(),{mathcoreTimeoutDuration:5e3,includeError:!1})}return this.scorer},getCorrectByIndex:function getCorrectByIndex(t){if(this.canValidateResponse()){this.get("question");var r,a=this.getValidResponse().value;return S.a.isArray(a)&&a.length>t&&(a=a[t],S.a.isArray(a)&&(r=S.a.find(a,(function(t){return S.a.isObject(t)&&S.a.isString(t.value)})))),r?r.value:""}}})},286:function(t,r,a){var l,S;l=[a(1)],void 0===(S=function(t){"use strict";var r={};return{publish:function(a,l){r[a]&&t.each(r[a],(function(){this&&this.apply(t,l||[])}))},subscribe:function(t,a){return r[t]||(r[t]=[]),r[t].push(a),[t,a]},unsubscribe:function(a){var l=a[0];r[l]&&t.each(r[l],(function(t){this==a[1]&&r[l].splice(t,1)}))},reset:function(){r={}}}}.apply(r,l))||(t.exports=S)},290:function(t,r,a){"use strict";a.d(r,"a",(function(){return l}));var l={recursionDepthHigh:13,recursionDepthLow:8};r.b={keepMouseEventHandlers:function keepMouseEventHandlers(t){t.hasMouseHandlers||t.addMouseEventHandlers()}}},314:function(t,r,a){"use strict";a.d(r,"d",(function(){return define})),a.d(r,"b",(function(){return addLocalDependency})),a.d(r,"a",(function(){return addAsyncDependency}));var l=a(2);function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(t){return typeof t}:function _typeof(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function safeGet(t,r){return r.split(".").reduce((function(t,r){return t&&t[r]}),t)}function isFunction(t){return"function"==typeof t}function loadDep(t,r){if(E.shim[t])return function loadByShim(t,r){var a=E.shim[t];return _require(a.deps||[],(function(){return loadScript(t).then(a.exportsFn||function(){return a.init&&a.init()||safeGet(window,a.exports)})}),null,r)}(t,r);var a=function defer(){var t={};return t.promise=new l.default((function(r,a){t.resolve=r,t.reject=a})),t}();return a.name=t,a.path=r,function invokeLater(t,r){function cleanup(){j=null}D=D.then((function(){return j=t,r()})).then(cleanup,cleanup)}(a,(function(){return loadScript(t).then((function(){setTimeout(a.resolve,100)})).catch((function(){a.reject(new Error('Error while loading module "'+t+'"'))}))})),a.promise}function loadScript(t){return new l.default((function(r,a){var l=_require2.load(null,t,toUrl(t,!0));l.onerror=a,l.onload=r}))}var S=/(\/\*([\s\S]*?)\*\/|([^:]|^)\/\/(.*)$)/gm,O=/[^.]\s*require\s*\(\s*["']([^'"\s]+)["']\s*\)/g;function _require(t,r,a,S){var O=S.slice(-1)[0];return new l.default((function(r,a){l.default.all(t.map((function(t){if(S.indexOf(t)>-1)return l.default.reject(new Error("Circular dependency: "+S.concat(t).join(" -> ")));var r=S.concat(t);return V[t]?V[t](O):(t.indexOf("!")>-1&&(T[t]=function loadWithPlugin(t,r){var a=t.indexOf("!"),S=t.substr(0,a);return t=t.substr(a+1),_require([S],(function(a){return new l.default((function(l,S){function localRequire(){if(!O)return _require2.apply(null,arguments)}Object.keys(_require2).forEach((function(t){localRequire[t]=_require2[t]}));var O=!1;l.error=S,l.fromText=function(t,a){a||(a=t);var T=j;j={name:t,resolve:l,reject:S,path:r},new Function(a)(),j=T,O=!0},a.load(t,localRequire,l,E)}))}),null,r)}(t,r)),L[t]?T[t]=l.default.resolve().then((function(){return _require.apply(null,L[t].concat([r]))})):T[t]||(B[t]?T[t]=B[t]():T[t]=loadDep(t,r)),T[t])}))).then(r,a)})).then((function(t){if(isFunction(r)){var a=r.apply(null,t);return O&&safeGet(T[O],"module.exports")||a}return r}),(function(t){return isFunction(a)&&a(t),_require2.onError(t),l.default.reject(t)}))}function _require2(t,r,a){return _require(t,r,a,[])}var T,L,E,D,j,V={require:function require(t){return _require2},module:function module(t){var module=T[t];if(!module)throw new Error('Module "module" should be required only by modules');return module.module=module.module||{id:t,config:function config(){return E.config[t]||{}}}},exports:function exports(t){return V.module(t).exports={}}};function toUrl(t,r){var a=Object.keys(E.bundles).filter((function(r){return E.bundles[r].indexOf(t)>-1}))[0];return a?_require2.toUrl(a):(E.paths[t]&&(t=E.paths[t]),/^([\w\+\.\-]+:)?\//.test(t)||(t=E.baseUrl+t),r&&t.indexOf(".js")<0&&(t+=".js"),E.urlArgs&&(t+="?"+E.urlArgs),t)}function define(t,r,a){"string"!=typeof t&&(a=r,r=t,t=null),Array.isArray(r)||(a=r,r=[]);var l=j;if(null===t&&!l)throw new Error("Unexpected define!");if(0===r.length&&a.length>0){var T=function wrapCommonJS(t,r){var a=[];return r.toString().replace(S,"").replace(O,(function(t,r){a.push(r)})),{deps:a,factory:function factory(){var l=arguments,S=a.reduce((function(t,r,a){return t[r]=l[a],t}),{});return r((function localRequire(t){if(!S[t])throw new Error('Module "'+a+'" has not been loaded yet');return S[t]}),V.module(t),V.exports(t))}}}(t||l.name,a);r=T.deps,a=T.factory}if(null===t||l&&l.name===t){var E=_require(r,a,l.reject,l.path);l.resolve(E)}else L[t]=[r,a,null]}function addLocalDependency(t,r){T[t]||(T[t]=r)}_require2.resetContext=function(){E={urlArgs:"",baseUrl:"./",paths:{},shim:{},bundles:{},config:{}},T={},L={},D=l.default.resolve(),j=null},_require2.config=function(t){E=function deepmerge(t,r){var a=Array.isArray(r),l=a&&[]||{};return a?(t=t||[],l=l.concat(t),r.forEach((function(r,a){void 0===l[a]?l[a]=r:"object"===_typeof(r)?l[a]=deepmerge(t[a],r):-1===t.indexOf(r)&&l.push(r)}))):(t&&"object"===_typeof(t)&&Object.keys(t).forEach((function(r){l[r]=t[r]})),Object.keys(r).forEach((function(a){"object"===_typeof(r[a])&&r[a]&&t[a]?l[a]=deepmerge(t[a],r[a]):l[a]=r[a]}))),l}(E,t)},_require2.load=function(t,r,a){var l=document.createElement("script");return l.src=a,l.async=!0,document.getElementsByTagName("body")[0].appendChild(l),l},_require2.toUrl=function(t){return toUrl(t,!1)},_require2.specified=function(t){return T.hasOwnProperty(t)},_require2.onError=function(t){console.error(t)},_require2.resetContext();var B={};function addAsyncDependency(t,r){B[t]||(B[t]=r)}r.c=_require2},315:function(t,r,a){"use strict";var l=a(0),S=a.n(l),O=a(316),T=a(206),L=a.n(T),E=(a(190),a(217));function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(t){return typeof t}:function _typeof(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _setPrototypeOf(t,r){return(_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(t,r){return t.__proto__=r,t})(t,r)}function _createSuper(t){var r=function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var a,l=_getPrototypeOf(t);if(r){var S=_getPrototypeOf(this).constructor;a=Reflect.construct(l,arguments,S)}else a=l.apply(this,arguments);return _possibleConstructorReturn(this,a)}}function _possibleConstructorReturn(t,r){if(r&&("object"===_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var D=function(t){!function _inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),r&&_setPrototypeOf(t,r)}(FormulaScorer,t);var r=_createSuper(FormulaScorer);function FormulaScorer(t,a){return function _classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,FormulaScorer),S.a.isObject(a)&&S.a.isNumber(a.mathcoreTimeoutDuration)?L.a.setTimeoutDuration(a.mathcoreTimeoutDuration):L.a.setTimeoutDuration(5e3),r.call(this,t,a)}return FormulaScorer}(O.a);D.prototype.validateSingleSpec=E.a,r.a=D},316:function(t,r,a){"use strict";var l=a(0),S=a.n(l),O=a(35),T=a(10);function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(t){return typeof t}:function _typeof(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,r){for(var a=0;a<r.length;a++){var l=r[a];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(t,l.key,l)}}function _setPrototypeOf(t,r){return(_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(t,r){return t.__proto__=r,t})(t,r)}function _createSuper(t){var r=function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var a,l=_getPrototypeOf(t);if(r){var S=_getPrototypeOf(this).constructor;a=Reflect.construct(l,arguments,S)}else a=l.apply(this,arguments);return _possibleConstructorReturn(this,a)}}function _possibleConstructorReturn(t,r){if(r&&("object"===_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var L=["exactMatch"],E=function isDefaultValidResponseValue(t){return 0===S.a.filter(t,(function(t){return t&&(t.value||t.method||0===t.value)})).length},D=function(t){!function _inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),r&&_setPrototypeOf(t,r)}(MathScorer,t);var r=_createSuper(MathScorer);function MathScorer(){return _classCallCheck(this,MathScorer),r.apply(this,arguments)}return function _createClass(t,r,a){return r&&_defineProperties(t.prototype,r),a&&_defineProperties(t,a),t}(MathScorer,[{key:"reset",value:function reset(t){var r=JSON.stringify(t),a=this.validateSingleSpec||this.cachedValidateSingleSpec;if(this.serializedData!==r){try{this.scoringData=function getScoringData(t,r){if(!function canValidateResponse(t){if(!1===S.a.getNested(t,"validation.automarkable"))return!1;var r=t.validation||t;return!(S.a.isEmpty(r)||!(r.valid_responses||r.valid_response&&!E(r.valid_response.value)))}(t.question))return{automarkable:!1};t.response=t.response||{};var a,l,O=t.response&&t.response.value,D=[];t.question.equiv_literal_legacy&&(t=T.a.processCompatibility(t));if(l=!!t.question.validation.allow_negative_scores,t.response=t.response||{},t.question.validation.scoring_type){if(!S.a.contains(L,t.question.validation.scoring_type))throw new T.a.InvalidScoringTypeException(t.question.type,t.question.validation.scoring_type);t.question.validation.valid_response&&D.push(t.question.validation.valid_response),t.question.validation.alt_responses&&(D=D.concat(t.question.validation.alt_responses)),a=Math.abs(S.a.isNumber(t.question.validation.penalty)?t.question.validation.penalty:0)}else D=t.question.validation&&t.question.validation.valid_responses||[];var j=T.a.validateMathLists(O,D,r,1,a);void 0===j.scoreWithFullPenalty?j.score=null:j.score=l?j.scoreWithFullPenalty:Math.max(0,j.scoreWithFullPenalty);return j}(t,a),T.a.normalizeScores(this.scoringData,t)}catch(t){this.scoringData={error:t}}this.serializedData=r}return this.cachedValidateSingleSpec=a,this}}]),MathScorer}(O.a);r.a=D},321:function(t,r,a){"use strict";var l=a(0),S=a.n(l),O=a(18),T=a.n(O),L=a(157);r.a={getShuffleOption:function getShuffleOption(){return this.shuffleOption||(this.shuffleOption=new L.a(this)),this.shuffleOption},usingPossibleGroupingResponses:function usingPossibleGroupingResponses(){return!!this.get("question").group_possible_responses},getPossibleResponseGroups:function getPossibleResponseGroups(){var t=this.getShuffleOption(),r=S.a.map(this.get("question").possible_response_groups,(function(r){return{title:r.title,responses:t.getOrderedData(r.responses)}}));return S.a.each(r,(function(t){S.a.isString(t.title)?t.title=T.a.stripHTML(T.a.createImageDescriptions(t.title),!0):t.title=""})),r},getPossibleResponseGroupResponses:function getPossibleResponseGroupResponses(){var t,r;return t=this.getPossibleResponseGroups(),S.a.isArray(t)&&t.length&&(r=[],S.a.each(t,(function(t,a){S.a.each(t.responses,(function(t){r.push({value:t,groupIndex:a})}))}))),r},getPossibleResponses:function getPossibleResponses(){var t=this.getShuffleOption().getOrderedData(this.get("question").possible_responses);return S.a.map(t,(function(t){return{value:t}}))}}},344:function(t,r,a){"use strict";a.d(r,"a",(function(){return getFullScreenElement}));a(1),a(7);function getFullScreenElement(){for(var t=["fullscreenElement","webkitFullscreenElement","msFullscreenElement","mozFullScreenElement"],r=0;r<t.length;r++){var a=document[t[r]];if(a)return a}return null}},351:function(t,r,a){"use strict";var l=a(5),S=a.n(l),O=a(0),T=a.n(O),L=(a(1),"stopped"),E="running",D="paused";r.a=S.a.View.extend({state:L,currentLength:void 0,length:5,direction:"down",template:null,showMinutes:!1,counterCompleted:!1,initialize:function initialize(){this.template=this.options.labels.counterTemplate,this.options.hasOwnProperty("length")&&(this.length=this.options.length),this.options.hasOwnProperty("direction")&&(this.direction=this.options.direction),this.options.hasOwnProperty("template")&&(this.template=this.options.template),this.options.hasOwnProperty("show_minutes")&&(this.showMinutes=this.options.show_minutes),this.resetCurrentLength(),this.render()},render:function render(){return this.$el.html(this.template.replace("{num}",'<span class="lrn_counterNumber"></span>')),this.counterNumber=this.$(".lrn_counterNumber"),this.setCounterDisplay(this.currentLength),this},counter:function counter(t){this.currentLength=t,this.setCounterDisplay(this.currentLength),"up"===this.direction&&t<this.length||"down"===this.direction&&t>0?this.timerId=T.a.delay(T.a.bind(this.counter,this),1e3,"up"===this.direction?t+1:t-1):(this.timerId=null,this.resetCurrentLength(),this.counterCompleted=!0,this.trigger("complete"))},setCounterDisplay:function setCounterDisplay(t){var r,a,l;this.showMinutes?(a=String(Math.floor(this.currentLength/60)),l=String(this.currentLength%60),r=(a=a.length>1?a:"0"+a)+":"+(l=l.length>1?l:"0"+l)):r=this.currentLength,this.counterNumber.html(r)},begin:function begin(){this.trigger("begin"),this.counter(this.currentLength),this.state=E},pause:function pause(){clearTimeout(this.timerId),this.timerId=null,this.state=D},stop:function stop(){clearTimeout(this.timerId),this.timerId=null,this.resetCurrentLength(),this.state=L},resetCurrentLength:function resetCurrentLength(){this.currentLength="up"===this.direction?0:this.length},isRunning:function isRunning(){return this.state===E},isStopped:function isStopped(){return this.state===L},isPaused:function isPaused(){return this.state===D}})},356:function(t,r,a){"use strict";var l,S=a(5),O=a.n(S),T=a(0),L=a.n(T),E=a(1),D=a.n(E),j=a(255),V=a(7),B=a.n(V),q=a(357),G=a.n(q),K=a(18),X=a.n(K),$=["bold","italic","underline","unorderedList"],Z=G.a,Q=/<!--([\s\S]*?)-->/g,ee=/<p>/gi,te=/<\/p>/gi,ne=/<\/?(em|strong|u|sup|sub)[^>]*>/gi,re=/<\/?(br|li|ol|ul|span)[^>]*>/gi,oe=/<\/?(div)[^>]*>/gi,ie=/<(div)><\/(div)>/gi,ae=/<(div|p)><br><\/(div|p)>/gi,se=/<br>(^<\/br>)/gi,le=/&nbsp;/g,ce=/src=\"data:image\/([a-zA-Z]*);base64,([^\"]*)\"/,ue=/<img .*?>/g,de=Object(j.a)("[\\p{L}\\p{N}]"),pe=D()(document);r.a=function editor(t){L.a.extend(this,O.a.Events);var r,a,S,T,E,j,V,q,G,K,fe,he,ge=!1,me=!1,ye=[],ve=[];function getContent(){return"ie"!==B.a.browser||9!==B.a.version&&10!==B.a.version?cleanHTML(E.html()):E.html().replace(/<p>/g,"").replace(/<\/p>/g,"<br>")}function cleanHTML(t){return t=function cleanTagsThatCauseIssuesWhenPasting(t){return t=(t=(t=t.replace(ae,"<br></br>")).replace(ie,"<br></br>")).replace(se,"<br></br>"),ce.test(t)&&(t=t.replace(ue,"")),t}(t),t=(t=X.a.sanitizeHTML(t)).replace(Q,""),"ie"===B.a.browser&&9===B.a.version||(t=t.replace(te,"<br></br>")),t=t.replace(ee,"")}function getWordCount(t){return t=function cleanHTMLForWordCount(t){return t=(t=(t=(t=t.replace(ne,"")).replace(re," ")).replace(oe," ")).replace(le," ")}(t),L.a.reduce(t.split(/\s+/),(function(t,r){return r.length>0&&de.test(r)?t+1:t}),0)}function updateToolbar(){L.a.each(ye,(function(t){t.updateUI()}))}this.getTbContainer=function(){return he};var be=function Command(t){this.execute=function(){"subscript"!==t&&"superscript"!==t||this.queryState()||L.a.each(["subscript","superscript"],(function(t){we[t]&&we[t].command.queryState()&&document.execCommand(t,!1,null)})),document.execCommand(t,!1,null),ge=!0},this.queryState=function(){return document.queryCommandState(t)},this.setButton=function(t){this.button=t}};function InsertListCommand(t){var r=t?"insertOrderedList":"insertUnorderedList",a="ie"===B.a.browser||"edge"===B.a.browser;this.execute=function(){!function handleInsertListDependingOnBrowser(t,r){var a;E.focus(),t&&(a=D()(document.createElement("p")),E.append(a));document.execCommand(r,!1,null),t&&a.remove()}(a,r),ge=!0},this.queryState=function(){return document.queryCommandState(r)},this.setButton=function(t){this.button=t}}function CharacterMapCommand(r){L.a.isArray(r)||(r=t.labels.characterMapCharacters),this.execute=function(){var a=this;if(me)removeCharMap();else{var l=D()(Z({characters:r,labels:t.labels})).hide().appendTo(this.button),S=this.button.position().left,O=he.width()-(S+this.button.outerWidth()),T=Math.abs(-l.width()/2+this.button.outerWidth()),L=function destroyCharacterMap(){a.button.removeClass("lrn_active"),removeCharMap()};T>S&&(T=S),l.width()/2>O&&(T+=l.width()/2-O),l.css("left",-T+"px").fadeIn("fast",(function(){pe.off("click.charactermap").on("click.charactermap",L)})),l.find(".lrn_characterbutton").first().focus(),me=!0,D()(".lrn_toolbar .lrn_charactermap .lrn_characterbutton",E.parents(".lrn_texteditor")).on("mousedown",(function(t){t.preventDefault()}))}},this.queryState=function(){return me},this.setButton=function(t){this.button=t}}var _e=function ToggleCommandButtonController(r,S,O,T){var L,j=D()("<li></li>").addClass("lrn_btn");j.html(r.content),j.attr({unselectable:"on",title:r.title,"aria-label":r.title,tabindex:0,role:"button","data-button-index":O}),D()(j).children().attr("unselectable","on"),j.on("mousedown",(function(t){t.preventDefault&&t.preventDefault()})),a||(j.on("click",(function(t){E.is(":focus")||E.focus(),r.command.execute(),updateToolbar()})),j.on("keydown",(function(a){13!==a.which&&32!==a.which||(a.preventDefault(),E.is(":focus")||E.focus(),r.title===t.labels.characterMapTitle&&(l=!0),r.command.execute(),updateToolbar()),37===a.which&&(a.preventDefault(),L=(O+T-1)%T,S.find('li[data-button-index="'+L+'"]').first().focus()),39===a.which&&(a.preventDefault(),L=(O+1)%T,S.find('li[data-button-index="'+L+'"]').first().focus())})),j.on("keyup",(function(t){32===t.which&&t.preventDefault()}))),j.appendTo(S),r.command.setButton(j),this.getQueryState=function(){return r.command.queryState()},this.updateUI=function(){r.command.queryState()?(j.addClass("lrn_active"),j.attr({"aria-pressed":"true"})):(j.removeClass("lrn_active"),j.attr({"aria-pressed":"false"}))}};function removeCharMap(){if(me&&!l){var t=D()(".lrn_toolbar .lrn_charactermap",E.parents(".lrn_texteditor"));t.finish().fadeOut((function(){t.remove()})),me=!1,pe.off("click.charactermap")}l=!1}function updateContentAndWordCount(){ge&&(ge=!1,S=getContent(),T=getWordCount(S),function checkWordCount(){G.html(T),T>r?("on-limit"===j&&K.addClass("lrn_hide"),"off"!==j&&q.removeClass("lrn_hide"),V.addClass("lrn_wordcount_warning_label"),E.addClass("lrn_wordcount_warning")):("on-limit"===j&&(K.removeClass("lrn_hide"),q.addClass("lrn_hide")),V.removeClass("lrn_wordcount_warning_label"),E.removeClass("lrn_wordcount_warning"))}())}function charLimitExceeded(){return T>1e4}function insertTextAtCursor(t){charLimitExceeded()||(document.getSelection?document.getSelection().getRangeAt(0).insertNode(document.createTextNode(t)):document.selection?document.selection.createRange().pasteHTML(t):document.execCommand("InsertHTML",!1,t))}var we={bold:{command:new be("bold"),content:"<strong>"+t.labels.editorBoldIcon+'</strong> <span class="sr-only">'+t.labels.editorBoldTitle+"</span>",title:t.labels.editorBoldTitle,block:!1},italic:{command:new be("italic"),content:"<em>"+t.labels.editorItalicsIcon+'</em> <span class="sr-only">'+t.labels.editorItalicsTitle+"</span>",title:t.labels.editorItalicsTitle,block:!1},underline:{command:new be("underline"),content:"<u>"+t.labels.editorUnderlineIcon+'</u> <span class="sr-only">'+t.labels.editorUnderlineTitle+"</span>",title:t.labels.editorUnderlineTitle,block:!1},removeFormat:{command:new be("removeFormat"),content:'<i class="lrn_icon lrn-icon-remove-format"></i> <span class="sr-only">'+t.labels.editorRemoveFormatTitle+"</span>",title:t.labels.editorRemoveFormatTitle,block:!1},unorderedList:{command:new InsertListCommand,content:'<i class="lrn_icon lrn-icon-list-bulleted"></i> <span class="sr-only">'+t.labels.editorBulletdListTitle+"</span>",title:t.labels.editorBulletdListTitle,block:!0},orderedList:{command:new InsertListCommand(!0),content:'<i class="lrn_icon lrn-icon-list-numbered"></i> <span class="sr-only">'+t.labels.editorNumberedListTitle+"</span>",title:t.labels.editorNumberedListTitle,block:!0},superscript:{command:new be("superscript"),content:'<i class="lrn_icon lrn-icon-superscript"></i> <span class="sr-only">'+t.labels.editorSuperscriptTitle+"</span>",title:t.labels.editorSuperscriptTitle,block:!1},subscript:{command:new be("subscript"),content:'<i class="lrn_icon lrn-icon-subscript"></i> <span class="sr-only"> <span class="sr-only">'+t.labels.editorSubscriptTitle+"</span>",title:t.labels.editorSubscriptTitle,block:!1}};this.makeEditor=function(l){var O,T,X,Z,Q,ee,te,ne,re,oe=this,ie=l.el,ae=l.showCharacterMap,se=l.spellCheck,le=l.characterMapIcon,ce=l.placeholder,ue=l.wordsLimit,de=l.shouldInsertToolbar,pe=this.normalizeFormattingOptions(l.formattingOptions);switch(a=l.readOnly,r=l.maxWordLength,this.commandDefinitions=we,L.a.isUndefined(de)&&(de=!0),L.a.isArray(pe)||(pe=$),O=L.a.map(pe,(function(t){return we[t]})),ae&&(we.characterMap={command:new CharacterMapCommand(ae),content:le+'<span class="sr-only">'+t.labels.characterMapTitle+"</span>",title:t.labels.characterMapTitle},O.push(we.characterMap)),(E=D()(ie)).addClass("lrn_editor_area"),E.wrap('<div class="lrn_response_input_wrapper" />'),a?E.wrap('<div class="lrn_texteditor lrn_editor_disabled" />'):(E.wrap('<div class="lrn_texteditor" />'),E.attr("contentEditable","true"),L.a.isBoolean(se)&&E.attr("spellcheck",se.toString()),"ie"===B.a.browser&&9===B.a.version&&0!==E.html().indexOf("<p>")&&E.html("<p>"+E.html().replace(/<br>/g,"</p><p>")+"</p>")),V=D()('<span class="lrn_length_indicator" />'),fe=D()('<span class="lrn_toolbar_right" />').append(V),T=D()('<ul class="lrn_toolbar_left lrn_clearfix"></ul>'),he=D()('<div class="lrn-toolbar-wrapper" />').append(D()('<div class="lrn_toolbar" />').append(T).append(fe)),de&&E.parent().prepend(he),L.a.each(O,(function(t,r){!0===t.block&&ve.push(t),X=new _e(t,T,r,O.length),ye.push(X)})),j=ue,Z=!1,ue){case"always":Z=!1;break;case"on-limit":case"off":Z=!0}if(G=D()('<span class="lrn_word_count" />').html("0"),K=D()('<span class="lrn_static_words'+(!0===Z?"":" lrn_hide")+'"> '+t.labels.word+"</span>"),q=D()('<span class="lrn_word_limit'+(!0===Z?" lrn_hide":"")+'"> / '+r+" "+t.labels.wordLength+"</span>"),V.append(G,K,q),a||L.a.isEmpty(ce)||(Q=D()('<span class="lrn_placeholder" />').text(ce),ee=D()('<div class="lrn_input_with_placeholder" />'),te=function togglePlaceholder(){var t=E.text();t&&t.length>0?Q.hide():Q.show()},E.wrap(ee).before(Q),E.on("focus blur keydown keyup",te),Q.on("click",(function(t){E.focus()})),te()),!a){E.on("blur",(function(){ge=!0,updateContentAndWordCount(),triggerChange(),oe.trigger("blur")})),E.on("focus",(function(){oe.trigger("focus")})),E.on("touchend",(function(){window.focus()})),E.on("keyup mouseup",(function(){removeCharMap(),updateToolbar(),triggerChange()})),"ie"!==B.a.browser?E.on("keyup mouseup",(function(){this.lastChild&&"br"===this.lastChild.nodeName.toLowerCase()||this.appendChild(document.createElement("br"))})):B.a.browser<9&&E.on("keyup mouseup",(function(){var t,r;E.is(":empty")&&(t=document.createElement("p"),E.append(t),(r=document.body.createTextRange()).moveToElementText(t),r.select())})),ne=L.a.debounce((function(){updateContentAndWordCount(),triggerChange()}),300),ge=!0,updateContentAndWordCount(),E.on("keyup",ne),E.on("keyup",(function(t){ge=!0,oe.trigger("keyup"),triggerChange()})),E.on("paste",(function(t){charLimitExceeded()&&t.preventDefault(),L.a.defer((function(){var t,r,a,l;window.getSelection?(t=window.getSelection().getRangeAt(0),(r=document.createElement("caret")).innerHTML="-",t.insertNode(r),E.html(getContent()),r=document.getElementsByTagName("caret")[0],(t=window.getSelection().rangeCount>0?window.getSelection().getRangeAt(0):document.createRange()).setStartBefore(r),t.setEndBefore(r),(a=window.getSelection()).rangeCount>0&&a.removeAllRanges(),a.addRange(t),r.parentNode.removeChild(r)):document.selection?((t=document.selection.createRange()).pasteHTML("<span id=lrneditorcaret>-</span>"),l=(l=cleanHTML(l=(l=E.html()).replace(/<span id=lrneditorcaret>-<\/span>/i,"<caret>-</caret>"))).replace(/<caret>-<\/caret>/i,"<span id=lrneditorcaret>-</span>"),E.html(l),r=document.getElementById("lrneditorcaret"),(t=document.selection.createRange()).moveToElementText(r),t.select(),r.parentNode.removeChild(r)):E.html(cleanHTML(E.html())),ge=!0,ne()}))})),E.on("keydown",(function(t){if(t.ctrlKey||t.metaKey){var r;switch(t.which){case 66:r=we.bold;break;case 73:r=we.italic;break;case 85:r=we.underline;break;default:return}r.command.execute(),t.preventDefault(),updateToolbar(),triggerChange()}})),E.on("keypress",(function(t){t.which>31&&t.which<127&&charLimitExceeded()&&t.preventDefault(),triggerChange()}));E.parents(".lrn_texteditor").on("click",".lrn_charactermap .lrn_characterbutton",(function clickListener(t){insertTextAtCursor(D()(t.target).text()),E.trigger("keyup"),triggerChange()})),E.parents(".lrn_texteditor").on("keydown",".lrn_charactermap .lrn_characterbutton",(function keyListener(t){var r=D()(t.target).data("character-btn-index");13!==t.which&&32!==t.which||insertTextAtCursor(D()(t.target).text()),37===t.which&&(r=(r+ae.length-1)%ae.length,t.preventDefault(),E.parents(".lrn_texteditor").find('.lrn_charactermap .lrn_characterbutton[data-character-btn-index="'+r+'"]').first().focus()),39===t.which&&(r=(r+1)%ae.length,t.preventDefault(),E.parents(".lrn_texteditor").find('.lrn_charactermap .lrn_characterbutton[data-character-btn-index="'+r+'"]').first().focus())})),E.parents(".lrn_texteditor").on("mousedown",".lrn_charactermap",(function mousedownListener(t){t.preventDefault(),triggerChange()}))}function triggerChange(){S!==re&&(oe.trigger("change"),re=S)}re=S},this.getContentAndWordCount=function(){return updateContentAndWordCount(),{content:S,wordCount:T}},this.focus=function(){E.focus()},this.isEmpty=function(){return!this.getContentAndWordCount().wordCount},this.normalizeFormattingOptions=function(t){if(L.a.isArray(t))return L.a.filter(L.a.uniq(t),(function(t){return!!t}))}}},357:function(module,exports,__webpack_require__){var _=__webpack_require__(0);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="lrn_bubble lrn_charactermap"><div class="lrn_charactermap_title">'+(null==(__t=labels.characterMapTitle)?"":__t)+"</div>",_.each(characters,(function(t,r){__p+='<button class="lrn_btn_grid lrn_characterbutton" type="button" unselectable="on" tabindex="0" data-character-btn-index="'+(null==(__t=r)?"":__t)+'">'+(null==(__t=t)?"":__t)+"</button>"})),__p+="</div>";return __p}},514:function(t,r,a){var l;void 0===(l=function(){var t=function(){var r,a,l,S,O,T,L="undefined",E="object",D="Shockwave Flash",j="application/x-shockwave-flash",V="SWFObjectExprInst",B="onreadystatechange",q=window,G=document,K=navigator,X=!1,$=[],Z=[],Q=[],ee=[],te=!1,ne=!1,re=!0,oe=!1,ie=function(){var t=typeof G.getElementById!=L&&typeof G.getElementsByTagName!=L&&typeof G.createElement!=L,r=K.userAgent.toLowerCase(),a=K.platform.toLowerCase(),l=/win/.test(a||r),S=/mac/.test(a||r),O=!!/webkit/.test(r)&&parseFloat(r.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")),T="Microsoft Internet Explorer"===K.appName,V=[0,0,0],B=null;if(typeof K.plugins!=L&&typeof K.plugins[D]==E)(B=K.plugins[D].description)&&typeof K.mimeTypes!=L&&K.mimeTypes[j]&&K.mimeTypes[j].enabledPlugin&&(X=!0,T=!1,B=B.replace(/^.*\s+(\S+\s+\S+$)/,"$1"),V[0]=n(B.replace(/^(.*)\..*$/,"$1")),V[1]=n(B.replace(/^.*\.(.*)\s.*$/,"$1")),V[2]=/[a-zA-Z]/.test(B)?n(B.replace(/^.*[a-zA-Z]+(.*)$/,"$1")):0);else if(typeof q.ActiveXObject!=L)try{var $=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");$&&(B=$.GetVariable("$version"))&&(T=!0,V=[n((B=B.split(" ")[1].split(","))[0]),n(B[1]),n(B[2])])}catch(t){}return{w3:t,pv:V,wk:O,ie:T,win:l,mac:S}}();ie.w3&&((typeof G.readyState!=L&&("complete"===G.readyState||"interactive"===G.readyState)||typeof G.readyState==L&&(G.getElementsByTagName("body")[0]||G.body))&&f(),te||(typeof G.addEventListener!=L&&G.addEventListener("DOMContentLoaded",f,!1),ie.ie&&(G.attachEvent(B,(function aa(){"complete"==G.readyState&&(G.detachEvent(B,aa),f())})),q==top&&function ac(){if(!te){try{G.documentElement.doScroll("left")}catch(t){return void setTimeout(ac,0)}f()}}()),ie.wk&&function ab(){te||(/loaded|complete/.test(G.readyState)?f():setTimeout(ab,0))}()));function f(){if(!te&&document.getElementsByTagName("body")[0]){try{var t,r=C("span");r.style.display="none",(t=G.getElementsByTagName("body")[0].appendChild(r)).parentNode.removeChild(t),t=null,r=null}catch(t){return}te=!0;for(var a=$.length,l=0;l<a;l++)$[l]()}}function M(t){te?t():$[$.length]=t}function H(){var t=Z.length;if(t>0)for(var r=0;r<t;r++){var a=Z[r].id,l=Z[r].callbackFn,S={success:!1,id:a};if(ie.pv[0]>0){var O=c(a);if(O)if(!F(Z[r].swfVersion)||ie.wk&&ie.wk<312)if(Z[r].expressInstall&&A()){var T={};T.data=Z[r].expressInstall,T.width=O.getAttribute("width")||"0",T.height=O.getAttribute("height")||"0",O.getAttribute("class")&&(T.styleclass=O.getAttribute("class")),O.getAttribute("align")&&(T.align=O.getAttribute("align"));for(var E={},D=O.getElementsByTagName("param"),j=D.length,V=0;V<j;V++)"movie"!=D[V].getAttribute("name").toLowerCase()&&(E[D[V].getAttribute("name")]=D[V].getAttribute("value"));R(T,E,a,l)}else b(O),l&&l(S);else w(a,!0),l&&(S.success=!0,S.ref=z(a),S.id=a,l(S))}else if(w(a,!0),l){var B=z(a);B&&typeof B.SetVariable!=L&&(S.success=!0,S.ref=B,S.id=B.id),l(S)}}}function z(t){var r=null,a=c(t);return a&&"OBJECT"===a.nodeName.toUpperCase()&&(r=typeof a.SetVariable!==L?a:a.getElementsByTagName(E)[0]||a),r}function A(){return!ne&&F("6.0.65")&&(ie.win||ie.mac)&&!(ie.wk&&ie.wk<312)}function R(t,O,T,E){var D=c(T);if(T=W(T),ne=!0,l=E||null,S={success:!1,id:T},D){"OBJECT"==D.nodeName.toUpperCase()?(r=J(D),a=null):(r=D,a=T),t.id=V,(typeof t.width==L||!/%$/.test(t.width)&&n(t.width)<310)&&(t.width="310"),(typeof t.height==L||!/%$/.test(t.height)&&n(t.height)<137)&&(t.height="137");var j=ie.ie?"ActiveX":"PlugIn",B="MMredirectURL="+encodeURIComponent(q.location.toString().replace(/&/g,"%26"))+"&MMplayerType="+j+"&MMdoctitle="+encodeURIComponent(G.title.slice(0,47)+" - Flash Player Installation");if(typeof O.flashvars!=L?O.flashvars+="&"+B:O.flashvars=B,ie.ie&&4!=D.readyState){var K=C("div");T+="SWFObjectNew",K.setAttribute("id",T),D.parentNode.insertBefore(K,D),D.style.display="none",y(D)}u(t,O,T)}}function b(t){if(ie.ie&&4!=t.readyState){t.style.display="none";var r=C("div");t.parentNode.insertBefore(r,t),r.parentNode.replaceChild(J(t),r),y(t)}else t.parentNode.replaceChild(J(t),t)}function J(t){var r=C("div");if(ie.win&&ie.ie)r.innerHTML=t.innerHTML;else{var a=t.getElementsByTagName(E)[0];if(a){var l=a.childNodes;if(l)for(var S=l.length,O=0;O<S;O++)1==l[O].nodeType&&"PARAM"==l[O].nodeName||8==l[O].nodeType||r.appendChild(l[O].cloneNode(!0))}}return r}function u(t,r,a){var l,S=c(a);if(a=W(a),ie.wk&&ie.wk<312)return l;if(S){var O,T,D,V=ie.ie?C("div"):C(E);for(D in typeof t.id==L&&(t.id=a),r)r.hasOwnProperty(D)&&"movie"!==D.toLowerCase()&&e(V,D,r[D]);for(O in ie.ie&&(V=function k(t,r){var a=C("div");return a.innerHTML="<object classid='clsid:D27CDB6E-AE6D-11cf-96B8-444553540000'><param name='movie' value='"+t+"'>"+r+"</object>",a.firstChild}(t.data,V.innerHTML)),t)t.hasOwnProperty(O)&&("styleclass"===(T=O.toLowerCase())?V.setAttribute("class",t[O]):"classid"!==T&&"data"!==T&&V.setAttribute(O,t[O]));ie.ie?Q[Q.length]=t.id:(V.setAttribute("type",j),V.setAttribute("data",t.data)),S.parentNode.replaceChild(V,S),l=V}return l}function e(t,r,a){var l=C("param");l.setAttribute("name",r),l.setAttribute("value",a),t.appendChild(l)}function y(t){var r=c(t);r&&"OBJECT"==r.nodeName.toUpperCase()&&(ie.ie?(r.style.display="none",function aa(){if(4==r.readyState){for(var t in r)"function"==typeof r[t]&&(r[t]=null);r.parentNode.removeChild(r)}else setTimeout(aa,10)}()):r.parentNode.removeChild(r))}function U(t){return t&&t.nodeType&&1===t.nodeType}function W(t){return U(t)?t.id:t}function c(t){if(U(t))return t;var r=null;try{r=G.getElementById(t)}catch(t){}return r}function C(t){return G.createElement(t)}function n(t){return parseInt(t,10)}function F(t){t+="";var r=ie.pv,a=t.split(".");return a[0]=n(a[0]),a[1]=n(a[1])||0,a[2]=n(a[2])||0,r[0]>a[0]||r[0]==a[0]&&r[1]>a[1]||r[0]==a[0]&&r[1]==a[1]&&r[2]>=a[2]}function v(t,r,a,l){var S=G.getElementsByTagName("head")[0];if(S){var E="string"==typeof a?a:"screen";if(l&&(O=null,T=null),!O||T!=E){var D=C("style");D.setAttribute("type","text/css"),D.setAttribute("media",E),O=S.appendChild(D),ie.ie&&typeof G.styleSheets!=L&&G.styleSheets.length>0&&(O=G.styleSheets[G.styleSheets.length-1]),T=E}O&&(typeof O.addRule!=L?O.addRule(t,r):typeof G.createTextNode!=L&&O.appendChild(G.createTextNode(t+" {"+r+"}")))}}function w(t,r){if(re){var a=r?"visible":"hidden",l=c(t);te&&l?l.style.visibility=a:"string"==typeof t&&v("#"+t,"visibility:"+a)}}function N(t){return null!=/[\\\"<>\.;]/.exec(t)&&typeof encodeURIComponent!=L?encodeURIComponent(t):t}$[0]=function(){X?function Y(){var t=G.getElementsByTagName("body")[0],r=C(E);r.setAttribute("style","visibility: hidden;"),r.setAttribute("type",j);var a=t.appendChild(r);if(a){var l=0;!function ab(){if(typeof a.GetVariable!=L)try{var S=a.GetVariable("$version");S&&(S=S.split(" ")[1].split(","),ie.pv=[n(S[0]),n(S[1]),n(S[2])])}catch(t){ie.pv=[8,0,0]}else if(l<10)return l++,void setTimeout(ab,10);t.removeChild(r),a=null,H()}()}else H()}():H()};ie.ie&&window.attachEvent("onunload",(function(){for(var r=ee.length,a=0;a<r;a++)ee[a][0].detachEvent(ee[a][1],ee[a][2]);for(var l=Q.length,S=0;S<l;S++)y(Q[S]);for(var O in ie)ie[O]=null;for(var T in ie=null,t)t[T]=null;t=null}));return{registerObject:function(t,r,a,l){if(ie.w3&&t&&r){var S={};S.id=t,S.swfVersion=r,S.expressInstall=a,S.callbackFn=l,Z[Z.length]=S,w(t,!1)}else l&&l({success:!1,id:t})},getObjectById:function(t){if(ie.w3)return z(t)},embedSWF:function(t,r,a,l,S,O,T,D,j,V){var B=W(r),q={success:!1,id:B};ie.w3&&!(ie.wk&&ie.wk<312)&&t&&r&&a&&l&&S?(w(B,!1),M((function(){a+="",l+="";var G={};if(j&&typeof j===E)for(var K in j)G[K]=j[K];G.data=t,G.width=a,G.height=l;var X={};if(D&&typeof D===E)for(var $ in D)X[$]=D[$];if(T&&typeof T===E)for(var Z in T)if(T.hasOwnProperty(Z)){var Q=oe?encodeURIComponent(Z):Z,ee=oe?encodeURIComponent(T[Z]):T[Z];typeof X.flashvars!=L?X.flashvars+="&"+Q+"="+ee:X.flashvars=Q+"="+ee}if(F(S)){var te=u(G,X,r);G.id==B&&w(B,!0),q.success=!0,q.ref=te,q.id=te.id}else{if(O&&A())return G.data=O,void R(G,X,r,V);w(B,!0)}V&&V(q)}))):V&&V(q)},switchOffAutoHideShow:function(){re=!1},enableUriEncoding:function(t){oe=typeof t===L||t},ua:ie,getFlashPlayerVersion:function(){return{major:ie.pv[0],minor:ie.pv[1],release:ie.pv[2]}},hasFlashPlayerVersion:F,createSWF:function(t,r,a){return ie.w3?u(t,r,a):void 0},showExpressInstall:function(t,r,a,l){ie.w3&&A()&&R(t,r,a,l)},removeSWF:function(t){ie.w3&&y(t)},createCSS:function(t,r,a,l){ie.w3&&v(t,r,a,l)},addDomLoadEvent:M,addLoadEvent:function s(t){if(typeof q.addEventListener!=L)q.addEventListener("load",t,!1);else if(typeof G.addEventListener!=L)G.addEventListener("load",t,!1);else if(typeof q.attachEvent!=L)!function g(t,r,a){t.attachEvent(r,a),ee[ee.length]=[t,r,a]}(q,"onload",t);else if("function"==typeof q.onload){var r=q.onload;q.onload=function(){r(),t()}}else q.onload=t},getQueryParamValue:function(t){var r=G.location.search||G.location.hash;if(r){if(/\?/.test(r)&&(r=r.split("?")[1]),null==t)return N(r);for(var a=r.split("&"),l=0;l<a.length;l++)if(a[l].substring(0,a[l].indexOf("="))==t)return N(a[l].substring(a[l].indexOf("=")+1))}return""},expressInstallCallback:function(){if(ne){var t=c(V);t&&r&&(t.parentNode.replaceChild(r,t),a&&(w(a,!0),ie.ie&&(r.style.display="block")),l&&l(S)),ne=!1}},version:"2.3"}}();return t}.call(r,a,r,t))||(t.exports=l)},544:function(module,exports,__webpack_require__){var _=__webpack_require__(0);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="",proper?(__p+='<div class="'+(null==(__t=fractionClass)?"":__t)+'">',integer&&(__p+='<span class="'+(null==(__t=fractionClass)?"":__t)+'-integer">'+(null==(__t=integer)?"":__t)+"</span>"),__p+='<span class="'+(null==(__t=fractionClass)?"":__t)+'-proper-fraction">'+(null==(__t=proper)?"":__t)+"</span></div>"):__p+=""+(null==(__t=integer)?"":__t),__p+="";return __p}},580:function(module,exports,__webpack_require__){var _=__webpack_require__(0);module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="<div ",htmlId&&(__p+='id="'+(null==(__t=htmlId)?"":__t)+'" '),__p+='class="lrn lrn_widget lrn_feature lrn_'+(null==(__t=featureType)?"":__t)+" "+(null==(__t=extraClasses)?"":__t)+'">'+(null==(__t=featureContent)?"":__t)+"</div>";return __p}}}]);