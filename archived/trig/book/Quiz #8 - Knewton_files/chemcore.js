(window.LearnosityAmd=window.LearnosityAmd||[]).push([[7],{289:function(module,exports,__webpack_require__){(function(global){var __WEBPACK_AMD_DEFINE_RESULT__;__WEBPACK_AMD_DEFINE_RESULT__=function(){"use strict";var name="",boxedString=Object("a"),splitString="a"!=boxedString[0]||!(0 in boxedString),forEach=function forEach(e,r){var n=arguments[2];if(Array.prototype.indexOf)return e.forEach(r);var t=toObject(e),a=splitString&&"[object String]"==_toString(t)?t.split(""):t,o=-1,i=a.length>>>0;if("[object Function]"!=_toString(r))throw new TypeError;for(;++o<i;)o in a&&r.call(n,a[o],o,t)},filter=function filter(e,r){var n=arguments[2];if(Array.prototype.filter)return e.filter(r);var t,a=toObject(e),o=splitString&&"[object String]"==_toString(e)?e.split(""):a,i=o.length>>>0,s=[];if("[object Function]"!=_toString(r))throw new TypeError(r+" is not a function");for(var l=0;l<i;l++)l in o&&(t=o[l],r.call(n,t,l,a)&&s.push(t));return s},every=function every(e,r){var n=arguments[2];if(Array.prototype.every)return e.every(r,n);var t=toObject(e),a=splitString&&"[object String]"==_toString(e)?e.split(""):t,o=a.length>>>0;if("[object Function]"!=_toString(r))throw new TypeError(r+" is not a function");for(var i=0;i<o;i++)if(i in a&&!r.call(n,a[i],i,t))return!1;return!0},some=function some(e,r){var n=arguments[2];if(Array.prototype.some)return e.some(r,n);var t=toObject(e),a=splitString&&"[object String]"==_toString(e)?e.split(""):t,o=a.length>>>0;if("[object Function]"!=_toString(r))throw new TypeError(r+" is not a function");for(var i=0;i<o;i++)if(i in a&&r.call(n,a[i],i,t))return!0;return!1},indexOf=function indexOf(e,r){var n=arguments[2];if(Array.prototype.indexOf||"string"==typeof e)return e.indexOf(r,n);var t=splitString&&"[object String]"==_toString(e)?e.split(""):toObject(e),a=t.length>>>0;if(!a)return-1;var o=0;for(arguments.length>2&&(o=toInteger(n)),o=o>=0?o:Math.max(0,a+o);o<a;o++)if(o in t&&t[o]===r)return o;return-1},keys=function keys(e){if(Object.keys)return Object.keys(e);var r=!0,n=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],t=n.length;for(var a in{toString:null})r=!1;if("object"!=typeof e&&"function"!=typeof e||null===e)throw new TypeError("Object.keys called on a non-object");var keys=[];for(var o in e)owns(e,o)&&keys.push(o);if(r)for(var i=0,s=t;i<s;i++){var l=n[i];owns(e,l)&&keys.push(l)}return keys},toObject=function(e){if(null==e)throw new TypeError("can't convert "+e+" to object");return Object(e)},prototypeOfObject=Object.prototype,_toString=function(e){return prototypeOfObject.toString.apply(e)},owns=function(e,r){return prototypeOfObject.hasOwnProperty.call(e,r)},create=function create(e){if(Object.create)return Object.create(e);var F=function(){};if(1!=arguments.length)throw new Error("Object.create implementation only accepts one parameter.");return F.prototype=e,new F},toString,isArray,escMap,escFunc,escRE;"undefined"==typeof window||window.JSON||(window.JSON={parse:function(sJSON){return eval("("+sJSON+")")},stringify:(toString=Object.prototype.toString,isArray=Array.isArray||function(e){return"[object Array]"===toString.call(e)},escMap={'"':'\\"',"\\":"\\\\","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t"},escFunc=function(e){return escMap[e]||"\\u"+(e.charCodeAt(0)+65536).toString(16).substr(1)},escRE=/[\\"\u0000-\u001F\u2028\u2029]/g,function stringify(e){if(null==e)return"null";if("number"==typeof e)return isFinite(e)?e.toString():"null";if("boolean"==typeof e)return e.toString();if("object"==typeof e){if("function"==typeof e.toJSON)return stringify(e.toJSON());if(isArray(e)){for(var r="[",n=0;n<e.length;n++)r+=(n?", ":"")+stringify(e[n]);return r+"]"}if("[object Object]"===toString.call(e)){var t=[];for(var a in e)e.hasOwnProperty(a)&&t.push(stringify(a)+": "+stringify(e[a]));return"{"+t.join(", ")+"}"}}return'"'+e.toString().replace(escRE,escFunc)+'"'})}),Math.sinh=Math.sinh||function(e){return(Math.exp(e)-Math.exp(-e))/2},Math.cosh=Math.cosh||function(e){return(Math.exp(e)+Math.exp(-e))/2},Math.tanh=Math.tanh||function(e){return e===1/0?1:e===-1/0?-1:(Math.exp(e)-Math.exp(-e))/(Math.exp(e)+Math.exp(-e))},Math.asinh=Math.asinh||function(e){return e===-1/0?e:Math.log(e+Math.sqrt(e*e+1))},Math.acosh=Math.acosh||function(e){return Math.log(e+Math.sqrt(e*e-1))},Math.atanh=Math.atanh||function(e){return Math.log((1+e)/(1-e))/2};var ASSERT=!0,assert=ASSERT?function(e,r,n){if(void 0===r&&(r="failed!"),!e){var t=new Error(r);throw t.location=n||Assert.location,t}}:function(){},message=function(e,r){var n=Assert.messages[e];Assert.location;return r&&forEach(r,(function(e,r){n=n.replace("%"+(r+1),e)})),e+": "+n},reserveCodeRange=function(e,r,n){assert(e<=r,"Invalid code range");var t=every(Assert.reservedCodes,(function(n){return r<n.first||e>n.last}));assert(t,"Conflicting request for error code range"),Assert.reservedCodes.push({first:e,last:r,name:n})},setLocation=function(e){Assert.location=e},clearLocation=function(){Assert.location=null},setTimeout_=function(e,r){void 0!==e&&(Assert.timeout=e?Date.now()+e:0,Assert.timeoutMessage=r||"ERROR timeout exceeded")},checkTimeout=function(){assert(!Assert.timeout||Assert.timeout>Date.now(),Assert.timeoutMessage)},Assert={assert:assert,message:message,messages:{},reserveCodeRange:reserveCodeRange,reservedCodes:[],setLocation:setLocation,clearLocation:clearLocation,checkTimeout:checkTimeout,setTimeout:setTimeout_},TRACE=!1,global=this,trace=TRACE?function trace(e){if(global.console&&global.console.log)console.log(e);else{if(!global.print)throw"No trace function defined!";print(e)}}:function(){},Ast=function(){function Ast(){this.nodePool=["unused"],this.nodeMap={}}function isNode(e){return void 0===e&&(e=this),e.op&&e.args}Ast.prototype.create=function create(e,r){var n=create(this);if("string"==typeof e)n.op=e,n.args=r instanceof Array?r:[];else if(null!==e&&"object"==typeof e){var t=e;forEach(keys(t),(function(e,r){n[e]=t[e]}))}return n},Ast.prototype.arg=function arg(e){if(!isNode(this))throw"Malformed node";return this.args.push(e),this},Ast.prototype.argN=function argN(e,r){if(!isNode(this))throw"Malformed node";return void 0===r?this.args[e]:(this.args[e]=r,this)},Ast.prototype.args=function args(e){if(!isNode(this))throw"Malformed node";return void 0===e?this.args:(this.args=e,this)},Ast.prototype.isNode=isNode,Ast.prototype.intern=function intern(e){this instanceof Ast&&void 0===e&&isNode(this)&&(e=this),assert("object"==typeof e,"node not an object");for(var r=e.op,n=e.args.length,t="",a=[],o=0;o<n;o++)t+=" ","string"==typeof e.args[o]?t+=a[o]=e.args[o]:t+=a[o]=this.intern(e.args[o]);var i=r+n+t,s=this.nodeMap[i];return void 0===s&&(this.nodePool.push({op:r,args:a}),s=this.nodePool.length-1,this.nodeMap[i]=s),s},Ast.prototype.node=function node(e){for(var r=JSON.parse(JSON.stringify(this.nodePool[e])),n=0;n<r.args.length;n++)"string"!=typeof r.args[n]&&(r.args[n]=this.node(r.args[n]));return r},Ast.prototype.dumpAll=function dumpAll(){var e="";return forEach(this.nodePool,(function(r,n){e+="\n"+n+": "+Ast.dump(r)})),e},Ast.dump=Ast.prototype.dump=function dump(e){if("string"==typeof e)var r='"'+e+'"';else if("number"==typeof e)r=e;else{r='{ op: "'+e.op+'", args: [ ';for(var n=0;n<e.args.length;n++)n>0&&(r+=" , "),r+=dump(e.args[n]);r+=" ] }"}return r};return Ast}(),Model=function(){function Model(){}Model.fn={},Model.env=r={};var e=[],r={};function isChemCore(){return!!Model.env.Au}Model.pushEnv=function pushEnv(n){e.push(r),Model.env=r=n},Model.popEnv=function popEnv(){assert(e.length>0,"1000: Empty envStack"),Model.env=r=e.pop()};var n=Model.prototype=new Ast;Assert.reserveCodeRange(1e3,1999,"model"),Assert.messages[1e3]="Internal error. %1.",Assert.messages[1001]="Invalid syntax. '%1' expected, '%2' found.",Assert.messages[1002]="Only one decimal separator can be specified.",Assert.messages[1003]="Extra characters in input at position: %1, lexeme: %2, prefix: %3.",Assert.messages[1004]="Invalid character '%1' (%2) in input.",Assert.messages[1005]="Misplaced thousands separator.",Assert.messages[1006]="Invalid syntax. Expression expected, %1 found.",Assert.messages[1007]="Unexpected character: '%1' in '%2'.",Assert.messages[1008]="The same character '%1' is being used as a thousands and decimal separators.",Assert.messages[1009]="Missing argument for '%1' command.",Assert.messages[1010]="Expecting an operator between numbers.",Assert.messages[1011]="Invalid grouping bracket.";var t=Assert.message;Model.create=n.create=function create(e,r){if(assert(null!=e,t(1011)),e instanceof Model)return r&&(e.location=r),e;var a;if(e instanceof Array)return a=[],forEach(e,(function(e){a.push(create(e,r))})),a;if(!(this instanceof Model))return(new Model).create(e,r);if((a=create(this)).location=r,"string"==typeof e){var o=l(e,Model.env);e=o.expr()}else e=JSON.parse(JSON.stringify(e));return forEach(keys(Model.fn),(function(e,r){n.hasOwnProperty(e)||(n[e]=function(){var r=Model.fn[e];if(arguments.length>1&&arguments[1]instanceof Model)return r.apply(this,arguments);for(var n=[this],t=0;t<arguments.length;t++)n.push(arguments[t]);return r.apply(this,n)})})),forEach(keys(e),(function(r,n){a[r]=e[r]})),a},Model.fromLaTex=n.fromLaTex=function fromLaTex(e){return assert("string"==typeof e,"1000: Model.prototype.fromLaTex"),this?this.create(e):Model.create(e)},n.toLaTex=function toLaTex(e){return i(e)};var a={ADD:"+",SUB:"-",MUL:"mul",TIMES:"times",COEFF:"coeff",DIV:"div",FRAC:"frac",EQL:"=",ATAN2:"atan2",SQRT:"sqrt",VEC:"vec",PM:"pm",SIN:"sin",COS:"cos",TAN:"tan",SEC:"sec",COT:"cot",CSC:"csc",ARCSIN:"arcsin",ARCCOS:"arccos",ARCTAN:"arctan",ARCSEC:"arcsec",ARCCSC:"arccsc",ARCCOT:"arccot",SINH:"sinh",COSH:"cosh",TANH:"tanh",SECH:"sech",COTH:"coth",CSCH:"csch",ARCSINH:"arcsinh",ARCCOSH:"arccosh",ARCTANH:"arctanh",ARCSECH:"arcsech",ARCCSCH:"arccsch",ARCCOTH:"arccoth",LOG:"log",LN:"ln",LG:"lg",VAR:"var",NUM:"num",CST:"cst",COMMA:",",POW:"^",SUBSCRIPT:"_",ABS:"abs",PAREN:"()",HIGHLIGHT:"hi",LT:"lt",LE:"le",GT:"gt",GE:"ge",NE:"ne",NGTR:"ngtr",NLESS:"nless",APPROX:"approx",INTERVAL:"interval",EVALAT:"eval-at",LIST:"list",EXISTS:"exists",IN:"in",FORALL:"forall",LIM:"lim",EXP:"exp",TO:"to",SUM:"sum",DERIV:"deriv",INT:"int",PROD:"prod",PERCENT:"%",M:"M",RIGHTARROW:"->",RIGHTLEFTHARPOONS:"harpoons",FACT:"fact",BINOM:"binom",ROW:"row",COL:"col",COLON:"colon",MATRIX:"matrix",FORMAT:"format",OVERSET:"overset",UNDERSET:"underset",OVERLINE:"overline",DEGREE:"degree",BACKSLASH:"backslash",MATHBF:"mathbf",DOT:"dot",NONE:"none"};forEach(keys(a),(function(e,r){Model[e]=a[e]}));var o={};o[a.ADD]="+",o[a.SUB]="-",o[a.MUL]="*",o[a.DIV]="\\div",o[a.FRAC]="\\frac",o[a.EQL]="=",o[a.ATAN2]="\\atan2",o[a.POW]="^",o[a.SUBSCRIPT]="_",o[a.PM]="\\pm",o[a.SIN]="\\sin",o[a.COS]="\\cos",o[a.TAN]="\\tan",o[a.ARCSIN]="\\arcsin",o[a.ARCCOS]="\\arccos",o[a.ARCTAN]="\\arctan",o[a.ARCSEC]="\\arcsec",o[a.ARCCSC]="\\arccsc",o[a.ARCCOT]="\\arccot",o[a.SEC]="\\sec",o[a.COT]="\\cot",o[a.CSC]="\\csc",o[a.SINH]="\\sinh",o[a.COSH]="\\cosh",o[a.TANH]="\\tanh",o[a.ARCSINH]="\\arcsinh",o[a.ARCCOSH]="\\arccosh",o[a.ARCTANH]="\\arctanh",o[a.ARCSECH]="\\arcsech",o[a.ARCCSCH]="\\arccsch",o[a.ARCCOTH]="\\arccoth",o[a.SECH]="\\sech",o[a.COTH]="\\coth",o[a.CSCH]="\\csch",o[a.LN]="\\ln",o[a.COMMA]=",",o[a.M]="\\M",o[a.BINOM]="\\binom",o[a.COLON]="\\colon",Model.fold=function fold(e,r){var n,t=[];switch(forEach(e.args,(function(e){t.push(fold(e,r))})),e.args=t,e.op){case a.VAR:(n=r[e.args[0]])&&(e=n)}return e};var i=function render(e){var r="";if("string"==typeof e)r=e;else if("number"==typeof e)r=e;else if("object"==typeof e){for(var n=[],t=0;t<e.args.length;t++)n[t]=render(e.args[t]);switch(e.op){case a.VAR:case a.CST:case a.NUM:r="("+e.args[0]+")";break;case a.SUB:r=1===e.args.length?o[e.op]+" "+n[0]:n[0]+" "+o[e.op]+" "+n[1];break;case a.DIV:case a.PM:case a.EQL:r=n[0]+" "+o[e.op]+" "+n[1];break;case a.POW:var i=e.args[0],s=e.args[1];(i.args&&2===i.args.length||s.args&&2===s.args.length)&&(i.op!==a.ADD&&i.op!==a.SUB&&i.op!==a.MUL&&i.op!==a.DIV&&i.op!==a.SQRT||(n[0]=" ("+n[0]+") ")),r="{"+n[0]+"^{"+n[1]+"}}";break;case a.SIN:case a.COS:case a.TAN:case a.ARCSIN:case a.ARCCOS:case a.ARCTAN:case a.ARCSEC:case a.ARCCSC:case a.ARCCOT:case a.SEC:case a.COT:case a.CSC:case a.SINH:case a.COSH:case a.TANH:case a.ARCSINH:case a.ARCCOSH:case a.ARCTANH:case a.ARCSECH:case a.ARCCSCH:case a.ARCCOTH:case a.SECH:case a.COTH:case a.CSCH:case a.LN:case a.M:r="{"+o[e.op]+"{"+n[0]+"}}";break;case a.FRAC:r="\\dfrac{"+n[0]+"}{"+n[1]+"}";break;case a.BINOM:r="\\binom{"+n[0]+"}{"+n[1]+"}";break;case a.SQRT:switch(n.length){case 1:r="\\sqrt{"+n[0]+"}";break;case 2:r="\\sqrt["+n[0]+"]{"+n[1]+"}"}break;case a.VEC:r="\\vec{"+n[0]+"}";break;case a.MUL:var l;r="",forEach(e.args,(function(t,i){t.args&&t.args.length>=2?(t.op!==a.ADD&&t.op!==a.SUB||(n[i]="("+n[i]+")"),0!==i&&"number"==typeof t&&(r+=o[e.op]+" "),r+=n[i]):(t.op===a.PAREN||t.op===a.VAR||t.op===a.CST||"number"==typeof l&&"number"!=typeof t||0!==i&&(r+=" "+o[e.op]+" "),r+=n[i]),l=t}));break;case a.ADD:case a.COMMA:default:forEach(n,(function(n,t){r=0===t?n:r+" "+o[e.op]+" "+n}))}}else assert(!1,"1000: Invalid expression type");return r},s={};s[47]=a.FRAC,s[256]=a.FRAC,s[257]=a.SQRT,s[290]=a.VEC,s[43]=a.ADD,s[45]=a.SUB,s[258]=a.PM,s[338]=a.NOT,s[94]=a.POW,s[95]=a.SUBSCRIPT,s[42]=a.MUL,s[304]=a.DOT,s[294]=a.DIV,s[259]=a.SIN,s[261]=a.COS,s[260]=a.TAN,s[291]=a.ARCSIN,s[292]=a.ARCCOS,s[293]=a.ARCTAN,s[321]=a.ARCSEC,s[322]=a.ARCCSC,s[323]=a.ARCCOT,s[262]=a.SEC,s[264]=a.COT,s[265]=a.CSC,s[307]=a.SINH,s[308]=a.COSH,s[309]=a.TANH,s[313]=a.ARCSINH,s[314]=a.ARCCOSH,s[315]=a.ARCTANH,s[351]=a.ARCSECH,s[352]=a.ARCCSCH,s[353]=a.ARCCOTH,s[310]=a.SECH,s[311]=a.COTH,s[312]=a.CSCH,s[263]=a.LN,s[267]=a.LG,s[268]=a.LOG,s[61]=a.EQL,s[44]=a.COMMA,s[269]=a.TEXT,s[354]=a.OPERATORNAME,s[270]=a.LT,s[271]=a.LE,s[272]=a.GT,s[273]=a.GE,s[301]=a.NE,s[305]=a.NGTR,s[306]=a.NLESS,s[333]=a.NI,s[334]=a.SUBSETEQ,s[335]=a.SUPSETEQ,s[336]=a.SUBSET,s[337]=a.SUPSET,s[302]=a.APPROX,s[329]=a.PERP,s[330]=a.PROPTO,s[339]=a.PARALLEL,s[340]=a.NPARALLEL,s[341]=a.SIM,s[342]=a.CONG,s[274]=a.EXISTS,s[275]=a.IN,s[276]=a.FORALL,s[277]=a.LIM,s[278]=a.EXP,s[279]=a.TO,s[124]=a.PIPE,s[280]=a.SUM,s[281]=a.INT,s[282]=a.PROD,s[325]=a.CUP,s[326]=a.BIGCUP,s[327]=a.CAP,s[328]=a.BIGCAP,s[283]=a.M,s[350]=a.IMPLIES,s[284]=a.RIGHTARROW,s[343]=a.LEFTARROW,s[344]=a.LONGRIGHTARROW,s[345]=a.LONGLEFTARROW,s[346]=a.OVERRIGHTARROW,s[347]=a.OVERLEFTARROW,s[348]=a.LONGLEFTRIGHTARROW,s[349]=a.OVERLEFTRIGHTARROW,s[357]=a.RIGHTLEFTHARPOONS,s[33]=a.FACT,s[285]=a.BINOM,s[286]=a.ROW,s[287]=a.COL,s[58]=a.COLON,s[59]=a.SEMICOLON,s[295]=a.TYPE,s[296]=a.OVERLINE,s[297]=a.OVERSET,s[298]=a.UNDERSET,s[299]=a.BACKSLASH,s[300]=a.MATHBF,s[304]=a.DOT,s[324]=a.MATHFIELD;var l=function parse(e,r){function newNode(e,r){return{op:e,args:r}}function matchThousandsSeparator(e,r){if(Model.option("allowThousandsSeparator")){var n=Model.option("setThousandsSeparator");return n?e===r||!r&&indexOf(n,e)>=0?e:"":","===e?e:""}return""}function matchDecimalSeparator(e){var r=Model.option("setDecimalSeparator"),n=Model.option("setThousandsSeparator");if("string"==typeof r){assert(1===r.length,t(1002));var a=r;return n instanceof Array&&indexOf(n,a)>=0&&assert(!1,t(1008,[a])),e===a}return r instanceof Array?(forEach(r,(function(e){n instanceof Array&&indexOf(n,e)>=0&&assert(!1,t(1008,[e]))})),indexOf(r,e)>=0):"."===e}function numberNode(e,r,n){var a,o,i,s,l,u=Model.option("ignoreTrailingZeros"),d=e.toString(),c="",p=0,g="integer",m=0;for("."===e&&assert(!1,t(1004,[e,e.charCodeAt(0)])),a=0;a<d.length;a++)matchThousandsSeparator(o=d.charAt(a))?((p&&i!==a-4||!p&&a>4)&&assert(!1,t(1005)),i=a,p++):(matchDecimalSeparator(o)?("decimal"===g&&assert(!1,t(1007,[o,c+o])),o=".",g="decimal",p&&i!==a-4&&assert(!1,t(1005)),s=c.length,i=a,p++):"decimal"===g&&"0"!==o&&(s=c.length),0===c.indexOf("0")&&"decimal"!==g&&(m++,"."!==o&&(c="")),c+=o);if("decimal"!==g&&i&&i!==a-4&&assert(!1,t(1005)),void 0!==s&&(s+1<c.length&&(l=!0),u&&"."===(c=c.substring(0,s+1))&&(c="0")),c=new BigDecimal(c),r){var f=option("decimalPlaces");(!n||c.scale()>f)&&(c=c.setScale(f,BigDecimal.ROUND_HALF_UP))}return{op:Model.NUM,args:[String(c)],hasThousandsSeparator:0!==p,numberFormat:g,hasLeadingZero:m,hasTrailingZero:l}}function multiplyNode(e,r){return 0===e.length&&(e=[i]),binaryNode(Model.MUL,e,r)}function unaryNode(e,r){return assert(1===r.length,"1000: Wrong number of arguments for unary node"),newNode(e,r)}function binaryNode(e,r,n){if(assert(r.length>0,"1000: Too few argument for binary node"),r.length<2)return r[0];var t=[];return forEach(r,(function(r){n&&r.op===e?t=t.concat(r.args):t.push(r)})),newNode(e,t)}e=function stripInvisible(e){var r,n,t="",a=0;for(;a<e.length;){for(;a<e.length&&isInvisibleCharCode(r=e.charCodeAt(a++));)32!==n&&(n=r=9);92===r?(t+=String.fromCharCode(r),a<e.length&&(r=e.charCodeAt(a++))):9===r&&isNumberCharCode(t.charCodeAt(t.length-1))&&isNumberCharCode(e.charCodeAt(a))&&(r=e.charCodeAt(a++)),t+=String.fromCharCode(r)}return t}(e);var n,o,i=numberNode("1"),l=unaryNode(Model.SUB,[numberNode("1")]),u=newNode(Model.NONE,[numberNode("0")]),d=newNode(Model.VAR,["0"]),c=0,p=0,g=function scanner(e){var n,a=0,o="",i={"\\cdot":42,"\\times":42,"\\div":294,"\\dfrac":256,"\\frac":256,"\\sqrt":257,"\\vec":290,"\\pm":258,"\\sin":259,"\\cos":261,"\\tan":260,"\\sec":262,"\\cot":264,"\\csc":265,"\\arcsin":291,"\\arccos":292,"\\arctan":293,"\\arcsec":321,"\\arccsc":322,"\\arccot":323,"\\sinh":307,"\\cosh":308,"\\tanh":309,"\\sech":310,"\\coth":311,"\\csch":312,"\\arcsinh":313,"\\arccosh":314,"\\arctanh":315,"\\arcsech":351,"\\arccsch":352,"\\arccoth":353,"\\ln":263,"\\lg":267,"\\log":268,"\\left":355,"\\right":356,"\\big":null,"\\Big":null,"\\bigg":null,"\\Bigg":null,"\\ ":null,"\\quad":null,"\\qquad":null,"\\text":269,"\\textrm":269,"\\textit":269,"\\textbf":269,"\\operatorname":354,"\\lt":270,"\\le":271,"\\gt":272,"\\ge":273,"\\ne":301,"\\ngtr":305,"\\nless":306,"\\approx":302,"\\exists":274,"\\in":275,"\\forall":276,"\\lim":277,"\\exp":278,"\\to":279,"\\sum":280,"\\int":281,"\\prod":282,"\\%":37,"\\rightarrow":284,"\\longrightarrow":284,"\\binom":285,"\\begin":288,"\\end":289,"\\colon":58,"\\vert":124,"\\lvert":124,"\\rvert":124,"\\mid":124,"\\format":332,"\\overline":296,"\\overset":297,"\\underset":298,"\\backslash":299,"\\mathbf":300,"\\abs":303,"\\dot":304,"\\rightleftharpoons":357},s={162:"\\cent",176:"\\degree",8704:"\\forall",8705:"\\complement",8706:"\\partial",8707:"\\exists",8708:"\\nexists",8709:"\\varnothing",8710:"\\triangle",8711:"\\nabla",8712:"\\in",8713:"\\notin",8714:"\\in",8715:"\\ni",8716:"\\notni",8717:"\\ni",8718:"\\blacksquare",8719:"\\sqcap",8720:"\\amalg",8721:"\\sigma",8722:"-",8723:"\\mp",8724:"\\dotplus",8725:"/",8726:"\\setminus",8727:"*",8728:"\\circ",8729:"\\bullet",8730:"\\sqrt",8731:null,8732:null,8733:"\\propto",8734:"\\infty",8735:"\\llcorner",8736:"\\angle",8737:"\\measuredangle",8738:"\\sphericalangle",8739:"\\divides",8740:"\\notdivides",8741:"\\parallel",8742:"\\nparallel",8743:"\\wedge",8744:"\\vee",8745:"\\cap",8746:"\\cup",8747:"\\int",8748:"\\iint",8749:"\\iiint",8750:"\\oint",8751:"\\oiint",8752:"\\oiiint",8753:null,8754:null,8755:null,8756:"\\therefore",8757:"\\because",8758:"\\colon",8759:null,8760:null,8761:null,8762:null,8763:null,8764:"\\sim",8765:"\\backsim",8766:null,8767:null,8768:"\\wr",8769:"\\nsim",8770:"\\eqsim",8771:"\\simeq",8772:null,8773:"\\cong",8774:null,8775:"\\ncong",8776:"\\approx",8777:null,8778:"\\approxeq",8779:null,8780:null,8781:"\\asymp",8782:"\\Bumpeq",8783:"\\bumpeq",8784:"\\doteq",8785:"\\doteqdot",8786:"\\fallingdotseq",8787:"\\risingdotseq",8788:null,8789:null,8790:"\\eqcirc",8791:"\\circeq",8792:null,8793:null,8794:null,8795:null,8796:"\\triangleq",8797:null,8798:null,8799:null,8800:"\\ne",8801:"\\equiv",8802:null,8803:null,8804:"\\le",8805:"\\ge",8806:"\\leqq",8807:"\\geqq",8808:"\\lneqq",8809:"\\gneqq",8810:"\\ll",8811:"\\gg",8812:"\\between",8813:null,8814:"\\nless",8815:"\\ngtr",8816:"\\nleq",8817:"\\ngeq",8818:"\\lessim",8819:"\\gtrsim",8820:null,8821:null,8822:"\\lessgtr",8823:"\\gtrless",8824:null,8825:null,8826:"\\prec",8827:"\\succ",8828:"\\preccurlyeq",8829:"\\succcurlyeq",8830:"\\precsim",8831:"\\succsim",8832:"\\nprec",8833:"\\nsucc",8834:"\\subset",8835:"\\supset",8836:null,8837:null,8838:"\\subseteq",8839:"\\supseteq",8840:"\\nsubseteq",8841:"\\nsupseteq",8842:"\\subsetneq",8843:"\\supsetneq",8844:null,8845:null,8846:null,8847:"\\sqsubset",8848:"\\sqsupset",8849:null,8850:null,8851:"\\sqcap",8852:"\\sqcup",8853:"\\oplus",8854:"\\ominus",8855:"\\otimes",8856:"\\oslash",8857:"\\odot",8858:"\\circledcirc",8859:"\\circledast",8860:null,8861:"\\circleddash",8862:"\\boxplus",8863:"\\boxminus",8864:"\\boxtimes",8865:"\\boxdot",8866:"\\vdash",8867:"\\dashv",8868:"\\top",8869:"\\bot",8870:null,8871:"\\models",8872:"\\vDash",8873:"\\Vdash",8874:"\\Vvdash",8875:"\\VDash*",8876:"\\nvdash",8877:"\\nvDash",8878:"\\nVdash",8879:"\\nVDash",8880:null,8881:null,8882:"\\vartriangleleft",8883:"\\vartriangleright",8884:"\\trianglelefteq",8885:"\\trianglerighteq",8886:null,8887:null,8888:"\\multimap",8889:null,8890:"\\intercal",8891:"\\veebar",8892:"\\barwedge",8893:null,8894:null,8895:null,8896:"\\wedge",8897:"\\vee",8898:"\\cap",8899:"\\cup",8900:"\\diamond",8901:"\\cdot",8902:"\\star",8903:null,8904:"\\bowtie",8905:"\\ltimes",8906:"\\rtimes",8907:"\\leftthreetimes",8908:"\\rightthreetimes",8909:"\\backsimeq",8910:"\\curlyvee",8911:"\\curlywedge",8912:"\\Subset",8913:"\\Supset",8914:"\\Cap",8915:"\\Cup",8916:"\\pitchfork",8917:"\\lessdot",8918:"\\gtrdot",8919:null,8920:"\\lll",8921:"\\ggg",8922:"\\lesseqgtr",8923:"\\gtreqless",8924:null,8925:null,8926:"\\curlyeqprec",8927:"\\curlyeqsucc",8928:null,8929:null,8930:null,8931:null,8932:null,8933:null,8934:"\\lnsim",8935:"\\gnsim",8936:"\\precnsim",8937:"\\succnsim",8938:"\\ntriangleleft",8939:"\\ntriangleright",8940:"\\ntrianglelefteq",8941:"\\ntrianglerighteq",8942:"\\vdots",8943:"\\cdots",8944:null,8945:"\\ddots",8946:null,8947:null,8948:null,8949:null,8950:null,8951:null,8952:null,8953:null,8954:null,8955:null,8956:null,8957:null,8958:null,8959:null,945:"\\alpha",946:"\\beta",947:"\\gamma",948:"\\delta",949:"\\epsilon",950:"\\zeta",951:"\\eta",952:"\\theta",953:"\\iota",954:"\\kappa",955:"\\lambda",956:"\\mu",957:"\\nu",958:"\\xi",959:"o",960:"\\pi",961:"\\rho",962:null,963:"\\sigma",964:"\\tau",965:"\\upsilon",966:"\\phi",967:"\\chi",968:"\\psi",969:"\\omega",913:"A",914:"B",915:"\\Gamma",916:"\\Delta",917:"E",918:"Z",919:"H",920:"\\Theta",921:"I",922:"K",923:"\\Lambda",924:"M",925:"N",926:"\\Xi",927:"O",928:"\\Pi",929:"P",930:null,931:"\\Sigma",932:"T",933:"\\Upsilon",934:"\\Phi",935:"X",936:"\\Psi",937:"\\Omega"},l=keys(r);function isAlphaCharCode(e){return e>=65&&e<=90||e>=97&&e<=122}function start(r){var n,l;for(r||(r={}),o="";a<e.length;)switch(n=e.charCodeAt(a++)){case 32:case 9:case 10:case 13:case 8203:continue;case 38:if(0===indexOf(e.substring(a),"nbsp;")){a+=5;continue}return 287;case 92:switch(o+=String.fromCharCode(n),e.charCodeAt(a)){case 92:return a++,286;case 123:case 124:case 125:return e.charCodeAt(a++)}if(null!==(u=latex()))return u;o="";continue;case 42:case 8727:return 42;case 45:case 8722:return 62===e.charCodeAt(a)?(a++,284):45;case 47:case 8725:return 47;case 33:return 61===e.charCodeAt(a)?(a++,301):n;case 58:case 8758:return 58;case 59:return 59;case 37:case 40:case 41:case 43:case 44:case 61:case 91:case 93:case 94:case 95:case 123:case 124:case 125:return o+=String.fromCharCode(n),n;case 36:return o+=String.fromCharCode(n),97;case 60:return 61===e.charCodeAt(a)?(a++,271):270;case 62:return 61===e.charCodeAt(a)?(a++,273):272;default:return isAlphaCharCode(n)||39===n?variable(n):(l=s[n])?(void 0===(u=i[o=l])&&(u=97),u):matchDecimalSeparator(String.fromCharCode(n))||isNumberCharCode(n)?r.oneCharToken?(o+=String.fromCharCode(n),48):number(n):(assert(!1,t(1004,[String.fromCharCode(n),n])),0);var u}return 0}function number(r){for(;isNumberCharCode(r)||matchDecimalSeparator(String.fromCharCode(r))||(n=matchThousandsSeparator(String.fromCharCode(r),n))&&isNumberCharCode(e.charCodeAt(a));)o+=String.fromCharCode(r),92===(r=e.charCodeAt(a++))&&32===e.charCodeAt(a)&&(r=32,a++);return"."!==o||0!==indexOf(e.substring(a),"overline")&&0!==indexOf(e.substring(a),"dot")||(o="0."),a--,"."===o?46:48}function variable(r){for(var n=String.fromCharCode(r),t=o+=n,i=a+1;(isAlphaCharCode(r)||39===r)&&isAlphaCharCode(r=e.charCodeAt(a++));){n=String.fromCharCode(r);if(!some(l,(function(e){return 0===indexOf(e,t+n)})))break;t+=n}for(indexOf(l,t)>=0?o=t:a=i;39===r;)o+=String.fromCharCode(r),r=e.charCodeAt(a++);return a--,97}function latex(){if(36===(r=e.charCodeAt(a++)))o=String.fromCharCode(r);else if(37===r)o+=String.fromCharCode(r);else if(indexOf([32,58,59,44,33],r)>=0)o="\\ ";else{for(;isAlphaCharCode(r);)o+=String.fromCharCode(r),r=e.charCodeAt(a++);a--}if(void 0===(n=i[o]))n=97;else if(354===n){for(var r=e.charCodeAt(a++);r&&123!==r;)r=e.charCodeAt(a++);o="";for(r=e.charCodeAt(a++);r&&125!==r;){"&"===(s=String.fromCharCode(r))&&0===indexOf(e.substring(a),"nbsp;")?a+=5:" "===s||"\t"===s||(o+=s),r=e.charCodeAt(a++)}var n;void 0===(n=i["\\"+o])&&(n=97)}else if(269===n){for(r=e.charCodeAt(a++);r&&123!==r;)r=e.charCodeAt(a++);o="";r=e.charCodeAt(a++);for(var t=Model.option("keepTextWhitespace");r&&125!==r;){var s=String.fromCharCode(r);t||"&"!==s||0!==indexOf(e.substring(a),"nbsp;")?(t||" "!==s&&"\t"!==s)&&(o+=s):a+=5,r=e.charCodeAt(a++)}n=!o||Model.option("ignoreText")?null:97}return n}return l.push("to"),{start:start,lexeme:function(){return o},pos:function(){return a}}}(e);function start(e){c=g.start(e),n=g.lexeme()}function hd(){return c}function lexeme(){return assert(void 0!==n,"1000: Lexeme for token T0="+c+" is missing."),n}function next(e){0===p?(c=g.start(e),n=g.lexeme()):(assert(void 0!==o,"1000: Lexeme for token="+p+" is missing."),c=p,n=o,p=0)}function lookahead(e){return 0===p&&(p=g.start(e),o=g.lexeme()),assert(void 0!==o,"1000: Lexeme for token="+p+" is missing."),p}function eat(e,r){var n=hd();if(n!==e){var a=String.fromCharCode(e),o=n?String.fromCharCode(n):"EOS";assert(!1,t(1001,[a,o]))}next(r)}function isSimpleFraction(e){if(e.op===Model.FRAC){var r=e.args[0].op===Model.SUB&&1===e.args[0].args.length&&e.args[0].args[0]||e.args[0],n=e.args[1].op===Model.SUB&&1===e.args[1].args.length&&e.args[1].args[0]||e.args[1];return r.op===Model.NUM&&"integer"===r.numberFormat&&n.op===Model.NUM&&"integer"===n.numberFormat}return!1}function isMinusOne(e){return e.op===Model.SUB&&1===e.args.length&&e.args[0].op===Model.NUM&&1===e.args[0].args.length&&"1"===e.args[0].args[0]}function isDerivative(e){if(e.op===Model.FRAC){var r=e.args[0],n=r.op===Model.MUL&&r.args[0].op===Model.VAR&&r.args[0].args[0]||r.op===Model.VAR&&r.args[0],t=e.args[1],a=t.op===Model.MUL&&t.args[0].op===Model.VAR&&t.args[0].args[0];return"d"===n&&"d"===a&&t.args[1].op===Model.VAR||void 0}}function primaryExpr(){var e,r;switch(e=hd()){case 65:case 97:var n=[lexeme()];next(),95===hd()&&(next({oneCharToken:!0}),n.push(primaryExpr())),i=newNode(Model.VAR,n),isChemCore()&&123===hd()&&125===lookahead()&&(eat(123),eat(125));break;case 48:i=numberNode(lexeme()),next();break;case 355:i=123===lookahead()?braceExpr(e):124===lookahead()?absExpr(e):parenExpr(e);break;case 91:case 40:i=parenExpr(e);break;case 93:i=Model.option("allowInterval")&&!f?parenExpr(e):d;break;case 123:i=braceExpr();break;case 288:next();var a=braceExpr();if(a.op===Model.VAR)if(0===indexOf(a.args[0],"array")){if(123===hd()){for(;125!==hd();)next();next()}}else if(indexOf(a.args[0],"matrix")>=0&&91===hd()){for(;93!==hd();)next();next()}var o=function matrixExpr(){var e=[];e.push(rowExpr());for(;286===hd();)next(),e.push(rowExpr());return newNode(s[286],e)}();eat(289),braceExpr(),indexOf(a.args[0],"matrix")>=0||0===indexOf(a.args[0],"array")?i=newNode(Model.MATRIX,[o]):assert(!1,"1000: Unrecognized LaTeX name");break;case 124:i=absExpr();break;case 303:next();var i=unaryNode(Model.ABS,[braceExpr()]);break;case 256:next();var c=braceExpr(),p=braceExpr();p=0===(c=0===c.args.length?newNode(Model.COMMA,[u]):c).args.length?newNode(Model.COMMA,[u]):p,(i=newNode(Model.FRAC,[c,p])).isFraction=isSimpleFraction(i);break;case 285:next();var g=braceExpr(),m=braceExpr(),M=unaryNode(Model.FACT,[g]),N=binaryNode(Model.POW,[binaryNode(Model.MUL,[unaryNode(Model.FACT,[m]),unaryNode(Model.FACT,[binaryNode(Model.ADD,[g,negate(m)])])]),l]);(i=binaryNode(Model.MUL,[M,N])).isBinomial=!0;break;case 257:switch(next(),hd()){case 91:var v=function bracketExpr(e){var r;assert(355===(e=e||91)||91===e,"1000: Internal error"),h++,eat(e),355===e?eat(91):e;var n=commaExpr();eat(r=355===e?355:93),356===r&&eat(r=93);return h--,n}(91),y=braceExpr();i=newNode(Model.POW,[y,newNode(Model.POW,[v,l])]);break;case 123:y=braceExpr();i=newNode(Model.POW,[y,newNode(Model.POW,[newNode(Model.NUM,["2"]),l])]);break;default:assert(!1,t(1001,["{ or (",String.fromCharCode(hd())]))}break;case 290:next();var b=braceExpr();i=newNode(Model.VEC,[b]);break;case 259:case 261:case 260:case 262:case 264:case 265:case 307:case 308:case 309:case 310:case 311:case 312:next();for(n=[];94===hd();)next({oneCharToken:!0}),n.push(unaryExpr());return 1===n.length&&isMinusOne(n[0])?(r="arc"+s[e],n=[]):r=s[e],n.unshift(newNode(r,[postfixExpr()])),n.length>1?newNode(Model.POW,n):n[0];case 291:case 292:case 293:case 321:case 322:case 323:case 313:case 314:case 315:case 351:case 352:case 353:next();for(n=[];94===hd();)next({oneCharToken:!0}),n.push(unaryExpr());return n.unshift(newNode(s[e],[primaryExpr()])),n.length>1?newNode(Model.POW,n):n[0];case 263:return next(),newNode(Model.LOG,[newNode(Model.VAR,["e"]),primaryExpr()]);case 267:return next(),newNode(Model.LOG,[newNode(Model.NUM,["10"]),primaryExpr()]);case 268:next();n=[];return 95===hd()?(next({oneCharToken:!0}),n.push(primaryExpr())):n.push(newNode(Model.NUM,["10"])),n.push(primaryExpr()),newNode(Model.LOG,n);case 277:next();n=[];return eat(95),n.push(primaryExpr()),n.push(multiplicativeExpr()),newNode(s[e],n);case 281:case 280:case 282:next();n=[];return 95===hd()&&(next({oneCharToken:!0}),n.push(primaryExpr()),eat(94,{oneCharToken:!0}),n.push(primaryExpr())),281===e?n=n.concat(function integralExpr(){var e,r=flattenNestedNodes(multiplicativeExpr()),n=hasDX(r);r=n?stripDX(r):r;for(;isAdditive(e=hd())&&!n;){next();var t=flattenNestedNodes(multiplicativeExpr());switch(n=hasDX(t),t=n?stripDX(t):t,e){case 45:r=binaryNode(Model.SUB,[r,t]);break;default:r=binaryNode(Model.ADD,[r,t],!0)}}return r}()):n.push(commaExpr()),newNode(s[e],n);case 274:return next(),newNode(Model.EXISTS,[equalExpr()]);case 276:return next(),newNode(Model.FORALL,[commaExpr()]);case 278:return next(),newNode(Model.EXP,[additiveExpr()]);case 283:return next(),newNode(Model.M,[multiplicativeExpr()]);case 332:return next(),newNode(Model.FORMAT,[braceExpr()]);case 296:return next(),newNode(Model.OVERLINE,[braceExpr()]);case 304:return next(),newNode(Model.DOT,[braceExpr()]);case 297:case 298:next();c=braceExpr();return(p=braceExpr()).args.push(newNode(s[e],[c])),p;case 300:return next(),c=braceExpr();case 46:return next(),d;default:assert(!Model.option("strict"),t(1006,[s[e]])),i=d}return i}function rowExpr(){var e=[];for(e.push(commaExpr());287===hd();)next(),e.push(commaExpr());return newNode(s[287],e)}var m=0;function absExpr(e){var r,n;m++,eat(e=e||124),355===e?eat(r=hd()):r=e;var t=additiveExpr();return eat(n=355===e?356:r),356===n&&eat(n=r),m--,unaryNode(Model.ABS,[t])}function braceExpr(e){var r,n,t;return eat(e=e||123),355===e?eat(r=123):r=e,356===hd()||125===hd()?(eat(n=hd()),356===n&&eat(n=46===hd()?46:125),t=newNode(Model.COMMA,[])):(t=commaExpr(),eat(n=355===e?356:125),356===n&&eat(n=46===hd()?46:125),t.op===d.op&&t.args[0]===d.args[0]&&(t=newNode(Model.COMMA,[]))),t.lbrk=r,t.rbrk=n,t}var f,h=0;function parenExpr(e){var r,n,a,o=Model.option("allowInterval");(h++,eat(e),355===e?eat(r=hd()):r=e,356===hd()||41===hd()||93===hd())?(eat(n=hd()),356===n&&eat(n=40===r?41:93),a=newNode(Model.COMMA,[])):(f=!0,a=commaExpr(o),o?(eat(n=41===hd()?41:355===e?356:91===hd()?91:93),356===n&&eat(n=41===hd()?41:91===hd()?91:93)):(eat(n=40===e?41:355===e?356:93),356===n&&eat(n=40===r?41:46===r?124:91===r?93:hd())));return a.lbrk=r=93===r?40:r,a.rbrk=n=91===n?41:n,!o||2!==a.args.length||a.op!==Model.COMMA||40!==r&&91!==r&&93!==r||41!==n&&93!==n&&91!==n?46===a.lbrk&&124===a.rbrk?a=newNode(Model.EVALAT,[a]):a.op===Model.COMMA&&(assert(40===r&&41===n||91===r&&93===n||r===n,t(1011)),a.op=Model.LIST):(a.op=Model.INTERVAL,a.args.push(numberNode(r)),a.args.push(numberNode(n))),h--,f=!1,a}function exponentialExpr(){for(var e=[primaryExpr()];94===(r=hd());){var r,n;if(next({oneCharToken:!0}),!isMathSymbol(e[0])&&!isChemCore()||43!==(r=hd())&&45!==r)(n=unaryExpr()).op===Model.VAR&&"\\circ"===n.args[0]?(97===hd()&&"K"===lexeme()||"C"===lexeme()||"F"===lexeme()?(n=multiplyNode([e.pop(),unaryNode(Model.VAR,["\\degree "+lexeme()])]),next()):n=multiplyNode([e.pop(),unaryNode(Model.VAR,["\\degree"])]),e.push(n)):e.push(n);else next(),n=hd()?primaryExpr():d,e.push(unaryNode(s[r],[n]))}if(e.length>1){var t=e.pop();return forEach(e.reverse(),(function(e){t=newNode(Model.POW,[e,t])})),t}return e[0]}function postfixExpr(){var e,r=exponentialExpr();switch(e=hd()){case 37:next(),r=newNode(Model.PERCENT,[r]);break;case 33:next(),r=newNode(Model.FACT,[r]);break;default:97===e&&"\\degree"===lexeme()?(next(),97!==hd()||"K"!==lexeme()&&"C"!==lexeme()&&"F"!==lexeme()?r=multiplyNode([r,unaryNode(Model.VAR,["\\degree"])]):(r=multiplyNode([r,unaryNode(Model.VAR,["\\degree "+lexeme()])]),next())):!isChemCore()||43!==e&&45!==e||125!==lookahead()||(next(),r=unaryNode(s[e],[r]))}return r}function unaryExpr(){var e,r;switch(e=hd()){case 43:next(),r=newNode(Model.ADD,[unaryExpr()]);break;case 45:next(),r=newNode(Model.SUB,[unaryExpr()]);break;case 258:next(),r=unaryExpr(),r=newNode(s[e],[r]);break;case 95:var n=s[e];if(next({oneCharToken:!0}),43===(e=hd())||45===e?(next(),r=i):r=unaryExpr(),r=newNode(n,[r]),94===(e=hd())){var t=[r];n=s[e];next({oneCharToken:!0}),43===(e=hd())||45===e?(next(),r=i):r=unaryExpr(),t.push(r),r=newNode(n,t)}break;case 94:n=s[e];next({oneCharToken:!0}),43===(e=hd())||45===e?(next(),r=i):r=unaryExpr(),r=newNode(n,[r]);break;default:97===e&&"$"===lexeme()?(next(),r=(e=hd())&&125!==e&&47!==e?multiplyNode([newNode(Model.VAR,["$"]),postfixExpr()]):newNode(Model.VAR,["$"])):r=postfixExpr()}return r}function subscriptExpr(){var e=[unaryExpr()];return 95===hd()&&(next({oneCharToken:!0}),e.push(exponentialExpr()),isChemCore()&&123===hd()&&(eat(123),eat(125))),e.length>1?newNode(Model.SUBSCRIPT,e):e[0]}function fractionExpr(){var e=subscriptExpr();if(isNumber(e)&&(256===hd()||48===hd()&&47===lookahead())){var r=fractionExpr();isMixedNumber(e,r)?(isNeg(e)&&(r=binaryNode(Model.MUL,[l,r])),(e=binaryNode(Model.ADD,[e,r])).isMixedNumber=!0):(e=binaryNode(Model.MUL,[e,r]),r.isImplicit=!0)}for(;47===hd();)next(),(e=newNode(Model.FRAC,[e,subscriptExpr()])).isFraction=isSimpleFraction(e),e.isSlash=!0;return e}function isMathSymbol(e){if(e.op!==Model.VAR)return!1;var r=Model.env[e.args[0]];return!(!r||!r.name)}function isVar(e,r){return assert(void 0===r||"string"==typeof r,"1000: Invalid id"),e.op===Model.VAR?void 0===r||e.args[0]===r:!(e.op!==Model.POW||!isVar(e.args[0])||!isInteger(e.args[1]))&&(void 0===r||e.args[0].args[0]===r)}function isOne(e){return e.op===Model.NUM&&"1"===e.args[0]}function isMinusOne(e){return e.op===Model.SUB&&1===e.args.length&&isOne(e.args[0])}function isDerivative(e){if(e.op===Model.FRAC){var r=e.args[0],n=r.op===Model.MUL&&r.args[0].op===Model.VAR&&r.args[0].args[0]||r.op===Model.VAR&&r.args[0],t=e.args[1],a=t.op===Model.MUL&&t.args[0].op===Model.VAR&&t.args[0].args[0];return"d"===n&&"d"===a&&t.args[1].op===Model.VAR||void 0}}function derivativeExpr(e){if(e.op===Model.FRAC){var r=e.args[0],n=e.args[1],t=r.op===Model.MUL&&r.args.slice(1).length>0&&multiplyNode(r.args.slice(1))||i;return assert(2===n.args.length),newNode(Model.DERIV,[n.args[1],t])}}function multiplicativeExpr(){var e,r,n=!1,a=[];e=fractionExpr(),isDerivative(e)&&(e=derivativeExpr(e)),a=e.op!==Model.MUL||e.isBinomial||Model.option("compareGrouping")?[e]:e.args;for(var o,i=0;(d=hd())&&!isAdditive(d)&&!isRelational(d)&&44!==d&&59!==d&&!isEquality(d)&&125!==d&&41!==d&&356!==d&&(91!==d&&93!==d||!(h>0))&&284!==d&&357!==d&&270!==d&&!(124===d&&m>0)&&286!==d&&287!==d&&289!==d;){if(n,n=!1,isMultiplicative(d)&&(next(),n=!0),e=fractionExpr(),isDerivative(e)&&(e=derivativeExpr(e)),294===d&&(e=newNode(Model.POW,[e,l])),!(n||0===a.length||e.lbrk||a[a.length-1].op!==Model.NUM||"decimal"!==a[a.length-1].numberFormat||a[a.length-1].args[0].indexOf(".")>=0||a[a.length-1].lbrk||isRepeatingDecimal([a[a.length-1],e])||e.op!==Model.NUM)){var s=a.pop();e=newNode(Model.NUM,[s.args[0]+"."+e.args[0]])}if(assert(n||0===a.length||e.lbrk||a[a.length-1].op!==Model.NUM||a[a.length-1].lbrk||isRepeatingDecimal([a[a.length-1],e])||e.op!==Model.NUM,t(1010)),isChemCore()&&40===d&&isVar(a[a.length-1],"M"))a.pop(),e=unaryNode(Model.M,[e]);else if(!n&&a.length>0)if(a.length>0&&isMixedNumber(a[a.length-1],e))isNeg(d=a.pop())&&(e=binaryNode(Model.MUL,[l,e])),(e=binaryNode(Model.ADD,[d,e])).isMixedNumber=!0;else if(Model.option("ignoreCoefficientOne")&&1===a.length&&((isOne(o=a[0])||isMinusOne(o))&&isPolynomialTerm(a[0],e)))isOne(a[0])?a.pop():(a.pop(),e=negate(e));else if(a.length>0&&(r=isRepeatingDecimal([a[a.length-1],e])))a.pop(),e=r;else if(isENotation(a,e)){var u=a.pop();e=binaryNode(Model.POW,[numberNode("10"),unaryExpr()]),(e=binaryNode(Model.MUL,[u,e])).isScientific=!0}else{var d;if(!isChemCore()&&isPolynomialTerm(a[a.length-1],e)){if(e.isPolynomial=!0,!(d=a.pop()).isPolynomial){if(d.op===Model.MUL&&d.args[d.args.length-1].isPolynomial){assert(2===d.args.length);var c=d.args[0],p=d.args[1];e.isPolynomial=p.isPolynomial=!1,e.isImplicit=!0,(e=binaryNode(Model.MUL,[c,binaryNode(Model.MUL,[p,e],!0)])).args[1].isPolynomial=!0,e.args[1].isImplicit=!0}else e=binaryNode(Model.MUL,[d,e]);e.isImplicit=d.isImplicit,d.isImplicit=void 0}}else if(a[a.length-1].op===Model.DERIV){var g=a[a.length-1].args[1];e=newNode(Model.DERIV,[a[a.length-1].args[0],multiplyNode([g,e])]),a.pop()}else e.isImplicit=!0}else 42===d&&a.length>0&&isScientific([a[a.length-1],e])&&(d=a.pop(),(e=binaryNode(Model.MUL,[d,e])).isScientific=!0);e.op!==Model.MUL||e.isScientific||e.isBinomial||!a.length||a[a.length-1].isImplicit||a[a.length-1].isPolynomial||!e.isImplicit||!e.isPolynomial?a.push(e):a=a.concat(e.args),assert(i++<1e3,"1000: Stuck in loop in multiplicativeExpr()")}return a.length>1?function trimEmptyBraces(e){assert(e.op===Model.MUL,"1000: Internal error");var r,n=e.args;(r=n[0]).op===Model.COMMA&&0===r.args.length&&((n=n.slice(1,n.length))[0].isImplicit=!1);(r=n[n.length-1]).op===Model.COMMA&&0===r.args.length&&(n=n.slice(0,n.length-1));return newNode(e.op,n)}(multiplyNode(a)):a[0];function isMultiplicative(e){return 42===e||294===e||47===e}}function isNumber(e){return e.op!==Model.SUB&&e.op!==Model.ADD||1!==e.args.length||(e=e.args[0]),e.op===Model.NUM&&e}function isMixedNumber(e,r){return e.op===Model.SUB&&1===e.args.length&&(e=e.args[0]),!(e.lbrk||r.lbrk||!isInteger(e)||!isSimpleFraction(r))&&(assert(function isProperFraction(e){if(e.op===Model.FRAC){var r=e.args[0],n=e.args[1];return r.op===Model.NUM&&"integer"===r.numberFormat&&n.op===Model.NUM&&"integer"===n.numberFormat&&+r.args[0]<n.args[0]}return!1}(r),t(1010)),!0)}function isPolynomialTerm(e,r){return e.op===Model.SUB&&1===e.args.length&&(e=e.args[0]),!(e.lbrk||r.lbrk||!(e.op===Model.NUM&&isVar(r)||isVar(e)&&r.op===Model.NUM||e.op===Model.NUM&&r.op===Model.NUM||e.op===Model.MUL&&e.args[e.args.length-1].isPolynomial&&isVar(r)))}function isInteger(e){var r;return!!e&&(e.op===Model.SUB&&1===e.args.length&&(e=e.args[0]),!(e.op!==Model.NUM||!(r=new BigDecimal(e.args[0]))||!isInteger(r))||e instanceof BigDecimal&&0===e.remainder(N).compareTo(M))}var M=new BigDecimal("0"),N=new BigDecimal("1");function isRepeatingDecimal(e){var r,n,t,a=!1;if(e[0].op===Model.SUB&&e[0].args[0].op===Model.NUM&&(e[0]=e[0].args[0],a=!0),e[0].isRepeating===Model.DOT){var o,i=e[0].op===Model.ADD&&e[0].args[1].op===Model.NUM?e[0].args[1]:e[0];assert(i.op===Model.NUM,"1000: Expecting a number"),e[1].op===Model.DOT?(assert(e[1].args[0].op===Model.NUM,"1000: Expecting a number"),o=numberNode(i.args[0]+e[1].args[0].args[0])):(assert(e[1].op===Model.NUM,"1000: Expecting a number"),o=numberNode(i.args[0]+e[1].args[0])),o.isRepeating=Model.DOT,e[0].op===Model.ADD?(e[0].args[1]=o,r=e[0]):r=o}else if(e[0].lbrk||e[0].op!==Model.NUM||"decimal"!==e[0].numberFormat)r=null;else{if(e[1].lbrk||e[1].op!==Model.OVERLINE){if(e[1].lbrk||e[1].op!==Model.DOT)return null;n=e[0],t=e[1].args[0]}else n=e[0],t=e[1].args[0];if((t=numberNode("."+new Array(t.hasLeadingZero).fill(0).join()+t.args[0])).isRepeating=e[1].op,indexOf(n.args[0],".")>=0){var s=n.args[0].length-indexOf(n.args[0],".")-1;t=multiplyNode([t,binaryNode(Model.POW,[numberNode("10"),numberNode("-"+s)])])}(r=n.op===Model.NUM&&0==+n.args[0]?t:binaryNode(Model.ADD,[n,t])).numberFormat="decimal",r.isRepeating=e[1].op}return r=null!==r&&a&&unaryNode(Model.SUB,[r])||r}function isENotation(e,r,n){var t=Model.option("allowEulersNumber");return!(!(e.length>0&&isNumber(e[e.length-1])&&r.op===Model.VAR)||"E"!==r.args[0]&&("e"!==r.args[0]||t)||48!==hd()&&(45!==hd()&&43!==hd()||48!==lookahead()))}function isScientific(e){var r;if(1===e.length)return!(!(r=isNumber(e[0]))||1!==r.args[0].length&&1!==indexOf(r.args[0],"."))||!(e[0].op!==Model.POW||!(r=isNumber(e[0].args[0]))||"10"!==r.args[0]||!isInteger(e[0].args[1]));if(2===e.length){var n=e[0],t=e[1];return!(!(r=isNumber(n))||1!==r.args[0].length&&1!==indexOf(r.args[0],".")||t.op!==Model.POW||!(r=isNumber(t.args[0]))||"10"!==r.args[0]||!isInteger(t.args[1]))}}function isNeg(e){return"number"==typeof e?e<0:1===e.args.length?e.op===a.SUB&&e.args[0].args[0]>0||e.op===Model.NUM&&+e.args[0]<0:2===e.args.length?e.op===a.MUL&&isNeg(e.args[0]):void 0}function negate(e){if("number"==typeof e)return-e;if(e.op===Model.MUL){var r=e.args.slice(0);return multiplyNode([negate(r.shift())].concat(r))}return e.op===Model.POW&&isMinusOne(e.args[1])?binaryNode(Model.POW,[negate(e.args[0]),l]):unaryNode(Model.SUB,[e])}function isAdditive(e){return 43===e||45===e||258===e||299===e}function additiveExpr(){for(var e,r=multiplicativeExpr();isAdditive(e=hd());){next();var n=multiplicativeExpr();switch(e){case 299:r=binaryNode(Model.BACKSLASH,[r,n]);break;case 258:r=binaryNode(Model.PM,[r,n]);break;case 45:r=binaryNode(Model.SUB,[r,n]);break;default:var t=!Model.option("compareGrouping");r=binaryNode(Model.ADD,[r,n],t)}}return r}function hasDX(e){var r=e.args.length;e.args[r-1].op===Model.FRAC&&(r=(e=e[r-1].args[0]).args.length);var n=e.args[r-2],t=e.args[r-1];return e&&e.op===Model.MUL&&n.op===Model.VAR&&"d"===n.args[0]&&t.op===Model.VAR}function stripDX(e){assert(e.op===Model.MUL||e.op===Model.FRAC);var r=e.args[e.args.length-1];return r.op===Model.FRAC?(r=function fractionNode(e,r){return multiplyNode([e,binaryNode(Model.POW,[r,l])],!0)}(r.args[0].slice(0,r.args[0].args.length-2),e.args[1]),e=multiplyNode(e.args.slice(0,e.args.length-1).concat(r))):e=multiplyNode(e.args.slice(0,e.args.length-2)),e}function flattenNestedNodes(e){var r=[];if(e.op===Model.NUM||e.op===Model.VAR)return e;forEach(e.args,(function(n){(n=flattenNestedNodes(n)).op===e.op?r=r.concat(n.args):r.push(n)}));var n=e.isMixedNumber;return(e=newNode(e.op,r)).isMixedNumber=n,e}function isRelational(e){return 270===e||271===e||272===e||273===e||305===e||306===e||275===e||279===e||58===e||97===e&&"to"===lexeme()}function isEquality(e){return 61===e||301===e||302===e}function equalExpr(){for(var e,r=function relationalExpr(){for(var e=hd(),r=additiveExpr(),n=[];isRelational(e=hd());){97===e&&"to"===lexeme()&&(e=58),next();var t=additiveExpr();r=newNode(s[e],[r,t]),n.push(r),r=Model.create(t)}return 0===n.length?r:1===n.length?n[0]:newNode(Model.COMMA,n)}(),n=[];isEquality(e=hd())||284===e||357===e;){next();var t=additiveExpr();r=newNode(s[e],[r,t]),n.push(r),r=Model.create(t)}return 0===n.length?r:1===n.length?n[0]:newNode(Model.COMMA,n)}function commaExpr(e){for(var r,n,t=equalExpr(),a=[t];44===(r=hd())||e&&59===r;)next(),41!==(n=hd())&&125!==n&&93!==n&&286!==n&&287!==n&&289!==n&&0!==n&&a.push(equalExpr());return a.length>1?newNode(s[44],a):t}return{expr:function expr(){if(start(),hd()){var r=commaExpr();return assert(!hd(),t(1003,[g.pos(),g.lexeme(),"'"+e.substring(g.pos()-1)+"'"])),r}return u},tokenize:function tokenize(){var e=[];for(start();hd();){var r=lexeme();e.push(newNode(hd(),r?[r]:[])),next()}return newNode(Model.COMMA,e)}};function isInvisibleCharCode(e){return function isControlCharCode(e){return e>=1&&e<=31||e>=127&&e<=159}(e)}function isNumberCharCode(e){return e>=48&&e<=57}};return Model}(),MathContext=function(){function MathContext(){this.digits=0,this.form=0,this.lostDigits=!1,this.roundingMode=0;var e=this.DEFAULT_FORM,r=this.DEFAULT_LOSTDIGITS,n=this.DEFAULT_ROUNDINGMODE;if(4==arguments.length)e=arguments[1],r=arguments[2],n=arguments[3];else if(3==arguments.length)e=arguments[1],r=arguments[2];else if(2==arguments.length)e=arguments[1];else if(1!=arguments.length)throw"MathContext(): "+arguments.length+" arguments given; expected 1 to 4";var t=arguments[0];if(t!=this.DEFAULT_DIGITS){if(t<this.MIN_DIGITS)throw"MathContext(): Digits too small: "+t;if(t>this.MAX_DIGITS)throw"MathContext(): Digits too large: "+t}if(e==this.SCIENTIFIC);else if(e==this.ENGINEERING);else if(e!=this.PLAIN)throw"MathContext() Bad form value: "+e;if(!this.isValidRound(n))throw"MathContext(): Bad roundingMode value: "+n;this.digits=t,this.form=e,this.lostDigits=r,this.roundingMode=n}return MathContext.prototype.getDigits=function getDigits(){return this.digits},MathContext.prototype.getForm=function getForm(){return this.form},MathContext.prototype.getLostDigits=function getLostDigits(){return this.lostDigits},MathContext.prototype.getRoundingMode=function getRoundingMode(){return this.roundingMode},MathContext.prototype.toString=function toString(){var e=null,r=0,n=null;e=this.form==this.SCIENTIFIC?"SCIENTIFIC":this.form==this.ENGINEERING?"ENGINEERING":"PLAIN";var t=this.ROUNDS.length;r=0;e:for(;t>0;t--,r++)if(this.roundingMode==this.ROUNDS[r]){n=this.ROUNDWORDS[r];break e}return"digits="+this.digits+" form="+e+" lostDigits="+(this.lostDigits?"1":"0")+" roundingMode="+n},MathContext.prototype.isValidRound=function isValidRound(e){var r=0,n=this.ROUNDS.length;r=0;for(;n>0;n--,r++)if(e==this.ROUNDS[r])return!0;return!1},MathContext.PLAIN=MathContext.prototype.PLAIN=0,MathContext.SCIENTIFIC=MathContext.prototype.SCIENTIFIC=1,MathContext.ENGINEERING=MathContext.prototype.ENGINEERING=2,MathContext.ROUND_CEILING=MathContext.prototype.ROUND_CEILING=2,MathContext.ROUND_DOWN=MathContext.prototype.ROUND_DOWN=1,MathContext.ROUND_FLOOR=MathContext.prototype.ROUND_FLOOR=3,MathContext.ROUND_HALF_DOWN=MathContext.prototype.ROUND_HALF_DOWN=5,MathContext.ROUND_HALF_EVEN=MathContext.prototype.ROUND_HALF_EVEN=6,MathContext.ROUND_HALF_UP=MathContext.prototype.ROUND_HALF_UP=4,MathContext.ROUND_UNNECESSARY=MathContext.prototype.ROUND_UNNECESSARY=7,MathContext.ROUND_UP=MathContext.prototype.ROUND_UP=0,MathContext.prototype.DEFAULT_FORM=MathContext.prototype.SCIENTIFIC,MathContext.prototype.DEFAULT_DIGITS=9,MathContext.prototype.DEFAULT_LOSTDIGITS=!1,MathContext.prototype.DEFAULT_ROUNDINGMODE=MathContext.prototype.ROUND_HALF_UP,MathContext.prototype.MIN_DIGITS=0,MathContext.prototype.MAX_DIGITS=999999999,MathContext.prototype.ROUNDS=new Array(MathContext.prototype.ROUND_HALF_UP,MathContext.prototype.ROUND_UNNECESSARY,MathContext.prototype.ROUND_CEILING,MathContext.prototype.ROUND_DOWN,MathContext.prototype.ROUND_FLOOR,MathContext.prototype.ROUND_HALF_DOWN,MathContext.prototype.ROUND_HALF_EVEN,MathContext.prototype.ROUND_UP),MathContext.prototype.ROUNDWORDS=new Array("ROUND_HALF_UP","ROUND_UNNECESSARY","ROUND_CEILING","ROUND_DOWN","ROUND_FLOOR","ROUND_HALF_DOWN","ROUND_HALF_EVEN","ROUND_UP"),MathContext.prototype.DEFAULT=new MathContext(MathContext.prototype.DEFAULT_DIGITS,MathContext.prototype.DEFAULT_FORM,MathContext.prototype.DEFAULT_LOSTDIGITS,MathContext.prototype.DEFAULT_ROUNDINGMODE),MathContext}(),BigDecimal=function(e){function div(e,r){return(e-e%r)/r}function createArrayWithZeros(e){var r,n=new Array(e);for(r=0;r<e;++r)n[r]=0;return n}function BigDecimal(){if(this.ind=0,this.form=e.prototype.PLAIN,this.mant=null,this.exp=0,0!=arguments.length){var r,n,t,a,o,i,s,l;1==arguments.length?(n=0,t=(r=arguments[0]).length):(r=arguments[0],n=arguments[1],t=arguments[2]),"string"==typeof r&&(r=r.split(""));var u=0,d=0,c=!1,p=0,g=0,m=0,f=0,h=0,M=0;t<=0&&this.bad("BigDecimal(): ",r),this.ind=this.ispos,"-"==r[0]?(0==--t&&this.bad("BigDecimal(): ",r),this.ind=this.isneg,n++):"+"==r[0]&&(0==--t&&this.bad("BigDecimal(): ",r),n++),a=!1,o=!1,i=0,s=-1,l=-1;var N=t;u=n;e:for(;N>0;N--,u++)if((d=r[u])>="0"&&d<="9")l=u,i++;else if("."!=d){if("e"==d||"E"==d){u-n>t-2&&this.bad("BigDecimal(): ",r),c=!1,"-"==r[u+1]?(c=!0,p=u+2):p="+"==r[u+1]?u+2:u+1,(0==(g=t-(p-n))||g>9)&&this.bad("BigDecimal(): ",r);var v=g;for(m=p;v>0;v--,m++)(f=r[m])<"0"&&this.bad("BigDecimal(): ",r),f>"9"?this.bad("BigDecimal(): ",r):h=f-"0",this.exp=10*this.exp+h;c&&(this.exp=-this.exp),o=!0;break e}(d<"0"||d>"9")&&this.bad("BigDecimal(): ",r),a=!0,l=u,i++}else s>=0&&this.bad("BigDecimal(): ",r),s=u-n;0==i&&this.bad("BigDecimal(): ",r),s>=0&&(this.exp=this.exp+s-i);var y=l-1;u=n;e:for(;u<=y;u++)if("0"==(d=r[u]))n++,s--,i--;else{if("."!=d){if(d<="9")break e;break e}n++,s--}if(this.mant=new Array(i),m=n,a){var b=i;for(u=0;b>0;b--,u++)u==s&&m++,(f=r[m])<="9"?this.mant[u]=f-"0":this.bad("BigDecimal(): ",r),m++}else{var O=i;for(u=0;O>0;O--,u++)u==s&&m++,this.mant[u]=r[m]-"0",m++}0==this.mant[0]?(this.ind=this.iszero,this.exp>0&&(this.exp=0),o&&(this.mant=this.ZERO.mant,this.exp=0)):o&&(this.form=e.prototype.SCIENTIFIC,((M=this.exp+this.mant.length-1)<this.MinExp||M>this.MaxExp)&&this.bad("BigDecimal(): ",r))}}function diginit(){var e,r=0,n=0;for(e=new Array(190),r=0;r<=189;r++)(n=r-90)>=0?(e[r]=n%10,BigDecimal.prototype.bytecar[r]=div(n,10)):(n+=100,e[r]=n%10,BigDecimal.prototype.bytecar[r]=div(n,10)-10);return e}return BigDecimal.prototype.div=div,BigDecimal.prototype.arraycopy=function arraycopy(e,r,n,t,a){var o;if(t>r)for(o=a-1;o>=0;--o)n[o+t]=e[o+r];else for(o=0;o<a;++o)n[o+t]=e[o+r]},BigDecimal.prototype.createArrayWithZeros=createArrayWithZeros,BigDecimal.prototype.abs=function abs(){var e;if(1==arguments.length)e=arguments[0];else{if(0!=arguments.length)throw"abs(): "+arguments.length+" arguments given; expected 0 or 1";e=this.plainMC}if(this.ind==this.isneg)return this.negate(e);return this.plus(e)},BigDecimal.prototype.add=function add(){var r;if(2==arguments.length)r=arguments[1];else{if(1!=arguments.length)throw"add(): "+arguments.length+" arguments given; expected 1 or 2";r=this.plainMC}var n,t,a,o,i,s,l,u=arguments[0],d=0,c=0,p=0,g=null,m=0,f=0,h=0,M=0,N=0,v=0;r.lostDigits&&this.checkdigits(u,r.digits);if(0==(n=this).ind&&r.form!=e.prototype.PLAIN)return u.plus(r);if(0==u.ind&&r.form!=e.prototype.PLAIN)return n.plus(r);(t=r.digits)>0&&(n.mant.length>t&&(n=this.clone(n).round(r)),u.mant.length>t&&(u=this.clone(u).round(r)));a=new BigDecimal,o=n.mant,i=n.mant.length,s=u.mant,l=u.mant.length;if(n.exp==u.exp)a.exp=n.exp;else if(n.exp>u.exp){if((d=i+n.exp-u.exp)>=l+t+1&&t>0)return a.mant=o,a.exp=n.exp,a.ind=n.ind,i<t&&(a.mant=this.extend(n.mant,t),a.exp=a.exp-(t-i)),a.finish(r,!1);a.exp=u.exp,d>t+1&&t>0&&(l-=c=d-t-1,a.exp=a.exp+c,d=t+1),d>i&&(i=d)}else{if((d=l+u.exp-n.exp)>=i+t+1&&t>0)return a.mant=s,a.exp=u.exp,a.ind=u.ind,l<t&&(a.mant=this.extend(u.mant,t),a.exp=a.exp-(t-l)),a.finish(r,!1);a.exp=n.exp,d>t+1&&t>0&&(i-=c=d-t-1,a.exp=a.exp+c,d=t+1),d>l&&(l=d)}n.ind==this.iszero?a.ind=this.ispos:a.ind=n.ind;if((n.ind==this.isneg?1:0)==(u.ind==this.isneg?1:0))p=1;else if(p=-1,u.ind==this.iszero);else if(i<l||n.ind==this.iszero)g=o,o=s,s=g,c=i,i=l,l=c,a.ind=-a.ind;else if(i>l);else{m=0,f=0,h=o.length-1,M=s.length-1;e:for(;;){if(m<=h)N=o[m];else{if(f>M){if(r.form!=e.prototype.PLAIN)return this.ZERO;break e}N=0}if(v=f<=M?s[f]:0,N!=v){N<v&&(g=o,o=s,s=g,c=i,i=l,l=c,a.ind=-a.ind);break e}m++,f++}}return a.mant=this.byteaddsub(o,i,s,l,p,!1),a.finish(r,!1)},BigDecimal.prototype.compareTo=function compareTo(){var e;if(2==arguments.length)e=arguments[1];else{if(1!=arguments.length)throw"compareTo(): "+arguments.length+" arguments given; expected 1 or 2";e=this.plainMC}var r,n=arguments[0],t=0,a=0;e.lostDigits&&this.checkdigits(n,e.digits);if(this.ind==n.ind&&this.exp==n.exp){if((t=this.mant.length)<n.mant.length)return-this.ind;if(t>n.mant.length)return this.ind;if(t<=e.digits||0==e.digits){var o=t;for(a=0;o>0;o--,a++){if(this.mant[a]<n.mant[a])return-this.ind;if(this.mant[a]>n.mant[a])return this.ind}return 0}}else{if(this.ind<n.ind)return-1;if(this.ind>n.ind)return 1}return(r=this.clone(n)).ind=-r.ind,this.add(r,e).ind},BigDecimal.prototype.divide=function divide(){var r,n=-1;if(2==arguments.length)r="number"==typeof arguments[1]?new e(0,e.prototype.PLAIN,!1,arguments[1]):arguments[1];else if(3==arguments.length){if((n=arguments[1])<0)throw"divide(): Negative scale: "+n;r=new e(0,e.prototype.PLAIN,!1,arguments[2])}else{if(1!=arguments.length)throw"divide(): "+arguments.length+" arguments given; expected between 1 and 3";r=this.plainMC}var t=arguments[0];return this.dodivide("D",t,r,n)},BigDecimal.prototype.divideInteger=function divideInteger(){var e;if(2==arguments.length)e=arguments[1];else{if(1!=arguments.length)throw"divideInteger(): "+arguments.length+" arguments given; expected 1 or 2";e=this.plainMC}var r=arguments[0];return this.dodivide("I",r,e,0)},BigDecimal.prototype.max=function max(){var e;if(2==arguments.length)e=arguments[1];else{if(1!=arguments.length)throw"max(): "+arguments.length+" arguments given; expected 1 or 2";e=this.plainMC}var r=arguments[0];return this.compareTo(r,e)>=0?this.plus(e):r.plus(e)},BigDecimal.prototype.min=function min(){var e;if(2==arguments.length)e=arguments[1];else{if(1!=arguments.length)throw"min(): "+arguments.length+" arguments given; expected 1 or 2";e=this.plainMC}var r=arguments[0];return this.compareTo(r,e)<=0?this.plus(e):r.plus(e)},BigDecimal.prototype.multiply=function multiply(){var e;if(2==arguments.length)e=arguments[1];else{if(1!=arguments.length)throw"multiply(): "+arguments.length+" arguments given; expected 1 or 2";e=this.plainMC}var r,n,t,a,o,i,s=arguments[0],l=null,u=null,d=0,c=0,p=0;e.lostDigits&&this.checkdigits(s,e.digits);r=this,n=0,(t=e.digits)>0?(r.mant.length>t&&(r=this.clone(r).round(e)),s.mant.length>t&&(s=this.clone(s).round(e))):(r.exp>0&&(n+=r.exp),s.exp>0&&(n+=s.exp));r.mant.length<s.mant.length?(l=r.mant,u=s.mant):(l=s.mant,u=r.mant);a=l.length+u.length-1,d=l[0]*u[0]>9?a+1:a;o=new BigDecimal,i=this.createArrayWithZeros(d);var g=l.length;c=0;for(;g>0;g--,c++)0!=(p=l[c])&&(i=this.byteaddsub(i,i.length,u,a,p,!0)),a--;o.ind=r.ind*s.ind,o.exp=r.exp+s.exp-n,o.mant=0==n?i:this.extend(i,i.length+n);return o.finish(e,!1)},BigDecimal.prototype.negate=function negate(){var e,r;if(1==arguments.length)e=arguments[0];else{if(0!=arguments.length)throw"negate(): "+arguments.length+" arguments given; expected 0 or 1";e=this.plainMC}e.lostDigits&&this.checkdigits(null,e.digits);return(r=this.clone(this)).ind=-r.ind,r.finish(e,!1)},BigDecimal.prototype.plus=function plus(){var r;if(1==arguments.length)r=arguments[0];else{if(0!=arguments.length)throw"plus(): "+arguments.length+" arguments given; expected 0 or 1";r=this.plainMC}r.lostDigits&&this.checkdigits(null,r.digits);if(r.form==e.prototype.PLAIN&&this.form==e.prototype.PLAIN){if(this.mant.length<=r.digits)return this;if(0==r.digits)return this}return this.clone(this).finish(r,!1)},BigDecimal.prototype.pow=function pow(){var r;if(2==arguments.length)r=arguments[1];else{if(1!=arguments.length)throw"pow(): "+arguments.length+" arguments given; expected 1 or 2";r=this.plainMC}var n,t,a,o,i,s,l=arguments[0],u=0,d=0,c=0;r.lostDigits&&this.checkdigits(l,r.digits);if(n=l.intcheck(this.MinArg,this.MaxArg),t=this,0==(a=r.digits)){if(l.ind==this.isneg)throw"pow(): Negative power: "+l.toString();u=0}else{if(l.mant.length+l.exp>a)throw"pow(): Too many digits: "+l.toString();t.mant.length>a&&(t=this.clone(t).round(r)),d=l.mant.length+l.exp,u=a+d+1}if(o=new e(u,r.form,!1,r.roundingMode),i=this.ONE,0==n)return i;n<0&&(n=-n);s=!1,c=1;e:for(;(n<<=1)<0&&(s=!0,i=i.multiply(t,o)),31!=c;c++)s&&(i=i.multiply(i,o));l.ind<0&&(i=this.ONE.divide(i,o));return i.finish(r,!0)},BigDecimal.prototype.remainder=function remainder(){var e;if(2==arguments.length)e=arguments[1];else{if(1!=arguments.length)throw"remainder(): "+arguments.length+" arguments given; expected 1 or 2";e=this.plainMC}var r=arguments[0];return this.dodivide("R",r,e,-1)},BigDecimal.prototype.subtract=function subtract(){var e;if(2==arguments.length)e=arguments[1];else{if(1!=arguments.length)throw"subtract(): "+arguments.length+" arguments given; expected 1 or 2";e=this.plainMC}var r,n=arguments[0];e.lostDigits&&this.checkdigits(n,e.digits);return(r=this.clone(n)).ind=-r.ind,this.add(r,e)},BigDecimal.prototype.equals=function equals(e){var r,n=0,t=null,a=null;if(null==e)return!1;if(!(e instanceof BigDecimal))return!1;if(r=e,this.ind!=r.ind)return!1;if(this.mant.length==r.mant.length&&this.exp==r.exp&&this.form==r.form){var o=this.mant.length;for(n=0;o>0;o--,n++)if(this.mant[n]!=r.mant[n])return!1}else{if(t=this.layout(),a=r.layout(),t.length!=a.length)return!1;var i=t.length;for(n=0;i>0;i--,n++)if(t[n]!=a[n])return!1}return!0},BigDecimal.prototype.format=function format(){var r,n,t,a;if(6==arguments.length)r=arguments[2],n=arguments[3],t=arguments[4],a=arguments[5];else{if(2!=arguments.length)throw"format(): "+arguments.length+" arguments given; expected 2 or 6";r=-1,n=-1,t=e.prototype.SCIENTIFIC,a=this.ROUND_HALF_UP}var o,i,s=arguments[0],l=arguments[1],u=0,d=0,c=0,p=null,g=0,m=0,f=0,h=0,M=null,N=0,v=0;(s<-1||0==s)&&this.badarg("format",1,s);l<-1&&this.badarg("format",2,l);(r<-1||0==r)&&this.badarg("format",3,r);n<-1&&this.badarg("format",4,n);t==e.prototype.SCIENTIFIC||t==e.prototype.ENGINEERING||(-1==t?t=e.prototype.SCIENTIFIC:this.badarg("format",5,t));if(a!=this.ROUND_HALF_UP)try{-1==a?a=this.ROUND_HALF_UP:new e(9,e.prototype.SCIENTIFIC,!1,a)}catch(e){this.badarg("format",6,a)}o=this.clone(this);-1==n||o.ind==this.iszero?o.form=e.prototype.PLAIN:(u=o.exp+o.mant.length,o.form=u>n||u<-5?t:e.prototype.PLAIN);if(l>=0)e:for(;o.form==e.prototype.PLAIN?d=-o.exp:o.form==e.prototype.SCIENTIFIC?d=o.mant.length-1:((c=(o.exp+o.mant.length-1)%3)<0&&(c=3+c),c++,d=c>=o.mant.length?0:o.mant.length-c),d!=l;){if(d<l){if(p=this.extend(o.mant,o.mant.length+l-d),o.mant=p,o.exp=o.exp-(l-d),o.exp<this.MinExp)throw"format(): Exponent Overflow: "+o.exp;break e}if((g=d-l)>o.mant.length)o.mant=this.ZERO.mant,o.ind=this.iszero,o.exp=0;else if(m=o.mant.length-g,f=o.exp,o.round(m,a),o.exp-f==g)break e}if(i=o.layout(),s>0){var y=i.length;h=0;e:for(;y>0&&"."!=i[h]&&"E"!=i[h];y--,h++);if(h>s&&this.badarg("format",1,s),h<s){M=new Array(i.length+s-h);var b=s-h;for(N=0;b>0;b--,N++)M[N]=" ";this.arraycopy(i,0,M,N,i.length),i=M}}if(r>0){var O=i.length-1;h=i.length-1;e:for(;O>0&&"E"!=i[h];O--,h--);if(0==h){M=new Array(i.length+r+2),this.arraycopy(i,0,M,0,i.length);var E=r+2;for(N=i.length;E>0;E--,N++)M[N]=" ";i=M}else if((v=i.length-h-2)>r&&this.badarg("format",3,r),v<r){M=new Array(i.length+r-v),this.arraycopy(i,0,M,0,h+2);var x=r-v;for(N=h+2;x>0;x--,N++)M[N]="0";this.arraycopy(i,h+2,M,N,v),i=M}}return i.join("")},BigDecimal.prototype.intValueExact=function intValueExact(){var e,r,n=0,t=0;if(this.ind==this.iszero)return 0;if(e=this.mant.length-1,this.exp<0){if(e+=this.exp,!this.allzero(this.mant,e+1))throw"intValueExact(): Decimal part non-zero: "+this.toString();if(e<0)return 0;n=0}else{if(this.exp+e>9)throw"intValueExact(): Conversion overflow: "+this.toString();n=this.exp}r=0;var a=e+n;t=0;for(;t<=a;t++)r*=10,t<=e&&(r+=this.mant[t]);if(e+n==9&&div(r,1e9)!=this.mant[0]){if(-2147483648==r&&this.ind==this.isneg&&2==this.mant[0])return r;throw"intValueExact(): Conversion overflow: "+this.toString()}if(this.ind==this.ispos)return r;return-r},BigDecimal.prototype.movePointLeft=function movePointLeft(e){var r;return(r=this.clone(this)).exp=r.exp-e,r.finish(this.plainMC,!1)},BigDecimal.prototype.movePointRight=function movePointRight(e){var r;return(r=this.clone(this)).exp=r.exp+e,r.finish(this.plainMC,!1)},BigDecimal.prototype.scale=function scale(){if(this.exp>=0)return 0;return-this.exp},BigDecimal.prototype.setScale=function setScale(){var r;if(2==arguments.length)r=arguments[1];else{if(1!=arguments.length)throw"setScale(): "+arguments.length+" given; expected 1 or 2";r=this.ROUND_UNNECESSARY}var n,t,a=+arguments[0],o=0,i=0;if((n=this.scale())==a&&this.form==e.prototype.PLAIN)return this;if(t=this.clone(this),n<=a)o=0==n?t.exp+a:a-n,t.mant=this.extend(t.mant,t.mant.length+o),t.exp=-a;else{if(a<0)throw"setScale(): Negative scale: "+a;i=t.mant.length-(n-a),(t=t.round(i,r)).exp!=-a&&(t.mant=this.extend(t.mant,t.mant.length+1),t.exp=t.exp-1)}return t.form=e.prototype.PLAIN,t},BigDecimal.prototype.signum=function signum(){return this.ind},BigDecimal.prototype.toString=function toString(){return this.layout().join("")},BigDecimal.prototype.layout=function layout(){var r,n,t,a=0,o=null,i=0,s=0,l=0,u=null,d=0;r=new Array(this.mant.length);var c=this.mant.length;a=0;for(;c>0;c--,a++)r[a]=this.mant[a]+"";if(this.form!=e.prototype.PLAIN){if(o="",this.ind==this.isneg&&(o+="-"),i=this.exp+r.length-1,this.form==e.prototype.SCIENTIFIC)o+=r[0],r.length>1&&(o+="."),o+=r.slice(1).join("");else if((s=i%3)<0&&(s=3+s),i-=s,++s>=r.length){o+=r.join("");for(var p=s-r.length;p>0;p--)o+="0"}else o+=r.slice(0,s).join(""),o+=".",o+=r.slice(s).join("");return 0!=i&&(i<0?(l="-",i=-i):l="+",o+="E",o+=l,o+=i),o.split("")}if(0==this.exp)return this.ind>=0?r:((u=new Array(r.length+1))[0]="-",this.arraycopy(r,0,u,1,r.length),u);if(n=this.ind==this.isneg?1:0,(t=this.exp+r.length)<1){d=n+2-this.exp,u=new Array(d),0!=n&&(u[0]="-"),u[n]="0",u[n+1]=".";var g=-t;for(a=n+2;g>0;g--,a++)u[a]="0";return this.arraycopy(r,0,u,n+2-t,r.length),u}if(t>r.length){d=n+t,u=new Array(d),0!=n&&(u[0]="-"),this.arraycopy(r,0,u,n,r.length);var m=t-r.length;for(a=n+r.length;m>0;m--,a++)u[a]="0";return u}d=n+1+r.length,u=new Array(d),0!=n&&(u[0]="-");return this.arraycopy(r,0,u,n,t),u[n+t]=".",this.arraycopy(r,t,u,n+t+1,r.length-t),u},BigDecimal.prototype.intcheck=function intcheck(e,r){var n;if((n=this.intValueExact())<e||n>r)throw"intcheck(): Conversion overflow: "+n;return n},BigDecimal.prototype.dodivide=function dodivide(r,n,t,a){var o,i,s,l,u,d,c,p,g,m,f,h=0,M=0,N=0,v=0,y=0,b=0,O=0,E=0,x=null,C=0,A=0,S=null;t.lostDigits&&this.checkdigits(n,t.digits);if(o=this,0==n.ind)throw"dodivide(): Divide by 0";if(0==o.ind)return t.form!=e.prototype.PLAIN?this.ZERO:-1==a?o:o.setScale(a);(i=t.digits)>0?(o.mant.length>i&&(o=this.clone(o).round(t)),n.mant.length>i&&(n=this.clone(n).round(t))):(-1==a&&(a=o.scale()),i=o.mant.length,a!=-o.exp&&(i=i+a+o.exp),(i=i-(n.mant.length-1)-n.exp)<o.mant.length&&(i=o.mant.length),i<n.mant.length&&(i=n.mant.length));if((s=o.exp-n.exp+o.mant.length-n.mant.length)<0&&"D"!=r)return"I"==r?this.ZERO:this.clone(o).finish(t,!1);(l=new BigDecimal).ind=o.ind*n.ind,l.exp=s,l.mant=this.createArrayWithZeros(i+1),u=i+i+1,d=this.extend(o.mant,u),c=u,p=n.mant,g=u,m=10*p[0]+1,p.length>1&&(m+=p[1]);f=0;e:for(;;){h=0;r:for(;!(c<g);){if(c==g){n:do{var R=c;for(M=0;R>0;R--,M++){if(N=M<p.length?p[M]:0,d[M]<N)break r;if(d[M]>N)break n}h++,l.mant[f]=h,f++,d[0]=0;break e}while(0);v=d[0]}else v=10*d[0],c>1&&(v+=d[1]);if(0==(y=div(10*v,m))&&(y=1),h+=y,0==(d=this.byteaddsub(d,c,p,g,-y,!0))[0]){var I=c-2;b=0;n:for(;b<=I&&0==d[b];b++)c--;0!=b&&this.arraycopy(d,b,d,0,c)}}if(0!=f||0!=h){if(l.mant[f]=h,++f==i+1)break e;if(0==d[0])break e}if(a>=0&&-l.exp>a)break e;if("D"!=r&&l.exp<=0)break e;l.exp=l.exp-1,g--}0==f&&(f=1);if("I"==r||"R"==r){if(f+l.exp>i)throw"dodivide(): Integer overflow";if("R"==r){if(0==l.mant[0])return this.clone(o).finish(t,!1);if(0==d[0])return this.ZERO;l.ind=o.ind,O=i+i+1-o.mant.length,l.exp=l.exp-O+o.exp,M=(E=c)-1;e:for(;M>=1&&(l.exp<o.exp&&l.exp<n.exp)&&0==d[M];M--)E--,l.exp=l.exp+1;return E<d.length&&(x=new Array(E),this.arraycopy(d,0,x,0,E),d=x),l.mant=d,l.finish(t,!1)}}else 0!=d[0]&&(C=l.mant[f-1])%5==0&&(l.mant[f-1]=C+1);if(a>=0)return f!=l.mant.length&&(l.exp=l.exp-(l.mant.length-f)),A=l.mant.length-(-l.exp-a),l.round(A,t.roundingMode),l.exp!=-a&&(l.mant=this.extend(l.mant,l.mant.length+1),l.exp=l.exp-1),l.finish(t,!0);if(f==l.mant.length)l.round(t),f=i;else{if(0==l.mant[0])return this.ZERO;S=new Array(f),this.arraycopy(l.mant,0,S,0,f),l.mant=S}return l.finish(t,!0)},BigDecimal.prototype.bad=function bad(e,r){throw e+"Not a number: "+r},BigDecimal.prototype.badarg=function badarg(e,r,n){throw"Bad argument "+r+" to "+e+": "+n},BigDecimal.prototype.extend=function extend(e,r){var n;if(e.length==r)return e;return n=createArrayWithZeros(r),this.arraycopy(e,0,n,0,e.length),n},BigDecimal.prototype.byteaddsub=function byteaddsub(e,r,n,t,a,o){var i,s,l,u,d,c,p,g,m,f=0,h=0,M=0;i=e.length,s=n.length,(d=u=t-1)<(l=r-1)&&(d=l);c=null,o&&d+1==i&&(c=e);null==c&&(c=this.createArrayWithZeros(d+1));p=!1,(1==a||-1==a)&&(p=!0);g=0,f=d;for(;f>=0;f--)l>=0&&(l<i&&(g+=e[l]),l--),u>=0&&(u<s&&(p?a>0?g+=n[u]:g-=n[u]:g+=n[u]*a),u--),g<10&&g>=0?(c[f]=g,g=0):(h=g+90,c[f]=this.bytedig[h],g=this.bytecar[h]);if(0==g)return c;m=null,o&&d+2==e.length&&(m=e);null==m&&(m=new Array(d+2));m[0]=g;var N=d+1;M=0;for(;N>0;N--,M++)m[M+1]=c[M];return m},BigDecimal.prototype.diginit=diginit,BigDecimal.prototype.clone=function clone(e){var r;return(r=new BigDecimal).ind=e.ind,r.exp=e.exp,r.form=e.form,r.mant=e.mant,r},BigDecimal.prototype.checkdigits=function checkdigits(e,r){if(0==r)return;if(this.mant.length>r&&!this.allzero(this.mant,r))throw"Too many digits: "+this.toString();if(null==e)return;if(e.mant.length>r&&!this.allzero(e.mant,r))throw"Too many digits: "+e.toString();return},BigDecimal.prototype.round=function round(){var e,r,n,t,a;if(2==arguments.length)e=arguments[0],r=arguments[1];else{if(1!=arguments.length)throw"round(): "+arguments.length+" arguments given; expected 1 or 2";var o=arguments[0];e=o.digits,r=o.roundingMode}var i,s=!1,l=0,u=null;if((n=this.mant.length-e)<=0)return this;this.exp=this.exp+n,t=this.ind,a=this.mant,e>0?(this.mant=new Array(e),this.arraycopy(a,0,this.mant,0,e),s=!0,l=a[e]):(this.mant=this.ZERO.mant,this.ind=this.iszero,s=!1,l=0==e?a[0]:0);i=0;if(r==this.ROUND_HALF_UP)l>=5&&(i=t);else if(r==this.ROUND_UNNECESSARY){if(!this.allzero(a,e))throw"round(): Rounding necessary"}else if(r==this.ROUND_HALF_DOWN)l>5?i=t:5==l&&(this.allzero(a,e+1)||(i=t));else if(r==this.ROUND_HALF_EVEN)l>5?i=t:5==l&&(this.allzero(a,e+1)?this.mant[this.mant.length-1]%2==1&&(i=t):i=t);else if(r==this.ROUND_DOWN);else if(r==this.ROUND_UP)this.allzero(a,e)||(i=t);else if(r==this.ROUND_CEILING)t>0&&(this.allzero(a,e)||(i=t));else{if(r!=this.ROUND_FLOOR)throw"round(): Bad round value: "+r;t<0&&(this.allzero(a,e)||(i=t))}0!=i&&(this.ind==this.iszero?(this.mant=this.ONE.mant,this.ind=i):(this.ind==this.isneg&&(i=-i),(u=this.byteaddsub(this.mant,this.mant.length,this.ONE.mant,1,i,s)).length>this.mant.length?(this.exp++,this.arraycopy(u,0,this.mant,0,this.mant.length)):this.mant=u));if(this.exp>this.MaxExp)throw"round(): Exponent Overflow: "+this.exp;return this},BigDecimal.prototype.allzero=function allzero(e,r){var n=0;r<0&&(r=0);var t=e.length-1;n=r;for(;n<=t;n++)if(0!=e[n])return!1;return!0},BigDecimal.prototype.finish=function finish(r,n){var t=0,a=0,o=null,i=0,s=0;0!=r.digits&&this.mant.length>r.digits&&this.round(r);if(n&&r.form!=e.prototype.PLAIN){t=this.mant.length,a=t-1;e:for(;a>=1&&0==this.mant[a];a--)t--,this.exp++;t<this.mant.length&&(o=new Array(t),this.arraycopy(this.mant,0,o,0,t),this.mant=o)}this.form=e.prototype.PLAIN;var l=this.mant.length;a=0;for(;l>0;l--,a++)if(0!=this.mant[a]){if(a>0&&(o=new Array(this.mant.length-a),this.arraycopy(this.mant,a,o,0,this.mant.length-a),this.mant=o),(i=this.exp+this.mant.length)>0){if(i>r.digits&&0!=r.digits&&(this.form=r.form),i-1<=this.MaxExp)return this}else i<-5&&(this.form=r.form);if(--i<this.MinExp||i>this.MaxExp)e:do{if(this.form==e.prototype.ENGINEERING&&((s=i%3)<0&&(s=3+s),(i-=s)>=this.MinExp&&i<=this.MaxExp))break e;throw"finish(): Exponent Overflow: "+i}while(0);return this}if(this.ind=this.iszero,r.form!=e.prototype.PLAIN)this.exp=0;else if(this.exp>0)this.exp=0;else if(this.exp<this.MinExp)throw"finish(): Exponent Overflow: "+this.exp;return this.mant=this.ZERO.mant,this},BigDecimal.prototype.isGreaterThan=function isGreaterThan(e){return this.compareTo(e)>0},BigDecimal.prototype.isLessThan=function isLessThan(e){return this.compareTo(e)<0},BigDecimal.prototype.isGreaterThanOrEqualTo=function isGreaterThanOrEqualTo(e){return this.compareTo(e)>=0},BigDecimal.prototype.isLessThanOrEqualTo=function isLessThanOrEqualTo(e){return this.compareTo(e)<=0},BigDecimal.prototype.isPositive=function isPositive(){return this.compareTo(BigDecimal.prototype.ZERO)>0},BigDecimal.prototype.isNegative=function isNegative(){return this.compareTo(BigDecimal.prototype.ZERO)<0},BigDecimal.prototype.isZero=function isZero(){return this.equals(BigDecimal.prototype.ZERO)},BigDecimal.ROUND_CEILING=BigDecimal.prototype.ROUND_CEILING=e.prototype.ROUND_CEILING,BigDecimal.ROUND_DOWN=BigDecimal.prototype.ROUND_DOWN=e.prototype.ROUND_DOWN,BigDecimal.ROUND_FLOOR=BigDecimal.prototype.ROUND_FLOOR=e.prototype.ROUND_FLOOR,BigDecimal.ROUND_HALF_DOWN=BigDecimal.prototype.ROUND_HALF_DOWN=e.prototype.ROUND_HALF_DOWN,BigDecimal.ROUND_HALF_EVEN=BigDecimal.prototype.ROUND_HALF_EVEN=e.prototype.ROUND_HALF_EVEN,BigDecimal.ROUND_HALF_UP=BigDecimal.prototype.ROUND_HALF_UP=e.prototype.ROUND_HALF_UP,BigDecimal.ROUND_UNNECESSARY=BigDecimal.prototype.ROUND_UNNECESSARY=e.prototype.ROUND_UNNECESSARY,BigDecimal.ROUND_UP=BigDecimal.prototype.ROUND_UP=e.prototype.ROUND_UP,BigDecimal.prototype.ispos=1,BigDecimal.prototype.iszero=0,BigDecimal.prototype.isneg=-1,BigDecimal.prototype.MinExp=-999999999,BigDecimal.prototype.MaxExp=999999999,BigDecimal.prototype.MinArg=-999999999,BigDecimal.prototype.MaxArg=999999999,BigDecimal.prototype.plainMC=new e(0,e.prototype.PLAIN),BigDecimal.prototype.bytecar=new Array(190),BigDecimal.prototype.bytedig=diginit(),BigDecimal.ZERO=BigDecimal.prototype.ZERO=new BigDecimal("0"),BigDecimal.ONE=BigDecimal.prototype.ONE=new BigDecimal("1"),BigDecimal.TEN=BigDecimal.prototype.TEN=new BigDecimal("10"),BigDecimal}(MathContext);!function(e){var r=Assert.messages;Assert.reserveCodeRange(2e3,2999,"mathmodel"),r[2e3]="Internal error. %1",r[2001]="Factoring of multi-variate polynomials with all terms of degree greater than one is not supported",r[2002]="Expression not supported.",r[2003]="Factoring non-polynomials is not supported.",r[2004]="Compound units not supported with tolerances.",r[2005]="Non-numeric expressions cannot be compared with equivValue.",r[2006]="More that two equals symbols in equation.",r[2007]="Tolerances are not supported in lists.",r[2008]="deprecated",r[2009]="Undefined value in 'equivValue'",r[2010]="Invalid option name %1.",r[2011]="Invalid option value %2 for option %1.",r[2012]="Expressions with comparison or equality operators cannot be compared with equivValue.",r[2013]="Incompatible values with matrix arithmetic",r[2014]="Incomplete expression found.",r[2015]="Invalid format name '%1'.",r[2016]="Exponents should be wrapped in braces.",r[2017]="Units with different base units not allowed in a single expression. Found: %1";var n=new Visitor(e),t=new BigDecimal("0"),a=new BigDecimal("1"),o=new BigDecimal("2"),i=new BigDecimal("3"),s=new BigDecimal("4"),l=new BigDecimal("5"),u=new BigDecimal("-1"),d=numberNode("0"),c=numberNode("1"),p=numberNode("2"),g=numberNode("3"),m=numberNode("-1"),f=e.intern(m),h=numberNode("Infinity"),M=numberNode("-Infinity"),N=(binaryNode(Model.POW,[p,m]),binaryNode(Model.POW,[g,m]),variableNode("i")),v=variableNode("e"),y=variableNode("\\pi");function hashCode(e){var r,n,t=0;if(0==e.length)return t;for(r=0,n=e.length;r<n;r++)t=(t<<5)-t+e.charCodeAt(r),t|=0;return t}function undefinedNode(e){return isUndefined(e)||((e=numberNode(JSON.stringify(e))).isUndefined=!0),e}function isUndefined(e){return e.op===Model.NUM?!!e.isUndefined:!!e.args&&some(e.args,(function(e){return isUndefined(e)}))}function isAdditive(e){return e.op===Model.ADD||e.op===Model.SUB||e.op===Model.PM||e.op===Model.BACKSLASH}function isMultiplicative(e){return e.op===Model.MUL||e.op===Model.TIMES||e.op===Model.COEFF||e.op===Model.DIV}function isImaginary(r){return!!r.op&&e.intern(N)===e.intern(r)}function isAdditive(e){return e.op===Model.ADD||e.op===Model.SUB||e.op===Model.PM||e.op===Model.BACKSLASH}function isMultiplicative(e){return e.op===Model.MUL||e.op===Model.TIMES||e.op===Model.COEFF||e.op===Model.DIV}function newNode(e,r){return{op:e,args:r}}function binaryNode(e,r,n){if(assert(r.length>0,"2000: Invalid node shape."),r.length<2)return r[0];var t=[];return forEach(r,(function(r){n&&r.op===e?t=t.concat(r.args):t.push(r)})),newNode(e,t)}function abs(e){if(null===e)return null;if(e instanceof BigDecimal){if(null===e)return null;e=toNumber(e)}else if(e.op){if(null===(e=mathValue(e,!0)))return null}else if(isNaN(e))return null;return toDecimal(Math.abs(e))}function isNeg(e){var r;if(null===e)return!1;if("number"==typeof e)return e<0;if(e.op){if((e.op===Model.POW||isAdditive(e))&&(e=e.args[0]),!(r=mathValue(constantPart(e),!0)))return!!(e.op===Model.MUL&&isMinusOne(e.args[0])||e.op===Model.NUM&&"-Infinity"===e.args[0])}else{if(!(e instanceof BigDecimal))return!1;r=e}return r.compareTo(t)<0}function numberNode(e,r,n,t){var a,o;if(assert(!(e instanceof Array),"2000: Expecting a scalar"),r){var i=C("decimalPlaces");if(isNeg(a=toDecimal(e))&&!isMinusOne(a)&&(o=u.setScale(i,BigDecimal.ROUND_HALF_UP),a=u.multiply(a)),null!==a&&(!n||a.scale()>i))if(i<0){var s=-1*i;a=a.round(new MathContext(s))}else a=a.setScale(i,BigDecimal.ROUND_HALF_UP)}else isNeg(a=toDecimal(e))&&!isMinusOne(a)&&(o=u,a=u.multiply(a));return o?multiplyNode([newNode(Model.NUM,[String(o)]),newNode(Model.NUM,[String(a)])]):newNode(Model.NUM,a?[String(a)]:[String(e)])}function multiplyNode(e,r){return 0===e.length&&(e=[c]),binaryNode(Model.MUL,e,r)}function addNode(e,r){return 0===e.length&&(e=[d]),binaryNode(Model.ADD,e,r)}function fractionNode(e,r){return multiplyNode([e,binaryNode(Model.POW,[r,m])],!0)}function unaryNode(e,r){return e===Model.ADD?r[0]:newNode(e,r)}function variableNode(e){return assert("string"==typeof e,"2000: Expecting a string"),newNode(Model.VAR,[e])}function negate(e,r){if("number"==typeof e)return-e;if(e.op===Model.MUL||e.op===Model.COEFF||e.op===Model.TIMES){var n=e.args.slice(0);if(isMinusOne(e.args[0]))return n.shift(),binaryNode(e.op,n,!0);var t=!1;e:for(var a=0;a<n.length;a++){if(isMinusOne(n[a])){0===a?n.shift():a===n.length-1?n.pop():n=n.slice(0,a).concat(n.slice(a+1)),a--,t=!0;break e}if(isNeg(n[a])){n[a]=negate(n[a]),t=!0;break e}}return t||(n=[negate(n.shift())].concat(n)),binaryNode(e.op,n,!0)}if(e.op===Model.ADD&&!r){n=[];return forEach(e.args,(function(e){n.push(negate(e))})),binaryNode(e.op,n,!0)}return e.op===Model.NUM?"1"===e.args[0]?m:"-1"===e.args[0]?c:"Infinity"===e.args[0]?M:"-Infinity"===e.args[0]?h:"-"===e.args[0].charAt(0)?unaryNode(Model.SUB,[e]):numberNode("-"+e.args[0]):e.op===Model.POW&&isMinusOne(e.args[1])?isZero(e.args[0])?M:binaryNode(Model.POW,[negate(e.args[0]),m]):e.op===Model.INT&&3===e.args.length?newNode(Model.INT,[e.args[1],e.args[0],e.args[2]]):multiplyNode([m,e],!0)}function isPositiveInfinity(e){return e===Number.POSITIVE_INFINITY||e.op===Model.NUM&&"Infinity"===e.args[0]}function isNegativeInfinity(e){return e===Number.NEGATIVE_INFINITY||e.op===Model.NUM&&"-Infinity"===e.args[0]}function isInfinity(e){return e===Number.POSITIVE_INFINITY||e===Number.NEGATIVE_INFINITY||e.op===Model.NUM&&("Infinity"===e.args[0]||"-Infinity"===e.args[0])}function isE(e){return null!==e&&(e instanceof BigDecimal?!bigE.compareTo(e):"number"==typeof e?e===Math.E:e.op===Model.NUM&&+e.args[0]===Math.E||e.op===Model.VAR&&"e"===e.args[0])}function isZero(e){return null!==e&&(e instanceof BigDecimal?!t.compareTo(e):"number"==typeof e?0===e:e.op===Model.NUM&&0==+e.args[0])}function isOne(e){var r;return null!==e&&(e instanceof BigDecimal?!a.compareTo(e):"number"==typeof e?1===e:e.op===Model.NUM?!!(r=mathValue(e))&&!a.compareTo(r):void 0)}function isMinusOne(r){return null!=r&&"string"!=typeof r&&("number"==typeof r?-1===r:r instanceof BigDecimal?!u.compareTo(r):r.op?e.intern(r)===f||!!mathValue(r,!0)&&!u.compareTo(mathValue(r,!0)):void assert(!1,"2000: Unable to compare with zero."))}function isInteger(e){var r;return!!e&&(!(e.op!==Model.NUM||null===(r=mathValue(e,!0))||!isInteger(r))||e instanceof BigDecimal&&0===e.remainder(a).compareTo(t))}function isDecimal(e){var r;return!!e&&(e.op===Model.NUM&&null!==(r=mathValue(e,!0))&&!isInteger(r)||e instanceof BigDecimal&&!isInteger(e))}function isOdd(e){var r=mathValue(e,!0);return isInteger(r)&&!function isEven(e){var r;return!!e&&(!(e.op!==Model.NUM||null===(r=mathValue(e,!0))||!isEven(r))||e instanceof BigDecimal&&0===e.remainder(o).compareTo(t))}(r)}function isOddFraction(e){var r=factors(e,{}),n=[c],t=[c];forEach(r,(function(e){e.op===Model.POW&&isNeg(mathValue(e.args[1],!0))?t.push(e.args[1]):n.push(e)}));var a=multiplyNode(n),o=multiplyNode(t);return isOdd(a)&&isOdd(o)}function isPolynomial(e){var r=terms(expand(JSON.parse(JSON.stringify(e)))),n=!1,t=[];return forEach(r,(function(e){var r=degree(e,!0);if(isImaginary(e)||r===Number.POSITIVE_INFINITY||r<0||r!==Math.floor(r)||r>10||null===mathValue(constantPart(e),!0))n=!0;else{if(void 0===t[r])for(var a=r;a>=0&&void 0===t[a];)t[a]=0,a--;t[r]=t[r]+toNumber(mathValue(constantPart(e),!0))}})),n||variables(e).length>1?null:t}function toNumber(e){var r;if(null===e)return Number.NaN;if("number"==typeof e)return e;if(e instanceof BigDecimal)r=e.toString();else{if(e.op!==Model.NUM)return Number.NaN;r=e.args[0]}return parseFloat(r)}function toDecimal(e){var r;return null===e||isNaN(e)||isInfinity(e)||isImaginary(e)||"string"==typeof e&&indexOf(e,"Infinity")>=0?null:e instanceof BigDecimal?e:(r=e.op===Model.NUM?e.args[0]:e.toString(),new BigDecimal(r))}function toRadians(e){assert(e.op,"2000: Invalid node");var r=[];return e.op===Model.MUL&&(forEach(e.args,(function(e){if(e.op===Model.VAR)switch(e.args[0]){case"\\degree":r.push(numberNode(new BigDecimal(""+Math.PI).divide(new BigDecimal("180"))));break;case"\\radians":break;default:r.push(toRadians(e))}else r.push(e)})),e=multiplyNode(r)),e}function factorial(e){for(var r=2,n=a;r<=e;r++)Assert.checkTimeout(),n=n.multiply(new BigDecimal(r.toString()));return n}var b={},O=[];function sqrtNode(e,r){return binaryNode(Model.POW,[e,binaryNode(Model.POW,[numberNode(r),m])])}function flattenNestedNodes(e,r){var n=[];if(e.op===Model.NUM||e.op===Model.VAR)return e;forEach(e.args,(function(t,a){r&&(t=simplify(t)),t=normalize(t),e.op!==t.op||t.op===Model.POW&&0===a?n.push(t):n=n.concat(t.args)}));var t=e.isMixedNumber;return(e=binaryNode(e.op,n)).isMixedNumber=t,e}var E=numberNode("298230487121230434902874");function Visitor(e){function visit(e,r){switch(assert(e.op&&e.args,"2000: Visitor.visit() op="+e.op+" args = "+e.args),e.op){case Model.NUM:e=r.numeric(e);break;case Model.ADD:case Model.SUB:case Model.PM:case Model.BACKSLASH:e=1===e.args.length?r.unary(e):r.additive(e);break;case Model.MUL:case Model.TIMES:case Model.COEFF:case Model.DIV:case Model.FRAC:e=r.multiplicative(e);break;case Model.POW:case Model.LOG:e=r.exponential(e);break;case Model.VAR:e=r.variable(e);break;case Model.SQRT:case Model.SIN:case Model.COS:case Model.TAN:case Model.ARCSIN:case Model.ARCCOS:case Model.ARCTAN:case Model.ARCSEC:case Model.ARCCSC:case Model.ARCCOT:case Model.SEC:case Model.CSC:case Model.COT:case Model.SINH:case Model.COSH:case Model.TANH:case Model.ARCSINH:case Model.ARCCOSH:case Model.ARCTANH:case Model.ARCSECH:case Model.ARCCSCH:case Model.ARCCOTH:case Model.SECH:case Model.CSCH:case Model.COTH:case Model.PERCENT:case Model.M:case Model.ABS:case Model.FACT:case Model.FORALL:case Model.EXISTS:case Model.IN:case Model.SUM:case Model.LIM:case Model.EXP:case Model.TO:case Model.DERIV:case Model.INT:case Model.PROD:case Model.ION:case Model.POW:case Model.SUBSCRIPT:case Model.OVERLINE:case Model.OVERSET:case Model.UNDERSET:case Model.NONE:case Model.DEGREE:case Model.DOT:case Model.EVALAT:case Model.PAREN:e=r.unary(e);break;case Model.COMMA:case Model.MATRIX:case Model.VEC:case Model.ROW:case Model.COL:case Model.INTERVAL:case Model.LIST:e=r.comma(e);break;case Model.EQL:case Model.LT:case Model.LE:case Model.GT:case Model.GE:case Model.NE:case Model.NGTR:case Model.NLESS:case Model.APPROX:case Model.COLON:case Model.RIGHTARROW:case Model.RIGHTLEFTHARPOONS:e=r.equals(e);break;case Model.FORMAT:e=r.format(e);break;default:"normalizeLiteral"!==r.name&&"sort"!==r.name&&assert(!1,"2000: Should not get here. Unhandled node operator "+e.op)}return e}function degree(e,r){return assert(e&&e.args,"2000: Invalid node"),visit(e,{name:"degree",exponential:function(e){var n,t=e.args;if(e.op===Model.POW){var a=mathValue(t[1],!0);n=a?r?degree(t[0],r)*toNumber(a):degree(t[0],r)*Math.abs(toNumber(a)):isNeg(t[1])?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY}else e.op===Model.LOG&&(n=Number.POSITIVE_INFINITY);return n},multiplicative:function(e){var n=e.args,t=0;return forEach(n,(function(e){t+=degree(e,r)})),t},additive:function(e){var n,t=e.args,a=0;return forEach(t,(function(e){(n=degree(e,r))>a&&(a=n)})),a},numeric:function(e){return 0},unary:function(e){var n=e.args,t=degree(n[0],r);switch(e.op){case Model.ADD:case Model.SUB:case Model.PM:case Model.PERCENT:case Model.M:case Model.ABS:return t;case Model.SIN:case Model.COS:case Model.TAN:case Model.ARCSIN:case Model.ARCCOS:case Model.ARCTAN:case Model.ARCSEC:case Model.ARCCSC:case Model.ARCCOT:case Model.SEC:case Model.CSC:case Model.COT:case Model.SINH:case Model.COSH:case Model.TANH:case Model.ARCSINH:case Model.ARCCOSH:case Model.ARCTANH:case Model.ARCSECH:case Model.ARCCSCH:case Model.ARCCOTH:case Model.SECH:case Model.CSCH:case Model.COTH:return 1;case Model.SQRT:return assert(1===n.length,message(2003)),t/2;case Model.FACT:return 0!==t?h:0;case Model.INT:return Number.POSITIVE_INFINITY;case Model.DEGREE:case Model.NONE:default:return 0}},variable:function(e){return name&&e.args[0]!==name?0:1},comma:function(e){return[]},equals:function(e){var n,t=e.args,a=0;return forEach(t,(function(e){(n=degree(e,r))>a&&(a=n)})),a}})}function constantPart(e){var r=Model.env;return assert(e&&e.args,"2000: Internal error."),visit(e,{name:"constantPart",exponential:function(e){return null===variablePart(e)?e:c},multiplicative:function(e){var n=[];return forEach(e.args,(function(e){var t=constantPart(e);if(!isOne(t)){var a=mathValue(t,r,!0);isOne(a)||(isZero(a)?n.push(d):n.push(e))}})),0===n.length?c:1===n.length?n[0]:multiplyNode(n)},additive:function(e){return some(e.args,(function(e){return null!==variablePart(e)}))?c:e},unary:function(e){return some(e.args,(function(e){return null!==variablePart(e)}))?c:e},numeric:function(e){return e},variable:function(e){return null===variablePart(e)?e:c},comma:function(e){return null===variablePart(e)?e:c},equals:function(e){return null===variablePart(e)?e:c}})}function variables(e){return assert(e&&e.args,"2000: Internal error."),visit(e,{name:"variables",exponential:function(e){var r=e.args,n=[];return forEach(r,(function(e){var r=variables(e);forEach(r,(function(e){indexOf(n,e)<0&&n.push(e)}))})),n},multiplicative:function(e){var r=e.args,n=[];return forEach(r,(function(e){var r=variables(e);forEach(r,(function(e){indexOf(n,e)<0&&n.push(e)}))})),n},additive:function(e){var r=e.args,n=[];return forEach(r,(function(e){var r=variables(e);forEach(r,(function(e){indexOf(n,e)<0&&n.push(e)}))})),n},unary:function(e){var r=[];return forEach(e.args,(function(e){r=r.concat(variables(e))})),r},numeric:function(e){return[]},variable:function(e){return"0"===e.args[0]?[]:[e.args[0]]},comma:function(e){var r=e.args,n=[];return forEach(r,(function(e){var r=variables(e);forEach(r,(function(e){indexOf(n,e)<0&&n.push(e)}))})),n},equals:function(e){var r=e.args,n=[];return forEach(r,(function(e){var r=variables(e);forEach(r,(function(e){indexOf(n,e)<0&&n.push(e)}))})),n}})}function variablePart(e){Model.env;return assert(e&&e.args,"2000: Internal error."),visit(e,{name:"variablePart",exponential:function(e){return variablePart(e.args[0])||variablePart(e.args[1])?e:null},multiplicative:function(e){var r=[];return forEach(e.args,(function(e){var n=variablePart(e);null!==n&&r.push(n)})),0===r.length?null:1===r.length?r[0]:multiplyNode(r)},additive:function(e){return some(e.args,(function(e){return null!==variablePart(e)}))?e:null},unary:function(e){return null!==variablePart(e.args[0])?e:null},numeric:function(e){return null},variable:function(e){return null===mathValue(e,!0)?e:null},comma:function(e){var r=[];return forEach(e.args,(function(e){r=r.concat(variables(e))})),0!==r.length?e:null},equals:function(e){var r=[];return forEach(e.args,(function(e){r=r.concat(variables(e))})),0!==r.length?e:null}})}function terms(e){return assert(e&&e.args,"2000: Internal error."),visit(e,{name:"terms",exponential:function(e){return[e]},multiplicative:function(e){return[e]},additive:function(e){var r=[];return forEach(e.args,(function(e){r=r.concat(terms(e))})),r},unary:function(e){return[e]},numeric:function(e){return[e]},variable:function(e){return[e]},comma:function(e){var r=[];return forEach(e.args,(function(e){r=r.concat(terms(e))})),r},equals:function(e){var r=[];return forEach(e.args,(function(e){r=r.concat(terms(e))})),r}})}function normalizeFormatObject(e){var r=[];switch(e.op){case Model.VAR:r.push({code:e.args[0]});break;case Model.MUL:var n="",t=void 0;forEach(e.args,(function(e){e.op===Model.VAR?n+=e.args[0]:e.op===Model.NUM&&(t=+e.args[0])})),r.push({code:n,length:t});break;case Model.COMMA:forEach(e.args,(function(e){r=r.concat(normalizeFormatObject(e))}))}return r}function checkNumberFormat(e,r){var n=normalizeFormatObject(e);return some(n,(function(e){var n=e.code,t=e.length;switch(n){case"\\integer":if("integer"===r.numberFormat&&(void 0===t||t===r.args[0].length))return!0;break;case"\\decimal":if("decimal"===r.numberFormat&&r.isRepeating)return void 0===t;if(("decimal"===r.numberFormat||"integer"===r.numberFormat)&&(void 0===t||0===t&&-1===indexOf(r.args[0],".")||t===r.args[0].substring(indexOf(r.args[0],".")+1).length))return!0;break;case"\\number":if("decimal"===r.numberFormat&&r.isRepeating)return void 0===t;if("integer"===r.numberFormat||"decimal"===r.numberFormat){var o=indexOf(r.args[0],".");if(void 0===t||0===t&&-1===o||o>=0&&t===r.args[0].substring(o+1).length)return!0}break;case"\\scientific":if(r.isScientific){var i=r.args[0].args[0];if(void 0===t||0===t&&-1===indexOf(i,".")||t===i.substring(indexOf(i,".")+1).length)return!0}break;case"\\fraction":if(r.isFraction||r.isMixedNumber||"integer"===r.numberFormat)return!0;break;case"\\simpleFraction":case"\\nonMixedNumber":if(r.isFraction||"integer"===r.numberFormat)return!0;break;case"\\mixedFraction":case"\\mixedNumber":var s;if(r.isMixedNumber||"integer"===r.numberFormat)return!0;if(r.isFraction&&(s=mathValue(normalize(r),!0))&&1===s.compareTo(u)&&-1===s.compareTo(a))return!0;break;case"\\fractionOrDecimal":if(r.isFraction||r.isMixedNumber||"decimal"===r.numberFormat||"integer"===r.numberFormat)return!0;break;default:assert(!1,message(2015,[n]))}}))}function flattenNestedMultiplyNodes(e){var r=[];return e.op!==Model.MUL||e.isScientific?e:(forEach(e.args,(function(e){e.op===Model.MUL?forEach(e.args,(function(e){r=r.concat(flattenNestedMultiplyNodes(e))})):r.push(e)})),multiplyNode(r,!0))}function cancelFactors(r){if(r.op!==Model.MUL)return r;var n=!1,t={},a={};forEach(r.args,(function(r,o){isMinusOne(r)&&(r=newNode(Model.POW,[m,m]),n=!0);var i=factors(r,{},!1,!0,!0);forEach(i,(function(r){var n=r.op===Model.POW&&isNeg(r.args[1]),o=n&&isMinusOne(r.args[1])&&r.args[0]||n&&newNode(Model.POW,[r.args[0],negate(r.args[1])])||r,i=mathValue(o,!0);if(!isOne(i)){var s=null!==i?String(i):"nid$"+e.intern(o);n?(a[s]||(a[s]=[]),a[s].push(r)):(t[s]||(t[s]=[]),t[s].push(r))}}))})),assert(!t[1]&&!a[1],"2000: Identity multiplication should be factored out by now."),t[-1]&&(t[-1].length%2==0?delete t[-1]:a.length>0?(delete t[-1],a[-1]=(a[-1]||[]).concat(binaryNode(Model.POW,[m,m]))):t[-1]=[].concat(t[-1][0]),n=!0),a[-1]&&(a[-1].length%2==0?delete a[-1]:a[-1]=[].concat(a[-1][0]),n=!0);var o=keys(t),i=keys(a);if(0===o.length||0===i.length||1===i.length&&"-1"===i[0])return r;if(forEach(o,(function(e){var r=t[e],o=a[e];if(o){var i=o.length>r.length?r.length:o.length;t[e]="0"===e?r.slice(0,1):r.slice(i),a[e]="0"===e?o.slice(0,1):o.slice(i),n=!0,Model.option("notSimplified",!0)}})),!n)return r;var s,l,u=[],d=[];return forEach(o,(function(e){u=u.concat(t[e])})),forEach(i,(function(e){d=d.concat(a[e])})),s=u.length?multiplyNode(u,!0):null,l=d.length?multiplyNode(d,!0):null,s||l?l?s?multiplyNode([s,l],!0):l:s:c}function cancelTerms(r,n){if(r.op!==Model.ADD)return r;var t={},a={};forEach(r.args,(function(r,n){var o,i=!1;isNeg(constantPart(r))?(i=!0,o=negate(r)):o=r;var s=mathValue(o,!0),l=null!==s?String(s):"nid$"+e.intern(o);i?(a[l]||(a[l]=[]),a[l].push(r)):(t[l]||(t[l]=[]),t[l].push(r))}));var o=keys(t),i=keys(a);if(0===o.length||0===i.length||1===i.length&&"-1"===i[0])return r;var s=[],l=!1;return forEach(o,(function(e){var r=t[e],n=a[e];if(n){var o=n.length>r.length?r.length:n.length;t[e]=r.slice(o),a[e]=n.slice(o),l=!0}})),l?(forEach(o,(function(e){s=s.concat(t[e])})),forEach(i,(function(e){s=s.concat(a[e])})),s.length?addNode(s):d):r}function combineLikeFactors(r){if(!r||0===r.length)return[];var n,o=t,i=[],s=0;return forEach(r,(function(r){var t,l;r.op===Model.POW?(t=r.args[0],l=(l=mathValue(r.args[1],!0))||r.args[1]):(t=r,l=a),assert(null!==l),assert(0===s||e.intern(t)===s),s=e.intern(t),n=t,l.op?i.push(l):o=o.add(l)})),i.unshift(numberNode(o)),[newNode(Model.POW,[n,addNode(i)])]}function factorCommonExpressions(r){if(r.op!==Model.ADD||r.args.length>2)return r;var n=!1,t=r.args.slice(0),o=t.shift(),i={},s={},l=o.op===Model.MUL?o.args:[o];forEach(l,(function(r,n){var t=mathValue(r,!0),a=null!==t?String(t):r.op===Model.POW&&mathValue(r.args[1])?"nid$"+e.intern(r.args[0]):"nid$"+e.intern(r);s[a]||(s[a]=[]),s[a].push(r)})),i[1]=[c];var u=[i],d=[];if(forEach(t,(function(t){var o={};d.push(o);var l=t.op===Model.MUL?t.args:[t];forEach(l,(function(r,n){var t=mathValue(r,!0),a=null!==t?String(t):r.op===Model.POW&&mathValue(r.args[1])?"nid$"+e.intern(r.args[0]):"nid$"+e.intern(r);o[a]||(o[a]=[]),o[a].push(r)}));var c=keys(i),p=keys(o),g=keys(s);if(1===g.length||0===c.length||0===p.length||1===p.length&&"-1"===p[0])return r;forEach(g,(function(e){if(o[e]&&o[e].length){for(var r=s[e]=combineLikeFactors(s[e]),t=(i[e]=combineLikeFactors(i[e]),o[e]=combineLikeFactors(o[e])),l=r.length,d=t.length;l-- >0&&d-- >0;){var c=r.pop(),p=t.pop(),g=c.op===Model.POW&&mathValue(c.args[1])?mathValue(c.args[1],!0):a,m=p.op===Model.POW&&mathValue(p.args[1])?mathValue(p.args[1],!0):a;if(isLessThan(g,m)){var f=m.subtract(g),h=c.op===Model.POW&&mathValue(c.args[1],!0)?c.args[0]:c;isZero(f)||t.push(isOne(f)?h:newNode(Model.POW,[h,numberNode(f)])),isZero(g)||r.push(isOne(g)?h:newNode(Model.POW,[h,numberNode(g)]))}else{f=g.subtract(m),h=c.op===Model.POW&&mathValue(c.args[1],!0)?c.args[0]:c;isZero(f)||u.forEach((function(r){r[e].push(isOne(f)?h:newNode(Model.POW,[h,numberNode(f)]))})),isZero(m)||r.push(isOne(m)?h:newNode(Model.POW,[h,numberNode(m)]))}}n=!0}else{for(r=s[e];r.length>0;){c=r.pop();u.forEach((function(r){(r[e]||(i[e]=[])).push(c)}))}n=!0}})),u.push(o)})),!n)return r;l=[];var p=[];forEach(keys(i),(function(e){l=l.concat(i[e])})),o=0===l.length?c:1===l.length?l[0]:multiplyNode(l),p.push(o),forEach(d,(function(e){var r,n=[];forEach(keys(e),(function(r){n=n.concat(e[r])})),r=0===n.length?c:1===n.length?n[0]:multiplyNode(n),p.push(r)}));var g=[];return forEach(keys(s),(function(e){g=g.concat(s[e])})),0===g.length?r:multiplyNode(g.concat(addNode(p)))}var r=[];function normalize(n){assert(n&&n.args,"2000: Internal error.");var a,o=e.intern(n);if(n.normalizeNid===o||n.normalized)return n;if(void 0!==(a=r[o]))return a;for(var i=o,s=Model.create(visit(n,{name:"normalize",numeric:function(e){return C("dontConvertDecimalToFraction")||!isRepeating(e)&&!isDecimal(e)||(e=decimalToFraction(e)),e},additive:function(r){if(r.op===Model.SUB)assert(2===r.args.length,"2000: Internal error."),r=addNode([r.args[0],negate(r.args[1],!0)],!0);else if(r.op===Model.PM)assert(2===r.args.length,"2000: Operator pm can only be used on binary nodes"),r=addNode([r.args[0],unaryNode(Model.PM,[r.args[1]])]);else if(some(r.args,(function(e){return e.op===Model.INT&&3===e.args.length})))return function normalizeIntegralAddition(r){var n={},t=[];forEach(r.args,(function(r){if(r.op===Model.INT&&3===r.args.length){var a=e.intern(r.args[2]);n[a]||(n[a]=[]),n[a].push(r)}else t.push(r)}));var a=keys(n);return forEach(a,(function(r){var a=n[r],o=a[0].args[2],i=[],s=[];forEach(a,(function(r){var n=r.args[0],t=r.args[1];i.push(e.intern(n)),s.push(e.intern(t))})),forEach(i,(function(r,n){var a=s.indexOf(r);a>=0&&(t.push(integralNode(e.node(i[a]),e.node(s[n]),o)),delete i[a],delete s[a],delete i[n],delete s[n])})),forEach(i,(function(r,n){var a=s[n];t.push(integralNode(e.node(r),e.node(a),o))}))})),binaryNode(r.op,t)}(r);if(r.op===Model.MATRIX||r.op===Model.BACKSLASH)return r;var n=t,a=[];forEach(r.args,(function(e){e.op===Model.NUM&&mathValue(e,!0)&&!C("dontConvertDecimalToFraction")?n=n.add(mathValue(e,!0)):a=a.concat(normalize(e))}));var o=r.isMixedNumber,i=r.isRepeating;return isZero(n)&&0!==a.length||a.unshift(numberNode(n)),mathValue(r=newNode(r.op,a),!0)&&!C("dontConvertDecimalToFraction")&&(r=commonDenom(r)),r.isMixedNumber=o,(r=flattenNestedNodes(r)).isMixedNumber=o,r.isRepeating=i,sort(r)},multiplicative:function(r){if(assert(r.op!==Model.DIV,"2000: Divsion should be eliminated during parsing"),r.op===Model.FRAC)if(r.args[1].op===Model.POW){var n=r.args[1],t=n.args[0],a=n.args[1];r=multiplyNode([r.args[0],newNode(Model.POW,[t,negate(a,!0)])])}else r=multiplyNode([r.args[0],newNode(Model.POW,[r.args[1],m])]);var o,i=[],s=0;forEach(r.args,(function(r){if(r=normalize(r),e.intern(r)!==e.intern(c)){if(C("normalizeArithmetic")){if(isMinusOne(r))return void s++;r.op===Model.POW&&isMinusOne(r.args[1])&&isNeg(r.args[0])?(s++,r=newNode(r.op,[negate(r.args[0]),r.args[1]])):isNeg(r)&&!isAdditive(r)&&(s++,r=negate(r))}else if(i.length>0&&isMinusOne(i[i.length-1])){if(isMinusOne(r))return void i.pop();if(isPositiveInfinity(r))return i.pop(),void i.push(M);if(isNegativeInfinity(r))return i.pop(),void i.push(h)}r.op===Model.MUL?i=i.concat(r.args):r.op===Model.PM?(o=!0,i.push(r.args[0])):i.push(r)}}));var l=r.isRepeating;return s%2?0===i.length?r=m:1===i.length?r=multiplyNode([m,i[0]]):(i.unshift(m),r=sort(binaryNode(r.op,i))):r=0===i.length?c:1===i.length?i[0]:sort(binaryNode(r.op,i)),o&&(r=unaryNode(Model.PM,[r])),r.isRepeating=l,r},unary:function(r){switch(r.op){case Model.SUBSCRIPT:if(r.args[0].op===Model.EVALAT){var n=r.args[1];if(n.op===Model.EQL)assert(n.args[0].op===Model.VAR),name=n.args[0].args[0],n=n.args[1];else{var a=variables(r.args[0]);name=a[0]}Model.env[name]={type:"param",node:n},r=r.args[0].args[0]}}var o=[];switch(forEach(r.args,(function(e){o=o.concat(normalize(e))})),(r=newNode(r.op,o)).op){case Model.SUBSCRIPT:r.args[0].op,Model.EVALAT;case Model.SUB:r=r.args[0].op===Model.POW&&isNeg(r.args[0].args[1])?negate(r.args[0]):negate(r.args[0],!0);break;case Model.PERCENT:if(o[0].op===Model.NUM)r=numberNode(divide(i=mathValue(o[0]),100));else r=multiplyNode([binaryNode(Model.POW,[numberNode("100"),m]),o[0]]);break;case Model.PM:if(isNeg(mathValue(o[0],!0))){o=r.args.slice(0);r=newNode(r.op,[negate(o.shift(),!0)].concat(o))}break;case Model.FACT:var i;r=(i=mathValue(o[0]))?numberNode(factorial(i)):unaryNode(r.op,[o[0]]);break;case Model.INT:r=function normalizeIntegral(r){var n,t,a,o,i;3===r.args.length?(n=r.args[0],t=r.args[1],a=r.args[2]):a=r.args[0];if(n&&e.intern(n)===e.intern(t))r=d;else if(isAdditive(a)){var s=[];forEach(a.args,(function(e){s.push(integralNode(n,t,e))})),r=binaryNode(a.op,s)}else if(o=constantPart(a))if(i=variablePart(a)){if(n&&isNeg(o)){o=negate(o);var l=n;n=t,t=l}r=isOne(o)?integralNode(n,t,i):multiplyNode([o,integralNode(n,t,i)])}else n&&(r=multiplyNode([o,addNode([t,negate(n)])]));return r}(r);break;case Model.SIN:case Model.COS:case Model.SINH:case Model.COSH:case Model.ARCSINH:case Model.ARCCOSH:r=function normalizeTrigIdent(e){if(e.normalized)return e;if((e.op===Model.SIN||e.op===Model.COS)&&e.args[0].op===Model.ADD){var r=e.args[0].args[0],n=addNode(e.args[0].args.slice(1));return e=e.op===Model.SIN?addNode([multiplyNode([unaryNode(Model.SIN,[r]),unaryNode(Model.COS,[n])],!0),multiplyNode([unaryNode(Model.COS,[r]),unaryNode(Model.SIN,[n])])]):addNode([multiplyNode([unaryNode(Model.COS,[r]),unaryNode(Model.COS,[n])]),negate(multiplyNode([unaryNode(Model.SIN,[r]),unaryNode(Model.SIN,[n])]))])}var a=e.op,o=e.args,i=sign(o[0])<0,s=terms(o[0]),l=t,u=[],f=[];forEach(s,(function(e,r){null===variablePart(e)?(l=l.add(mathValue(e,!0,!0)),u.push(e)):f.push(e)}));var h,M=u.length&&simplify(normalize(fractionNode(addNode(u),y)))||d,N=toNumber(mathValue(M,!0))/2,b=isNeg(N)?Math.ceil(N):Math.floor(N);h=b?addNode([M,negate(multiplyNode([p,numberNode(b)]))],!0):M;var O=toNumber(mathValue(h,!0));E=f.length?addNode(O?f.concat(cancelFactors(multiplyNode([h,y]))):f,!0):o[0];switch(a){case Model.SIN:if(i)E=negate(E),e=unaryNode(Model.SIN,[E]),e=i?negate(e):e;else{switch(O){case 1:case-1:f.length?e=negate(unaryNode(Model.SIN,[addNode(f)])):(e=unaryNode(Model.COS,[d]),e=d);break;case.5:case-1.5:f.length?e=unaryNode(Model.COS,[addNode(f)]):(e=unaryNode(Model.COS,[d]),e=c);break;case-.5:case 1.5:f.length?e=negate(unaryNode(Model.COS,[addNode(f)])):(e=unaryNode(Model.COS,[y]),e=m);break;case 0:f.length?e=unaryNode(Model.SIN,[addNode(f.concat(u),!0)]):(e=unaryNode(Model.COS,[fractionNode(y,p)]),e=d);break;default:e=f.length?unaryNode(Model.COS,[addNode([fractionNode(y,p),negate(addNode(o))],!0)]):unaryNode(Model.SIN,o)}e.normalized=!0}break;case Model.COS:if(i)E=negate(E),e=unaryNode(Model.COS,[E]);else switch(O){case 1:case-1:f.length?e=negate(unaryNode(Model.COS,[addNode(f)])):(e=unaryNode(Model.COS,[y]),e=m);break;case.5:case-1.5:f.length?(E=addNode(f),e=negate(unaryNode(Model.SIN,[E]))):(e=unaryNode(Model.COS,[fractionNode(y,p)]),e=d);break;case-.5:case 1.5:f.length?e=unaryNode(Model.COS,[addNode(f)]):(e=unaryNode(Model.COS,[fractionNode(multiplyNode([g,y]),p)]),e=d);break;case 0:f.length?e=unaryNode(Model.COS,[addNode(f.concat(u))]):(e=unaryNode(Model.COS,[d]),e=c);break;default:e=unaryNode(Model.COS,o)}break;case Model.SINH:case Model.COSH:break;case Model.ARCSINH:isNeg(E=o[0])&&(E=negate(E),x=!0),e=newNode(Model.LOG,[v,addNode([E,sqrtNode(addNode([binaryNode(Model.POW,[E,p]),c]))])]),x&&(e=negate(e));break;case Model.ARCCOSH:var E,x;isNeg(E=o[0])&&(E=negate(E)),e=newNode(Model.LOG,[v,addNode([E,sqrtNode(addNode([binaryNode(Model.POW,[E,p]),m]))])]);break;default:assert(!1,"2000: Internal error.")}return e}(r);break;case Model.TAN:case Model.TANH:var s=r.op===Model.TAN?Model.SIN:Model.SINH,l=r.op===Model.TAN?Model.COS:Model.COSH;r=multiplyNode([newNode(s,[u=normalize(r.args[0])]),binaryNode(Model.POW,[newNode(l,[u]),m])]);break;case Model.COT:case Model.COTH:s=r.op===Model.COT?Model.SIN:Model.SINH;r=multiplyNode([newNode(l=r.op===Model.COT?Model.COS:Model.COSH,[u=normalize(r.args[0])]),binaryNode(Model.POW,[newNode(s,[u]),m])]);break;case Model.SEC:case Model.SECH:l=r.op===Model.SEC?Model.COS:Model.COSH;var u=normalize(r.args[0]);r=multiplyNode([binaryNode(Model.POW,[newNode(l,[u]),m])]);break;case Model.CSC:case Model.CSCH:s=r.op===Model.CSC?Model.SIN:Model.SINH,u=normalize(r.args[0]);r=multiplyNode([binaryNode(Model.POW,[newNode(s,[u]),m])]);break;case Model.ABS:r=function normalizeAbs(e){switch(assert(e.op===Model.ABS,"2000: Internal error"),e.args[0].op){case Model.ADD:if(every(e.args[0].args,(function(e){return!isNeg(e)}))){var r=[];forEach(e.args[0].args,(function(e){r.push(unaryNode(Model.ABS,[e]))})),e=addNode(r)}}return e}(r)}return r},variable:function(e){if("i"!==e.args[0]||C("dontSimplifyImaginary")){if("\\infty"===e.args[0])e=h;else if("\\radian"===e.args[0])e=c;else if("\\degree"===e.args[0])e=fractionNode(y,numberNode("180"));else if(Model.env[e.args[0]]&&"param"===Model.env[e.args[0]].type)e=Model.env[e.args[0]].node;else if(C("treatLettersAsVariables"))if(Model.env[e.args[0]]&&"unit"===Model.env[e.args[0]].type){var r=[];e.args[0].split("").forEach((function(e){r.push(variableNode(e))})),e=multiplyNode(r)}else if(e.args[1]&&e.args[1].op===Model.VAR&&Model.env[e.args[1].args[0]]&&"unit"===Model.env[e.args[1].args[0]].type){var n=e.args[1].args[0].slice(0,1),t=e.args[1].args[0].slice(1).split(""),a=e.args[1].args.slice(1);r=[newNode(Model.VAR,[e.args[0],variableNode(n)])];t.forEach((function(e){r.push(variableNode(e))})),r[r.length-1].args=r[r.length-1].args.concat(a),e=multiplyNode(r)}}else e=N;return e},exponential:function(r){var n=!1,t=r.args[0],a=r.args[1];if(r.op===Model.POW&&2===r.args.length&&t.op===Model.TANH&&a.op===Model.NUM&&"2"===a.args[0])return addNode([c,negate(binaryNode(Model.POW,[binaryNode(Model.POW,[newNode(Model.COSH,t.args),p]),m]))]);if(r.op===Model.POW&&2===r.args.length&&t.op===Model.SINH&&e.intern(a)===e.intern(p))return addNode([binaryNode(Model.POW,[newNode(Model.COSH,t.args),p]),m]);if(r.op===Model.POW&&2===r.args.length&&t.op===Model.COTH&&a.op===Model.NUM&&"2"===a.args[0])return addNode([c,binaryNode(Model.POW,[binaryNode(Model.POW,[newNode(Model.SINH,t.args),p]),m])]);if(r.op===Model.POW&&2===r.args.length&&t.op===Model.SECH&&a.op===Model.NUM&&"2"===a.args[0])return binaryNode(Model.POW,[binaryNode(Model.POW,[newNode(Model.COSH,t.args),p]),m]);if(r.op===Model.POW&&2===r.args.length&&t.op===Model.CSCH&&a.op===Model.NUM&&"2"===a.args[0])return binaryNode(Model.POW,[binaryNode(Model.POW,[newNode(Model.SINH,t.args),p]),m]);C("treatLettersAsVariables")&&t.op===Model.VAR&&Model.env[t.args[0]]&&"unit"===Model.env[t.args[0]].type&&(n=!0);var o=[];forEach(r.args,(function(e){o=o.concat(normalize(e))})),r=newNode(r.op,o);o=[];switch(r.op){case Model.LOG:e.intern(r.args[0])===e.intern(v)?o.push(v):o.push(normalize(r.args[0])),r.args.length>1&&(o=o.concat(r.args.slice(1))),r=function normalizeLogIdent(e,r){var n,t=[];if(isMultiplicative(r)){var a=[];forEach(r.args,(function(r){r.op===Model.POW?a.push(multiplyNode([r.args[1],newNode(Model.LOG,[e,r.args[0]])])):a.push(newNode(Model.LOG,[e,r]))})),t.push(addNode(a)),n=binaryNode(Model.LOG,t)}else r.op===Model.POW?(t.push(multiplyNode([r.args[1],newNode(Model.LOG,[e,r.args[0]])])),assert(t.length>0,"2000: Internal error"),t.length>1?n=multiplyNode(t):1===t.length&&(n=t[0])):n=newNode(Model.LOG,[e,r]);return n}(o[0],o[1]);break;case Model.POW:if(isMinusOne(r.args[0])&&.5===toNumber(mathValue(r.args[1],!0)))return N;if(isMinusOne(r.args[0])&&isMinusOne(r.args[1]))return m;if(2===r.args.length&&r.args[1].op===Model.LOG){var i=r.args[0],s=r.args[1].args[1];t=r.args[1].args[0],o=sort(multiplyNode([i,s])).args;return binaryNode(Model.POW,[o[0],binaryNode(r.args[1].op,[t,o[1]])])}if(C("treatLettersAsVariables")&&n&&r.args[0].op===Model.MUL){var l=(t=r.args[0]).args.pop();r=multiplyNode([t=1===t.args.length&&t[0]||t,binaryNode(Model.POW,[l,r.args[1]])])}}return r},comma:function(e){var r=[];return forEach(e.args,(function(e){r=r.concat(normalize(e))})),sort(e=newNode(e.op,r))},equals:function(e){assert(2===e.args.length,"2000: Internal error.");var r=[];if(forEach(e.args,(function(e){e=normalize(e),r.push(e)})),(e=binaryNode(e.op,r)).op===Model.GT||e.op===Model.GE||e.op===Model.NLESS){e.op=e.op===Model.GT?Model.LT:Model.LE;var n=e.args[0];e.args[0]=e.args[1],e.args[1]=n}else e.op===Model.NGTR&&(e.op=Model.LE);return(e=sort(e)).op===Model.COLON||isZero(mathValue(e.args[1],!0))?isZero(mathValue(e.args[1],!0))||isOne(mathValue(e.args[1],!0))||(e=binaryNode(e.op,[multiplyNode([e.args[0],binaryNode(Model.POW,[e.args[1],m])]),c])):e=binaryNode(e.op,[addNode([e.args[0],multiplyNode([m,e.args[1]],!0)],!0),d]),e.op===Model.COLON&&(e=e.args[0]),e}}),n.location);o!==e.intern(s);)o=e.intern(s),s=normalize(s);return s.normalizeNid=o,r[i]=s,s}var n=[];function sort(r){Assert.checkTimeout(),assert(r&&r.args,"2000: Internal error.");var t,a=e.intern(r);if(r.sortNid===a)return r;if(void 0!==(t=n[a]))return t;for(var o=a,i=visit(r,{name:"sort",numeric:function(e){return e},additive:function(e){var r=[];forEach(e.args,(function(n,t){t>0&&e.op===Model.SUB&&(n=negate(n)),r.push(sort(n))}));var n,t,a,o,i,s,l,u,d,c,p,g,m=e.op===Model.SUB?Model.ADD:e.op,f=e.isMixedNumber,h=e.isRepeating;if((e=binaryNode(m,r,!0)).isMixedNumber=f,e.isRepeating=h,e.op===Model.PM||e.op===Model.BACKSLASH)return e;for(var M=0;M<e.args.length-1;M++)a=e.args[M],o=e.args[M+1],(n=degree(e.args[M]))<(t=degree(e.args[M+1]))?(e.args[M]=o,e.args[M+1]=a):n===t&&(i=variables(a),s=variables(o),i.length!==s.length?i.length<s.length&&(e.args[M]=o,e.args[M+1]=a):i.length>0?(d=i.join(","))!==(c=s.join(","))||(l=isPolynomial(a))&&(u=isPolynomial(o))&&(d=l.join(","))!==(c=u.join(","))?d<c&&(e.args[M]=o,e.args[M+1]=a):isLessThan(constantPart(a),constantPart(o))&&(e.args[M]=o,e.args[M+1]=a):0===n&&(exponent(a)!==exponent(o)?exponent(a)<exponent(o)&&(e.args[M]=o,e.args[M+1]=a):(isLessThan((p=mathValue(constantPart(a)),!0),(g=mathValue(constantPart(o)),!0))||!p&&g)&&(e.args[M]=o,e.args[M+1]=a)));return e},multiplicative:function(e){var r,n,t,a,o,i,s,l,u=[];if(forEach(e.args,(function(r,n){isMinusOne(e.args[n-1])&&isMinusOne(e.args[n])?(u.pop(),u.push(c)):u.push(sort(r))})),(e=binaryNode(e.op,u)).op===Model.FRAC||e.op===Model.COEFF)return e;for(var d=0;d<e.args.length-1;d++){var p,g;if(t=e.args[d],a=e.args[d+1],(r=degree(t))!==(n=degree(a)))r>n&&(e.args[d]=a,e.args[d+1]=t);else if(Math.abs(r)===Math.abs(n)){o=t.op===Model.POW&&variables(t.args[0])||variables(t),i=a.op===Model.POW&&variables(a.args[0])||variables(a);var m=exponent(t),f=exponent(a);m===f||isNaN(m)||isNaN(f)?o.length!==i.length?o.length<i.length&&(e.args[d]=a,e.args[d+1]=t):t.op===Model.POW&&a.op===Model.POW&&0===o.length?isLessThan(mathValue(t.args[0],!0),mathValue(a.args[0],!0))&&(e.args[d]=a,e.args[d+1]=t):t.op!==a.op?hashCode(t.op)<hashCode(a.op)&&(e.args[d]=a,e.args[d+1]=t):o.length>0?(p=o.join(","))!==(g=i.join(","))||(s=isPolynomial(t))&&(l=isPolynomial(a))&&(p=s.join(","))!==(g=l.join(","))?p<g&&(e.args[d]=a,e.args[d+1]=t):isLessThan(constantPart(t),constantPart(a))&&(e.args[d]=a,e.args[d+1]=t):isLessThan(leadingCoeff(t),leadingCoeff(a))&&(e.args[d]=a,e.args[d+1]=t):m<f&&(e.args[d]=a,e.args[d+1]=t)}}return e},unary:function(e){var r=[];return forEach(e.args,(function(e){r=r.concat(sort(e))})),newNode(e.op,r)},exponential:function(e){var r=[];return forEach(e.args,(function(e,n){r.push(sort(e))})),e=binaryNode(e.op,r)},variable:function(e){return e},comma:function(e){var r=[];switch(forEach(e.args,(function(e){r.push(sort(e))})),e.op){case Model.COMMA:r.sort((function(e,r){return(e=JSON.stringify(e))<(r=JSON.stringify(r))?-1:e>r?1:0}))}return newNode(e.op,r)},equals:function(e){if(forEach(e.args,(function(r,n){e.args[n]=sort(r)})),e.op===Model.COLON||e.op===Model.RIGHTARROW||e.op===Model.GT||e.op===Model.GE||e.op===Model.LT||e.op===Model.LE||e.op===Model.NGTR||e.op===Model.NLESS||2===e.args.length&&isZero(e.args[1]))return e;for(var r,n,t,a,o,i,s=0;s<e.args.length-1;s++)if(t=e.args[s],a=e.args[s+1],(r=degree(e.args[s],!0))<(n=degree(e.args[s+1],!0)))e.args[s]=a,e.args[s+1]=t;else if(r===n)if(o=variables(t),i=variables(a),o.length!==i.length){if(o.length<i.length){e.args[s];e.args[s]=a,e.args[s+1]=t}}else if(o.length>0){if(o[0]<i[0]){e.args[s];e.args[s]=a,e.args[s+1]=t}}else if(!isZero(a)&&isLessThan(mathValue(t),mathValue(a))){e.args[s];e.args[s]=a,e.args[s+1]=t}return e}});a!==e.intern(i);)a=e.intern(i),i=sort(i);return i.sortNid=a,n[o]=i,i}var f=[];function isRepeating(e){return assert(e.op===Model.NUM,"2000: Internal error."),e.isRepeating}function repeatingDecimalToFraction(e){assert(isRepeating(e),"2000: Internal error.");var r=e.args[0];"0"===r.charAt(0)&&(r=r.slice(1));var n=indexOf(r,"."),t=r.slice(0,n),a=function findRepeatingPattern(e,r,n){return r||(assert("string"==typeof e&&e.length>0,"2000: Internal error."),r=e.charAt(0),e=e.substring(1),n=""),0===e.length?r:0===indexOf(e,r)?(n+=r,findRepeatingPattern(e=e.substring(r.length),r,n)):(r+=n+e.charAt(0),n="",findRepeatingPattern(e=e.substring(1),r,n))}(r.slice(n+1)),o=a.length;return fractionNode(numberNode(t+a),addNode([binaryNode(Model.POW,[numberNode("10"),numberNode(o)]),m]))}function decimalToFraction(e){if(assert(e.op===Model.NUM,"2000: Internal error."),isRepeating(e))return repeatingDecimalToFraction(e);var r=e.args[0];"0"===r.charAt(0)&&(r=r.slice(1));var n=indexOf(r,"."),t=r.length-n-1;return multiplyNode([numberNode(r.slice(0,n)+r.slice(n+1)),binaryNode(Model.POW,[numberNode("10"),negate(numberNode(t))])])}function isLessThan(e,r){return e&&void 0!==e.op&&(e=mathValue(e,!0)),r&&void 0!==r.op&&(r=mathValue(r,!0)),null!==e&&e instanceof BigDecimal&&null!==r&&e instanceof BigDecimal&&e.compareTo(r)<0}function pow(e,r){var n;return null===e||null===r?null:Math.abs(toNumber(r))>1e3?(r=toNumber(r),e=toNumber(e),toDecimal(Math.pow(e,r))):e instanceof BigDecimal?isInteger(r)?(n=e.pow(r.abs()),isNeg(r)&&(n=divide(a,n)),n):(e=toNumber(e),r=toNumber(r),n=Math.pow(e,r),isNaN(n)?null:toDecimal(n)):toDecimal(Math.pow(e,r))}var A=new MathContext(34);function divide(e,r){return null===e||null===r?null:(e instanceof BigDecimal||(e=toDecimal(e)),r instanceof BigDecimal||(r=toDecimal(r)),isZero(r)?null:e.divide(r,A))}function integralNode(e,r,n){return newNode(Model.INT,e?[e,r,n]:[n])}function factorGroupingKey(e){return assert(e&&e.args,"2000: Internal error."),visit(e,{name:"factorGroupingKey",exponential:function(e){return factorGroupingKey(e.args[1])+Model.POW+factorGroupingKey(e.args[0])},multiplicative:function(e){var r="";return(r+=variables(e).join(""))||(r=factorGroupingKey(e.args[0])),r},additive:function(e){var r="";return forEach(e.args,(function(e){r+="+"+factorGroupingKey(e)})),r},unary:function(e){return factorGroupingKey(e.args[0])},numeric:function(e){return Model.NUM},variable:function(e){return e.args[0]},comma:function(e){return Model.COMMA},equals:function(e){return Model.EQL}})}var S=[];function groupLikes(r){var n,t={};if(r.op!==Model.MUL&&r.op!==Model.ADD)return r;assert(r.args.length>1,"2000: Internal error.");var a,o=e.intern(r);if(void 0!==(a=S[o]))return a;var i=o;r=flattenNestedNodes(r),forEach(r.args,(function(a,o){var i,s;(r.op===Model.MUL?i=factorGroupingKey(a):r.op===Model.ADD&&(i=variablePart(a)),i)||(i=null!==(s=mathValue(a,!0))?a.op===Model.POW?null!==(s=abs(mathValue(a.args[0],!0)))?"number":"none":null!==(s=abs(s))?"number":"none":a);assert(i,"2000: Internal error."),"string"==typeof i&&(i=variableNode(i)),n=e.intern(i),(t[n]?t[n]:t[n]=[]).push(a)}));var s=[],l=[],u=r.isMixedNumber;if(forEach(keys(t),(function(e){var n=t[e];assert(n,"2000: Internal error.");var a=[],o=[];if(forEach(n,(function(e){var r=constantPart(e);r&&a.push(r)})),forEach(n,(function(e){var r=variablePart(e);r&&o.push(r)})),indexOf(a,null)>=0)return r;if(r.op===Model.ADD){if(a.length>0){(u=binaryNode(r.op,a)).isMixedNumber=r.isMixedNumber;u=null!==(p=mathValue(u))?numberNode(p):simplify(u,{dontGroup:!0})}else u=c;if(o.length>0){var i=o[0];isZero(u)?s.push(d):isOne(u)?s.push(i):s.push(simplify(multiplyNode([u,i]),{dontGroup:!0}))}else u&&(u.op===Model.NUM?l.push(u):s.push(u))}else if(r.op===Model.MUL){var u;if(a.length>0){var p;null!==(p=mathValue(u=binaryNode(r.op,a)))?(isOne(p)||l.push(numberNode(p.toString())),u=null):u=simplify(u,{dontGroup:!0})}else u=null;o.length>0?null===u||isOne(u)?s.push(simplify(multiplyNode(o),{dontGroup:!0})):isZero(u)?s.push(d):s.push(simplify(multiplyNode([u].concat(o)),{dontGroup:!0})):u&&(mathValue(u,!0)?l.push(u):s.push(u))}else s.push(binaryNode(r.op,n))})),l.length>0){var p=binaryNode(r.op,l),g=mathValue(p);null===g?s.push(p):s.push(numberNode(g))}return r=sort(r=0===s.length?c:1===s.length?s[0]:binaryNode(r.op,s)),S[i]=r,r.isMixedNumber=u,r}function listNodeIDs(r){var n=[];return r.op===Model.COMMA?forEach(r.args,(function(r){n.push(e.intern(r))})):n.push(e.intern(r)),n}function commonDenom(r){var n=r.args;if(!function isChemCore(){return!!Model.env.Au}()){var t=[],a=0;if(forEach(n,(function(e){t=denom(e,t),forEach(t,(function(e){var r=degree(e);a=r>a&&r||a}))})),t.length>1&&a<3||1===t.length&&!isMinusOne(t[0])&&!isOne(t[0])){var o,i=binaryNode(Model.POW,[multiplyNode(t,!0),m]),s=[];if(forEach(n,(function(r){var n;n=function numer(r,n,t){t=t.slice(0);var a,o=factors(r,{},!0,!0),i=[];forEach(o,(function(e){e.op===Model.POW&&isNeg(mathValue(e.args[1],!0))||i.push(e)})),a=0===i.length||isOne(i[0])?[]:[multiplyNode(i)];var s=n?e.intern(n):0,l=-1;some(t,(function(r,n){var t=e.intern(r);return s===t&&(l=n,!0)})),l>-1&&t.splice(l,1);if(a.length||t.length)return multiplyNode([].concat(a).concat(t),!0);return c}(r,denom(r,[])[0],t),s=s.concat(n)})),s.length)(o=mathValue(n=binaryNode(r.op,s)))&&(n=numberNode(o)),r=multiplyNode([n,i]);else r=i}}return r}function denom(r,n){var t,a=factors(r,{},!0,!0),o=[];return forEach(a,(function(e){t=e.args[0],e.op!==Model.POW||isOne(e.args[0])||(isMinusOne(e.args[1])?o.push(t):isNeg(mathValue(e.args[1],!0))&&o.push(binaryNode(Model.POW,[t,simplify(negate(e.args[1]),x)])))})),0===o.length||(t=multiplyNode(o),every(n,(function(r){return e.intern(r)!==e.intern(t)}))&&n.push(t)),n}function simplify(r,n){assert(r&&r.args,"2000: Internal error."),assert(r.op!==Model.MUL||r.args.length>1,"2000: Internal error.");var a=e.intern(r);if(r.simplifyNid===a)return r;for(var u=Model.create(visit(r,{name:"simplify",numeric:function(e){return e},additive:function(r){if(assert(r.op!==Model.SUB,"2000: simplify() additive node not normalized: "+JSON.stringify(r)),r.op===Model.PM)return r;var t=r.isMixedNumber;if(r=cancelTerms(r),n&&n.dontGroup||(r=groupLikes(r)),!isAdditive(r))return r;var a=[];if(forEach(r.args,(function(e,r){a=a.concat(simplify(e,n))})),(r=binaryNode(r.op,a)).isMixedNumber=t,r.op===Model.PM)return r;if(r.op===Model.BACKSLASH||r.op===Model.ADD&&2===r.args.length&&r.args[0].op===Model.MUL&&2===r.args[0].args.length&&r.args[0].args[0].op===Model.NUM&&"-1"===r.args[0].args[0].args[0]&&r.args[0].args[1].op===Model.COMMA&&r.args[1].op===Model.COMMA)return function diffSets(r,n){if(r.op===Model.MUL){assert(2===r.args.length,"2000: Internal error."),assert(r.args[1].op===Model.COMMA,message(2002));var t=n;n=r.args[1],r=t}var a=listNodeIDs(r),o=listNodeIDs(n),i=filter(a,(function(e){return indexOf(o,e)<0})),s=[];return forEach(i,(function(r){s.push(e.node(r))})),1===s.length?s[0]:newNode(Model.COMMA,s)}(r.args[0],r.args[1]);if((!C("dontFactorDenominators")||!t&&mathValue(r,!0))&&(r=commonDenom(r)),!isAdditive(r))return r;var o=[simplify((a=r.args.slice(0)).shift(),n)];return forEach(a,(function(r,t){r=simplify(r,n),o=o.concat(function fold(r,t){var a=degree(r),o=degree(t),i=constantPart(r),s=constantPart(t);if(isZero(i))return t;if(isZero(s))return r;if(a===o){var l=variablePart(r),u=variablePart(t);if(null!==l&&null!==u&&e.intern(l)===e.intern(u)){var g=addNode([i,s]),m=mathValue(g);return isZero(m)?d:isOne(m)?l:multiplyNode([g,l])}if(r.op===Model.LOG&&t.op===Model.LOG&&e.intern(r.args[0])===e.intern(t.args[0]))return simplify(newNode(Model.LOG,[r.args[0],multiplyNode([r.args[1],t.args[1]])]),n);if(0===a&&0===o){var f=mathValue(r,!0),h=mathValue(t,!0);return isInteger(f)&&isInteger(h)?numberNode(f.add(h)):e.intern(r)===e.intern(t)?multiplyNode([p,r]):n&&n.dontGroup||C("dontFactorTerms")||!(commonFactors(r,t).length>0)?[r,t]:[factorTerms(r,t)]}if(2===a&&2===o&&isOne(i)&&isOne(s)&&(r.args[0].op===Model.SIN&&t.args[0].op===Model.COS||r.args[0].op===Model.COS&&t.args[0].op===Model.SIN)&&e.intern(r.args[0].args[0])===e.intern(t.args[0].args[0]))return c;if(2===a&&2===o&&isOne(i)&&isOne(s)&&(r.args[0].op===Model.SIN&&t.args[0].op===Model.COS||r.args[0].op===Model.COS&&t.args[0].op===Model.SIN)&&e.intern(r.args[0].args[0])===e.intern(t.args[0].args[0]))return c}if(e.intern(r)===e.intern(t))return multiplyNode([p,r]);if(isZero(mathValue(i)))return t;if(isZero(mathValue(s)))return r;if(!C("dontFactorTerms")&&!isOne(mathValue(i))&&!isOne(mathValue(s))&&commonFactors(r,t).length>0)return[factorTerms(r,t)];return[r,t]}(o.pop(),r))})),(r=o.length<2?o[0]:binaryNode(r.op,o)).isMixedNumber=t,assert(r.args.length>0,"2000: Internal error."),r},multiplicative:function(r){if(assert(r.op===Model.MUL,"2000: simplify() multiplicative node not normalized: "+JSON.stringify(r)),r=cancelFactors(r),n&&n.dontGroup||(r=groupLikes(r)),!isMultiplicative(r))return r;e.intern(r);var t=r.args.slice(0),a=[simplify(t.shift(),n)];return a[0].op===Model.MUL&&(a=a[0].args.slice(0)),forEach(t,(function(t,o){t=simplify(t,n),a=a.concat(function fold(t,a){var o,i,s=degree(t),l=degree(a),u=(variables(t),variables(a),variablePart(t)),g=variablePart(a),f=constantPart(t),h=constantPart(a),M=mathValue(f,!0),N=mathValue(h,!0);if(0===s&&isZero(M)&&!isUndefined(a)||0===l&&isZero(N)&&!isUndefined(t))return units(t).length||units(a).length?[t,a]:d;if(isInteger(o=mathValue(t))&&isInteger(i=mathValue(a)))return numberNode(o.multiply(i));if(0===s&&isOne(M))return a;if(0===l&&isOne(N))return t;if(isInfinity(t))return isNeg(a)?negate(t):t;if(isInfinity(a))return isNeg(t)?negate(a):a;if(0===s&&0===l){if(isOne(N)&&isOne(M))return c;if(isImaginary(t)&&isImaginary(a))return m;var v,y=exponent(t),b=exponent(a),O=base(t),E=base(a);if(null!==O&&null!==E&&1===Math.abs(y)&&1===Math.abs(b))if(y===b)isMinusOne(O)||isMinusOne(E)?r=[t,a]:(r=multiplyNode([numberNode(O),numberNode(E)]),(v=mathValue(r))&&(r=numberNode(v)),-1===y&&(r=binaryNode(Model.POW,[r,m])));else if(isZero(t))r=d;else if(v=mathValue(multiplyNode([t,a])))r=numberNode(v);else{var x=toNumber(O),A=toNumber(E);if((R=gcd(x,A))===(0|R)&&(O=divide(O,toDecimal(R)),E=divide(E,toDecimal(R))),y<0&&isOne(O))r=numberNode(E);else if(b<0&&isOne(E))r=numberNode(O);else{var S=1===y?O:E,R=1===y?E:O;if(isOne(S))r=binaryNode(Model.POW,[numberNode(R),m]);else{var I=divide(S,R);isInteger(I)?r=numberNode(I):(isNeg(S)&&isNeg(R)&&(S=S.multiply(toDecimal("-1")),R=R.multiply(toDecimal("-1"))),r=[numberNode(S),binaryNode(Model.POW,[numberNode(R),m])])}}}else if(t.op===Model.POW&&a.op===Model.POW&&e.intern(t.args[1])===e.intern(a.args[1])){O=t.args[0],E=a.args[0],y=exponent(t),b=exponent(a);r=.5===y&&e.intern(O)===e.intern(E)?O:-1===y||isMinusOne(O)||isMinusOne(E)?[t,a]:binaryNode(Model.POW,[simplify(multiplyNode([O,E])),t.args[1]])}else r=[t,a]}else if(u&&g&&e.intern(u)===e.intern(g)){t=multiplyNode([f,h]);if(u.op===Model.POW){assert(2===u.args.length&&2===g.args.length,"2000: Exponents of exponents not handled here.");y=u.args[1],b=g.args[1],a=binaryNode(Model.POW,[u.args[0],addNode([y,b])])}else a=binaryNode(Model.POW,[u,p]);r=isZero(mathValue(t))?[]:isOne(mathValue(t))?a:[t,a]}else if(e.intern(t.op===Model.POW?t.args[0]:t)===e.intern(a.op===Model.POW?a.args[0]:a)){var D,T,L;D=t.op===Model.POW?t.args[0]:t,T=t.op===Model.POW?t.args[1]:c,L=a.op===Model.POW?a.args[1]:c;var P=simplify(addNode([T,L]),n);r=isZero(P)?c:isOne(P)?D:binaryNode(Model.POW,[D,P])}else{if(0===s&&isOne(M))return a;if(0===l&&isOne(N))return t;if(0===s){if(sign(t)<0&&function isPolynomialDenominatorWithNegativeTerm(e){return e.op===Model.POW&&isMinusOne(e.args[1])&&e.args[0].op===Model.ADD&&variables(e.args[0]).length>0&&some(e.args[0].args,(function(e){return isNeg(constantPart(e))}))}(a))return[negate(t),expand(negate(a))];var w=mathValue(t);r=null!==w?[numberNode(w),a]:[t,a]}else if(0===l){w=mathValue(a);r=null!==w?[numberNode(w),t]:[t,a]}else if(C("dontExpandPowers")&&t.op===Model.POW&&a.op===Model.POW&&e.intern(t.args[1])===e.intern(a.args[1])){O=t.args[0],E=a.args[0];var U=[];O.op===Model.MUL?U=U.concat(O.args):U.push(O),E.op===Model.MUL?U=U.concat(E.args):U.push(E),r=binaryNode(Model.POW,[simplify(multiplyNode(U)),t.args[1]])}else r=[t,a]}t.op!==Model.PM&&a.op!==Model.PM||(r=r instanceof Array?binaryNode(Model.PM,r):unaryNode(Model.PM,[r]));return r}(a.pop(),t))})),a.length<2?(assert(a.length,"2000: Internal error."),r=a[0]):r=sort(flattenNestedNodes(multiplyNode(a))),r},unary:function(e){var r=[];switch(forEach(e.args,(function(e){r=r.concat(simplify(e,n))})),(e=newNode(e.op,r)).op){case Model.SUB:e=negate(e.args[0]);break;case Model.ABS:var t,a=simplify(e.args[0]),o=constantPart(a),i=variablePart(a);i&&i.op===Model.POW&&2===i.args.length&&(t=i.args[1],i=i.args[0]),i=i&&sign(i)<0?unaryNode(Model.ABS,[simplify(expand(negate(i)))]):i?unaryNode(Model.ABS,[i]):c,t&&(i=binaryNode(Model.POW,[i,t])),e=isOne(o)||isMinusOne(o)?i:isNeg(o)?multiplyNode([simplify(expand(negate(o))),i]):multiplyNode([o,i]);break;case Model.M:var s=mathValue(e);null!==s&&(e=numberNode(s));break;case Model.PM:default:e=unaryNode(e.op,r)}return e},exponential:function(r){r.args[0],e.intern(r);var a=r.args.slice(0).reverse(),u=[simplify(a.shift(),n)];if(forEach(a,(function(a,g){a=simplify(a,n),u=u.concat(function fold(r,n,a){var u=mathValue(a),g=mathValue(n,{},!0);if(r===Model.POW){if(isZero(u))return isNeg(g)?[undefinedNode(newNode(r,[a,n]))]:[d];if(isZero(g))return[c];if(isOne(u))return[c];if(isOne(g))return[a];if(isImaginary(a)&&null!==g)return 0===g.remainder(s).compareTo(t)?[c]:0===g.remainder(o).compareTo(t)?[m]:0===g.remainder(i).compareTo(t)?[negate(N)]:0===g.remainder(l).compareTo(t)?[N]:[n,a];if(a.op===Model.POW)return binaryNode(Model.POW,[a.args[0],multiplyNode([a.args[1],n])]);if(isMinusOne(a)&&isOddFraction(n))return multiplyNode([m,binaryNode(Model.POW,[negate(a),n])]);if(!C("dontExpandPowers")&&a.op===Model.MUL){var f=[];return forEach(a.args,(function(e){e.op===Model.POW?f.push(binaryNode(Model.POW,[e.args[0],multiplyNode([e.args[1],n])])):f.push(binaryNode(Model.POW,[e,n]))})),multiplyNode(f)}if(null!==u&&null!==g&&!isNeg(u)){var h=pow(u,g);return a=numberNode(h)}if(n.op===Model.LOG&&e.intern(a)===e.intern(n.args[0]))return n.args[1];if(a.op===Model.SINH&&e.intern(n)===e.intern(p))return addNode([binaryNode(Model.POW,[newNode(Model.COSH,a.args),p]),m]);if(null!==(h=pow(u,g)))return numberNode(h)}else if(r===Model.LOG)if(null!==g&&isE(a)){var M;if(isInteger(M=toDecimal(Math.log(toNumber(g)))))return numberNode(M)}else{if(e.intern(a)===e.intern(n))return c;if(!C("dontExpandPowers")&&!isE(a))return multiplyNode([binaryNode(Model.LOG,[v,n]),binaryNode(Model.POW,[binaryNode(Model.LOG,[v,a]),m])])}return[n,a]}(r.op,u.pop(),a))})),1===u.length){var g=u[0];(g.op!==Model.NUM||isInteger(g)||isInfinity(g)||isUndefined(g))&&(r=g)}else{if(isInfinity(u[1])&&isNeg(u[0]))return d;r=binaryNode(r.op,u.reverse())}return r},variable:function(e){return e},comma:function(e){var r=[];return forEach(e.args,(function(e){r=r.concat(simplify(e,n))})),newNode(e.op,r)},equals:function(e){var r=[];if(forEach(e.args,(function(e){r=r.concat(simplify(e,n))})),assert(2===r.length,"2000: Internal error."),isZero(r[1])){if(null!==mathValue(r[0],!0))return newNode(e.op,r);var t=factors(r[0],{},!0,!0,!0),a=!1;isMinusOne(t[0])&&(t.shift(),a=!0);var o=[];forEach(t,(function(r){var n=mathValue(r,!0);a&&function isInequality(e){return e===Model.LT||e===Model.LE||e===Model.GT||e===Model.GE||e===Model.NE||e===Model.NGTR||e===Model.NLESS}(e.op)||null!==n&&!isZero(n)&&t.length>1||r.op===Model.VAR&&units(r).length>0&&t.length>1||r.op===Model.POW&&units(r.args[0]).length>0&&null!==mathValue(r.args[0])&&t.length>1||r.op===Model.POW&&isNeg(r.args[1])?e.op!==Model.EQL&&e.op!==Model.APPROX&&(o.length>0?o.push(expand(negate(o.pop()))):1===t.length&&o.push(expand(negate(r)))):isZero(n)?(o=[d],!0):o=o.concat(r)})),o.length>0?r[0]=multiplyNode(o):r[0]=d}return newNode(e.op,r)}}),r.location);a!==e.intern(u);)a=e.intern(u),u=simplify(u,n);return u.simplifyNid=a,u}function leadingCoeff(e){var r;switch(e.op){case Model.ADD:r=constantPart(e.args[0]);break;default:r=constantPart(e)}return r}function sign(e){var r=0,n=terms(e);return forEach(n,(function(e){mathValue(e);isNeg(leadingCoeff(e))?r-=1:r+=1})),0===r&&(r=isNeg(leadingCoeff(n[0]))?-1:1),r}function base(e){return e.op===Model.POW?mathValue(e.args[0]):mathValue(e)}function exponent(e){return e.op===Model.POW?toNumber(mathValue(e.args[1],{},!0)):1}function mathValue(e,r,n,o){return e&&e.args?(void 0===r?r=Model.env:"boolean"==typeof r&&(o=n,n=r,r=Model.env),visit(e,{name:"mathValue",numeric:function(e){return isUndefined(e)||isRepeating(e)?null:toDecimal(e.args[0])},additive:function(e){if(e.op===Model.PM)return null;var a=t;return forEach(e.args,(function(e){var n=mathValue(e,r,!0,o);a=n&&a?a.add(n):null})),n||isInteger(a)?a:null},multiplicative:function(e){var t=a,i=!1;return forEach(e.args,(function(e){i=i||isDecimal(e);var n=mathValue(e,r,!0,o);t=null!==t&&null!=n?t.multiply(n):null})),n||isInteger(t)||i&&C("dontConvertDecimalToFraction")?t:null},unary:function(e){switch(e.op){case Model.SUB:return null===(l=mathValue(e.args[0],r,n,o))?null:l.multiply(u);case Model.FACT:return(a=mathValue(e.args[0],r,n,o))?toDecimal(factorial(a)):null;case Model.M:var t=[];if(e.args[0].op===Model.MUL)forEach(e.args[0].args,(function(e){assert(e.op===Model.VAR,"2000: Invalid arguments to the M tag");var a=Model.env[e.args[0]];assert(a&&a.mass,"2000: Missing chemical symbol");var i=e.args[1]?toNumber(mathValue(e.args[1],r,n,o)):1;t.push(numberNode(a.mass*i))}));else{var a=e.args[0];assert(a.op===Model.VAR,"2000: Invalid arguments to the M tag");var i=Model.env[a.args[0]];assert(i&&i.mass,"2000: Missing chemical symbol");var s=a.args[1]?toNumber(mathValue(a.args[1],r,n,o)):1;t.push(numberNode(i.mass*s))}return mathValue(makeTerm(t),r,n,o);case Model.ABS:return abs(mathValue(e.args[0],r,n,o));case Model.SIN:case Model.COS:case Model.TAN:case Model.ARCSIN:case Model.ARCCOS:case Model.ARCTAN:case Model.SINH:case Model.COSH:case Model.TANH:case Model.ARCSINH:case Model.ARCCOSH:case Model.ARCTANH:var l;return n?function trig(e,r){if(null===e)return null;if(e instanceof BigDecimal)e=toNumber(e);else if(isNaN(e))return null;var n;switch(r){case Model.SIN:n=Math.sin;break;case Model.COS:n=Math.cos;break;case Model.TAN:n=Math.tan;break;case Model.ARCSIN:n=Math.asin;break;case Model.ARCCOS:n=Math.acos;break;case Model.ARCTAN:n=Math.atan;break;case Model.SINH:n=Math.sinh;break;case Model.COSH:n=Math.cosh;break;case Model.TANH:n=Math.tanh;break;case Model.ARCSINH:n=Math.asinh;break;case Model.ARCCOSH:n=Math.acosh;break;case Model.ARCTANH:n=Math.atanh;break;default:assert(!1,"2000: Internal error.")}return toDecimal(n(e))}(l=isPositiveInfinity(e.args[0])?Number.POSITIVE_INFINITY:isNegativeInfinity(e.args[0])?Number.NEGATIVE_INFINITY:mathValue(toRadians(e.args[0]),r,n,o),e.op):null;case Model.ADD:return mathValue(e.args[0],r,n,o);case Model.DEGREE:return mathValue(toRadians(e.args[0]),r,n,o);default:return null}},exponential:function(e){var t=e.args.slice(0).reverse(),a=mathValue(t.shift(),r,n,o),i=e.op;if(i===Model.POW)forEach(t,(function(e){var n=mathValue(e,r,!0,o);a=null!==a&&null!=n?pow(n,a):null}));else if(i===Model.LOG){assert(1===t.length,"2000: Internal error.");var s=a,l=t[0],u=mathValue(l,!0,o);null!==s&&(null!==u?a=function logBase(e,r){var n=Math.log(toNumber(r))/Math.log(toNumber(e));return isNaN(n)?null:new BigDecimal(String(n))}(u,s):l.op===Model.VAR&&"e"===l.args[0]&&(a=toDecimal(Math.log(toNumber(s)))))}return n||isInteger(a)?a:null},variable:function(e){var t,a;return(t=r[e.args[0]])&&("const"===t.type||"unit"===t.type&&o)&&(a=t.value),a&&(n||isInteger(a))?toDecimal(a):null},comma:function(e){return null},equals:function(e){return null}})):null}function units(e,r){return assert(e&&e.args,"2000: Internal error."),visit(e,{name:"units",exponential:function(e){return units(e.args[0],r).length>0?[e]:[]},multiplicative:function(e){var n=[];return forEach(e.args,(function(e){n=n.concat(units(e,r))})),n},additive:function(e){var n=[];return forEach(e.args,(function(e){n=n.concat(units(e,r))})),n},unary:function(e){return[]},numeric:function(e){return[]},variable:function(e){var r,n=Model.env;return n&&(r=n[e.args[0]])&&"unit"===r.type?[e]:[]},comma:function(e){var n=[];return forEach(e.args,(function(e){n=n.concat(units(e,r))})),n},equals:function(e){var n=[];return forEach(e.args,(function(e){n=n.concat(units(e,r))})),n}})}function multiplyMatrix(e,r){if(e.op!==Model.MATRIX)return multiplyScalarAndMatrix(e,r);if(r.op!==Model.MATRIX)return multiplyScalarAndMatrix(r,e);var n=[],t=e.args[0].args;return forEach(t,(function(e){var a=[],o=r.args[0].args[0].args;assert(t.length===o.length,message(2013)),forEach(o,(function(n,t){n=function getMatrixCol(e,r){var n=[],t=e.args[0].args;return forEach(t,(function(e){var t=e.args;n.push(t[r])})),n}(r,t),a.push(function multiplyVectors(e,r){var n=[];return forEach(e,(function(e,t){var a=r[t];n.push(multiplyNode([e,a]))})),addNode(n)}(e.args,n))})),n.push(newNode(Model.COL,a))})),newNode(Model.MATRIX,[newNode(Model.ROW,n)])}function addMatrix(e,r){if(e.op!==Model.MATRIX)return addScalarAndMatrix(e,r);if(r.op!==Model.MATRIX)return addScalarAndMatrix(r,e);var n=[],t=e.args[0].args;return forEach(t,(function(e,a){var o,i=r.args[0].args;assert(t.length===i.length,message(2013));var s=i[a];o=function addVectors(e,r){assert(e.length===r.length,message(2013));var n=[];return forEach(e,(function(e,t){var a=r[t];n.push(addNode([e,a]))})),n}(e.args,s.args),n.push(newNode(Model.COL,o))})),newNode(Model.MATRIX,[newNode(Model.ROW,n)])}function multiplyScalarAndMatrix(e,r){var n=[],t=r.args[0].args;return forEach(t,(function(r){var t=[],a=r.args;forEach(a,(function(r){t.push(multiplyNode([e,r]))})),n.push(newNode(Model.COL,t))})),newNode(Model.MATRIX,[newNode(Model.ROW,n)])}function addScalarAndMatrix(e,r){var n=[],t=r.args[0].args;return forEach(t,(function(r){var t=[],a=r.args;forEach(a,(function(r){t.push(addNode([e,r]))})),n.push(newNode(Model.COL,t))})),newNode(Model.MATRIX,[newNode(Model.ROW,n)])}var R=[];function expand(r,n){assert(r&&r.args,"2000: Internal error.");var t,a=e.intern(r);if(r.expandNid===a)return r;if(void 0!==(t=R[a]))return t;for(var o=a,i=Model.create(visit(r,{name:"expand",numeric:function(e){return assert("string"==typeof e.args[0],"2000: Internal error."),e},additive:function(r){e.intern(r);var n=r.isMixedNumber,t=r.args.slice(0),a=[expand(t.shift())];return forEach(t,(function(e){e=expand(e),a=a.concat(function unfold(e,r){if(e.op===Model.MATRIX||r.op===Model.MATRIX)return addMatrix(e,r);return[e,r]}(a.pop(),e))})),(r=a.length<2?a[0]:binaryNode(r.op,a,!0)).op===Model.MATRIX||C("equivLiteral")||((r=cancelTerms(r)).isMixedNumber=n),r},multiplicative:function(r){e.intern(r);var n=r.args.slice(0),t=[expand(n.shift())];forEach(n,(function(e,r){e=expand(e),t=t.concat(function unfold(e,r){var n,t,a;if(e.op===Model.MATRIX||r.op===Model.MATRIX)return multiplyMatrix(e,r);e.op===Model.POW&&r.op===Model.POW&&exponent(e)===exponent(r)?(t=terms(e.args[0]),a=terms(r.args[0]),n=exponent(e)):(t=terms(e),a=terms(r));if(t&&a&&(!isAggregate(e)&&t.length>1||!isAggregate(r)&&a.length>1)&&t.length*a.length<64)return function multiplyTerms(e,r,n){var t=[];forEach(e,(function(e){forEach(r,(function(r){var n=[];e.op===Model.MUL?n=n.concat(e.args):n.push(e),r.op===Model.MUL?n=n.concat(r.args):n.push(r),t.push(multiplyNode(n))}))}));var a=addNode(t,!0);return void 0!==n&&(a=binaryNode(Model.POW,[a,numberNode(n.toString())])),[sort(a)]}(t,a,n);var o=[];e.op===Model.MUL?o=o.concat(e.args):o.push(e);r.op===Model.MUL?o=o.concat(r.args):o.push(r);return o}(t.pop(),e))})),n=t;var a=0;t=[];var o=C("equivLiteral")&&C("normalizeArithmetic")&&n.length>1;return forEach(n,(function(e,r){o&&isOne(e)||(o&&n.length>1&&isMinusOne(e)?a++:t.push(e))})),a%2&&t.unshift(m),r=1===t.length?t[0]:0===t.length?c:multiplyNode(t)},unary:function(e){switch(assert(e.op!==Model.SQRT,"2000: SQRT removed during parsing"),e.op){case Model.ABS:var r=expand(e.args[0]);if(r.op===Model.MUL){var n=[];forEach(r.args,(function(e){n.push(unaryNode(Model.ABS,[e]))})),e=multiplyNode(n)}else e=unaryNode(Model.ABS,[r]);break;case Model.SUB:(e=multiplyNode([expand(e.args[0]),m])).args[0]=expand(e.args[0]);break;default:n=[];forEach(e.args,(function(e){n.push(expand(e))})),e=unaryNode(e.op,n)}return e},exponential:function(e){C("dontExpandPowers")||(e=flattenNestedNodes(e));var r,n=e.args.slice(0).reverse(),t=[expand(n.shift())];(forEach(n,(function(r){r=expand(r),t=t.concat(function unfold(e,r,n){var t=C("dontExpandPowers"),a=mathValue(r),o=[];if(e===Model.POW){if(t&&(n.op===Model.VAR||n.op===Model.NUM))return[r,n];if(n.op===Model.POW&&!isNeg(n.args[1])&&!isNeg(r))return r=multiplyNode(n.args.slice(1).concat(r)),n=n.args[0],[r,n];if(r.op===Model.MUL&&isAdditive(n)){var i=constantPart(r),s=variablePart(r);if(i&&s)return[s,newNode(e,[n,i])]}var l=factors(n,null,!1,!0);if(0===l.length)return c;forEach(l,(function(n){if(r.op===Model.ADD)forEach(r.args,(function(r){o.push(newNode(e,[n,r]))}));else if(isInteger(a)){var i,s=Math.abs(toNumber(a));if(isZero(a))o.push(c);else if(isNeg(i=mathValue(n))&&!isNeg(a)){var l=pow(i,a);o.push(numberNode(l))}else if(s<5||s<10&&!isPolynomial(n)&&!t)for(var u=isNeg(a),d=0;d<s;d++)u?n.op===Model.POW&&isMinusOne(n.args[1])?o.push(n.args[0]):(isOne(n)||isMinusOne(n))&&isMinusOne(a)?o.push(n):o.push(binaryNode(Model.POW,[n,m])):o.push(n);else o.push(newNode(e,[n,r]))}else o.push(newNode(e,[n,r]))}))}else if(e===Model.LOG){o=[];if(isMultiplicative(r)){var u=[];forEach(r.args,(function(r){r.op===Model.POW?u.push(multiplyNode([r.args[1],newNode(Model.LOG,[n,r.args[0]])])):u.push(newNode(e,[n,r]))})),o.push(addNode(u))}else r.op===Model.POW&&o.push(multiplyNode([r.args[1],newNode(Model.LOG,[n,r.args[0]])]))}if(o.length>1)return[multiplyNode(o)];if(1===o.length)return[o[0]];return[r,n]}(e.op,t.pop(),r))})),t.length<2)?r=t[0]:r=binaryNode(e.op,t.reverse());return r},variable:function(e){return e},comma:function(e){var r=[];return forEach(e.args,(function(e){r=r.concat(expand(e))})),newNode(e.op,r)},equals:function(e){var r=[];return forEach(e.args,(function(e){r=r.concat(expand(e))})),newNode(e.op,r)}}),r.location);a!==e.intern(i);)a=e.intern(i),i=expand(i);return i.expandNid=a,R[o]=i,i}function factors(e,r,n,t,a){return assert(e&&e.args,"2000: Internal error."),visit(e,{name:"factors",numeric:function(e){if(n||isInfinity(e))return[e];var r=[];t&&isNeg(e)&&r.push(m);var a=Math.abs(+e.args[0]);return 0!==primeFactors(a).length||isOne(a)?forEach(primeFactors(+e.args[0]),(function(e){r.push(numberNode(e))})):r.push(numberNode(a)),r},additive:function(e){if(!a)return[e];if((e=function factorQuadratic(e){var r,n,t;return(r=isPolynomial(e))&&3===r.length&&1===(n=variables(e)).length&&(t=solveQuadratic(r[2],r[1],r[0]))&&(e=multiplyNode([addNode([variableNode(n[0]),negate(numberNode(t[0]))]),addNode([variableNode(n[0]),negate(numberNode(t[1]))])])),e}(e)).op===Model.MUL)return[e];var r=e.args.slice(0),n=[multiplyNode(factors(r.shift(),{},!0,!0))];return forEach(r,(function(e,r){var t;e=multiplyNode(factors(e,{},!0,!0)),n=commonFactors(t=n.pop(),e).length>0?n.concat(factorTerms(t,e)):n.concat([t,e])})),1===n.length&&n[0].op===Model.MUL?n[0].args:[e]},multiplicative:function(e){switch(e.op){case Model.MUL:case Model.COEFF:case Model.TIMES:var a=[];return forEach(e.args,(function(e){a=a.concat(factors(e,r,n,t))})),a;default:assert(!1,"2000: Node not normalized")}return[e]},unary:function(e){return[e]},exponential:function(e){if(C("dontExpandPowers"))return[e];if(e.op===Model.POW){var r;isNeg(mathValue(binaryNode(Model.POW,e.args.slice(1)),!0))&&(r=!0);var n=[],t=mathValue(e.args[1]),a=Math.abs(toNumber(t));if(a<5||a<10&&!isPolynomial(e.args[0])){for(var o=factors(e.args[0],{},!1,!0,!0),i=0;i<o.length;i++)for(var s=r?newNode(Model.POW,[o[i],m]):o[i],l=a;l>0;l--)n.push(s);return n}return[e]}return e.op===Model.LOG?[e]:void 0},variable:function(e){return[e]},comma:function(e){return[e]},equals:function(e){return[e]}})}function commonFactors(r,n){var t,a=[];forEach([r,n],(function(r){t=factors(r,null,!1,!0);var n=[];forEach(t,(function(r){n.push(e.intern(r))})),a.push(n)}));var o=a.shift();return forEach(a,(function(e){o=filter(o,(function(r){var n=indexOf(e,r);return-1!==n&&(delete e[n],!0)}))})),o}function factorTerms(r,n){var t,a=commonFactors(r,n),o=factors(r,null,!1,!0),i=factors(n,null,!1,!0),s=[],l=[],u=a.slice(0);forEach(o,(function(r){-1===(t=indexOf(u,e.intern(r)))?s.push(r):delete u[t]}));u=a.slice(0);forEach(i,(function(r){-1===(t=indexOf(u,e.intern(r)))?l.push(r):delete u[t]}));var d=[];d=(d=d.concat(makeFactor(s))).concat(makeFactor(l));var c=[];return d.length>0&&c.push(makeTerm(d)),forEach(a,(function(r){c.push(e.node(r))})),makeFactor(c)[0]}function makeFactor(e){return 0===e.length?[c]:1===e.length?e:[multiplyNode(e)]}function makeTerm(e){return assert(e.length>0,"2000: Too few arguments in makeTerm()"),1===e.length?e[0]:addNode(e)}var I={};function solveQuadratic(e,r,n){e=toNumber(e),r=toNumber(r),n=toNumber(n);var t=(-r+Math.sqrt(r*r-4*e*n))/(2*e),a=(-r-Math.sqrt(r*r-4*e*n))/(2*e),o=C("field");return"integer"===o&&t===(0|t)&&a===(0|a)||"real"===o&&r*r-4*e*n>=0||"complex"===o?[t,a]:null}function primeFactors(e){var r=Math.abs(e);if(r<=1||isNaN(e)||isInfinity(e)||isImaginary(e))return[];if(function isPrime(e){if(void 0!==I[e])return I[e];if(e<=1)return I[e]=!1,!1;if(e<=1||e>2&&e%2==0)return I[e]=!1;for(var r=3,n=Math.sqrt(e);r<=n;r+=2)if(e%r==0)return I[e]=!1;return I[e]=!0}(r))return[r];for(var n=Math.sqrt(r),t=2;t<=n;t++)if(e%t==0)return primeFactors(t).concat(primeFactors(r/t))}function gcd(e,r){if(arguments.length>2){var n=[].slice.call(arguments,1);return gcd(e,gcd.apply(n))}var t;for(e=Math.abs(e),r=Math.abs(r);r;)t=e%r,e=r,r=t;return e}forEach([2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97],(function(e){I[e]=!0})),this.normalize=normalize,this.normalizeExpanded=function normalizeExpanded(r){assert(r&&r.args,"2000: Internal error.");var n=e.intern(r);if(r.normalizeExpandedNid===n)return r;for(var t=visit(r,{name:"normalizeExpanded",numeric:function(e){return e},additive:function(e){var r=[];return forEach(e.args,(function(e){r.push(normalizeExpanded(e))})),e.args=r,groupLikes(e)},multiplicative:function(e){var r=[];return forEach(e.args,(function(e){r.push(normalizeExpanded(e))})),e.args=r,flattenNestedNodes(groupLikes(e))},unary:function(e){var r=[];return forEach(e.args,(function(e){r.push(normalizeExpanded(e))})),e.args=r,e},exponential:function(e){var r=[];return forEach(e.args,(function(e){r.push(normalizeExpanded(e))})),e.args=r,e},variable:function(e){return e},comma:function(e){var r=[];return forEach(e.args,(function(e){r.push(normalizeExpanded(e))})),e.args=r,e},equals:function(e){var r=[];return forEach(e.args,(function(e){r.push(normalizeExpanded(e))})),e.args=r,e}});n!==e.intern(t);)n=e.intern(t),t=normalizeExpanded(t);return t.normalizeExpandedNid=n,t},this.normalizeLiteral=function normalizeLiteral(r){assert(r&&r.args,"2000: Internal error.");var n=e.intern(r);if(r.normalizeLiteralNid===n)return r;var t=visit(r,{name:"normalizeLiteral",numeric:function(e){return e},additive:function(e){var r=[],n=e.lbrk&&Model.option("compareGrouping");return forEach(e.args,(function(e){r.push(normalizeLiteral(e))})),Model.option("ignoreOrder")&&e.op===Model.SUB?(assert(2===r.length,"2000: Internal error."),e=addNode([r[0],negate(r[1],!0)])):e=binaryNode(e.op,r),n&&(e=newNode(Model.PAREN,[e])),e},multiplicative:function(e){var r=[],n=e.lbrk&&Model.option("compareGrouping"),t=!n;(forEach(e.args,(function(e){"v1.37"===Model.option("compatibility")?r.push(normalizeLiteral(e)):e.isPolynomial&&r.length>0?r.push(binaryNode(Model.COEFF,[r.pop(),normalizeLiteral(e)],t)):e.isImplicit&&r.length>0?r.push(multiplyNode([r.pop(),normalizeLiteral(e)],t)):r.push(normalizeLiteral(e))})),C("normalizeArithmetic")&&e.op===Model.FRAC)?e=multiplyNode([e.args[0],newNode(Model.POW,[e.args[1],m])]):e=binaryNode(e.op===Model.MUL?Model.TIMES:e.op,r,t);return n&&(e=newNode(Model.PAREN,[e])),e},unary:function(e){var r=[];if(forEach(e.args,(function(e){r.push(normalizeLiteral(e))})),Model.option("ignoreOrder")&&e.op===Model.SUB)return assert(1===r.length,"2000: Internal error."),negate(r[0],!0);switch(e.op){case Model.ADD:return e.args[0];default:return newNode(e.op,r)}},exponential:function(e){var r=[];return forEach(e.args,(function(e){r.push(normalizeLiteral(e))})),e.args=r,e},variable:function(e){return e},comma:function(e){var r=[];return forEach(e.args,(function(e){r.push(normalizeLiteral(e))})),e.args=r,e},equals:function(e){var r=[];if(forEach(e.args,(function(e){r.push(normalizeLiteral(e))})),!C("ignoreOrder")||e.op!==Model.GT&&e.op!==Model.GE&&e.op!==Model.NGTR)e.args=r;else{assert(2===r.length,"2000: Comparisons have only two operands.");var n=r[0];r[0]=r[1],r[1]=n,e.op=e.op===Model.GT?Model.LT:e.op===Model.GE?Model.LE:Model.NLESS,e.args=r}return e}});return t.normalizeLiteralNid=e.intern(t),t},this.normalizeSyntax=function normalizeSyntax(r,n){return Model.options&&Model.options,n&&n.args||(n={args:[]}),assert(r&&r.args,"2000: Internal error."),e.intern(r),Model.create(visit(r,{name:"normalizeSyntax",format:function(e){var r=normalizeFormatObject(e.args[0]);return"\\variable"===r[0].code?variableNode(void 0===r[0].length?"_":"_"+r[0].length):E},numeric:function(e){return n&&n.op===Model.SUB&&1===n.args.length&&n.args[0].op===Model.FORMAT&&(n=n.args[0]),n&&n.op===Model.FORMAT&&checkNumberFormat(n.args[0],e)?E:e},additive:function(e){var r=[];return n&&n.op===Model.FORMAT&&checkNumberFormat(n.args[0],e)?E:(forEach(e.args,(function(e,t){e=normalizeSyntax(e,n.args[t]),r.push(e)})),addNode(r))},multiplicative:function(e){n=flattenNestedMultiplyNodes(n),e=flattenNestedMultiplyNodes(e);var r=[];return n&&n.op===Model.FORMAT&&checkNumberFormat(n.args[0],e)?E:(forEach(e.args,(function(e,t){isMinusOne(e=normalizeSyntax(e,n.args[t]))||r.push(e)})),multiplyNode(r))},unary:function(e){var r=[];switch(forEach(e.args,(function(e,t){r=r.concat(normalizeSyntax(e,n.args[t]))})),e.op){case Model.PERCENT:e=unaryNode(e.op,r);break;case Model.ADD:e=r[0];break;case Model.SUB:if(n&&n.op===Model.FORMAT&&checkNumberFormat(n.args[0],e.args[0]))return E;e=negate(r[0],!0);break;default:e=newNode(e.op,r)}return e},variable:function(e){var r=e.args[0];return variableNode(n&&n.op===Model.FORMAT?function checkVariableFormat(e,r){var n=normalizeFormatObject(e);assert(1===n.length,"2000: Internal error.");var t,a=n[0].code,o=n[0].length;switch(a){case"\\variable":void 0===o?t="_":(t=b[r])||(indexOf(O,"_"+o)<0?(b[r]=t="_"+o,O.push(t)):t=r);break;case"\\integer":case"\\decimal":case"\\number":case"\\scientific":case"\\fraction":case"\\mixedFraction":case"\\mixedNumber":case"\\nonMixedNumber":case"\\fractionOrDecimal":t=r;break;default:assert(!1,message(2015,[a]))}return t}(n.args[0],r):r)},exponential:function(e){var r=[];return forEach(e.args,(function(e,t){e=normalizeSyntax(e,n.args[t]),r.push(e)})),binaryNode(e.op,r)},comma:function(e){var r=[];return forEach(e.args,(function(e,t){r=r.concat(normalizeSyntax(e,n.args[t]))})),e=newNode(e.op,r)},equals:function(e){var r=[];return forEach(e.args,(function(e,t){e=normalizeSyntax(e,n.args[t]),r.push(e)})),binaryNode(e.op,r)}}),r.location)},this.normalizeCalculate=function normalizeCalculate(r){assert(r&&r.args,"2000: Internal error.");var n=e.intern(r);if(r.normalizeCalculateNid===n)return r;for(var t=Model.create(visit(r,{name:"normalizeCalculate",numeric:function(e){return isRepeating(e)||!C("dontConvertDecimalToFraction")&&isDecimal(e)?e=decimalToFraction(e):isNeg(e)&&(e=numberNode(e.args[0])),e},additive:function(e){e.op===Model.SUB?(assert(2===e.args.length,"2000: Internal error."),e=addNode([e.args[0],negate(e.args[1])],!0)):e.op===Model.PM&&(assert(2===e.args.length,"2000: Operator pm can only be used on binary nodes"),e=addNode([e.args[0],unaryNode(Model.PM,[e.args[1]])]));return e.op===Model.MATRIX?e:sort(e=flattenNestedNodes(e))},multiplicative:function(r){assert(r.op!==Model.DIV,"2000: Divsion should be eliminated during parsing"),r.op===Model.FRAC&&(r=multiplyNode([r.args[0],newNode(Model.POW,[r.args[1],m])]));var n,t=[];return forEach(r.args,(function(r){if(r=normalizeCalculate(r),e.intern(r)!==e.intern(c)){if(t.length>0&&isMinusOne(t[t.length-1])){if(isMinusOne(r))return void t.pop();if(isPositiveInfinity(r))return t.pop(),void t.push(M);if(isNegativeInfinity(r))return t.pop(),void t.push(h)}r.op===Model.MUL?t=t.concat(r.args):r.op===Model.PM?(n=!0,t.push(r.args[0])):t.push(r)}})),r=0===t.length?c:1===t.length?t[0]:sort(binaryNode(r.op,t)),n&&(r=unaryNode(Model.PM,[r])),r},unary:function(e){var r=[];switch(forEach(e.args,(function(e){r=r.concat(normalizeCalculate(e))})),(e=newNode(e.op,r)).op){case Model.SUB:e=negate(r[0]);break;case Model.PERCENT:if(r[0].op===Model.NUM)e=numberNode(divide(n=mathValue(r[0]),100));else e=multiplyNode([binaryNode(Model.POW,[numberNode("100"),m]),r[0]]);break;case Model.PM:if(isNeg(mathValue(r[0],!0))){r=e.args.slice(0);e=newNode(e.op,[negate(r.shift())].concat(r))}break;case Model.FACT:var n;e=(n=mathValue(r[0]))?numberNode(factorial(n)):unaryNode(e.op,[r[0]])}return e},variable:function(e){return"i"!==e.args[0]||C("dontSimplifyImaginary")||(e=N),"\\infty"===e.args[0]&&(e=h),e},exponential:function(r){var n=[];switch(r.op){case Model.LOG:e.intern(r.args[0])===e.intern(v)?n.push(v):n.push(normalizeCalculate(r.args[0]));break;case Model.POW:if(isMinusOne(r.args[0])&&.5===toNumber(mathValue(r.args[1],!0)))return N;if(isOne(r.args[0]))return c;if(isMinusOne(r.args[0])&&isMinusOne(r.args[1]))return m;default:n.push(normalizeCalculate(r.args[0]))}return n.push(normalizeCalculate(r.args[1])),binaryNode(r.op,n)},comma:function(e){var r=[];return forEach(e.args,(function(e){r=r.concat(normalizeCalculate(e))})),sort(e=newNode(e.op,r))},equals:function(e){assert(2===e.args.length,message(2006)),assert(isZero(e.args[1]),"2000: Internal error.");var r=isPolynomial(e);assert(2===r.length,"2000: Internal error.");var n=void 0===r[0]?"1":r[0],t=void 0===r[1]?"1":r[1];return fractionNode(negate(numberNode(n)),numberNode(t))}}),r.location);n!==e.intern(t);)n=e.intern(t),t=normalizeCalculate(t);return t.normalizeCalculateNid=n,t},this.degree=degree,this.constantPart=constantPart,this.variables=variables,this.variablePart=variablePart,this.sort=sort,this.sortLiteral=function sortLiteral(r){Assert.checkTimeout(),assert(r&&r.args,"2000: Internal error.");var n,t=e.intern(r);if(r.sortLiteralNid===t)return r;if(void 0!==(n=f[t]))return n;for(var a=t,o=visit(r,{name:"sortLiteral",numeric:function(e){return e},additive:function(r){var n=[];forEach(r.args,(function(e,t){t>0&&r.op===Model.SUB&&(e=negate(e,!0)),n.push(sortLiteral(e))}));var t,a,o=r.op===Model.SUB?Model.ADD:r.op;if((r=binaryNode(o,n,!0)).op===Model.PM||r.op===Model.BACKSLASH)return r;for(var i=0;i<r.args.length-1;i++)t=r.args[i],a=r.args[i+1],e.intern(t)<e.intern(a)&&(r.args[i]=a,r.args[i+1]=t);return r},multiplicative:function(r){var n,t,a=[];if(forEach(r.args,(function(e,r){a.push(sortLiteral(e))})),(r=binaryNode(r.op,a)).op===Model.FRAC||r.op===Model.COEFF)return r;for(var o=0;o<r.args.length-1;o++)n=r.args[o],t=r.args[o+1],e.intern(n)<e.intern(t)&&(r.args[o]=t,r.args[o+1]=n);return r},unary:function(e){var r=[];return e.op===Model.SUB&&(e=negate(e.args[0])),forEach(e.args,(function(e){r=r.concat(sortLiteral(e))})),newNode(e.op,r)},exponential:function(e){var r=[];return forEach(e.args,(function(e,n){r.push(sortLiteral(e))})),e=binaryNode(e.op,r)},variable:function(e){return e},comma:function(e){var r=[];switch(forEach(e.args,(function(e){r.push(sortLiteral(e))})),e.op){case Model.COMMA:r.sort((function(e,r){return(e=JSON.stringify(e))<(r=JSON.stringify(r))?-1:e>r?1:0}))}return newNode(e.op,r)},equals:function(r){if(forEach(r.args,(function(e,n){r.args[n]=sortLiteral(e)})),r.op===Model.COLON||r.op===Model.RIGHTARROW||r.op===Model.GT||r.op===Model.GE||r.op===Model.LT||r.op===Model.LE||r.op===Model.NGTR||r.op===Model.NLESS)return r;for(var n,t,a=0;a<r.args.length-1;a++)n=r.args[a],t=r.args[a+1],e.intern(n)<e.intern(t)&&(r.args[a]=t,r.args[a+1]=n);return r}});t!==e.intern(o);)t=e.intern(o),o=sortLiteral(o);return o.sortLiteralNid=t,f[a]=o,o},this.simplify=simplify,this.expand=expand,this.terms=terms,this.subexprs=function subexprs(e){return assert(e&&e.args,"2000: Internal error."),visit(e,{name:"terms",exponential:function(e){var r=[];return forEach(e.args,(function(e){r=r.concat(subexprs(e))})),r},multiplicative:function(e){var r=[];return forEach(e.args,(function(e){r=r.concat(subexprs(e))})),r},additive:function(e){var r=[];return e.isRepeating?[e]:(forEach(e.args,(function(e){r=r.concat(subexprs(e))})),r)},unary:function(e){var r=[];return forEach(e.args,(function(e){r=r.concat(subexprs(e))})),r},numeric:function(e){return[e]},variable:function(e){return[e]},comma:function(e){var r=[];return forEach(e.args,(function(e){r=r.concat(subexprs(e))})),r},equals:function(e){var r=[];return forEach(e.args,(function(e){r=r.concat(subexprs(e))})),r}})},this.factors=factors,this.isFactorised=function isFactorised(r,n){return assert(r&&r.args,"2000: Internal error."),visit(r,{name:"isFactorised",numeric:function(e){return!0},additive:function(r){if(r.op===Model.PM)return!0;var n,t,a=variables(r),o=terms(normalize(r)),i=[];forEach(o,(function(r){t=factors(r);var n=[];forEach(t,(function(r){n.push(e.intern(r))})),i.push(n)}));var s=i.shift();return forEach(i,(function(e){s=filter(s,(function(r){return-1!=indexOf(e,r)}))})),!(s.length>0)&&(!!((n=isPolynomial(r))&&n.length<3)||(null!==n&&1===variables(r).length?3===n.length?!solveQuadratic(n[2],n[1],n[0]):!function hasRoot(e,r){var n=function findPossibleRoots(e){var r=e[0],n=e[e.length-1],t=primeFactors(r),a=primeFactors(n);t.push(1),t.push(r),a.push(1),a.push(n);var o=[];return forEach(t,(function(e){var r=numberNode(e),n=negate(numberNode(e));forEach(a,(function(e){e=numberNode(e);o.push(fractionNode(r,e)),o.push(fractionNode(n,e))}))})),o}(r),t=C("field");return some(n,(function(r){r=toNumber(mathValue(r,!0));var n=variables(e);assert(1===n.length,"2000: Internal error.");var a={};return a[n[0]]={type:"const",value:r},0===toNumber(mathValue(e,a,!0))&&("integer"===t&&r===(0|r)||"real"===t)}))}(r,n):(some(o,(function(e){degree(e,!0)!==Number.POSITIVE_INFINITY||assert(!1,message(2003))}))||some(o,(function(e){var r=degree(e,!0);if(r>=0&&r<2)return!0}))||assert(a.length<2,message(2001)),!0)))},multiplicative:function(e){switch(e.op){case Model.MUL:return every(e.args,(function(e){return isFactorised(e)}));default:assert(!1,"2000: isFactorised(): node not normalized")}return!1},unary:function(e){return!0},exponential:function(e){return!0},variable:function(e){return!0},comma:function(e){return every(e.args,(function(e){return isFactorised(e)}))},equals:function(e){return every(e.args,(function(e){return isFactorised(e)}))}})},this.isExpanded=function isExpanded(e){return Model.create(e).isExpanded()},this.mathValue=mathValue,this.units=units,this.scale=function scale(e){return assert(e&&e.args,"2000: Internal error."),Model.create(visit(e,{name:"scale",exponential:function(e){var r,n;if((r=mathValue(e,!0))&&(n=numberNode(String(r),!0)))return n;if(function isHyperbolicSecant(e){return e.op===Model.POW&&e.args.length>1&&e.args[0].op===Model.COSH&&isMinusOne(e.args[1])}(e)){var t=e.args[0].args[0],a=binaryNode(Model.POW,[v,t]),o=binaryNode(Model.POW,[v,negate(t)]);e=scale(expand(normalize(simplify(expand(normalize(e=fractionNode(p,addNode([a,o]))))))))}else if(function isHyperbolicCosecant(e){return e.op===Model.POW&&e.args.length>1&&e.args[0].op===Model.SINH&&isMinusOne(e.args[1])}(e)){t=e.args[0].args[0],a=binaryNode(Model.POW,[v,t]),o=binaryNode(Model.POW,[v,negate(t)]);e=scale(expand(normalize(simplify(expand(normalize(e=fractionNode(p,addNode([a,negate(o)]))))))))}var i=[];return forEach(e.args,(function(e){i.push(scale(e))})),newNode(e.op,i)},multiplicative:function(e){var r,n;if((r=mathValue(e,!0))&&(n=numberNode(String(r),!0)))return n;if(function isHyperbolicTangent(e){return e.op===Model.MUL&&e.args.length>1&&e.args[0].op===Model.SINH&&e.args[1].op===Model.POW&&e.args[1].args[0].op===Model.COSH&&isMinusOne(e.args[1].args[1])}(e)){var t=e.args[0].args[0],o=binaryNode(Model.POW,[v,t]),i=binaryNode(Model.POW,[v,negate(t)]);return e=scale(expand(normalize(simplify(expand(normalize(e=fractionNode(addNode([o,negate(i)]),addNode([o,i]))))))))}if(function isHyperbolicCotangent(e){return e.op===Model.MUL&&e.args.length>1&&e.args[0].op===Model.COSH&&e.args[1].op===Model.POW&&e.args[1].args[0].op===Model.SINH&&isMinusOne(e.args[1].args[1])}(e)){t=e.args[0].args[0];return e=scale(expand(normalize(simplify(expand(normalize(e=fractionNode(addNode([o=binaryNode(Model.POW,[v,t]),i=binaryNode(Model.POW,[v,negate(t)])]),addNode([o,negate(i)]))))))))}var s,l=[],u=a;return forEach(e.args,(function(e){(r=mathValue(multiplyNode([numberNode(u),e]),!0))?u=r:l.push(scale(e))})),isOne(s=numberNode(u,!0))||l.unshift(s),e=multiplyNode(l),(r=mathValue(e,!0))&&(n=numberNode(String(r),!0))?n:e},additive:function(e){var r,n;if((r=mathValue(e,!0))&&(n=numberNode(String(r),!0)))return n;var a=[],o=t;return forEach(e.args,(function(e){(r=mathValue(addNode([numberNode(o),e]),!0))?o=r:a.push(scale(e))})),isZero(o)||a.unshift(numberNode(o,!0)),e=1===a.length?a[0]:addNode(a),(r=mathValue(e,!0))&&(n=numberNode(String(r),!0))?n:sort(e)},unary:function(e){var r;if(r=mathValue(e,!0))return numberNode(r,!0);var n=[];switch(forEach(e.args,(function(e){n.push(scale(e))})),e.op){case Model.SINH:var t=n[0];e=scale(expand(normalize(simplify(expand(normalize(e=addNode([fractionNode(binaryNode(Model.POW,[v,t]),p),fractionNode(negate(binaryNode(Model.POW,[v,negate(t)])),p)])))))));break;case Model.COSH:t=n[0];e=scale(expand(normalize(simplify(expand(normalize(e=addNode([fractionNode(binaryNode(Model.POW,[v,t]),p),fractionNode(binaryNode(Model.POW,[v,negate(t)]),p)])))))));break;default:e=newNode(e.op,n)}return e},numeric:function(e){return isUndefined(e)?e:numberNode(e.args[0],!0)},variable:function(e){var r;return(r=Model.env[e.args[0]])&&("unit"===r.type?"\\radian"===r.base?e=numberNode(r.value):1!==r.value&&(e=multiplyNode([numberNode(r.value,!0),variableNode(r.base)])):"const"===r.type&&(e=numberNode(r.value,!0))),e},comma:function(e){var r=[];return forEach(e.args,(function(e){r.push(scale(e))})),newNode(e.op,r)},equals:function(e){var r,n=[];if(e.op!==Model.EQL&&e.op!==Model.APPROX||!((r=isPolynomial(e.args[0]))&&r[r.length-1]<0||!r&&sign(e.args[0])<0)||(e.args[0]=simplify(expand(negate(e.args[0])))),isComparison(e.op)){n=[];var t,a=e.args[0];isPolynomial(a)&&isAdditive(a)&&!isOne(abs(leadingCoeff(a)))&&(forEach(a.args,(function(e,r){if(0===r){t=constantPart(e);var a=variablePart(e);a&&n.push(a)}else assert(t,"2000: Internal error."),n.push(fractionNode(e,t))})),e.args[0]=newNode(Model.ADD,[multiplyNode([t,addNode(n)])]))}return n=[],forEach(e.args,(function(e){n.push(scale(e))})),newNode(e.op,n)}}),e.location)},this.hasLikeFactors=function hasLikeFactors(r){if(!isMultiplicative(r))return!1;var n,t={};return some(r.args,(function(r){return!(r.op!==Model.MUL||!hasLikeFactors(r))||(n=isMinusOne(r)&&e.intern(r)||r.op===Model.NUM&&(mathValue(r,!0)?"0":e.intern(r))||r.op===Model.POW&&(mathValue(r.args[1])&&!!variablePart(r.args[0])&&e.intern(variablePart(r.args[0]))||!!constantPart(r.args[0])&&mathValue(r.args[1]))||!!variablePart(r)&&e.intern(variablePart(r)),!!t[n]||(t[n]=!0,!1))}))},this.hasLikeFactorsOrTerms=function hasLikeFactorsOrTerms(r){if(!isMultiplicative(r)&&!isAdditive(r)||r.isRepeating||r.isMixedNumber)return!1;var n,t={};return some(r.args,(function(r){return r.op===Model.MUL&&isNeg(r)&&(r=negate(r)),!(r.op!==Model.ADD&&r.op!==Model.MUL||!hasLikeFactorsOrTerms(r))||(n=isMinusOne(r)&&e.intern(r)||(r.op===Model.NUM&&mathValue(r,!0)?"0":!!variablePart(r)&&e.intern(variablePart(r))||e.intern(r)),!!t[n]||(t[n]=!0,!1))}))},this.factorGroupingKey=factorGroupingKey,this.hint=function hint(e){return assert(e&&e.args,"2000: Internal error."),visit(e,{name:"hints",exponential:function(e){var r=[];return e.hints instanceof Array&&(r=r.concat(e.hints)),forEach(e.args,(function(e){r=r.concat(hint(e))})),e.args[1].lbrk||r.push(message(2016)),r},multiplicative:function(e){var r=[];return e.hints instanceof Array&&(r=r.concat(e.hints)),forEach(e.args,(function(e){r=r.concat(hint(e))})),r},additive:function(e){var r=[];return e.hints instanceof Array&&(r=r.concat(e.hints)),forEach(e.args,(function(e){r=r.concat(hint(e))})),r},unary:function(e){var r=[];return e.hints instanceof Array&&(r=r.concat(e.hints)),forEach(e.args,(function(e){r=r.concat(hint(e))})),r},numeric:function(e){var r=[];return e.hints instanceof Array&&(r=r.concat(e.hints)),r},variable:function(e){var r=[];return e.hints instanceof Array&&(r=r.concat(e.hints)),r},comma:function(e){var r=[];return e.hints instanceof Array&&(r=r.concat(e.hints)),forEach(e.args,(function(e){r=r.concat(hint(e))})),r},equals:function(e){var r=[];return e.hints instanceof Array&&(r=r.concat(e.hints)),forEach(e.args,(function(e){r=r.concat(hint(e))})),r}})},this.eraseCommonExpressions=function eraseCommonExpressions(r,n){if(r=factorCommonExpressions(r),n=factorCommonExpressions(n),r=cancelFactors(r),n=cancelFactors(n),r.op===n.op&&r.op===Model.POW&&2===r.args.length&&2===n.args.length&&e.intern(r.args[1])===e.intern(n.args[1])&&null===mathValue(r.args[1],!0)&&(r=r.args[0],n=n.args[0]),r.op!==n.op||r.op!==Model.MUL)return[r,n];var t=!1,o={},i={};forEach(r.args,(function(r,n){var t=mathValue(r,!0),a=null!==t?String(t):r.op===Model.POW&&mathValue(r.args[1])?"nid$"+e.intern(r.args[0]):"nid$"+e.intern(r);o[a]||(o[a]=[]),o[a].push(r)})),forEach(n.args,(function(r,n){var t=mathValue(r,!0),a=null!==t?String(t):r.op===Model.POW&&mathValue(r.args[1])?"nid$"+e.intern(r.args[0]):"nid$"+e.intern(r);i[a]||(i[a]=[]),i[a].push(r)}));var s=keys(o),l=keys(i);if(0===s.length||0===l.length||1===l.length&&"-1"===l[0])return[r,n];if(forEach(s,(function(e){if(isNaN(+e)){var r=o[e],n=i[e];if(n){for(;r.length>0&&n.length>0;){var s=r.pop(),l=n.pop(),u=s.op===Model.POW&&mathValue(s.args[1])?mathValue(s.args[1],!0):a,d=l.op===Model.POW&&mathValue(l.args[1])?mathValue(l.args[1],!0):a;if(isLessThan(u,d)){var c=d.subtract(u),p=s.op===Model.POW&&mathValue(s.args[1],!0)?s.args[0]:s;n.push(isOne(c)?p:newNode(Model.POW,[p,numberNode(c)]))}else{c=u.subtract(d),p=s.op===Model.POW&&mathValue(s.args[1],!0)?s.args[0]:s;isZero(c)||r.push(isOne(c)?p:newNode(Model.POW,[p,numberNode(c)]))}}t=!0}}})),!t)return[cancelFactors(r),cancelFactors(n)];var u=[];return forEach(s,(function(e){u=u.concat(o[e])})),0===u.length?r=c:1===u.length?(u.push(c),r=newNode(r.op,u)):r=newNode(r.op,u),u=[],forEach(l,(function(e){u=u.concat(i[e])})),0===u.length?n=c:1===u.length?(u.push(c),n=newNode(n.op,u)):n=newNode(n.op,u),[cancelFactors(r),cancelFactors(n)]}}function degree(e,r){return n.degree(e,r)}function constantPart(e){return n.constantPart(e)}function variables(e){return n.variables(e)}function variablePart(e){return n.variablePart(e)}function sortLiteral(r){var n=new Visitor(e),t=Assert.location;r.location&&Assert.setLocation(r.location);var a=n.sortLiteral(r);return Assert.setLocation(t),a}function normalize(r){var n=new Visitor(e),t=Assert.location;r.location&&Assert.setLocation(r.location);var a=n.normalize(r);return Assert.setLocation(t),a}function normalizeLiteral(e){var r=Assert.location;e.location&&Assert.setLocation(e.location);var t=n.normalizeLiteral(e);return Assert.setLocation(r),t}function normalizeSyntax(e,r){var t=Assert.location;e.location&&Assert.setLocation(e.location);var a=n.normalizeSyntax(e,r);return Assert.setLocation(t),a}function mathValue(e,r,t,a){var o=Assert.location;e.location&&Assert.setLocation(e.location);var i=n.mathValue(e,r,t,a);return Assert.setLocation(o),i}function units(e,r){var t=Assert.location;e.location&&Assert.setLocation(e.location);var a=n.units(e,r);return Assert.setLocation(t),a}function simplify(r,n){var t=new Visitor(e),a=Assert.location;r.location&&Assert.setLocation(r.location);var o=t.simplify(r,n);return Assert.setLocation(a),o}function hasLikeFactorsOrTerms(e,r){var t=Assert.location;e.location&&Assert.setLocation(e.location);var a=n.hasLikeFactorsOrTerms(e,r);return Assert.setLocation(t),a}function expand(r,n){var t=new Visitor(e),a=Assert.location;r.location&&Assert.setLocation(r.location);var o=t.expand(r,n);return Assert.setLocation(a),o}function terms(e,r){var t=Assert.location;e.location&&Assert.setLocation(e.location);var a=n.terms(e,r);return Assert.setLocation(t),a}function subexprs(e,r){var t=Assert.location;e.location&&Assert.setLocation(e.location);var a=n.subexprs(e,r);return Assert.setLocation(t),a}function factors(e,r){var t=Assert.location;e.location&&Assert.setLocation(e.location);var a=n.factors(e,r);return Assert.setLocation(t),a}function isFactorised(e,r){var t=Assert.location;e.location&&Assert.setLocation(e.location);var a=n.isFactorised(e,r);return Assert.setLocation(t),a}function scale(e){var r=Assert.location;e.location&&Assert.setLocation(e.location);var t=n.scale(e);return Assert.setLocation(r),t}function eraseCommonExpressions(e,r){return n.eraseCommonExpressions(e,r)}E.is_normal=!0;var x=Model.env;function distributeUnits(e,r){var n=units(e),t=units(r);assert(n.length<2,message(2004)),assert(t.length<2,message(2004));var a,o,i=n[0],s=t[0];return void 0===i&&void 0!==s?(a=multiplyNode([e,variableNode(s.args[0])]),o=r):void 0===s&&void 0!==i?(a=e,o=multiplyNode([r,variableNode(i.args[0])])):(a=e,o=r),[a,o]}function formulaKind(e){var r;switch(e.op){case Model.EQL:r=Model.EQL;break;case Model.GE:case Model.LE:case Model.GT:case Model.LT:case Model.NGTR:case Model.NLESS:r=Model.GE;break;default:r=0}return r}function isAggregate(e){return e.op===Model.COMMA||e.op===Model.LIST||e.op===Model.MATRIX||e.op===Model.INTERVAL||e.op!==Model.NUM&&e.op!==Model.VAR&&some(e.args,(function(e){return isAggregate(e)}))}function isComparison(e){return e===Model.LT||e===Model.LE||e===Model.GT||e===Model.GE||e===Model.NE||e===Model.NGTR||e===Model.NLESS||e===Model.APPROX||e===Model.EQL}function getRE(e){return"string"==typeof e&&("latex"===e?e=/^[\\]/:"not latex"===e?e=/^[^\\]/:assert(!1,"2000: Expecting 'latex' or 'not latex'")),e}Model.fn.equivValue=function equivValue(r,n,a){var o,i,s,l,u=Model.options=Model.options?Model.options:{},d=Model.env,c=C("inverseResult"),p=t,g=t,m=[];if(isComparison(r.op)&&isComparison(n.op)){(r.op===(a=Model.LT)&&n.op===Model.GT||r.op===(a=Model.GT)&&n.op===Model.LT||r.op===(a=Model.LE)&&n.op===Model.GE||r.op===(a=Model.GE)&&n.op===Model.LE||r.op===(a=Model.NGTR)&&n.op===Model.NLESS||r.op===(a=Model.NLESS)&&n.op===Model.NGTR)&&(n=newNode(a,n.args.reverse()));var f=r.args[0],h=r.args[1],M=n.args[0],N=n.args[1];if(C("compareSides")){if(r.op!==n.op)return!1;var v=equivValue(f,M),y=equivValue(h,N),b=v&&y}else var b=(v=Model.create(f).equivValue(h,r.op))===(y=Model.create(M).equivValue(N,n.op));return c?!b:b}if(r.op===Model.PM&&r.args.length>1){m=distributeUnits(r.args[0],r.args[1]);r=binaryNode(Model.PM,m)}if(n.op===Model.PM&&n.args.length>1){m=distributeUnits(n.args[0],n.args[1]);n=binaryNode(Model.PM,m)}if(r.op===Model.PM&&r.args.length>1){o=simplify(expand(normalize(r.args[0]))),s=simplify(expand(normalize(r.args[1])));v=mathValue(o,d,!0,!0),p=mathValue(s,d,!0,!0)}else(v=mathValue(r=normalize(r),!0))?o=scale(r):v=mathValue(o=simplify(expand(r)),!0,!0);if(n.op===Model.PM&&n.args.length>1){i=simplify(expand(normalize(n.args[0]))),l=simplify(expand(normalize(n.args[1])));y=mathValue(i,d,!0,!0),g=mathValue(l,d,!0,!0)}else(y=mathValue(n=normalize(n),!0))?i=scale(n):y=mathValue(i=simplify(expand(n)),!0,!0);if(isUndefined(o)||isUndefined(i))return b=!1,c?!b:b;if(o.op===Model.COMMA&&i.op===Model.COMMA||o.op===Model.LIST&&i.op===Model.LIST)return assert(void 0===s&&void 0===l,message(2007)),b=!!((b=every(o.args,(function(e,r){return equivValue(o.args[r],i.args[r])})))&&o.lbrk===i.lbrk||o.rbrk===i.rbrk),c?!b:b;var O=variablePart(o),E=variablePart(i);if(!s&&!l&&O&&E&&e.intern(O)===e.intern(E)&&(o=constantPart(o),i=constantPart(i),void 0===o&&void 0===i))return b=!0,c?!b:b;if(e.intern(o)===e.intern(i)&&void 0===s&&void 0===l&&(void 0===a||function isEqualsComparison(e){return e===Model.LE||e===Model.GE||e===Model.EQL}(a)))return b=!0,c?!b:b;if(o.op===Model.LIST&&i.op===Model.LIST){if(assert(void 0===s&&void 0===l,message(2007)),o.lbrk!==i.lbrk||o.rbrk!==i.rbrk)return!1;var x=o.args,A=i.args;return every(x,(function(e,r){var n=equivValue(e,A[r]);return c?!n:n}))}v=mathValue(o,d,!0,!0),y=mathValue(i,d,!0,!0);if(assert(null!==v||isComparison(o.op),message(2005),"spec"),assert(o.op!==Model.PM||null!==p,message(2005),"spec"),assert(null!==y||isComparison(i.op),message(2005),"user"),assert(i.op!==Model.PM||null!==g,message(2005),"user"),Assert.clearLocation(),null!==v&&null!==y&&function checkUnits(e,r){var n=units(e),t=units(r);if(0===n.length||0===t.length)return n.length===t.length;var a=degree(n[0]),o=degree(t[0]);return a===o}(o,i)){y=baseUnitConversion(o,i)(y),isZero(g)||(g=baseUnitConversion(o,i)(g));var S=null!=u.decimalPlaces?+u.decimalPlaces:10;if(v=v.setScale(S,BigDecimal.ROUND_HALF_UP),y=y.setScale(S,BigDecimal.ROUND_HALF_UP),Model.options=u,isZero(p)&&isZero(g)){var R=v.compareTo(y);switch(a){case Model.LT:b=R<0;break;case Model.LE:b=R<=0;break;case Model.GT:b=R>0;break;case Model.GE:b=R>=0;break;default:b=0===R}return c?!b:b}p=p.setScale(S,BigDecimal.ROUND_HALF_UP),g=g.setScale(S,BigDecimal.ROUND_HALF_UP);var I=v.subtract(p),D=y.subtract(g),T=v.add(p),L=y.add(g);if(I.compareTo(D)>=0&&T.compareTo(D)<=0||I.compareTo(L)>=0&&T.compareTo(L)<=0||D.compareTo(I)>=0&&L.compareTo(T)<=0||D.compareTo(T)>=0&&L.compareTo(T)<=0)return b=!0,c?!b:b}b=!1;return c?!b:b;function baseUnit(e){var r=Model.env,n=Assert.location;e.location&&Assert.setLocation(e.location);var t=units(e,r),a=[];return forEach(t,(function(e){var n;e.op===Model.POW?(assert(e.args[0].op===Model.VAR,"2000: Internal error."),n=r[e.args[0].args[0]]):(assert(e.op===Model.VAR,"2000: Internal error."),n=r[e.args[0]]),assert(n&&"unit"===n.type,"2000: Internal error."),indexOf(a,n.base)<0&&a.push(n.base)})),Assert.setLocation(n),assert(a.length<2,message(2017,[a])),a[0]}function baseUnitConversion(e,r){Math.NaN;var n={"g/lb":function(e){return e.multiply(toDecimal("453.592"))},"lb/g":function(e){return e.multiply(toDecimal("0.00220462"))},"m/ft":function(e){return e.multiply(toDecimal("0.3048"))},"ft/m":function(e){return e.multiply(toDecimal("3.28084"))},"L/fl":function(e){return e.multiply(toDecimal("0.02957353"))},"fl/L":function(e){return e.multiply(toDecimal("33.814022702"))},"\\degree K/\\degree C":function(e){return e.add(toDecimal("273.15"))},"\\degree C/\\degree K":function(e){return e.subtract(toDecimal("273.15"))},"\\degree C/\\degree F":function(e){return e.subtract(toDecimal("32")).multiply(toDecimal("5")).divide(toDecimal("9"))},"\\degree F/\\degree C":function(e){return e.multiply(toDecimal("9")).divide(toDecimal("5")).add(toDecimal("32"))},"\\degree K/\\degree F":function(e){return e.add(toDecimal("459.67")).multiply(toDecimal("5")).divide(toDecimal("9"))},"\\degree F/\\degree K":function(e){return e.multiply(toDecimal("9")).divide(toDecimal("5")).subtract(toDecimal("459.67"))}},t=baseUnit(e),a=baseUnit(r);return t===a?function(e){return e}:n[t+"/"+a]}},Model.fn.equivSyntax=function(r,n){!function reset(){b={},O=[]}();C("ignoreOrder");var t,a=C("inverseResult"),o=Model.options?Model.options:{};r instanceof Array||(r=[r]),t=some(r,(function(r){try{o.is_normal=!0;var t=normalizeSyntax(r,r);delete o.is_normal}catch(e){throw e}var a=normalizeSyntax(n,r);return e.intern(t)===e.intern(a)}));return delete o.is_normal,o.not&&("NOT ",delete o.not),a?!t:t},Model.fn.equivLiteral=function equivLiteral(r,n){var t=C("inverseResult");if(!(terms(r).length===terms(n).length||r.op===Model.MUL&&isMinusOne(r.args[0])||n.op===Model.MUL&&isMinusOne(n.args[0])||r.op===Model.SUB&&1===r.args.length||n.op===Model.SUB&&1===n.args.length))return!!t;r=normalizeLiteral(r),n=normalizeLiteral(n),C("normalizeArithmetic")&&(C("equivLiteral",!0),r=expand(normalize(r)),n=expand(normalize(n)),C("equivLiteral",void 0)),C("ignoreOrder")&&(r=sortLiteral(r),n=sortLiteral(n));var a=e.intern(r)===e.intern(n);return t?!a:a},Model.fn.equivSymbolic=function equivSymbolic(r,n){var t=C("inverseResult"),a=C("strict");if(!t&&!a){var o=JSON.parse(JSON.stringify(r)),i=JSON.parse(JSON.stringify(n)),s=C("ignoreOrder",!1);try{var l=Model.fn.equivLiteral(r,n);C("ignoreOrder",s)}catch(e){throw C("ignoreOrder",s),e}if(l)return!0;r=o,n=i}if(isComparison(r.op)&&r.op===n.op){var u,c=r.args[0],p=r.args[1],g=n.args[0],m=n.args[1],f=e.intern(c),h=e.intern(p),M=e.intern(g),N=e.intern(m);c.op===Model.VAR&&g.op===Model.VAR&&f===M?(p.op!==Model.NUM&&(u=mathValue(normalize(p),!0))&&(r=newNode(r.op,[c,numberNode(u,!0)])),m.op!==Model.NUM&&(u=mathValue(normalize(m),!0))&&(n=newNode(n.op,[g,numberNode(u,!0)]))):c.op===Model.VAR&&m.op===Model.VAR&&f===N?(p.op!==Model.NUM&&(u=mathValue(normalize(p),!0))&&(r=newNode(r.op,[c,numberNode(u,!0)])),g.op!==Model.NUM&&(u=mathValue(normalize(g),!0))&&(n=newNode(n.op,[numberNode(u,!0),m]))):p.op===Model.VAR&&g.op===Model.VAR&&h===M?(c.op!==Model.NUM&&(u=mathValue(normalize(c),!0))&&(r=newNode(r.op,[numberNode(u,!0),p])),m.op!==Model.NUM&&(u=mathValue(normalize(m),!0))&&(n=newNode(n.op,[g,numberNode(u,!0)]))):p.op===Model.VAR&&m.op===Model.VAR&&h===N&&(c.op!==Model.NUM&&(u=mathValue(normalize(c),!0))&&(r=newNode(r.op,[numberNode(u,!0),p])),g.op!==Model.NUM&&(u=mathValue(normalize(g),!0))&&(n=newNode(n.op,[numberNode(u,!0),m])))}if(formulaKind(r)!==formulaKind(n))l=!1;else if(C("compareSides")&&isComparison(r.op)&&isComparison(n.op)){var v;if((r.op===(v=Model.LT)&&n.op===Model.GT||r.op===(v=Model.GT)&&n.op===Model.LT||r.op===(v=Model.LE)&&n.op===Model.GE||r.op===(v=Model.GE)&&n.op===Model.LE||r.op===(v=Model.NGTR)&&n.op===Model.NLESS||r.op===(v=Model.NLESS)&&n.op===Model.NGTR)&&(n=newNode(v,n.args.reverse())),r.op===n.op){var y=r.args[0],b=r.args[1],O=n.args[0],E=n.args[1];y=(S=eraseCommonExpressions(normalize(y),normalize(O)))[0],O=S[1],b=(S=eraseCommonExpressions(normalize(b),normalize(E)))[0],E=S[1],C("inverseResult",!1),C("strict",!0);var x=equivSymbolic(Model.create(y),Model.create(O)),A=equivSymbolic(Model.create(b),Model.create(E));C("strict",a),C("inverseResult",t),l=x&&A}else l=!1}else{var S;o=r=(S=eraseCommonExpressions(normalize(r),normalize(n)))[0],i=n=S[1];mathValue(r,!0)&&mathValue(n,!0)?(r=scale(r),n=scale(n)):(r=scale(expand(normalize(simplify(expand(normalize(r)))))),n=scale(expand(normalize(simplify(expand(normalize(n)))))));var R=e.intern(r),I=e.intern(n);(l=R===I)||t||(isComparison(r.op)?(r=scale(normalize(simplify(expand(normalize(r))))),n=scale(normalize(simplify(expand(normalize(n))))),l=(R=e.intern(r))===(I=e.intern(n))):isComparison(n.op)||isAggregate(r)||isAggregate(n)||(r=addNode([o,negate(i)]),n=d,r=scale(normalize(simplify(expand(normalize(r))))),n=scale(normalize(simplify(expand(normalize(n))))),l=(R=e.intern(r))===(I=e.intern(n))))}return l?!t:!!t},Model.fn.isTrue=function(e){var r,n=Assert.location;if(e.location&&Assert.setLocation(e.location),isComparison(e.op)){try{r=Model.create(e.args[0]).equivValue(e.args[1],e.op)}catch(e){r=!1}return Assert.setLocation(n),r}var t=mathValue(e);return r=!(!t||isZero(t)),Assert.setLocation(n),C("inverseResult")?!r:r},Model.fn.calculate=function(e){var r,t=Assert.location;if(e.location&&Assert.setLocation(e.location),mathValue(e=normalize(e),!0,!0))r=scale(e);else{var a=Model.option("decimalPlaces",20);r=function normalizeCalculate(e){return n.normalizeCalculate(e)}(scale(expand(normalize(simplify(expand(e)))))),Model.option("decimalPlaces",a),r=scale(r)}var o=function stripTrailingZeros(e){if(e.op!==Model.NUM){var r=mathValue(e,!0);if(!r)return e;e=newNode(Model.NUM,[String(r)])}for(var n,t=e.args[0],a=0;a<t.length;a++){var o=t.charCodeAt(a);if(46===o)n=a;else if((o<48||o>57)&&45!==o)return e}if(void 0!==n){for(a=t.length-1;a>n&&48===t.charCodeAt(a);a--)t=t.substring(0,a);46===t.charCodeAt(t.length-1)&&(t=t.substring(0,t.length-1))}return t}(scale(numberNode(mathValue(r,Model.env,!0,!0))));return Assert.setLocation(t),o},Model.fn.isExpanded=function isExpanded(r){var t,a,o,i,s,l=C("inverseResult"),u=C("dontConvertDecimalToFraction",!0);if(r.op===Model.COMMA)s=every(r.args,(function(e){return isExpanded(e)}));else if(isComparison(r.op)){l=C("inverseResult",!1);s=isExpanded(r.args[0])&&isExpanded(r.args[1]),C("inverseResult",l)}else if(isAdditive(r)){r=flattenNestedNodes(normalize(r));l=C("inverseResult",!1);s=every(r.args,(function(e){return isExpanded(e)}))&&!hasLikeFactorsOrTerms(normalize(r))}else{var d=C("dontExpandPowers",!0),c=C("dontFactorDenominators",!0),p=C("dontFactorTerms",!0),g=(u=C("dontConvertDecimalToFraction",!0),C("dontSimplifyImaginary",!0));t=r=flattenNestedNodes(normalize(r)),a=function normalizeExpanded(e){var r=Assert.location;e.location&&Assert.setLocation(e.location);var t=n.normalizeExpanded(e);return Assert.setLocation(r),t}(normalize(expand(normalize(r)))),o=e.intern(t),i=e.intern(a),C("dontExpandPowers",d),C("dontFactorDenominators",c),C("dontFactorTerms",p),C("dontConvertDecimalToFraction",u),C("dontSimplifyImaginary",g),s=!(o!==i||hasLikeFactorsOrTerms(t)||r.op===Model.POW&&isAdditive(r.args[0])&&isPolynomial(r))}return C("dontConvertDecimalToFraction",u),l?!s:s},Model.fn.isSimplified=function isSimplified(r){var t,a,o,i,s,l=C("dontFactorDenominators",!0),u=C("dontFactorTerms",!0),d=C("dontConvertDecimalToFraction",!0),c=C("dontSimplifyImaginary",!0),p=C("inverseResult");if(r.op===Model.COMMA)s=every(r.args,(function(e){return isSimplified(e)}));else if(!isComparison(r.op)||isZero(r.args[0])||isZero(r.args[1])){var g;if(isNeg(r=normalize(r))&&(!(g=variablePart(r))||g.op!==Model.ADD)){var m=r.isMixedNumber;(r=negate(r)).isMixedNumber=m}if(t=r,a=normalize(simplify(expand(r))),o=e.intern(t),i=e.intern(a),C("inverseResult",!1),C("ignoreOrder",!0),Model.option("notSimplified"))return p;s=o===i||!(subexprs(a)<subexprs(t))&&(!mathValue(r,!0)&&(isAdditive(r)||isMultiplicative(r))&&(!function hasLikeFactors(e,r){var t=Assert.location;e.location&&Assert.setLocation(e.location);var a=n.hasLikeFactors(e,r);return Assert.setLocation(t),a}(r)&&isFactorised(r)||!hasLikeFactorsOrTerms(r)&&function isExpanded(e,r){var t=Assert.location;e.location&&Assert.setLocation(e.location);var a=n.isExpanded(e,r);return Assert.setLocation(t),a}(r))||r.op===Model.POW&&e.intern(function squareRoot(r,n){if(n.op!==Model.POW||!isNeg(n.args[1])||!isInteger(n.args[0]))return newNode(Model.POW,[r,n]);var t,a=+n.args[0].args[0];if(C("dontExpandPowers")||r.op!==Model.NUM){if(r.op!==Model.MUL)return sqrtNode(r,a);t=r.args}else t=factors(r,{});var o,i,s={};forEach(t,(function(r){o=e.intern(r),(i=s[o]?s[o]:s[o]=[]).push(r)}));var l=[],u=[];return forEach(keys(s),(function(e){if((i=s[e]).length>=a){for(;i.length>=a;)u.push(i[0]),i=i.slice(a);l=l.concat(i)}else l=l.concat(i)})),l.length>0&&(u=u.concat(sqrtNode(simplify(multiplyNode(l)),a))),multiplyNode(u)}(constantPart(r.args[0]),r.args[1]))===e.intern(newNode(Model.POW,[constantPart(r.args[0]),r.args[1]])))||function equivLiteralIgnoreOrder(e,r){var n=Model.option("ignoreOrder",!0),t=Model.fn.equivLiteral(e,r);return Model.option("ignoreOrder",n),t}(t,a)}else{t=normalize(addNode([r.args[0],r.args[1]])),s=!0;p=C("inverseResult",!1);isSimplified(t)||(s=!1),C("inverseResult",p),s&&function hasDenominator(e){var r=terms(e);return some(r,(function(e){if(variablePart(e)){var r=factors(e);return some(r,(function(e){return e.op===Model.POW&&isNeg(e.args[1])}))}return!1}))}(t)&&(s=!1),s&&!isFactorised(t)&&(s=!1)}return C("dontFactorDenominators",l),C("dontFactorTerms",u),C("dontConvertDecimalToFraction",d),C("dontSimplifyImaginary",c),C("inverseResult",p),s&&t&&hasLikeFactorsOrTerms(t)?!!p:p?!s:s},Model.fn.isFactorised=function(e){var r=C("inverseResult"),n=C("dontConvertDecimalToFraction",!0),t=isFactorised(normalize(e));return C("dontConvertDecimalToFraction",n),r?!t:t},Model.fn.isUnit=function(r,n){var t=C("inverseResult"),a=units(normalize(r),x),o=units(normalize(n),x);o instanceof Array||(o=[o]);var i=!1;return 0===a.length&&0===o.length&&n.op!==Model.NONE?i=!0:o.length&&(i=every(o,(function(r){return some(a,(function(n){return e.intern(r)===e.intern(n)}))}))),t?!i:i},Model.fn.variables=function(e,r){var n=variables(e),t=[],a=getRE(r);return forEach(n,(function(e){a&&!a.test(e)||t.push(e)})),t},Model.fn.known=function(e,r){var n=e.env?e.env:[],t=variables(e),a=getRE(r),o=[];return forEach(t,(function(e){!n[e]||a&&!a.test(e)||o.push(e)})),o},Model.fn.unknown=function(e,r){var n=e.env?e.env:[],t=variables(e),a=getRE(r),o=[];return forEach(t,(function(e){n[e]||a&&!a.test(e)||o.push(e)})),o},Model.fn.hint=function(e){return function hint(e){return n.hint(e)}(e)};var C=Model.option=function option(e,r){var n=Model.options,t=n&&n[e];if(arguments.length>1&&(Model.options=n=n||{},void 0===r?delete n[e]:n[e]=r),void 0===t)switch(e){case"field":t="integer";break;case"decimalPlaces":t=10;break;case"setThousandsSeparator":case"setDecimalSeparator":case"dontExpandPowers":case"dontFactorDenominators":case"dontFactorTerms":case"dontConvertDecimalToFraction":case"strict":case"compatibility":case"allowEulersNumber":case"treatLettersAsVariables":t=void 0;break;default:t=!1}return t}}(Model.prototype);var ChemCore=function(){Assert.reserveCodeRange(4e3,4999,"chemcore");var e=Assert.messages,r=Assert.message,n=Assert.assert;e[4001]="No Chem Core spec provided.",e[4002]="No Chem Core solution provided.",e[4003]="No Chem Core spec value provided.",e[4004]="Invalid Chem Core spec method '%1'.",e[4005]="Operation taking more than %1 milliseconds.",e[4006]="Invalid option name '%1'.",e[4007]="Invalid option value '%2' for option '%1'.",e[4008]="Internal error: %1";var t=1e3,a=Math.pow(10,-2),o=Math.pow(10,-3),i=Math.pow(10,-6),s=Math.pow(10,-9),l={g:{type:"unit",value:1,base:"g"},s:{type:"unit",value:1,base:"s"},m:{type:"unit",value:1,base:"m"},L:{type:"unit",value:1,base:"L"},kg:{type:"unit",value:t,base:"g"},km:{type:"unit",value:t,base:"m"},ks:{type:"unit",value:t,base:"s"},kL:{type:"unit",value:t,base:"L"},cg:{type:"unit",value:a,base:"g"},cm:{type:"unit",value:a,base:"m"},cs:{type:"unit",value:a,base:"s"},cL:{type:"unit",value:a,base:"L"},mg:{type:"unit",value:o,base:"g"},mm:{type:"unit",value:o,base:"m"},ms:{type:"unit",value:o,base:"s"},mL:{type:"unit",value:o,base:"L"},"\\mug":{type:"unit",value:i,base:"g"},"\\mus":{type:"unit",value:i,base:"s"},"\\mum":{type:"unit",value:i,base:"m"},"\\muL":{type:"unit",value:i,base:"L"},ng:{type:"unit",value:s,base:"g"},nm:{type:"unit",value:s,base:"m"},ns:{type:"unit",value:s,base:"s"},nL:{type:"unit",value:s,base:"L"},in:{type:"unit",value:1/12,base:"ft"},ft:{type:"unit",value:1,base:"ft"},yd:{type:"unit",value:3,base:"ft"},mi:{type:"unit",value:5280,base:"ft"},fl:{type:"unit",value:1,base:"fl"},cup:{type:"unit",value:8,base:"fl"},pt:{type:"unit",value:16,base:"fl"},qt:{type:"unit",value:32,base:"fl"},gal:{type:"unit",value:128,base:"fl"},oz:{type:"unit",value:1/16,base:"lb"},lb:{type:"unit",value:1,base:"lb"},st:{type:"unit",value:1/1614,base:"lb"},qtr:{type:"unit",value:28,base:"lb"},cwt:{type:"unit",value:112,base:"lb"},$:{type:"unit",value:1,base:"$"},min:{type:"unit",value:60,base:"s"},hr:{type:"unit",value:3600,base:"s"},day:{type:"unit",value:86400,base:"s"},mol:{type:"unit",value:1,base:"mol"},"\\radian":{type:"unit",value:1,base:"\\radian"},"\\degree":{type:"unit",value:Math.PI/180,base:"\\radian"},"\\degree K":{type:"unit",value:1,base:"\\degree K"},"\\degree C":{type:"unit",value:1,base:"\\degree C"},"\\degree F":{type:"unit",value:1,base:"\\degree F"},aq:1,Ac:{name:"Actinium",num:"89",mass:"227"},Al:{name:"Aluminum",num:"13",mass:"26.9815385"},Am:{name:"Americium",num:"95",mass:"243"},Sb:{name:"Antimony",num:"51",mass:"121.760"},Ar:{name:"Argon",num:"18",mass:"39.948"},As:{name:"Arsenic",num:"33",mass:"74.921595"},At:{name:"Astatine",num:"85",mass:"210"},Ba:{name:"Barium",num:"56",mass:"137.327"},Bk:{name:"Berkelium",num:"97",mass:"247"},Be:{name:"Beryllium",num:"4",mass:"9.0121831"},Bi:{name:"Bismuth",num:"83",mass:"208.98040"},Bh:{name:"Bohrium",num:"107",mass:"270"},B:{name:"Boron",num:"5",mass:"10.81"},Br:{name:"Bromine",num:"35",mass:"79.904"},Cd:{name:"Cadmium",num:"48",mass:"112.414"},Ca:{name:"Calcium",num:"20",mass:"40.078"},Cf:{name:"Californium",num:"98",mass:"251"},C:{name:"Carbon",num:"6",mass:"12.011"},Ce:{name:"Cerium",num:"58",mass:"140.116"},Cl:{name:"Chlorine",num:"17",mass:"35.45"},Cr:{name:"Chromium",num:"24",mass:"51.9961"},Co:{name:"Cobalt",num:"27",mass:"58.933194"},Cu:{name:"Copper",num:"29",mass:"63.546"},Cm:{name:"Curium",num:"96",mass:"247"},Ds:{name:"Darmstadtium",num:"110",mass:"281"},Db:{name:"Dubnium",num:"105",mass:"270"},Dy:{name:"Dysprosium",num:"66",mass:"162.500"},Es:{name:"Einsteinium",num:"99",mass:"252"},Er:{name:"Erbium",num:"68",mass:"167.259"},Eu:{name:"Europium",num:"63",mass:"151.964"},Fm:{name:"Fermium",num:"100",mass:"257"},F:{name:"Fluorine",num:"9",mass:"18.998403163"},Fr:{name:"Francium",num:"87",mass:"223"},Gd:{name:"Gadolinium",num:"64",mass:"157.25"},Ga:{name:"Gallium",num:"31",mass:"69.723"},Ge:{name:"Germanium",num:"32",mass:"72.630"},Au:{name:"Gold",num:"79",mass:"196.966569"},Hf:{name:"Hafnium",num:"72",mass:"178.49"},Hs:{name:"Hassium",num:"108",mass:"277"},He:{name:"Helium",num:"2",mass:"4.002602"},Ho:{name:"Holmium",num:"67",mass:"164.93033"},H:{name:"Hydrogen",num:"1",mass:"1.008"},In:{name:"Indium",num:"49",mass:"114.818"},I:{name:"Iodine",num:"53",mass:"126.90447"},Ir:{name:"Iridium",num:"77",mass:"192.217"},Fe:{name:"Iron",num:"26",mass:"55.845"},Kr:{name:"Krypton",num:"36",mass:"83.798"},La:{name:"Lanthanum",num:"57",mass:"138.90547"},Lr:{name:"Lawrencium",num:"103",mass:"262"},Pb:{name:"Lead",num:"82",mass:"207.2"},Li:{name:"Lithium",num:"3",mass:"6.94"},Lv:{name:"Livermoreium",num:"116",mass:"293"},Lu:{name:"Lutetium",num:"71",mass:"174.9668"},Mg:{name:"Magnesium",num:"12",mass:"24.305"},Mn:{name:"Manganese",num:"25",mass:"54.938044"},Mt:{name:"Meitnerium",num:"109",mass:"276"},Md:{name:"Mendelevium",num:"101",mass:"258"},Hg:{name:"Mercury",num:"80",mass:"200.592"},Mo:{name:"Molybdenum",num:"42",mass:"95.95"},Nd:{name:"Neodymium",num:"60",mass:"144.242"},Ne:{name:"Neon",num:"10",mass:"20.1797"},Np:{name:"Neptunium",num:"93",mass:"237"},Ni:{name:"Nickel",num:"28",mass:"58.6934"},Nb:{name:"Niobium",num:"41",mass:"92.90637"},N:{name:"Nitrogen",num:"7",mass:"14.007"},No:{name:"Nobelium",num:"102",mass:"259"},Os:{name:"Osmium",num:"76",mass:"190.23"},O:{name:"Oxygen",num:"8",mass:"15.999"},Pd:{name:"Palladium",num:"46",mass:"106.42"},P:{name:"Phosphorus",num:"15",mass:"30.973761998"},Pt:{name:"Platinum",num:"78",mass:"195.084"},Pu:{name:"Plutonium",num:"94",mass:"244"},Po:{name:"Polonium",num:"84",mass:"209"},K:{name:"Potassium",num:"19",mass:"39.0983"},Pr:{name:"Praseodymium",num:"59",mass:"140.90766"},Pm:{name:"Promethium",num:"61",mass:"145"},Pa:{name:"Protactinium",num:"91",mass:"231.03588"},Ra:{name:"Radium",num:"88",mass:"226"},Rn:{name:"Radon",num:"86",mass:"222"},Re:{name:"Rhenium",num:"75",mass:"186.207"},Rh:{name:"Rhodium",num:"45",mass:"102.90550"},Rb:{name:"Rubidium",num:"37",mass:"85.4678"},Ru:{name:"Ruthenium",num:"44",mass:"101.07"},Rf:{name:"Rutherfordium",num:"104",mass:"267"},Sm:{name:"Samarium",num:"62",mass:"150.36"},Sc:{name:"Scandium",num:"21",mass:"44.955908"},Sg:{name:"Seaborgium",num:"106",mass:"271"},Se:{name:"Selenium",num:"34",mass:"78.971"},Si:{name:"Silicon",num:"14",mass:"28.085"},Ag:{name:"Silver",num:"47",mass:"107.8682"},Na:{name:"Sodium",num:"11",mass:"22.98976928"},Sr:{name:"Strontium",num:"38",mass:"87.62"},S:{name:"Sulfur",num:"16",mass:"32.06"},Ta:{name:"Tantalum",num:"73",mass:"180.94788"},Tc:{name:"Technetium",num:"43",mass:"97"},Te:{name:"Tellurium",num:"52",mass:"127.60"},Tb:{name:"Terbium",num:"65",mass:"158.92535"},Tl:{name:"Thallium",num:"81",mass:"204.38"},Th:{name:"Thorium",num:"90",mass:"232.0377"},Tm:{name:"Thulium",num:"69",mass:"168.93422"},Sn:{name:"Tin",num:"50",mass:"118.710"},Ti:{name:"Titanium",num:"22",mass:"47.867"},W:{name:"Tungsten",num:"74",mass:"183.84"},U:{name:"Uranium",num:"92",mass:"238.02891"},V:{name:"Vanadium",num:"23",mass:"50.9415"},Xe:{name:"Xenon",num:"54",mass:"131.293"},Yb:{name:"Ytterbium",num:"70",mass:"173.054"},Y:{name:"Yttrium",num:"39",mass:"88.90584"},Zn:{name:"Zinc",num:"30",mass:"65.38"},Zr:{name:"Zirconium",num:"40",mass:"91.224"},"\\alpha":{type:"var"},"\\beta":{type:"var"},"\\gamma":{type:"var"},"\\delta":{type:"var"},"\\epsilon":{type:"var"},"\\zeta":{type:"var"},"\\eta":{type:"var"},"\\theta":{type:"var"},"\\iota":{type:"var"},"\\kappa":{type:"var"},"\\lambda":{type:"var"},"\\mu":{type:"const",value:i},"\\nu":{type:"var"},"\\xi":{type:"var"},"\\pi":{type:"const",value:Math.PI},e:{type:"const",value:Math.E},"\\rho":{type:"var"},"\\sigma":{type:"var"},"\\tau":{type:"var"},"\\upsilon":{type:"var"},"\\phi":{type:"var"},"\\chi":{type:"var"},"\\psi":{type:"var"},"\\omega":{type:"var"}};var u=3e4;function validateOptions(e){e&&forEach(keys(e),(function(t){!function validateOption(e,t){switch(e){case"field":switch(t){case void 0:case"integer":case"real":case"complex":break;default:n(!1,r(2011,[e,t]))}break;case"decimalPlaces":if(void 0===t||+t>=0&&+t<=20)break;n(!1,r(2011,[e,t]));break;case"allowDecimal":case"dontExpandPowers":case"dontFactorDenominators":case"dontFactorTerms":case"dontConvertDecimalToFraction":case"dontSimplifyImaginary":case"ignoreOrder":case"inverseResult":case"ignoreText":case"ignoreCoefficientOne":case"keepTextWhitespace":case"strict":if(void 0===t||"boolean"==typeof t)break;n(!1,r(4007,[e,t]));break;default:n(!1,r(4006,[e]))}}(t,e[t])}))}function makeEvaluator(e){var t=e.method,a=e.value,o=Model.options=Object.assign({},e.options);Assert.setLocation("spec"),validateOptions(o),Model.pushEnv(l);var i=null!=a?Model.create(a,"spec"):void 0;i&&(i.env=l),Model.popEnv();var s={evaluate:function evaluate(e){Assert.setLocation("user"),n(null!=e,r(4002)),Model.pushEnv(l);var o,u=Model.create(e,"user");switch(s.model||(u.env=l,s.model=u),Assert.setLocation("spec"),t){case"equivValue":n(null!=a,r(4003)),o=i.equivValue(u);break;case"equivLiteral":n(null!=a,r(4003)),o=i.equivLiteral(u);break;case"equivSyntax":n(null!=a,r(4003)),i instanceof Array||(i=[i]),o=some(i,(function(e){return e.equivSyntax(u)}));break;case"equivSymbolic":n(null!=a,r(4003)),o=i.equivSymbolic(u);break;case"isFactorised":o=u.isFactorised();break;case"isSimplified":o=u.isSimplified();break;case"isExpanded":o=u.isExpanded();break;case"isUnit":o=i.isUnit(u);break;case"isTrue":o=u.isTrue();break;case"validSyntax":o=!0;break;default:n(!1,r(4004,[t]))}return Model.popEnv(),o},model:i};return s}return{evaluate:function evaluate(e,t){try{n(e,r(4001,[e])),n(null!=t,r(4002,[t])),Assert.setTimeout(u,r(4005,[u]));var a=makeEvaluator(e).evaluate(t)}catch(e){trace(e+"\n"+e.stack),a=void 0}return a},evaluateVerbose:function evaluateVerbose(e,t){try{n(null!=e,r(4001,[e])),Assert.setTimeout(u,r(4005,[u]));var a,o,i,s=makeEvaluator(e),l=0,d="Normal completion";a=s.evaluate(t)}catch(e){if(!e.message)try{n(!1,r(4006,[e]))}catch(r){e=r}a=void 0,l=parseErrorCode(e.message),d=function parseMessage(e){if(parseErrorCode(e))return e.slice(indexOf(e,":")+2);return e}(e.message),o=e.stack,i=e.location}return{result:a,errorCode:l,message:d,stack:o,location:i,toString:function(){return this.errorCode+": ("+i+") "+d+"\n"+this.stack}};function parseErrorCode(e){var r=+e.slice(0,indexOf(e,":"));return isNaN(r)?0:r}},makeEvaluator:makeEvaluator,setTimeoutDuration:function setTimeoutDuration(e){u=e}}}();return ChemCore}.call(exports,__webpack_require__,exports,module),void 0===__WEBPACK_AMD_DEFINE_RESULT__||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)}).call(this,__webpack_require__(37))}}]);